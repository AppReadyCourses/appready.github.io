(function(){var innerGlobal="undefined"!=typeof window?window:global,exportTo={};if(function(window,global,module){var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(t){var i=0;return function(){return i<t.length?{done:!1,value:t[i++]}:{done:!0}}},$jscomp.arrayIterator=function(t){return{next:$jscomp.arrayIteratorImpl(t)}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.ISOLATE_POLYFILLS=!1,$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,i,r){return t==Array.prototype||t==Object.prototype||(t[i]=r.value),t},$jscomp.getGlobal=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var i=0;i<t.length;++i){var r=t[i];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")},$jscomp.global=$jscomp.getGlobal(this),$jscomp.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE,$jscomp.polyfills={},$jscomp.propertyToPolyfillSymbol={},$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(t,i){var r=$jscomp.propertyToPolyfillSymbol[i];return null==r?t[i]:void 0!==(r=t[r])?r:t[i]};$jscomp.polyfill=function(t,i,r,o){i&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(t,i,r,o):$jscomp.polyfillUnisolated(t,i,r,o))},$jscomp.polyfillUnisolated=function(t,i,r,o){for(r=$jscomp.global,t=t.split("."),o=0;o<t.length-1;o++){var l=t[o];if(!(l in r))return;r=r[l]}(i=i(o=r[t=t[t.length-1]]))!=o&&null!=i&&$jscomp.defineProperty(r,t,{configurable:!0,writable:!0,value:i})},$jscomp.polyfillIsolated=function(t,i,r,o){var l=t.split(".");o=l[0],o=!(t=1===l.length)&&o in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<l.length-1;g++){var _=l[g];if(!(_ in o))return;o=o[_]}l=l[l.length-1],null!=(i=i(r=$jscomp.IS_SYMBOL_NATIVE&&"es6"===r?o[l]:null))&&(t?$jscomp.defineProperty($jscomp.polyfills,l,{configurable:!0,writable:!0,value:i}):i!==r&&(void 0===$jscomp.propertyToPolyfillSymbol[l]&&(r=1e9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[l]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(l):$jscomp.POLYFILL_PREFIX+r+"$"+l),$jscomp.defineProperty(o,$jscomp.propertyToPolyfillSymbol[l],{configurable:!0,writable:!0,value:i})))},$jscomp.initSymbol=function(){},$jscomp.polyfill("Symbol",function(t){if(t)return t;var i=function(g,_){this.$jscomp$symbol$id_=g,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:_})};i.prototype.toString=function(){return this.$jscomp$symbol$id_};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",o=0,l=function(g){if(this instanceof l)throw new TypeError("Symbol is not a constructor");return new i(r+(g||"")+"_"+o++,g)};return l},"es6","es3"),$jscomp.polyfill("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var i="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<i.length;r++){var o=$jscomp.global[i[r]];"function"==typeof o&&"function"!=typeof o.prototype[t]&&$jscomp.defineProperty(o.prototype,t,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return t},"es6","es3"),$jscomp.iteratorPrototype=function(t){return(t={next:t})[Symbol.iterator]=function(){return this},t},$jscomp.createTemplateTagFirstArg=function(t){return t.raw=t},$jscomp.createTemplateTagFirstArgWithRaw=function(t,i){return t.raw=i,t},$jscomp.makeIterator=function(t){var i="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return i?i.call(t):$jscomp.arrayIterator(t)},$jscomp.arrayFromIterator=function(t){for(var i,r=[];!(i=t.next()).done;)r.push(i.value);return r},$jscomp.arrayFromIterable=function(t){return t instanceof Array?t:$jscomp.arrayFromIterator($jscomp.makeIterator(t))},$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(t){var i=function(){};return i.prototype=t,new i},$jscomp.getConstructImplementation=function(){if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(function(){function r(){}return new r,Reflect.construct(r,[],function(){}),new r instanceof r}())return Reflect.construct;var i=Reflect.construct;return function(r,o,l){return r=i(r,o),l&&Reflect.setPrototypeOf(r,l.prototype),r}}return function(r,o,l){return void 0===l&&(l=r),l=$jscomp.objectCreate(l.prototype||Object.prototype),Function.prototype.apply.call(r,l,o)||l}},$jscomp.construct=$jscomp.getConstructImplementation(),$jscomp.underscoreProtoCanBeSet=function(){var i={};try{return i.__proto__={a:!0},i.a}catch(r){}return!1},$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(t,i){if(t.__proto__=i,t.__proto__!==i)throw new TypeError(t+" is not extensible");return t}:null,$jscomp.inherits=function(t,i){if(t.prototype=$jscomp.objectCreate(i.prototype),t.prototype.constructor=t,$jscomp.setPrototypeOf){var r=$jscomp.setPrototypeOf;r(t,i)}else for(r in i)if("prototype"!=r)if(Object.defineProperties){var o=Object.getOwnPropertyDescriptor(i,r);o&&Object.defineProperty(t,r,o)}else t[r]=i[r];t.superClass_=i.prototype},$jscomp.generator={},$jscomp.generator.ensureIteratorResultIsObject_=function(t){if(!(t instanceof Object))throw new TypeError("Iterator result "+t+" is not an object")},$jscomp.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1},$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},$jscomp.generator.Context.prototype.next_=function(t){this.yieldResult=t},$jscomp.generator.Context.prototype.throw_=function(t){this.abruptCompletion_={exception:t,isException:!0},this.jumpToErrorHandler_()},$jscomp.generator.Context.prototype.return=function(t){this.abruptCompletion_={return:t},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(t){this.abruptCompletion_={jumpTo:t},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.yield=function(t,i){return this.nextAddress=i,{value:t}},$jscomp.generator.Context.prototype.yieldAll=function(t,i){var r=$jscomp.makeIterator(t),o=r.next();if($jscomp.generator.ensureIteratorResultIsObject_(o),!o.done)return this.yieldAllIterator_=r,this.yield(o.value,i);this.yieldResult=o.value,this.nextAddress=i},$jscomp.generator.Context.prototype.jumpTo=function(t){this.nextAddress=t},$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(t,i){this.catchAddress_=t,null!=i&&(this.finallyAddress_=i)},$jscomp.generator.Context.prototype.setFinallyBlock=function(t){this.catchAddress_=0,this.finallyAddress_=t||0},$jscomp.generator.Context.prototype.leaveTryBlock=function(t,i){this.nextAddress=t,this.catchAddress_=i||0},$jscomp.generator.Context.prototype.enterCatchBlock=function(t){return this.catchAddress_=t||0,t=this.abruptCompletion_.exception,this.abruptCompletion_=null,t},$jscomp.generator.Context.prototype.enterFinallyBlock=function(t,i,r){r?this.finallyContexts_[r]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=t||0,this.finallyAddress_=i||0},$jscomp.generator.Context.prototype.leaveFinallyBlock=function(t,i){var r=this.finallyContexts_.splice(i||0)[0];if(r=this.abruptCompletion_=this.abruptCompletion_||r){if(r.isException)return this.jumpToErrorHandler_();null!=r.jumpTo&&this.finallyAddress_<r.jumpTo?(this.nextAddress=r.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=t},$jscomp.generator.Context.prototype.forIn=function(t){return new $jscomp.generator.Context.PropertyIterator(t)},$jscomp.generator.Context.PropertyIterator=function(t){for(var i in this.object_=t,this.properties_=[],t)this.properties_.push(i);this.properties_.reverse()},$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var t=this.properties_.pop();if(t in this.object_)return t}return null},$jscomp.generator.Engine_=function(t){this.context_=new $jscomp.generator.Context,this.program_=t},$jscomp.generator.Engine_.prototype.next_=function(t){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,t,this.context_.next_):(this.context_.next_(t),this.nextStep_())},$jscomp.generator.Engine_.prototype.return_=function(t){this.context_.start_();var i=this.context_.yieldAllIterator_;return i?this.yieldAllStep_("return"in i?i.return:function(r){return{value:r,done:!0}},t,this.context_.return):(this.context_.return(t),this.nextStep_())},$jscomp.generator.Engine_.prototype.throw_=function(t){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,t,this.context_.next_):(this.context_.throw_(t),this.nextStep_())},$jscomp.generator.Engine_.prototype.yieldAllStep_=function(t,i,r){try{var o=t.call(this.context_.yieldAllIterator_,i);if($jscomp.generator.ensureIteratorResultIsObject_(o),!o.done)return this.context_.stop_(),o;var l=o.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}return this.context_.yieldAllIterator_=null,r.call(this.context_,l),this.nextStep_()},$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var t=this.program_(this.context_);if(t)return this.context_.stop_(),{value:t.value,done:!1}}catch(i){this.context_.yieldResult=void 0,this.context_.throw_(i)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(t=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,t.isException)throw t.exception;return{value:t.return,done:!0}}return{value:void 0,done:!0}},$jscomp.generator.Generator_=function(t){this.next=function(i){return t.next_(i)},this.throw=function(i){return t.throw_(i)},this.return=function(i){return t.return_(i)},this[Symbol.iterator]=function(){return this}},$jscomp.generator.createGenerator=function(t,i){var r=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(i));return $jscomp.setPrototypeOf&&t.prototype&&$jscomp.setPrototypeOf(r,t.prototype),r},$jscomp.asyncExecutePromiseGenerator=function(t){function i(o){return t.next(o)}function r(o){return t.throw(o)}return new Promise(function(o,l){!function g(_){_.done?o(_.value):Promise.resolve(_.value).then(i,r).then(g,l)}(t.next())})},$jscomp.asyncExecutePromiseGeneratorFunction=function(t){return $jscomp.asyncExecutePromiseGenerator(t())},$jscomp.asyncExecutePromiseGeneratorProgram=function(t){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(t)))},$jscomp.polyfill("Reflect",function(t){return t||{}},"es6","es3"),$jscomp.polyfill("Reflect.construct",function(t){return $jscomp.construct},"es6","es3"),$jscomp.polyfill("Reflect.setPrototypeOf",function(t){if(t)return t;if($jscomp.setPrototypeOf){var i=$jscomp.setPrototypeOf;return function(r,o){try{return i(r,o),!0}catch(l){return!1}}}return null},"es6","es5"),$jscomp.polyfill("Promise",function(t){function i(){this.batch_=null}function r(_){return _ instanceof l?_:new l(function(v,E){v(_)})}if(t&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&void 0===$jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return t;i.prototype.asyncExecute=function(_){if(null==this.batch_){this.batch_=[];var v=this;this.asyncExecuteFunction(function(){v.executeBatch_()})}this.batch_.push(_)};var o=$jscomp.global.setTimeout;i.prototype.asyncExecuteFunction=function(_){o(_,0)},i.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var _=this.batch_;this.batch_=[];for(var v=0;v<_.length;++v){var E=_[v];_[v]=null;try{E()}catch(P){this.asyncThrow_(P)}}}this.batch_=null},i.prototype.asyncThrow_=function(_){this.asyncExecuteFunction(function(){throw _})};var l=function(_){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[],this.isRejectionHandled_=!1;var v=this.createResolveAndReject_();try{_(v.resolve,v.reject)}catch(E){v.reject(E)}};l.prototype.createResolveAndReject_=function(){function _(P){return function(M){E||(E=!0,P.call(v,M))}}var v=this,E=!1;return{resolve:_(this.resolveTo_),reject:_(this.reject_)}},l.prototype.resolveTo_=function(_){if(_===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(_ instanceof l)this.settleSameAsPromise_(_);else{e:switch(typeof _){case"object":var v=null!=_;break e;case"function":v=!0;break e;default:v=!1}v?this.resolveToNonPromiseObj_(_):this.fulfill_(_)}},l.prototype.resolveToNonPromiseObj_=function(_){var v=void 0;try{v=_.then}catch(E){return void this.reject_(E)}"function"==typeof v?this.settleSameAsThenable_(v,_):this.fulfill_(_)},l.prototype.reject_=function(_){this.settle_(2,_)},l.prototype.fulfill_=function(_){this.settle_(1,_)},l.prototype.settle_=function(_,v){if(0!=this.state_)throw Error("Cannot settle("+_+", "+v+"): Promise already settled in state"+this.state_);this.state_=_,this.result_=v,2===this.state_&&this.scheduleUnhandledRejectionCheck_(),this.executeOnSettledCallbacks_()},l.prototype.scheduleUnhandledRejectionCheck_=function(){var _=this;o(function(){if(_.notifyUnhandledRejection_()){var v=$jscomp.global.console;void 0!==v&&v.error(_.result_)}},1)},l.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var _=$jscomp.global.CustomEvent,v=$jscomp.global.Event,E=$jscomp.global.dispatchEvent;return void 0===E||("function"==typeof _?_=new _("unhandledrejection",{cancelable:!0}):"function"==typeof v?_=new v("unhandledrejection",{cancelable:!0}):(_=$jscomp.global.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,_),_.promise=this,_.reason=this.result_,E(_))},l.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var _=0;_<this.onSettledCallbacks_.length;++_)g.asyncExecute(this.onSettledCallbacks_[_]);this.onSettledCallbacks_=null}};var g=new i;return l.prototype.settleSameAsPromise_=function(_){var v=this.createResolveAndReject_();_.callWhenSettled_(v.resolve,v.reject)},l.prototype.settleSameAsThenable_=function(_,v){var E=this.createResolveAndReject_();try{_.call(v,E.resolve,E.reject)}catch(P){E.reject(P)}},l.prototype.then=function(_,v){function E(U,$){return"function"==typeof U?function(G){try{P(U(G))}catch(z){M(z)}}:$}var P,M,R=new l(function(U,$){P=U,M=$});return this.callWhenSettled_(E(_,P),E(v,M)),R},l.prototype.catch=function(_){return this.then(void 0,_)},l.prototype.callWhenSettled_=function(_,v){function E(){switch(P.state_){case 1:_(P.result_);break;case 2:v(P.result_);break;default:throw Error("Unexpected state: "+P.state_)}}var P=this;null==this.onSettledCallbacks_?g.asyncExecute(E):this.onSettledCallbacks_.push(E),this.isRejectionHandled_=!0},l.resolve=r,l.reject=function(_){return new l(function(v,E){E(_)})},l.race=function(_){return new l(function(v,E){for(var P=$jscomp.makeIterator(_),M=P.next();!M.done;M=P.next())r(M.value).callWhenSettled_(v,E)})},l.all=function(_){var v=$jscomp.makeIterator(_),E=v.next();return E.done?r([]):new l(function(P,M){function R(G){return function(z){U[G]=z,0==--$&&P(U)}}var U=[],$=0;do{U.push(void 0),$++,r(E.value).callWhenSettled_(R(U.length-1),M),E=v.next()}while(!E.done)})},l},"es6","es3"),$jscomp.checkEs6ConformanceViaProxy=function(){try{var t={},i=Object.create(new $jscomp.global.Proxy(t,{get:function(r,o,l){return r==t&&"q"==o&&l==i}}));return!0===i.q}catch(r){return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.owns=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},$jscomp.polyfill("WeakMap",function(t){function r(){}function o(P){var M=typeof P;return"object"===M&&null!==P||"function"===M}function l(P){if(!$jscomp.owns(P,_)){var M=new r;$jscomp.defineProperty(P,_,{value:M})}}function g(P){if(!$jscomp.ISOLATE_POLYFILLS){var M=Object[P];M&&(Object[P]=function(R){return R instanceof r?R:(Object.isExtensible(R)&&l(R),M(R))})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(function(){if(!t||!Object.seal)return!1;try{var P=Object.seal({}),M=Object.seal({}),R=new t([[P,2],[M,3]]);return 2==R.get(P)&&3==R.get(M)&&(R.delete(P),R.set(M,4),!R.has(P)&&4==R.get(M))}catch(U){return!1}}())return t;var _="$jscomp_hidden_"+Math.random();g("freeze"),g("preventExtensions"),g("seal");var v=0,E=function(P){if(this.id_=(v+=Math.random()+1).toString(),P){P=$jscomp.makeIterator(P);for(var M;!(M=P.next()).done;)this.set((M=M.value)[0],M[1])}};return E.prototype.set=function(P,M){if(!o(P))throw Error("Invalid WeakMap key");if(l(P),!$jscomp.owns(P,_))throw Error("WeakMap key fail: "+P);return P[_][this.id_]=M,this},E.prototype.get=function(P){return o(P)&&$jscomp.owns(P,_)?P[_][this.id_]:void 0},E.prototype.has=function(P){return o(P)&&$jscomp.owns(P,_)&&$jscomp.owns(P[_],this.id_)},E.prototype.delete=function(P){return!!(o(P)&&$jscomp.owns(P,_)&&$jscomp.owns(P[_],this.id_))&&delete P[_][this.id_]},E},"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",function(t){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(function(){if($jscomp.ASSUME_NO_NATIVE_MAP||!t||"function"!=typeof t||!t.prototype.entries||"function"!=typeof Object.seal)return!1;try{var E=Object.seal({x:4}),P=new t($jscomp.makeIterator([[E,"s"]]));if("s"!=P.get(E)||1!=P.size||P.get({x:4})||P.set({x:4},"t")!=P||2!=P.size)return!1;var M=P.entries(),R=M.next();return!R.done&&R.value[0]==E&&"s"==R.value[1]&&!((R=M.next()).done||4!=R.value[0].x||"t"!=R.value[1]||!M.next().done)}catch(U){return!1}}())return t;var r=new WeakMap,o=function(E){if(this.data_={},this.head_=_(),this.size=0,E){E=$jscomp.makeIterator(E);for(var P;!(P=E.next()).done;)this.set((P=P.value)[0],P[1])}};o.prototype.set=function(E,P){var M=l(this,E=0===E?0:E);return M.list||(M.list=this.data_[M.id]=[]),M.entry?M.entry.value=P:(M.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:E,value:P},M.list.push(M.entry),this.head_.previous.next=M.entry,this.head_.previous=M.entry,this.size++),this},o.prototype.delete=function(E){return!(!(E=l(this,E)).entry||!E.list||(E.list.splice(E.index,1),E.list.length||delete this.data_[E.id],E.entry.previous.next=E.entry.next,E.entry.next.previous=E.entry.previous,E.entry.head=null,this.size--,0))},o.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=_(),this.size=0},o.prototype.has=function(E){return!!l(this,E).entry},o.prototype.get=function(E){return(E=l(this,E).entry)&&E.value},o.prototype.entries=function(){return g(this,function(E){return[E.key,E.value]})},o.prototype.keys=function(){return g(this,function(E){return E.key})},o.prototype.values=function(){return g(this,function(E){return E.value})},o.prototype.forEach=function(E,P){for(var R,M=this.entries();!(R=M.next()).done;)E.call(P,(R=R.value)[1],R[0],this)},o.prototype[Symbol.iterator]=o.prototype.entries;var l=function(E,P){var M=P&&typeof P;"object"==M||"function"==M?r.has(P)?M=r.get(P):(M=""+ ++v,r.set(P,M)):M="p_"+P;var R=E.data_[M];if(R&&$jscomp.owns(E.data_,M))for(var U=0;U<R.length;U++){var $=R[U];if(P!=P&&$.key!=$.key||P===$.key)return{id:M,list:R,index:U,entry:$}}return{id:M,list:R,index:-1,entry:void 0}},g=function(E,P){var M=E.head_;return $jscomp.iteratorPrototype(function(){if(M){for(;M.head!=E.head_;)M=M.previous;for(;M.next!=M.head;)return{done:!1,value:P(M=M.next)};M=null}return{done:!0,value:void 0}})},_=function(){var E={};return E.previous=E.next=E.head=E},v=0;return o},"es6","es3"),$jscomp.polyfill("Set",function(t){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(function(){if($jscomp.ASSUME_NO_NATIVE_SET||!t||"function"!=typeof t||!t.prototype.entries||"function"!=typeof Object.seal)return!1;try{var o=Object.seal({x:4}),l=new t($jscomp.makeIterator([o]));if(!l.has(o)||1!=l.size||l.add(o)!=l||1!=l.size||l.add({x:4})!=l||2!=l.size)return!1;var g=l.entries(),_=g.next();return!_.done&&_.value[0]==o&&_.value[1]==o&&!(_=g.next()).done&&_.value[0]!=o&&4==_.value[0].x&&_.value[1]==_.value[0]&&g.next().done}catch(v){return!1}}())return t;var r=function(o){if(this.map_=new Map,o){o=$jscomp.makeIterator(o);for(var l;!(l=o.next()).done;)this.add(l.value)}this.size=this.map_.size};return r.prototype.add=function(o){return this.map_.set(o=0===o?0:o,o),this.size=this.map_.size,this},r.prototype.delete=function(o){return o=this.map_.delete(o),this.size=this.map_.size,o},r.prototype.clear=function(){this.map_.clear(),this.size=0},r.prototype.has=function(o){return this.map_.has(o)},r.prototype.entries=function(){return this.map_.entries()},r.prototype.keys=r.prototype.values=function(){return this.map_.values()},r.prototype[Symbol.iterator]=r.prototype.values,r.prototype.forEach=function(o,l){var g=this;this.map_.forEach(function(_){return o.call(l,_,_,g)})},r},"es6","es3"),$jscomp.iteratorFromArray=function(t,i){t instanceof String&&(t+="");var r=0,o=!1,l={next:function(){if(!o&&r<t.length){var g=r++;return{value:i(g,t[g]),done:!1}}return o=!0,{done:!0,value:void 0}}};return l[Symbol.iterator]=function(){return l},l},$jscomp.polyfill("Array.prototype.keys",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(i){return i})}},"es6","es3"),$jscomp.polyfill("Array.from",function(t){return t||function(i,r,o){r=null!=r?r:function(v){return v};var l=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&i[Symbol.iterator];if("function"==typeof g){i=g.call(i);for(var _=0;!(g=i.next()).done;)l.push(r.call(o,g.value,_++))}else for(g=i.length,_=0;_<g;_++)l.push(r.call(o,i[_],_));return l}},"es6","es3"),$jscomp.polyfill("Object.is",function(t){return t||function(i,r){return i===r?0!==i||1/i==1/r:i!=i&&r!=r}},"es6","es3"),$jscomp.polyfill("Array.prototype.includes",function(t){return t||function(i,r){var o=this;o instanceof String&&(o=String(o));var l=o.length,g=r||0;for(0>g&&(g=Math.max(g+l,0));g<l;g++){var _=o[g];if(_===i||Object.is(_,i))return!0}return!1}},"es7","es3"),$jscomp.checkStringArgs=function(t,i,r){if(null==t)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(i instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return t+""},$jscomp.polyfill("String.prototype.includes",function(t){return t||function(i,r){return-1!==$jscomp.checkStringArgs(this,i,"includes").indexOf(i,r||0)}},"es6","es3"),$jscomp.findInternal=function(t,i,r){t instanceof String&&(t=String(t));for(var o=t.length,l=0;l<o;l++){var g=t[l];if(i.call(r,g,l,t))return{i:l,v:g}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.findIndex",function(t){return t||function(i,r){return $jscomp.findInternal(this,i,r).i}},"es6","es3"),$jscomp.polyfill("Array.prototype.values",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(i,r){return r})}},"es8","es3"),$jscomp.polyfill("Array.prototype.find",function(t){return t||function(i,r){return $jscomp.findInternal(this,i,r).v}},"es6","es3"),$jscomp.polyfill("String.prototype.startsWith",function(t){return t||function(i,r){for(var o=$jscomp.checkStringArgs(this,i,"startsWith"),l=o.length,g=(i+="").length,_=Math.max(0,Math.min(0|r,o.length)),v=0;v<g&&_<l;)if(o[_++]!=i[v++])return!1;return v>=g}},"es6","es3"),$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(t,i){for(var r=1;r<arguments.length;r++){var o=arguments[r];if(o)for(var l in o)$jscomp.owns(o,l)&&(t[l]=o[l])}return t},$jscomp.polyfill("Object.assign",function(t){return t||$jscomp.assign},"es6","es3"),$jscomp.polyfill("Promise.prototype.finally",function(t){return t||function(i){return this.then(function(r){return Promise.resolve(i()).then(function(){return r})},function(r){return Promise.resolve(i()).then(function(){throw r})})}},"es9","es3"),$jscomp.polyfill("Array.prototype.entries",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(i,r){return[i,r]})}},"es6","es3"),$jscomp.polyfill("String.prototype.repeat",function(t){return t||function(i){var r=$jscomp.checkStringArgs(this,null,"repeat");if(0>i||1342177279<i)throw new RangeError("Invalid count value");i|=0;for(var o="";i;)1&i&&(o+=r),(i>>>=1)&&(r+=r);return o}},"es6","es3"),$jscomp.polyfill("Object.values",function(t){return t||function(i){var o,r=[];for(o in i)$jscomp.owns(i,o)&&r.push(i[o]);return r}},"es8","es3"),$jscomp.polyfill("Math.log2",function(t){return t||function(i){return Math.log(i)/Math.LN2}},"es6","es3"),$jscomp.polyfill("Object.entries",function(t){return t||function(i){var o,r=[];for(o in i)$jscomp.owns(i,o)&&r.push([o,i[o]]);return r}},"es8","es3");var COMPILED=!0,goog=goog||{};if(goog.global=this||self,goog.exportPath_=function(t,i,r,o){(t=t.split("."))[0]in(o=o||goog.global)||void 0===o.execScript||o.execScript("var "+t[0]);for(var l;t.length&&(l=t.shift());)if(t.length||void 0===i)o=o[l]&&o[l]!==Object.prototype[l]?o[l]:o[l]={};else if(!r&&goog.isObject(i)&&goog.isObject(o[l]))for(var g in i)i.hasOwnProperty(g)&&(o[l][g]=i[g]);else o[l]=i},goog.define=function(t,i){var r=i;if(!COMPILED){var o=goog.global.CLOSURE_UNCOMPILED_DEFINES,l=goog.global.CLOSURE_DEFINES;o&&void 0===o.nodeType&&Object.prototype.hasOwnProperty.call(o,t)?r=o[t]:l&&void 0===l.nodeType&&Object.prototype.hasOwnProperty.call(l,t)&&(r=l[t])}return r},goog.FEATURESET_YEAR=2012,goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(t){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");if(!COMPILED&&goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');goog.constructNamespace_(t)},goog.constructNamespace_=function(t,i,r){if(!COMPILED){delete goog.implicitNamespaces_[t];for(var o=t;(o=o.substring(0,o.lastIndexOf(".")))&&!goog.getObjectByName(o);)goog.implicitNamespaces_[o]=!0}goog.exportPath_(t,i,r)},goog.getScriptNonce=function(t){return t&&t!=goog.global?goog.getScriptNonce_(t.document):(null===goog.cspNonce_&&(goog.cspNonce_=goog.getScriptNonce_(goog.global.document)),goog.cspNonce_)},goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/,goog.cspNonce_=null,goog.getScriptNonce_=function(t){return(t=t.querySelector&&t.querySelector("script[nonce]"))&&(t=t.nonce||t.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(t)?t:""},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(t){if("string"!=typeof t||!t||-1==t.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+t+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=t,!COMPILED){if(goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');delete goog.implicitNamespaces_[t]}},goog.module.get=function(t){return goog.module.getInternal_(t)},goog.module.getInternal_=function(t){if(!COMPILED){if(t in goog.loadedModules_)return goog.loadedModules_[t].exports;if(!goog.implicitNamespaces_[t])return null!=(t=goog.getObjectByName(t))?t:null}return null},goog.ModuleType={ES6:"es6",GOOG:"goog"},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()},goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG},goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var t=goog.global.$jscomp;return!!t&&"function"==typeof t.getCurrentModulePath&&!!t.getCurrentModulePath()},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.declareModuleId=function(t){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw Error("goog.declareModuleId may only be called from within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw Error("goog.declareModuleId may only be called once per module.");if(t in goog.loadedModules_)throw Error('Module with namespace "'+t+'" already exists.')}if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=t;else{var i=goog.global.$jscomp;if(!i||"function"!=typeof i.getCurrentModulePath)throw Error('Module with namespace "'+t+'" has been loaded incorrectly.');i=i.require(i.getCurrentModulePath()),goog.loadedModules_[t]={exports:i,type:goog.ModuleType.ES6,moduleId:t}}},goog.setTestOnly=function(t){if(goog.DISALLOW_TEST_ONLY_CODE)throw t=t||"",Error("Importing test-only code into non-debug environment"+(t?": "+t:"."))},goog.forwardDeclare=function(t){},COMPILED||(goog.isProvided_=function(t){return t in goog.loadedModules_||!goog.implicitNamespaces_[t]&&null!=goog.getObjectByName(t)},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(t,i){for(var r=t.split("."),o=i||goog.global,l=0;l<r.length;l++)if(null==(o=o[r[l]]))return null;return o},goog.addDependency=function(t,i,r,o){!COMPILED&&goog.DEPENDENCIES_ENABLED&&goog.debugLoader_.addDependency(t,i,r,o)},goog.ENABLE_DEBUG_LOADER=!1,goog.logToConsole_=function(t){goog.global.console&&goog.global.console.error(t)},goog.require=function(t){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.debugLoader_.requested(t),goog.isProvided_(t)){if(goog.isInModuleLoader_())return goog.module.getInternal_(t)}else if(goog.ENABLE_DEBUG_LOADER){var i=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(t)}finally{goog.moduleLoaderState_=i}}return null}},goog.requireType=function(t){return{}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(t){t.instance_=void 0,t.getInstance=function(){return t.instance_?t.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=t),t.instance_=new t)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.TRANSPILE="detect",goog.ASSUME_ES_MODULES_TRANSPILED=!1,goog.TRANSPILE_TO_LANGUAGE="",goog.TRANSPILER="transpile.js",goog.TRUSTED_TYPES_POLICY_NAME="goog",goog.hasBadLetScoping=null,goog.loadModule=function(t){var i=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG};var r={},o=r;if("function"==typeof t)o=t.call(void 0,o);else{if("string"!=typeof t)throw Error("Invalid module definition");o=goog.loadModuleFromSource_.call(void 0,o,t)}var l=goog.moduleLoaderState_.moduleName;if("string"!=typeof l||!l)throw Error('Invalid module name "'+l+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(l,o,r!==o):goog.SEAL_MODULE_EXPORTS&&Object.seal&&"object"==typeof o&&null!=o&&Object.seal(o),goog.loadedModules_[l]={exports:o,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName}}finally{goog.moduleLoaderState_=i}},goog.loadModuleFromSource_=function(a,b){return eval(goog.CLOSURE_EVAL_PREFILTER_.createScript(b)),a},goog.normalizePath_=function(t){t=t.split("/");for(var i=0;i<t.length;)"."==t[i]?t.splice(i,1):i&&".."==t[i]&&t[i-1]&&".."!=t[i-1]?t.splice(--i,2):i++;return t.join("/")},goog.loadFileSync_=function(t){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(t);try{var i=new goog.global.XMLHttpRequest;return i.open("get",t,!1),i.send(),0==i.status||200==i.status?i.responseText:null}catch(r){return null}},goog.transpile_=function(t,i,r){var o=goog.global.$jscomp;o||(goog.global.$jscomp=o={});var l=o.transpile;if(!l){var g=goog.basePath+goog.TRANSPILER,_=goog.loadFileSync_(g);if(_){if(function(){(0,eval)(_+"\n//# sourceURL="+g)}.call(goog.global),goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile,l=(o=goog.global.$jscomp).transpile}}return l||(l=o.transpile=function(v,E){return goog.logToConsole_(E+" requires transpilation but no transpiler was found."),v}),l(t,i,r)},goog.typeOf=function(t){var i=typeof t;return"object"!=i?i:t?Array.isArray(t)?"array":i:"null"},goog.isArrayLike=function(t){var i=goog.typeOf(t);return"array"==i||"object"==i&&"number"==typeof t.length},goog.isDateLike=function(t){return goog.isObject(t)&&"function"==typeof t.getFullYear},goog.isObject=function(t){var i=typeof t;return"object"==i&&null!=t||"function"==i},goog.getUid=function(t){return Object.prototype.hasOwnProperty.call(t,goog.UID_PROPERTY_)&&t[goog.UID_PROPERTY_]||(t[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(t){return!!t[goog.UID_PROPERTY_]},goog.removeUid=function(t){null!==t&&"removeAttribute"in t&&t.removeAttribute(goog.UID_PROPERTY_);try{delete t[goog.UID_PROPERTY_]}catch(i){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.cloneObject=function(t){var i=goog.typeOf(t);if("object"==i||"array"==i){if("function"==typeof t.clone)return t.clone();for(var r in i="array"==i?[]:{},t)i[r]=goog.cloneObject(t[r]);return i}return t},goog.bindNative_=function(t,i,r){return t.call.apply(t.bind,arguments)},goog.bindJs_=function(t,i,r){if(!t)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var l=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(l,o),t.apply(i,l)}}return function(){return t.apply(i,arguments)}},goog.bind=function(t,i,r){return goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bindNative_:goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(t,i){var r=Array.prototype.slice.call(arguments,1);return function(){var o=r.slice();return o.push.apply(o,arguments),t.apply(this,o)}},goog.mixin=function(t,i){for(var r in i)t[r]=i[r]},goog.now=function(){return Date.now()},goog.globalEval=function(t){(0,eval)(t)},goog.getCssName=function(t,i){if("."==String(t).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+t);var r=function(l){return goog.cssNameMapping_[l]||l},o=function(l){l=l.split("-");for(var g=[],_=0;_<l.length;_++)g.push(r(l[_]));return g.join("-")};return o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:o:function(l){return l},o=i?t+"-"+o(i):o(t),goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(o):o},goog.setCssNameMapping=function(t,i){goog.cssNameMapping_=t,goog.cssNameMappingStyle_=i},!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(t,i,r){return r&&r.html&&(t=t.replace(/</g,"&lt;")),r&&r.unescapeHtmlEntities&&(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&")),i&&(t=t.replace(/\{\$([^}]+)}/g,function(o,l){return null!=i&&l in i?i[l]:o})),t},goog.getMsgWithFallback=function(t,i){return t},goog.exportSymbol=function(t,i,r){goog.exportPath_(t,i,!0,r)},goog.exportProperty=function(t,i,r){t[i]=r},goog.inherits=function(t,i){function r(){}r.prototype=i.prototype,t.superClass_=i.prototype,t.prototype=new r,t.prototype.constructor=t,t.base=function(o,l,g){for(var _=Array(arguments.length-2),v=2;v<arguments.length;v++)_[v-2]=arguments[v];return i.prototype[l].apply(o,_)}},goog.scope=function(t){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");t.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(t,i){var r=i.constructor,o=i.statics;return r&&r!=Object.prototype.constructor||(r=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),r=goog.defineClass.createSealingConstructor_(r,t),t&&goog.inherits(r,t),delete i.constructor,delete i.statics,goog.defineClass.applyProperties_(r.prototype,i),null!=o&&(o instanceof Function?o(r):goog.defineClass.applyProperties_(r,o)),r},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(t,i){return goog.defineClass.SEAL_CLASS_INSTANCES?function(){var r=t.apply(this,arguments)||this;return r[goog.UID_PROPERTY_]=r[goog.UID_PROPERTY_],r}:t},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);for(var o=0;o<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;o++)r=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[o],Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},goog.identity_=function(t){return t},goog.createTrustedTypesPolicy=function(t){var i=null,r=goog.global.trustedTypes;if(!r||!r.createPolicy)return i;try{i=r.createPolicy(t,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_})}catch(o){goog.logToConsole_(o.message)}return i},!COMPILED&&goog.DEPENDENCIES_ENABLED&&(goog.isEdge_=function(){return!!(goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"").match(/Edge\/(\d+)(\.\d)*/i)},goog.inHtmlDocument_=function(){var t=goog.global.document;return null!=t&&"write"in t},goog.isDocumentLoading_=function(){var t=goog.global.document;return t.attachEvent?"complete"!=t.readyState:"loading"==t.readyState},goog.findBasePath_=function(){if(null!=goog.global.CLOSURE_BASE_PATH&&"string"==typeof goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var t=goog.global.document,i=t.currentScript;for(i=(t=i?[i]:t.getElementsByTagName("SCRIPT")).length-1;0<=i;--i){var r=t[i].src,o=r.lastIndexOf("?");if("base.js"==r.substr((o=-1==o?r.length:o)-7,7)){goog.basePath=r.substr(0,o-7);break}}}},goog.findBasePath_(),goog.Transpiler=function(){this.requiresTranspilation_=null,this.transpilationTarget_=goog.TRANSPILE_TO_LANGUAGE},goog.Transpiler.prototype.createRequiresTranspilation_=function(){function a(t,i){e?d[t]=!0:i()?(c=t,d[t]=!1):e=d[t]=!0}function b(f){try{return!!eval(goog.CLOSURE_EVAL_PREFILTER_.createScript(f))}catch(t){return!1}}var c="es3",d={es3:!1},e=!1;return a("es5",function(){return b("[1,].length==1")}),a("es6",function(){return!goog.isEdge_()&&b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')}),a("es7",function(){return b("2**3==8")}),a("es8",function(){return b("async()=>1,1")}),a("es9",function(){return b("({...rest}={}),1")}),a("es_2019",function(){return b('let r;try{throw 0}catch{r="\u2029"};r')}),a("es_2020",function(){return b("null?.x??1")}),a("es_next",function(){return!1}),{target:c,map:d}},goog.Transpiler.prototype.needsTranspile=function(t,i){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;if(!this.requiresTranspilation_){var r=this.createRequiresTranspilation_();this.requiresTranspilation_=r.map,this.transpilationTarget_=this.transpilationTarget_||r.target}if(t in this.requiresTranspilation_)return!!this.requiresTranspilation_[t]||!(!goog.inHtmlDocument_()||"es6"!=i||"noModule"in goog.global.document.createElement("script"));throw Error("Unknown language mode: "+t)},goog.Transpiler.prototype.transpile=function(t,i){return goog.transpile_(t,i,this.transpilationTarget_)},goog.transpiler_=new goog.Transpiler,goog.protectScriptTag_=function(t){return t.replace(/<\/(SCRIPT)/gi,"\\x3c/$1")},goog.DebugLoader_=function(){this.dependencies_={},this.idToPath_={},this.written_={},this.loadingDeps_=[],this.depsToLoad_=[],this.paused_=!1,this.factory_=new goog.DependencyFactory(goog.transpiler_),this.deferredCallbacks_={},this.deferredQueue_=[]},goog.DebugLoader_.prototype.bootstrap=function(t,i){function r(){o&&(goog.global.setTimeout(o,0),o=null)}var o=i;if(t.length){for(var l=[],g=0;g<t.length;g++){var _=this.getPathFromDeps_(t[g]);if(!_)throw Error("Unregonized namespace: "+t[g]);l.push(this.dependencies_[_])}_=goog.require;var v=0;for(g=0;g<t.length;g++)_(t[g]),l[g].onLoad(function(){++v==t.length&&r()})}else r()},goog.DebugLoader_.prototype.loadClosureDeps=function(){this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+"deps.js"),"deps.js",[],[],{},!1)),this.loadDeps_()},goog.DebugLoader_.prototype.requested=function(t,i){var r=this.getPathFromDeps_(t);if(r&&(i||this.areDepsLoaded_(this.dependencies_[r].requires))){var o=this.deferredCallbacks_[r];o&&(delete this.deferredCallbacks_[r],o())}},goog.DebugLoader_.prototype.setDependencyFactory=function(t){this.factory_=t},goog.DebugLoader_.prototype.load_=function(t){if(this.getPathFromDeps_(t)){var i=this,r=[],o=function(l){var g=i.getPathFromDeps_(l);if(!g)throw Error("Bad dependency path or symbol: "+l);if(!i.written_[g]){for(i.written_[g]=!0,l=i.dependencies_[g],g=0;g<l.requires.length;g++)goog.isProvided_(l.requires[g])||o(l.requires[g]);r.push(l)}};o(t),t=!!this.depsToLoad_.length,this.depsToLoad_=this.depsToLoad_.concat(r),this.paused_||t||this.loadDeps_()}else goog.logToConsole_("goog.require could not find: "+t)},goog.DebugLoader_.prototype.loadDeps_=function(){for(var t=this,i=this.paused_;this.depsToLoad_.length&&!i;)!function(){var r=!1,o=t.depsToLoad_.shift(),l=!1;t.loading_(o);var g={pause:function(){if(r)throw Error("Cannot call pause after the call to load.");i=!0},resume:function(){r?t.resume_():i=!1},loaded:function(){if(l)throw Error("Double call to loaded.");l=!0,t.loaded_(o)},pending:function(){for(var _=[],v=0;v<t.loadingDeps_.length;v++)_.push(t.loadingDeps_[v]);return _},setModuleState:function(_){goog.moduleLoaderState_={type:_,moduleName:"",declareLegacyNamespace:!1}},registerEs6ModuleExports:function(_,v,E){E&&(goog.loadedModules_[E]={exports:v,type:goog.ModuleType.ES6,moduleId:E||""})},registerGoogModuleExports:function(_,v){goog.loadedModules_[_]={exports:v,type:goog.ModuleType.GOOG,moduleId:_}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(_){if(r)throw Error("Cannot register with defer after the call to load.");t.defer_(o,_)},areDepsLoaded:function(){return t.areDepsLoaded_(o.requires)}};try{o.load(g)}finally{r=!0}}();i&&this.pause_()},goog.DebugLoader_.prototype.pause_=function(){this.paused_=!0},goog.DebugLoader_.prototype.resume_=function(){this.paused_&&(this.paused_=!1,this.loadDeps_())},goog.DebugLoader_.prototype.loading_=function(t){this.loadingDeps_.push(t)},goog.DebugLoader_.prototype.loaded_=function(t){for(var i=0;i<this.loadingDeps_.length;i++)if(this.loadingDeps_[i]==t){this.loadingDeps_.splice(i,1);break}for(i=0;i<this.deferredQueue_.length;i++)if(this.deferredQueue_[i]==t.path){this.deferredQueue_.splice(i,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)for(;this.deferredQueue_.length;)this.requested(this.deferredQueue_.shift(),!0);t.loaded()},goog.DebugLoader_.prototype.areDepsLoaded_=function(t){for(var i=0;i<t.length;i++){var r=this.getPathFromDeps_(t[i]);if(!r||!(r in this.deferredCallbacks_)&&!goog.isProvided_(t[i]))return!1}return!0},goog.DebugLoader_.prototype.getPathFromDeps_=function(t){return t in this.idToPath_?this.idToPath_[t]:t in this.dependencies_?t:null},goog.DebugLoader_.prototype.defer_=function(t,i){this.deferredCallbacks_[t.path]=i,this.deferredQueue_.push(t.path)},goog.LoadController=function(){},goog.LoadController.prototype.pause=function(){},goog.LoadController.prototype.resume=function(){},goog.LoadController.prototype.loaded=function(){},goog.LoadController.prototype.pending=function(){},goog.LoadController.prototype.registerEs6ModuleExports=function(t,i,r){},goog.LoadController.prototype.setModuleState=function(t){},goog.LoadController.prototype.clearModuleState=function(){},goog.LoadController.prototype.defer=function(t){},goog.LoadController.prototype.areDepsLoaded=function(){},goog.Dependency=function(t,i,r,o,l){this.path=t,this.relativePath=i,this.provides=r,this.requires=o,this.loadFlags=l,this.loaded_=!1,this.loadCallbacks_=[]},goog.Dependency.prototype.getPathName=function(){var t=this.path,i=t.indexOf("://");return 0<=i&&0<=(i=(t=t.substring(i+3)).indexOf("/"))&&(t=t.substring(i+1)),t},goog.Dependency.prototype.onLoad=function(t){this.loaded_?t():this.loadCallbacks_.push(t)},goog.Dependency.prototype.loaded=function(){this.loaded_=!0;var t=this.loadCallbacks_;this.loadCallbacks_=[];for(var i=0;i<t.length;i++)t[i]()},goog.Dependency.defer_=!1,goog.Dependency.callbackMap_={},goog.Dependency.registerCallback_=function(t){var i=Math.random().toString(32);return goog.Dependency.callbackMap_[i]=t,i},goog.Dependency.unregisterCallback_=function(t){delete goog.Dependency.callbackMap_[t]},goog.Dependency.callback_=function(t,i){if(!(t in goog.Dependency.callbackMap_))throw Error("Callback key "+t+" does not exist (was base.js loaded more than once?).");for(var r=goog.Dependency.callbackMap_[t],o=[],l=1;l<arguments.length;l++)o.push(arguments[l]);r.apply(void 0,o)},goog.Dependency.prototype.load=function(t){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?t.loaded():t.pause();else if(goog.inHtmlDocument_()){var i=goog.global.document;if("complete"==i.readyState&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){if(/\bdeps.js$/.test(this.path))return void t.loaded();throw Error('Cannot write "'+this.path+'" after document load')}var r=goog.getScriptNonce();if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var o=function(v){v.readyState&&"complete"!=v.readyState?v.onload=o:(goog.Dependency.unregisterCallback_(l),t.loaded())},l=goog.Dependency.registerCallback_(o),g='<script src="'+this.path+'"'+(r=r?' nonce="'+r+'"':"")+(goog.Dependency.defer_?" defer":"")+' id="script-'+l+'"><\/script>';g+="<script"+r+">",g=goog.Dependency.defer_?g+"document.getElementById('script-"+l+"').onload = function() {\n  goog.Dependency.callback_('"+l+"', this);\n};\n":g+"goog.Dependency.callback_('"+l+"', document.getElementById('script-"+l+"'));",g+="<\/script>",i.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(g):g)}else{var _=i.createElement("script");_.defer=goog.Dependency.defer_,_.async=!1,r&&(_.nonce=r),goog.DebugLoader_.IS_OLD_IE_?(t.pause(),_.onreadystatechange=function(){("loaded"==_.readyState||"complete"==_.readyState)&&(t.loaded(),t.resume())}):_.onload=function(){_.onload=null,t.loaded()},_.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path,i.head.appendChild(_)}}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),"deps.js"==this.relativePath?(goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, or setting CLOSURE_NO_DEPS to true."),t.loaded()):t.pause()},goog.Es6ModuleDependency=function(t,i,r,o,l){goog.Dependency.call(this,t,i,r,o,l)},goog.inherits(goog.Es6ModuleDependency,goog.Dependency),goog.Es6ModuleDependency.prototype.load=function(t){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?t.loaded():t.pause();else if(goog.inHtmlDocument_()){var o=goog.global.document,l=this;if(goog.isDocumentLoading_()){var g=function(P,M){var R="",U=goog.getScriptNonce();U&&(R=' nonce="'+U+'"'),R=M?'<script type="module" crossorigin'+R+">"+M+"<\/script>":'<script type="module" crossorigin src="'+P+'"'+R+"><\/script>",o.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(R):R)};goog.Dependency.defer_=!0}else g=function(P,M){var R=o.createElement("script");R.defer=!0,R.async=!1,R.type="module",R.setAttribute("crossorigin",!0);var U=goog.getScriptNonce();U&&(R.nonce=U),M?R.text=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(M):M:R.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(P):P,o.head.appendChild(R)};var _=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(_),t.setModuleState(goog.ModuleType.ES6)});g(void 0,'goog.Dependency.callback_("'+_+'")'),g(this.path,void 0);var v=goog.Dependency.registerCallback_(function(P){goog.Dependency.unregisterCallback_(v),t.registerEs6ModuleExports(l.path,P,goog.moduleLoaderState_.moduleName)});g(void 0,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+v+'", m)');var E=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(E),t.clearModuleState(),t.loaded()});g(void 0,'goog.Dependency.callback_("'+E+'")')}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),t.pause()},goog.TransformedDependency=function(t,i,r,o,l){goog.Dependency.call(this,t,i,r,o,l),this.contents_=null,this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))},goog.inherits(goog.TransformedDependency,goog.Dependency),goog.TransformedDependency.prototype.load=function(t){function i(){l.contents_=goog.loadFileSync_(l.path),l.contents_&&(l.contents_=l.transform(l.contents_),l.contents_&&(l.contents_+="\n//# sourceURL="+l.path))}function r(){if(l.lazyFetch_&&i(),l.contents_){g&&t.setModuleState(goog.ModuleType.ES6);try{var M=l.contents_;if(l.contents_=null,goog.globalEval(goog.CLOSURE_EVAL_PREFILTER_.createScript(M)),g)var R=goog.moduleLoaderState_.moduleName}finally{g&&t.clearModuleState()}g&&goog.global.$jscomp.require.ensure([l.getPathName()],function(){t.registerEs6ModuleExports(l.path,goog.global.$jscomp.require(l.getPathName()),R)}),t.loaded()}}var M,R,U,l=this;if(goog.global.CLOSURE_IMPORT_SCRIPT)i(),this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)?(this.contents_=null,t.loaded()):t.pause();else{var g=this.loadFlags.module==goog.ModuleType.ES6;this.lazyFetch_||i();var _=1<t.pending().length,v=_&&goog.DebugLoader_.IS_OLD_IE_;if(_=goog.Dependency.defer_&&(_||goog.isDocumentLoading_()),v||_)t.defer(function(){r()});else{var E=goog.global.document;if(v=goog.inHtmlDocument_()&&("ActiveXObject"in goog.global||goog.isEdge_()),g&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!v){goog.Dependency.defer_=!0,t.pause();var P=E.onreadystatechange;E.onreadystatechange=function(){"interactive"==E.readyState&&(E.onreadystatechange=P,r(),t.resume()),"function"==typeof P&&P.apply(void 0,arguments)}}else!goog.DebugLoader_.IS_OLD_IE_&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()?(M=goog.global.document,R=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(R),r()}),U="<script"+((U=goog.getScriptNonce())?' nonce="'+U+'"':"")+">"+goog.protectScriptTag_('goog.Dependency.callback_("'+R+'");')+"<\/script>",M.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(U):U)):r()}}},goog.TransformedDependency.prototype.transform=function(t){},goog.TranspiledDependency=function(t,i,r,o,l,g){goog.TransformedDependency.call(this,t,i,r,o,l),this.transpiler=g},goog.inherits(goog.TranspiledDependency,goog.TransformedDependency),goog.TranspiledDependency.prototype.transform=function(t){return this.transpiler.transpile(t,this.getPathName())},goog.PreTranspiledEs6ModuleDependency=function(t,i,r,o,l){goog.TransformedDependency.call(this,t,i,r,o,l)},goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency),goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(t){return t},goog.GoogModuleDependency=function(t,i,r,o,l,g,_){goog.TransformedDependency.call(this,t,i,r,o,l),this.needsTranspile_=g,this.transpiler_=_},goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency),goog.GoogModuleDependency.prototype.transform=function(t){return this.needsTranspile_&&(t=this.transpiler_.transpile(t,this.getPathName())),goog.LOAD_MODULE_USING_EVAL&&void 0!==goog.global.JSON?"goog.loadModule("+goog.global.JSON.stringify(t+"\n//# sourceURL="+this.path+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+t+"\n;return exports});\n//# sourceURL="+this.path+"\n"},goog.DebugLoader_.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.DebugLoader_.prototype.addDependency=function(t,i,r,o){i=i||[],t=t.replace(/\\/g,"/");var l=goog.normalizePath_(goog.basePath+t);for(o&&"boolean"!=typeof o||(o=o?{module:goog.ModuleType.GOOG}:{}),r=this.factory_.createDependency(l,t,i,r,o,goog.transpiler_.needsTranspile(o.lang||"es3",o.module)),this.dependencies_[l]=r,r=0;r<i.length;r++)this.idToPath_[i[r]]=l;this.idToPath_[t]=l},goog.DependencyFactory=function(t){this.transpiler=t},goog.DependencyFactory.prototype.createDependency=function(t,i,r,o,l,g){return l.module==goog.ModuleType.GOOG?new goog.GoogModuleDependency(t,i,r,o,l,g,this.transpiler):g?new goog.TranspiledDependency(t,i,r,o,l,this.transpiler):l.module==goog.ModuleType.ES6?"never"==goog.TRANSPILE&&goog.ASSUME_ES_MODULES_TRANSPILED?new goog.PreTranspiledEs6ModuleDependency(t,i,r,o,l):new goog.Es6ModuleDependency(t,i,r,o,l):new goog.Dependency(t,i,r,o,l)},goog.debugLoader_=new goog.DebugLoader_,goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()},goog.setDependencyFactory=function(t){goog.debugLoader_.setDependencyFactory(t)},goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null,goog.global.CLOSURE_NO_DEPS||goog.debugLoader_.loadClosureDeps(),goog.bootstrap=function(t,i){goog.debugLoader_.bootstrap(t,i)}),!COMPILED){var isChrome87=!1;try{isChrome87=eval(goog.global.trustedTypes.emptyScript)!==goog.global.trustedTypes.emptyScript}catch(t){}goog.CLOSURE_EVAL_PREFILTER_=goog.global.trustedTypes&&isChrome87&&goog.createTrustedTypesPolicy("goog#base#devonly#eval")||{createScript:goog.identity_}}var shaka={util:{}};if(shaka.util.FakeEvent=function(t,i){for(var r in i=void 0===i?{}:i)Object.defineProperty(this,r,{value:i[r],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.stopped=!1},shaka.util.FakeEvent.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},shaka.util.FakeEvent.prototype.stopImmediatePropagation=function(){this.stopped=!0},shaka.util.FakeEvent.prototype.stopPropagation=function(){},goog.exportSymbol("shaka.util.FakeEvent",shaka.util.FakeEvent),goog.asserts=function(){},goog.asserts.assert=function(t,i){},goog.asserts.ENABLE_ASSERTS=!0,goog.asserts.ENABLE_ASSERTS&&console.assert&&console.assert.bind&&(goog.asserts.assert=console.assert.bind(console)),shaka.log=function(){},shaka.log.alwaysError=function(t){},shaka.log.alwaysWarn=function(t){},shaka.log.warnOnce=function(t,i){for(var r=[],o=1;o<arguments.length;++o)r[o-1]=arguments[o];shaka.log.oneTimeWarningIssued_.has(t)||(shaka.log.oneTimeWarningIssued_.add(t),shaka.log.alwaysWarn.apply(shaka.log,$jscomp.arrayFromIterable(r)))},shaka.log.error=function(t){},shaka.log.warning=function(t){},shaka.log.info=function(t){},shaka.log.debug=function(t){},shaka.log.v1=function(t){},shaka.log.v2=function(t){},shaka.log.Level={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,V1:5,V2:6},shaka.log.MAX_LOG_LEVEL=4,shaka.log.oneTimeWarningIssued_=new Set,window.console&&window.console.log.bind){var $jscomp$compprop0={};shaka.log.logMap_=($jscomp$compprop0[shaka.log.Level.ERROR]=console.error.bind(console),$jscomp$compprop0[shaka.log.Level.WARNING]=console.warn.bind(console),$jscomp$compprop0[shaka.log.Level.INFO]=console.info.bind(console),$jscomp$compprop0[shaka.log.Level.DEBUG]=console.log.bind(console),$jscomp$compprop0[shaka.log.Level.V1]=console.debug.bind(console),$jscomp$compprop0[shaka.log.Level.V2]=console.debug.bind(console),$jscomp$compprop0),shaka.log.alwaysWarn=shaka.log.logMap_[shaka.log.Level.WARNING],shaka.log.alwaysError=shaka.log.logMap_[shaka.log.Level.ERROR],goog.DEBUG?(goog.exportSymbol("shaka.log",shaka.log),shaka.log.setLevel=function(t){var i=function(r){return r<=t?(goog.asserts.assert(shaka.log.logMap_[r],"Unexpected log level"),shaka.log.logMap_[r]):function(){}};shaka.log.currentLevel=t,shaka.log.error=i(shaka.log.Level.ERROR),shaka.log.warning=i(shaka.log.Level.WARNING),shaka.log.info=i(shaka.log.Level.INFO),shaka.log.debug=i(shaka.log.Level.DEBUG),shaka.log.v1=i(shaka.log.Level.V1),shaka.log.v2=i(shaka.log.Level.V2)},shaka.log.setLevel(shaka.log.MAX_LOG_LEVEL)):(shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.ERROR&&(shaka.log.error=shaka.log.logMap_[shaka.log.Level.ERROR]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.WARNING&&(shaka.log.warning=shaka.log.logMap_[shaka.log.Level.WARNING]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.INFO&&(shaka.log.info=shaka.log.logMap_[shaka.log.Level.INFO]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.DEBUG&&(shaka.log.debug=shaka.log.logMap_[shaka.log.Level.DEBUG]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V1&&(shaka.log.v1=shaka.log.logMap_[shaka.log.Level.V1]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V2&&(shaka.log.v2=shaka.log.logMap_[shaka.log.Level.V2]))}shaka.util.MultiMap=function(){this.map_={}},shaka.util.MultiMap.prototype.push=function(t,i){this.map_.hasOwnProperty(t)?this.map_[t].push(i):this.map_[t]=[i]},shaka.util.MultiMap.prototype.get=function(t){return(t=this.map_[t])?t.slice():null},shaka.util.MultiMap.prototype.getAll=function(){var i,t=[];for(i in this.map_)t.push.apply(t,$jscomp.arrayFromIterable(this.map_[i]));return t},shaka.util.MultiMap.prototype.remove=function(t,i){t in this.map_&&(this.map_[t]=this.map_[t].filter(function(r){return r!=i}),0==this.map_[t].length&&delete this.map_[t])},shaka.util.MultiMap.prototype.clear=function(){this.map_={}},shaka.util.MultiMap.prototype.forEach=function(t){for(var i in this.map_)t(i,this.map_[i])},shaka.util.MultiMap.prototype.size=function(){return Object.keys(this.map_).length},shaka.util.MultiMap.prototype.keys=function(){return Object.keys(this.map_)},shaka.util.FakeEventTarget=function(){this.listeners_=new shaka.util.MultiMap,this.dispatchTarget=this},shaka.util.FakeEventTarget.prototype.addEventListener=function(t,i,r){this.listeners_.push(t,i)},shaka.util.FakeEventTarget.prototype.listenToAllEvents=function(t){this.addEventListener(shaka.util.FakeEventTarget.ALL_EVENTS_,t)},shaka.util.FakeEventTarget.prototype.removeEventListener=function(t,i,r){this.listeners_.remove(t,i)},shaka.util.FakeEventTarget.prototype.dispatchEvent=function(t){goog.asserts.assert(t instanceof shaka.util.FakeEvent,"FakeEventTarget can only dispatch FakeEvents!");var i=this.listeners_.get(t.type)||[],r=this.listeners_.get(shaka.util.FakeEventTarget.ALL_EVENTS_);for(r&&(i=i.concat(r)),r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next()){r=r.value,t.target=this.dispatchTarget,t.currentTarget=this.dispatchTarget;try{r.handleEvent?r.handleEvent(t):r.call(this,t)}catch(o){shaka.log.error("Uncaught exception in event handler",o,o?o.message:null,o?o.stack:null)}if(t.stopped)break}return t.defaultPrevented},shaka.util.FakeEventTarget.ALL_EVENTS_="All",shaka.util.Iterables=function(){},shaka.util.Iterables.map=function(t,i){for(var r=[],o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())r.push(i(l.value));return r},shaka.util.Iterables.every=function(t,i){for(var r=$jscomp.makeIterator(t),o=r.next();!o.done;o=r.next())if(!i(o.value))return!1;return!0},shaka.util.Iterables.some=function(t,i){for(var r=$jscomp.makeIterator(t),o=r.next();!o.done;o=r.next())if(i(o.value))return!0;return!1},shaka.util.Iterables.filter=function(t,i){for(var r=[],o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())i(l=l.value)&&r.push(l);return r},shaka.util.Iterables.range=function t(i){var r;return $jscomp.generator.createGenerator(t,function(o){return 1==o.nextAddress&&(r=0),3!=o.nextAddress?r<i?o.yield(r,3):o.jumpTo(0):(r++,o.jumpTo(2))})},shaka.util.Iterables.enumerate=function t(i){var r,o,l,g,_,v;return $jscomp.generator.createGenerator(t,function(E){return 1==E.nextAddress&&(r=-1,l=o=void 0,g=$jscomp.makeIterator(i),_=g.next()),5!=E.nextAddress?_.done?-1==r?E.jumpTo(0):E.yield({i:r,prev:o,item:l,next:void 0},0):(v=_.value,0<=r?E.yield({i:r,item:l,prev:o,next:v},5):E.jumpTo(5)):(r++,o=l,l=v,_=g.next(),E.jumpTo(2))})},goog.uri={},goog.uri.utils={},goog.uri.utils.splitRe_=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},goog.uri.utils.split=function(t){return t.match(goog.uri.utils.splitRe_)},goog.Uri=function(t){var i;t instanceof goog.Uri?(this.setScheme(t.getScheme()),this.setUserInfo(t.getUserInfo()),this.setDomain(t.getDomain()),this.setPort(t.getPort()),this.setPath(t.getPath()),this.setQueryData(t.getQueryData().clone()),this.setFragment(t.getFragment())):t&&(i=goog.uri.utils.split(String(t)))?(this.setScheme(i[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(i[goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(i[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(i[goog.uri.utils.ComponentIndex.PORT]),this.setPath(i[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(i[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(i[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):this.queryData_=new goog.Uri.QueryData(null,null)},goog.Uri.prototype.scheme_="",goog.Uri.prototype.userInfo_="",goog.Uri.prototype.domain_="",goog.Uri.prototype.port_=null,goog.Uri.prototype.path_="",goog.Uri.prototype.fragment_="",goog.Uri.prototype.toString=function(){var t=[],i=this.getScheme();if(i&&t.push(goog.Uri.encodeSpecialChars_(i,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":"),i=this.getDomain()){t.push("//");var r=this.getUserInfo();r&&t.push(goog.Uri.encodeSpecialChars_(r,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),t.push(goog.Uri.removeDoubleEncoding_(encodeURIComponent(i))),null!=(i=this.getPort())&&t.push(":",String(i))}return(i=this.getPath())&&(this.hasDomain()&&"/"!=i.charAt(0)&&t.push("/"),t.push(goog.Uri.encodeSpecialChars_(i,"/"==i.charAt(0)?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,!0))),(i=this.getEncodedQuery())&&t.push("?",i),(i=this.getFragment())&&t.push("#",goog.Uri.encodeSpecialChars_(i,goog.Uri.reDisallowedInFragment_)),t.join("")},goog.Uri.prototype.resolve=function(t){var i=this.clone();"data"===i.scheme_&&(i=new goog.Uri);var r=t.hasScheme();r?i.setScheme(t.getScheme()):r=t.hasUserInfo(),r?i.setUserInfo(t.getUserInfo()):r=t.hasDomain(),r?i.setDomain(t.getDomain()):r=t.hasPort();var o=t.getPath();if(r)i.setPort(t.getPort());else if(r=t.hasPath()){if("/"!=o.charAt(0))if(this.hasDomain()&&!this.hasPath())o="/"+o;else{var l=i.getPath().lastIndexOf("/");-1!=l&&(o=i.getPath().substr(0,l+1)+o)}o=goog.Uri.removeDotSegments(o)}return r?i.setPath(o):r=t.hasQuery(),r?i.setQueryData(t.getQueryData().clone()):r=t.hasFragment(),r&&i.setFragment(t.getFragment()),i},goog.Uri.prototype.clone=function(){return new goog.Uri(this)},goog.Uri.prototype.getScheme=function(){return this.scheme_},goog.Uri.prototype.setScheme=function(t,i){return(this.scheme_=i?goog.Uri.decodeOrEmpty_(t,!0):t)&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},goog.Uri.prototype.setUserInfo=function(t,i){return this.userInfo_=i?goog.Uri.decodeOrEmpty_(t):t,this},goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},goog.Uri.prototype.getDomain=function(){return this.domain_},goog.Uri.prototype.setDomain=function(t,i){return this.domain_=i?goog.Uri.decodeOrEmpty_(t,!0):t,this},goog.Uri.prototype.hasDomain=function(){return!!this.domain_},goog.Uri.prototype.getPort=function(){return this.port_},goog.Uri.prototype.setPort=function(t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);this.port_=t}else this.port_=null;return this},goog.Uri.prototype.hasPort=function(){return null!=this.port_},goog.Uri.prototype.getPath=function(){return this.path_},goog.Uri.prototype.setPath=function(t,i){return this.path_=i?goog.Uri.decodeOrEmpty_(t,!0):t,this},goog.Uri.prototype.hasPath=function(){return!!this.path_},goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},goog.Uri.prototype.setQueryData=function(t,i){return t instanceof goog.Uri.QueryData?this.queryData_=t:(i||(t=goog.Uri.encodeSpecialChars_(t,goog.Uri.reDisallowedInQuery_)),this.queryData_=new goog.Uri.QueryData(t,null)),this},goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},goog.Uri.prototype.getQueryData=function(){return this.queryData_},goog.Uri.prototype.getFragment=function(){return this.fragment_},goog.Uri.prototype.setFragment=function(t,i){return this.fragment_=i?goog.Uri.decodeOrEmpty_(t):t,this},goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},goog.Uri.removeDotSegments=function(t){if(".."==t||"."==t)return"";if(-1==t.indexOf("./")&&-1==t.indexOf("/."))return t;var i=0==t.lastIndexOf("/",0);t=t.split("/");for(var r=[],o=0;o<t.length;){var l=t[o++];"."==l?i&&o==t.length&&r.push(""):".."==l?((1<r.length||1==r.length&&""!=r[0])&&r.pop(),i&&o==t.length&&r.push("")):(r.push(l),i=!0)}return r.join("/")},goog.Uri.decodeOrEmpty_=function(t,i){return t?i?decodeURI(t):decodeURIComponent(t):""},goog.Uri.encodeSpecialChars_=function(t,i,r){return null!=t?(t=encodeURI(t).replace(i,goog.Uri.encodeChar_),r&&(t=goog.Uri.removeDoubleEncoding_(t)),t):null},goog.Uri.encodeChar_=function(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)},goog.Uri.removeDoubleEncoding_=function(t){return t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,goog.Uri.reDisallowedInRelativePath_=/[#\?:]/g,goog.Uri.reDisallowedInAbsolutePath_=/[#\?]/g,goog.Uri.reDisallowedInQuery_=/[#\?@]/g,goog.Uri.reDisallowedInFragment_=/#/g,goog.Uri.QueryData=function(t,i){this.encodedQuery_=t||null},goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_={},this.count_=0,this.encodedQuery_))for(var t=this.encodedQuery_.split("&"),i=0;i<t.length;i++){var r=t[i].indexOf("="),o=null;if(0<=r){var l=t[i].substring(0,r);o=t[i].substring(r+1)}else l=t[i];l=decodeURIComponent(l.replace(/\+/g," ")),o=o||"",this.add(l,decodeURIComponent(o.replace(/\+/g," ")))}},goog.Uri.QueryData.prototype.keyMap_=null,goog.Uri.QueryData.prototype.count_=null,goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},goog.Uri.QueryData.prototype.add=function(t,i){this.ensureKeyMapInitialized_(),this.encodedQuery_=null;var r=this.keyMap_.hasOwnProperty(t)&&this.keyMap_[t];return r||(this.keyMap_[t]=r=[]),r.push(i),goog.asserts.assert(null!=this.count_,"Should not be null."),this.count_++,this},goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";var i,t=[];for(i in this.keyMap_)for(var r=encodeURIComponent(i),o=this.keyMap_[i],l=0;l<o.length;l++){var g=r;""!==o[l]&&(g+="="+encodeURIComponent(o[l])),t.push(g)}return this.encodedQuery_=t.join("&")},goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())},goog.Uri.QueryData.prototype.clone=function(){var t=new goog.Uri.QueryData;if(t.encodedQuery_=this.encodedQuery_,this.keyMap_){var r,i={};for(r in this.keyMap_)i[r]=this.keyMap_[r].concat();t.keyMap_=i,t.count_=this.count_}return t},shaka.util.Error=function(t,i,r,o){for(var l=[],g=3;g<arguments.length;++g)l[g-3]=arguments[g];if(this.severity=t,this.category=i,this.code=r,this.data=l,this.handled=!1,goog.DEBUG){for(var _ in g=l="UNKNOWN",shaka.util.Error.Category)shaka.util.Error.Category[_]==this.category&&(l=_);for(var v in shaka.util.Error.Code)shaka.util.Error.Code[v]==this.code&&(g=v);if(this.message="Shaka Error "+l+"."+g+" ("+this.data.toString()+")",shaka.util.Error.createStack)try{throw Error(this.message)}catch(E){this.stack=E.stack}}},shaka.util.Error.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},goog.exportSymbol("shaka.util.Error",shaka.util.Error),goog.DEBUG&&(shaka.util.Error.createStack=!0),shaka.util.Error.Severity={RECOVERABLE:1,CRITICAL:2},goog.exportProperty(shaka.util.Error,"Severity",shaka.util.Error.Severity),shaka.util.Error.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},goog.exportProperty(shaka.util.Error,"Category",shaka.util.Error.Category),shaka.util.Error.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004},goog.exportProperty(shaka.util.Error,"Code",shaka.util.Error.Code),shaka.deprecate={},shaka.deprecate.Version=function(t,i){this.major_=t,this.minor_=i},shaka.deprecate.Version.prototype.major=function(){return this.major_},shaka.deprecate.Version.prototype.minor=function(){return this.minor_},shaka.deprecate.Version.prototype.compareTo=function(t){return this.major_-t.major_||this.minor_-t.minor_},shaka.deprecate.Version.prototype.toString=function(){return"v"+this.major_+"."+this.minor_},shaka.deprecate.Version.parse=function(t){return t=t.substring(1).split(".",2),new shaka.deprecate.Version(Number(t[0]),Number(t[1]))},shaka.deprecate.Enforcer=function(t,i,r){this.libraryVersion_=t,this.onPending_=i,this.onExpired_=r},shaka.deprecate.Enforcer.prototype.enforce=function(t,i,r){(0<t.compareTo(this.libraryVersion_)?this.onPending_:this.onExpired_)(this.libraryVersion_,t,i,r)},shaka.Deprecate=function(){},shaka.Deprecate.init=function(t){goog.asserts.assert(null==shaka.Deprecate.enforcer_,"Deprecate.init should only be called once."),shaka.Deprecate.enforcer_=new shaka.deprecate.Enforcer(shaka.deprecate.Version.parse(t),shaka.Deprecate.onPending_,shaka.Deprecate.onExpired_)},shaka.Deprecate.deprecateFeature=function(t,i,r){var o=shaka.Deprecate.enforcer_;goog.asserts.assert(o,"Missing deprecation enforcer. Was |init| called?"),t=new shaka.deprecate.Version(t,0),o.enforce(t,i,r)},shaka.Deprecate.onPending_=function(t,i,r,o){shaka.log.alwaysWarn([r,"has been deprecated and will be removed in",i,". We are currently at version",t,". Additional information:",o].join(" "))},shaka.Deprecate.onExpired_=function(t,i,r,o){t=[r,"has been deprecated and has been removed in",i,". We are now at version",t,". Additional information:",o].join(""),shaka.log.alwaysError(t),goog.asserts.assert(!1,t)},shaka.Deprecate.enforcer_=null,shaka.util.Functional=function(){},shaka.util.Functional.createFallbackPromiseChain=function(t,i){return t.reduce(function(r,o){return r.catch(function(){return i(o)})},Promise.reject())},shaka.util.Functional.collapseArrays=function(t,i){return t.concat(i)},shaka.util.Functional.ignored=function(t){},shaka.util.Functional.noop=function(){},shaka.util.Functional.isNotNull=function(t){return null!=t},shaka.util.Functional.callFactory=function(t){var i=Object.create(t.prototype||Object.prototype);try{var r=t.call(i);r||(shaka.Deprecate.deprecateFeature(4,"Factories requiring new","Factories should be plain functions"),r=i)}catch(o){shaka.Deprecate.deprecateFeature(4,"Factories requiring new","Factories should be plain functions"),r=new t}return r},shaka.util.ManifestParserUtils=function(){},shaka.util.ManifestParserUtils.resolveUris=function(t,i){var r=shaka.util.Functional;if(0==i.length)return t;var o=i.map(function(l){return new goog.Uri(l)});return t.map(function(l){return new goog.Uri(l)}).map(function(l){return o.map(function(g){return l.resolve(g)})}).reduce(r.collapseArrays,[]).map(function(l){return l.toString()})},shaka.util.ManifestParserUtils.createDrmInfo=function(t,i){return{keySystem:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:i||[],keyIds:new Set}},shaka.util.ManifestParserUtils.guessCodecs=function(t,i){if(1==i.length)return i[0];var r=shaka.util.ManifestParserUtils.guessCodecsSafe(t,i);if(null!=r)return r;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_GUESS_CODECS,i)},shaka.util.ManifestParserUtils.guessCodecsSafe=function(t,i){for(var r=$jscomp.makeIterator(shaka.util.ManifestParserUtils.CODEC_REGEXPS_BY_CONTENT_TYPE_[t]),o=r.next();!o.done;o=r.next()){o=o.value;for(var l=$jscomp.makeIterator(i),g=l.next();!g.done;g=l.next())if(o.test((g=g.value).trim()))return g.trim()}return t==shaka.util.ManifestParserUtils.ContentType.TEXT?"":null},shaka.util.ManifestParserUtils.ContentType={VIDEO:"video",AUDIO:"audio",TEXT:"text",IMAGE:"image",APPLICATION:"application"},shaka.util.ManifestParserUtils.TextStreamKind={SUBTITLE:"subtitle",CLOSED_CAPTION:"caption"},shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS=1/15,shaka.util.ManifestParserUtils.VIDEO_CODEC_REGEXPS_=[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],shaka.util.ManifestParserUtils.AUDIO_CODEC_REGEXPS_=[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],shaka.util.ManifestParserUtils.TEXT_CODEC_REGEXPS_=[/^vtt$/,/^wvtt/,/^stpp/],shaka.util.ManifestParserUtils.CODEC_REGEXPS_BY_CONTENT_TYPE_={audio:shaka.util.ManifestParserUtils.AUDIO_CODEC_REGEXPS_,video:shaka.util.ManifestParserUtils.VIDEO_CODEC_REGEXPS_,text:shaka.util.ManifestParserUtils.TEXT_CODEC_REGEXPS_},shaka.util.LanguageUtils=function(){},shaka.util.LanguageUtils.areLocaleCompatible=function(t,i){var r=shaka.util.LanguageUtils;return(t=r.normalize(t))==r.normalize(i)},shaka.util.LanguageUtils.areLanguageCompatible=function(t,i){var r=shaka.util.LanguageUtils;t=r.normalize(t),i=r.normalize(i);var o=r.disassembleLocale_(t);return r=r.disassembleLocale_(i),o[0]==r[0]},shaka.util.LanguageUtils.isParentOf=function(t,i){var r=shaka.util.LanguageUtils;t=r.normalize(t),i=r.normalize(i);var o=r.disassembleLocale_(t);return r=r.disassembleLocale_(i),o[0]==r[0]&&1==o.length&&2==r.length},shaka.util.LanguageUtils.isSiblingOf=function(t,i){var r=shaka.util.LanguageUtils;t=r.normalize(t),i=r.normalize(i);var o=r.disassembleLocale_(t);return r=r.disassembleLocale_(i),2==o.length&&2==r.length&&o[0]==r[0]},shaka.util.LanguageUtils.normalize=function(t){var i=shaka.util.LanguageUtils,r=t.split("-");return t=r[0]||"",r=r[1]||"",t=t.toLowerCase(),t=i.isoMap_.get(t)||t,(r=r.toUpperCase())?t+"-"+r:t},shaka.util.LanguageUtils.areSiblings=function(t,i){var r=shaka.util.LanguageUtils,o=r.getBase(t);return r=r.getBase(i),t!=o&&i!=r&&o==r},shaka.util.LanguageUtils.relatedness=function(t,i){var r=shaka.util.LanguageUtils;return t=r.normalize(t),(i=r.normalize(i))==t?4:r.isParentOf(i,t)?3:r.isSiblingOf(i,t)?2:r.isParentOf(t,i)?1:0},shaka.util.LanguageUtils.getBase=function(t){var i=shaka.util.LanguageUtils,r=t.indexOf("-");return t=(t=0<=r?t.substring(0,r):t).toLowerCase(),i.isoMap_.get(t)||t},shaka.util.LanguageUtils.getLocaleForText=function(t){var i=shaka.util.LanguageUtils;return goog.asserts.assert(t.type==shaka.util.ManifestParserUtils.ContentType.TEXT,"Can only get language from text streams"),i.normalize(t.language||"und")},shaka.util.LanguageUtils.getLocaleForVariant=function(t){var i=shaka.util.LanguageUtils;return t.language?i.normalize(t.language):t.audio&&t.audio.language?i.normalize(t.audio.language):t.video&&t.video.language?i.normalize(t.video.language):"und"},shaka.util.LanguageUtils.findClosestLocale=function(t,i){for(var r=shaka.util.LanguageUtils,o=r.normalize(t),l=new Set,g=$jscomp.makeIterator(i),_=g.next();!_.done;_=g.next())l.add(r.normalize(_.value));for(_=(g=$jscomp.makeIterator(l)).next();!_.done;_=g.next())if((_=_.value)==o)return _;for(_=(g=$jscomp.makeIterator(l)).next();!_.done;_=g.next())if(r.isParentOf(_=_.value,o))return _;for(_=(g=$jscomp.makeIterator(l)).next();!_.done;_=g.next())if(r.isSiblingOf(_=_.value,o))return _;for(_=(l=$jscomp.makeIterator(l)).next();!_.done;_=l.next())if(r.isParentOf(o,_=_.value))return _;return null},shaka.util.LanguageUtils.disassembleLocale_=function(t){var i=t.split("-");return goog.asserts.assert(2>=i.length,["Locales should not have more than 2 components. ",t," has too many components."].join()),i},shaka.util.LanguageUtils.isoMap_=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),shaka.ui={},shaka.ui.Localization=function(t){this.fallbackLocale_=shaka.util.LanguageUtils.normalize(t),this.currentMap_=new Map,this.currentLocales_=new Set,this.localizations_=new Map,this.events_=new shaka.util.FakeEventTarget},shaka.ui.Localization.prototype.addEventListener=function(t,i,r){this.events_.addEventListener(t,i,r)},shaka.ui.Localization.prototype.removeEventListener=function(t,i,r){this.events_.removeEventListener(t,i,r||void 0)},shaka.ui.Localization.prototype.dispatchEvent=function(t){return this.events_.dispatchEvent(t)},shaka.ui.Localization.prototype.changeLocale=function(t){var i=this,r=shaka.ui.Localization;this.currentLocales_.clear();for(var o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next())this.currentLocales_.add(shaka.util.LanguageUtils.normalize(o.value));this.updateCurrentMap_(),(t=shaka.util.Iterables.filter(this.currentLocales_,function(l){return!i.localizations_.has(l)})).length&&this.events_.dispatchEvent(new shaka.util.FakeEvent(r.UNKNOWN_LOCALES,{locales:t})),t=shaka.util.Iterables.filter(this.currentLocales_,function(l){return i.localizations_.has(l)}),this.events_.dispatchEvent(new shaka.util.FakeEvent(r.LOCALE_CHANGED,{locales:t.length?t:[this.fallbackLocale_]}))},shaka.ui.Localization.prototype.insert=function(t,i,r){var o=shaka.ui.Localization,l=shaka.ui.Localization.ConflictResolution,g=shaka.util.FakeEvent;t=shaka.util.LanguageUtils.normalize(t),void 0===r&&(r=l.USE_NEW);var _=this.localizations_.get(t)||new Map;return i.forEach(function(v,E){_.has(E)&&r!=l.USE_NEW||_.set(E,v)}),this.localizations_.set(t,_),this.updateCurrentMap_(),this.events_.dispatchEvent(new g(o.LOCALE_UPDATED)),this},shaka.ui.Localization.prototype.resolveDictionary=function(t){for(var i=$jscomp.makeIterator(t.keys()),r=i.next();!r.done;r=i.next())t.set(r=r.value,this.resolve(r))},shaka.ui.Localization.prototype.resolve=function(t){var i=shaka.ui.Localization,r=shaka.util.FakeEvent;return this.currentMap_.get(t)||(t={locales:Array.from(this.currentLocales_),missing:t},this.events_.dispatchEvent(new r(i.UNKNOWN_LOCALIZATION,t)),"")},shaka.ui.Localization.prototype.updateCurrentMap_=function(){for(var t=this,i=shaka.util.LanguageUtils,r=this.localizations_,o=this.fallbackLocale_,l=this.currentLocales_,g=new Set,_={},v=$jscomp.makeIterator(l),E=v.next();!E.done;_={$jscomp$loop$prop$locale$615:_.$jscomp$loop$prop$locale$615},E=v.next()){_.$jscomp$loop$prop$locale$615=E.value,g.add(_.$jscomp$loop$prop$locale$615),g.add(i.getBase(_.$jscomp$loop$prop$locale$615)),(E=shaka.util.Iterables.filter(r.keys(),function(M){return function(R){return i.areSiblings(R,M.$jscomp$loop$prop$locale$615)}}(_))).sort();var P=$jscomp.makeIterator(E);for(E=P.next();!E.done;E=P.next())g.add(E.value);for((E=shaka.util.Iterables.filter(r.keys(),function(M){return function(R){return i.getBase(R)==M.$jscomp$loop$prop$locale$615}}(_))).sort(),E=(P=$jscomp.makeIterator(E)).next();!E.done;E=P.next())g.add(E.value)}for(g.add(o),o=[],E=(g=$jscomp.makeIterator(g)).next();!E.done;E=g.next())(E=r.get(E.value))&&o.push(E);for(o.reverse(),this.currentMap_.clear(),E=(r=$jscomp.makeIterator(o)).next();!E.done;E=r.next())E.value.forEach(function(M,R){t.currentMap_.set(R,M)});for(r=this.currentMap_.keys(),g=new Set,E=(o=$jscomp.makeIterator(this.currentLocales_)).next();!E.done;E=o.next())E=this.localizations_.get(E.value)||new Map,shaka.ui.Localization.findMissingKeys_(E,r,g);0<g.size&&(l={locales:Array.from(l),missing:Array.from(g)},this.events_.dispatchEvent(new shaka.util.FakeEvent(shaka.ui.Localization.MISSING_LOCALIZATIONS,l)))},shaka.ui.Localization.findMissingKeys_=function(t,i,r){for(var o=(i=$jscomp.makeIterator(i)).next();!o.done;o=i.next())t.get(o=o.value)||r.add(o)},goog.exportSymbol("shaka.ui.Localization",shaka.ui.Localization),goog.exportProperty(shaka.ui.Localization.prototype,"resolve",shaka.ui.Localization.prototype.resolve),goog.exportProperty(shaka.ui.Localization.prototype,"resolveDictionary",shaka.ui.Localization.prototype.resolveDictionary),goog.exportProperty(shaka.ui.Localization.prototype,"insert",shaka.ui.Localization.prototype.insert),goog.exportProperty(shaka.ui.Localization.prototype,"changeLocale",shaka.ui.Localization.prototype.changeLocale),goog.exportProperty(shaka.ui.Localization.prototype,"dispatchEvent",shaka.ui.Localization.prototype.dispatchEvent),goog.exportProperty(shaka.ui.Localization.prototype,"removeEventListener",shaka.ui.Localization.prototype.removeEventListener),goog.exportProperty(shaka.ui.Localization.prototype,"addEventListener",shaka.ui.Localization.prototype.addEventListener),shaka.ui.Localization.ConflictResolution={USE_OLD:0,USE_NEW:1},goog.exportProperty(shaka.ui.Localization,"ConflictResolution",shaka.ui.Localization.ConflictResolution),shaka.ui.Localization.UNKNOWN_LOCALES="unknown-locales",goog.exportProperty(shaka.ui.Localization,"UNKNOWN_LOCALES",shaka.ui.Localization.UNKNOWN_LOCALES),shaka.ui.Localization.UNKNOWN_LOCALIZATION="unknown-localization",goog.exportProperty(shaka.ui.Localization,"UNKNOWN_LOCALIZATION",shaka.ui.Localization.UNKNOWN_LOCALIZATION),shaka.ui.Localization.MISSING_LOCALIZATIONS="missing-localizations",goog.exportProperty(shaka.ui.Localization,"MISSING_LOCALIZATIONS",shaka.ui.Localization.MISSING_LOCALIZATIONS),shaka.ui.Localization.LOCALE_CHANGED="locale-changed",goog.exportProperty(shaka.ui.Localization,"LOCALE_CHANGED",shaka.ui.Localization.LOCALE_CHANGED),shaka.ui.Localization.LOCALE_UPDATED="locale-updated",goog.exportProperty(shaka.ui.Localization,"LOCALE_UPDATED",shaka.ui.Localization.LOCALE_UPDATED),shaka.ui.Locales={},shaka.ui.Locales.addTo=function(t){t.insert("ar",new Map([["AD_DURATION","\u0645\u062f\u0629 \u0627\u0644\u0625\u0639\u0644\u0627\u0646"],["AD_PROGRESS","\u0627\u0644\u0625\u0639\u0644\u0627\u0646 [AD_ON] \u0645\u0646 [NUM_ADS]"],["AD_TIME","\u0627\u0644\u0625\u0639\u0644\u0627\u0646: [AD_TIME]"],["AUTO_QUALITY","\u062a\u0644\u0642\u0627\u0626\u064a"],["BACK","\u0631\u062c\u0648\u0639"],["CAPTIONS","\u0627\u0644\u062a\u0631\u062c\u0645\u0629 \u0648\u0627\u0644\u0634\u0631\u062d"],["CAST","\u0625\u0631\u0633\u0627\u0644..."],["ENTER_LOOP_MODE","\u062a\u0643\u0631\u0627\u0631 \u0627\u0644\u0641\u064a\u062f\u064a\u0648 \u0627\u0644\u062d\u0627\u0644\u064a"],["ENTER_PICTURE_IN_PICTURE",'\u0627\u0644\u062f\u062e\u0648\u0644 \u0641\u064a \u0648\u0636\u0639 "\u0646\u0627\u0641\u0630\u0629 \u0636\u0645\u0646 \u0646\u0627\u0641\u0630\u0629"'],["EXIT_FULL_SCREEN","\u0625\u0646\u0647\u0627\u0621 \u0648\u0636\u0639 \u0645\u0644\u0621 \u0627\u0644\u0634\u0627\u0634\u0629"],["EXIT_LOOP_MODE","\u0625\u064a\u0642\u0627\u0641 \u062a\u0643\u0631\u0627\u0631 \u0627\u0644\u0641\u064a\u062f\u064a\u0648 \u0627\u0644\u062d\u0627\u0644\u064a"],["EXIT_PICTURE_IN_PICTURE",'\u0627\u0644\u062e\u0631\u0648\u062c \u0645\u0646 \u0648\u0636\u0639 "\u0646\u0627\u0641\u0630\u0629 \u0636\u0645\u0646 \u0646\u0627\u0641\u0630\u0629"'],["FAST_FORWARD","\u062a\u0642\u062f\u064a\u0645 \u0633\u0631\u064a\u0639"],["FULL_SCREEN","\u0645\u0644\u0621 \u0627\u0644\u0634\u0627\u0634\u0629"],["LANGUAGE","\u0627\u0644\u0644\u063a\u0629"],["LIVE","\u0645\u0628\u0627\u0634\u0631"],["LOOP","\u062a\u0643\u0631\u0627\u0631"],["MORE_SETTINGS","\u0645\u0632\u064a\u062f \u0645\u0646 \u0627\u0644\u0625\u0639\u062f\u0627\u062f\u0627\u062a"],["MULTIPLE_LANGUAGES","\u0644\u063a\u0627\u062a \u0645\u062a\u0639\u062f\u062f\u0629"],["MUTE","\u0643\u062a\u0645 \u0627\u0644\u0635\u0648\u062a"],["NOT_APPLICABLE","\u063a\u064a\u0631 \u0633\u0627\u0631\u064d"],["OFF","\u0625\u064a\u0642\u0627\u0641"],["ON","\u062a\u0634\u063a\u064a\u0644"],["PAUSE","\u0625\u064a\u0642\u0627\u0641 \u0645\u0624\u0642\u062a"],["PICTURE_IN_PICTURE","\u0646\u0627\u0641\u0630\u0629 \u0636\u0645\u0646 \u0627\u0644\u0646\u0627\u0641\u0630\u0629"],["PLAY","\u0627\u0644\u062a\u0634\u063a\u064a\u0644"],["PLAYBACK_RATE","\u0633\u0631\u0639\u0629 \u0627\u0644\u062a\u0634\u063a\u064a\u0644"],["RESOLUTION","\u062f\u0631\u062c\u0629 \u0627\u0644\u062f\u0642\u0629"],["REWIND","\u062a\u0631\u062c\u064a\u0639"],["SEEK","\u0627\u0644\u0628\u062d\u062b \u0628\u0627\u0644\u062a\u0645\u0631\u064a\u0631"],["SKIP_AD","\u062a\u062e\u0637\u0651\u064a \u0627\u0644\u0625\u0639\u0644\u0627\u0646"],["SKIP_TO_LIVE","\u0627\u0644\u0627\u0646\u062a\u0642\u0627\u0644 \u0625\u0644\u0649 \u0628\u062b \u0645\u0628\u0627\u0634\u0631"],["UNDETERMINED_LANGUAGE","\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"],["UNMUTE","\u0625\u0639\u0627\u062f\u0629 \u0627\u0644\u0635\u0648\u062a"],["UNRECOGNIZED_LANGUAGE","\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"],["VOLUME","\u0645\u0633\u062a\u0648\u0649 \u0627\u0644\u0635\u0648\u062a"]])),t.insert("de",new Map([["AD_DURATION","Dauer der Werbeanzeige"],["AD_PROGRESS","Werbung\xa0[AD_ON] von\xa0[NUM_ADS]"],["AD_TIME","Werbeanzeige: [AD_TIME]"],["AUTO_QUALITY","Automatisch"],["BACK","Zur\xfcck"],["CAPTIONS","Untertitel"],["CAST","Streamen..."],["ENTER_LOOP_MODE","In Endlosschleife spielen"],["ENTER_PICTURE_IN_PICTURE","Bild-im-Bild-Modus aktivieren"],["EXIT_FULL_SCREEN","Vollbildmodus beenden"],["EXIT_LOOP_MODE","Endlosschleife stoppen"],["EXIT_PICTURE_IN_PICTURE","Bild-im-Bild-Modus beenden"],["FAST_FORWARD","Vorspulen"],["FULL_SCREEN","Vollbildmodus"],["LANGUAGE","Sprache"],["LIVE","Live"],["LOOP","Schleife"],["MORE_SETTINGS","Weitere Einstellungen"],["MULTIPLE_LANGUAGES","Mehrere Sprachen"],["MUTE","Stummschalten"],["NOT_APPLICABLE","Nicht zutreffend"],["OFF","Aus"],["ON","Ein"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Bild im Bild"],["PLAY","Wiedergabe"],["PLAYBACK_RATE","Geschwindigkeit"],["RESOLUTION","Aufl\xf6sung"],["REWIND","Zur\xfcckspulen"],["SEEK","Suche"],["SKIP_AD","\xdcberspringen"],["SKIP_TO_LIVE","Zum Live-Videostream wechseln"],["UNDETERMINED_LANGUAGE","Unbestimmt"],["UNMUTE","Stummschaltung aufheben"],["UNRECOGNIZED_LANGUAGE","Unbekannt"],["VOLUME","Lautst\xe4rke"]])),t.insert("en",new Map([["AD_DURATION","Ad duration"],["AD_PROGRESS","Ad [AD_ON] of [NUM_ADS]"],["AD_TIME","Ad: [AD_TIME]"],["AIRPLAY","AirPlay"],["AUTO_QUALITY","Auto"],["BACK","Back"],["CAPTIONS","Captions"],["CAST","Cast..."],["ENTER_LOOP_MODE","Loop the current video"],["ENTER_PICTURE_IN_PICTURE","Enter Picture-in-Picture"],["EXIT_FULL_SCREEN","Exit full screen"],["EXIT_LOOP_MODE","Stop looping the current video"],["EXIT_PICTURE_IN_PICTURE","Exit Picture-in-Picture"],["FAST_FORWARD","Fast-forward"],["FULL_SCREEN","Full screen"],["LANGUAGE","Language"],["LIVE","Live"],["LOOP","Loop"],["MORE_SETTINGS","More settings"],["MULTIPLE_LANGUAGES","Multiple languages"],["MUTE","Mute"],["NOT_APPLICABLE","Not applicable"],["OFF","Off"],["ON","On"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Picture-in-Picture"],["PLAY","Play"],["PLAYBACK_RATE","Playback speed"],["RESOLUTION","Resolution"],["REWIND","Rewind"],["SEEK","Seek"],["SKIP_AD","Skip Ad"],["SKIP_TO_LIVE","Skip ahead to live"],["SUBTITLE_FORCED","Forced"],["UNDETERMINED_LANGUAGE","Undetermined"],["UNMUTE","Unmute"],["UNRECOGNIZED_LANGUAGE","Unrecognized"],["VOLUME","Volume"]])),t.insert("en-GB",new Map([["AD_DURATION","Ad duration"],["AD_PROGRESS","Ad [AD_ON] of [NUM_ADS]"],["AD_TIME","Ad: [AD_TIME]"],["AUTO_QUALITY","Auto"],["BACK","Back"],["CAPTIONS","Captions"],["CAST","Cast..."],["ENTER_LOOP_MODE","Loop the current video"],["ENTER_PICTURE_IN_PICTURE","Enter picture-in-picture"],["EXIT_FULL_SCREEN","Exit full screen"],["EXIT_LOOP_MODE","Stop looping the current video"],["EXIT_PICTURE_IN_PICTURE","Exit picture-in-picture"],["FAST_FORWARD","Fast-forward"],["FULL_SCREEN","Full screen"],["LANGUAGE","Language"],["LIVE","Live"],["LOOP","Loop"],["MORE_SETTINGS","More settings"],["MULTIPLE_LANGUAGES","Multiple languages"],["MUTE","Mute"],["NOT_APPLICABLE","Not applicable"],["OFF","Off"],["ON","On"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Picture-in-picture"],["PLAY","Play"],["PLAYBACK_RATE","Playback speed"],["RESOLUTION","Resolution"],["REWIND","Rewind"],["SEEK","Seek"],["SKIP_AD","Skip ad"],["SKIP_TO_LIVE","Skip ahead to live"],["UNDETERMINED_LANGUAGE","Undetermined"],["UNMUTE","Unmute"],["UNRECOGNIZED_LANGUAGE","Unrecognised"],["VOLUME","volume"]])),t.insert("es",new Map([["AD_DURATION","Duraci\xf3n del anuncio"],["AD_PROGRESS","Anuncio [AD_ON] de [NUM_ADS]"],["AD_TIME","Anuncio: [AD_TIME]"],["AUTO_QUALITY","Autom\xe1tico"],["BACK","Atr\xe1s"],["CAPTIONS","Subt\xedtulos"],["CAST","Enviar..."],["ENTER_LOOP_MODE","Reproducir en bucle el v\xeddeo actual"],["ENTER_PICTURE_IN_PICTURE","Activar el modo imagen en imagen"],["EXIT_FULL_SCREEN","Salir del modo de pantalla completa"],["EXIT_LOOP_MODE","Dejar de reproducir en bucle el v\xeddeo actual"],["EXIT_PICTURE_IN_PICTURE","Salir del modo imagen en imagen"],["FAST_FORWARD","Avanzar r\xe1pidamente"],["FULL_SCREEN","Pantalla completa"],["LANGUAGE","Idioma"],["LIVE","En directo"],["LOOP","Reproducir en bucle"],["MORE_SETTINGS","M\xe1s ajustes"],["MULTIPLE_LANGUAGES","Varios idiomas"],["MUTE","Silenciar"],["NOT_APPLICABLE","No aplicable"],["OFF","Desactivado"],["ON","Activado"],["PAUSE","Pausar"],["PICTURE_IN_PICTURE","Imagen en imagen"],["PLAY","Reproducir"],["PLAYBACK_RATE","Velocidad de reproducci\xf3n"],["RESOLUTION","Resoluci\xf3n"],["REWIND","Rebobinar"],["SEEK","Buscar"],["SKIP_AD","Saltar anuncio"],["SKIP_TO_LIVE","Ir al v\xeddeo en directo"],["SUBTITLE_FORCED","Forzado"],["UNDETERMINED_LANGUAGE","Sin especificar"],["UNMUTE","Activar sonido"],["UNRECOGNIZED_LANGUAGE","No reconocida"],["VOLUME","Volumen"]])),t.insert("es-419",new Map([["AD_DURATION","Duraci\xf3n del anuncio"],["AD_PROGRESS","Anuncio [AD_ON] de [NUM_ADS]"],["AD_TIME","Anuncio: [AD_TIME]"],["AUTO_QUALITY","Autom\xe1tico"],["BACK","Atr\xe1s"],["CAPTIONS","Subt\xedtulos"],["CAST","Transmitir..."],["ENTER_LOOP_MODE","Repetir indefinidamente el video actual"],["ENTER_PICTURE_IN_PICTURE","Ingresar al modo de pantalla en pantalla"],["EXIT_FULL_SCREEN","Salir de pantalla completa"],["EXIT_LOOP_MODE","Detener la repetici\xf3n indefinida del video actual"],["EXIT_PICTURE_IN_PICTURE","Salir del modo de pantalla en pantalla"],["FAST_FORWARD","Avanzar"],["FULL_SCREEN","Pantalla completa"],["LANGUAGE","Idioma"],["LIVE","En directo"],["LOOP","Repetir indefinidamente"],["MORE_SETTINGS","M\xe1s opciones de configuraci\xf3n"],["MULTIPLE_LANGUAGES","Varios idiomas"],["MUTE","Silenciar"],["NOT_APPLICABLE","No aplicable"],["OFF","Desactivado"],["ON","Activado"],["PAUSE","Detener"],["PICTURE_IN_PICTURE","Pantalla en pantalla"],["PLAY","Reproducir"],["PLAYBACK_RATE","Velocidad de reproducci\xf3n"],["RESOLUTION","Resoluci\xf3n"],["REWIND","Retroceder"],["SEEK","Buscar"],["SKIP_AD","Omitir anuncio"],["SKIP_TO_LIVE","Adelantar hasta la transmisi\xf3n en vivo"],["SUBTITLE_FORCED","Forzado"],["UNDETERMINED_LANGUAGE","Sin especificar"],["UNMUTE","Dejar de silenciar"],["UNRECOGNIZED_LANGUAGE","No reconocida"],["VOLUME","Volumen"]])),t.insert("fr",new Map([["AD_DURATION","Dur\xe9e de l'annonce"],["AD_PROGRESS","Annonce\xa0[AD_ON] sur\xa0[NUM_ADS]"],["AD_TIME","Annonce\xa0: [AD_TIME]"],["AUTO_QUALITY","Automatique"],["BACK","Retour"],["CAPTIONS","Sous-titres"],["CAST","Caster\u2026"],["ENTER_LOOP_MODE","Lire en boucle la vid\xe9o en cours"],["ENTER_PICTURE_IN_PICTURE","Utiliser le mode Picture-in-Picture"],["EXIT_FULL_SCREEN","Quitter le mode plein \xe9cran"],["EXIT_LOOP_MODE","Arr\xeater la lecture en boucle de la vid\xe9o en cours"],["EXIT_PICTURE_IN_PICTURE","Quitter le mode\xa0PIP (Picture-in-picture)"],["FAST_FORWARD","Avance rapide"],["FULL_SCREEN","Plein \xe9cran"],["LANGUAGE","Langue"],["LIVE","En direct"],["LOOP","R\xe9p\xe9ter"],["MORE_SETTINGS","Plus de param\xe8tres"],["MULTIPLE_LANGUAGES","Plusieurs langues"],["MUTE","Couper le son"],["NOT_APPLICABLE","Non applicable"],["OFF","D\xe9sactiv\xe9e"],["ON","Activ\xe9e"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Picture-in-Picture"],["PLAY","Visionner"],["PLAYBACK_RATE","Vitesse de lecture"],["RESOLUTION","R\xe9solution"],["REWIND","Retour arri\xe8re"],["SEEK","Chercher"],["SKIP_AD","Passer l'annonce"],["SKIP_TO_LIVE","Acc\xe9der \xe0 la partie la plus r\xe9cente du direct"],["UNDETERMINED_LANGUAGE","Langue ind\xe9termin\xe9e"],["UNMUTE","R\xe9activer le son"],["UNRECOGNIZED_LANGUAGE","Non reconnu"],["VOLUME","Volume"]])),t.insert("it",new Map([["AD_DURATION","Durata dell'annuncio"],["AD_PROGRESS","Annuncio [AD_ON] di [NUM_ADS]"],["AD_TIME","Annuncio: [AD_TIME]"],["AUTO_QUALITY","Automatica"],["BACK","Indietro"],["CAPTIONS","Sottotitoli"],["CAST","Trasmetti..."],["ENTER_LOOP_MODE","Riproduci in loop il video corrente"],["ENTER_PICTURE_IN_PICTURE","Attiva Picture in picture"],["EXIT_FULL_SCREEN","Esci da schermo intero"],["EXIT_LOOP_MODE","Interrompi riproduzione in loop del video corrente"],["EXIT_PICTURE_IN_PICTURE","Esci da Picture in picture"],["FAST_FORWARD","Avanti veloce"],["FULL_SCREEN","Schermo intero"],["LANGUAGE","Lingua"],["LIVE","Dal vivo"],["LOOP","Riproduci in loop"],["MORE_SETTINGS","Altre impostazioni"],["MULTIPLE_LANGUAGES","Pi\xf9 lingue"],["MUTE","Disattiva audio"],["NOT_APPLICABLE","Non applicabile"],["OFF","Disattivo"],["ON","Attivo"],["PAUSE","Metti in pausa"],["PICTURE_IN_PICTURE","Picture in picture"],["PLAY","Riproduci"],["PLAYBACK_RATE","Velocit\xe0 di riproduzione"],["RESOLUTION","Risoluzione"],["REWIND","Riavvolgi"],["SEEK","Cerca"],["SKIP_AD","Salta annuncio"],["SKIP_TO_LIVE","Passa alla trasmissione dal vivo"],["UNDETERMINED_LANGUAGE","Indeterminata"],["UNMUTE","Riattiva audio"],["UNRECOGNIZED_LANGUAGE","Non riconosciuto"],["VOLUME","Volume"]])),t.insert("ja",new Map([["AD_DURATION","\u5e83\u544a\u518d\u751f\u6642\u9593"],["AD_PROGRESS","[AD_ON] \u756a\u76ee\u306e\u5e83\u544a\uff08\u5168 [NUM_ADS] \u500b\uff09"],["AD_TIME","\u5e83\u544a: [AD_TIME]"],["AUTO_QUALITY","\u81ea\u52d5"],["BACK","\u623b\u308b"],["CAPTIONS","\u5b57\u5e55"],["CAST","\u30ad\u30e3\u30b9\u30c8..."],["ENTER_LOOP_MODE","\u73fe\u5728\u306e\u52d5\u753b\u3092\u30eb\u30fc\u30d7\u518d\u751f"],["ENTER_PICTURE_IN_PICTURE","\u30d4\u30af\u30c1\u30e3\u30fc \u30a4\u30f3 \u30d4\u30af\u30c1\u30e3\u30fc\u3092\u958b\u59cb"],["EXIT_FULL_SCREEN","\u5168\u753b\u9762\u8868\u793a\u3092\u7d42\u4e86"],["EXIT_LOOP_MODE","\u73fe\u5728\u306e\u52d5\u753b\u306e\u30eb\u30fc\u30d7\u518d\u751f\u3092\u505c\u6b62"],["EXIT_PICTURE_IN_PICTURE","\u30d4\u30af\u30c1\u30e3\u30fc \u30a4\u30f3 \u30d4\u30af\u30c1\u30e3\u30fc\u3092\u7d42\u4e86"],["FAST_FORWARD","\u65e9\u9001\u308a"],["FULL_SCREEN","\u5168\u753b\u9762\u8868\u793a"],["LANGUAGE","\u8a00\u8a9e"],["LIVE","\u30e9\u30a4\u30d6"],["LOOP","\u30eb\u30fc\u30d7"],["MORE_SETTINGS","\u8a73\u7d30\u8a2d\u5b9a"],["MULTIPLE_LANGUAGES","\u591a\u8a00\u8a9e"],["MUTE","\u30df\u30e5\u30fc\u30c8"],["NOT_APPLICABLE","\u8a72\u5f53\u306a\u3057"],["OFF","\u30aa\u30d5"],["ON","\u30aa\u30f3"],["PAUSE","\u4e00\u6642\u505c\u6b62"],["PICTURE_IN_PICTURE","\u30d4\u30af\u30c1\u30e3\u30fc \u30a4\u30f3 \u30d4\u30af\u30c1\u30e3\u30fc"],["PLAY","\u518d\u751f"],["PLAYBACK_RATE","\u518d\u751f\u901f\u5ea6"],["RESOLUTION","\u89e3\u50cf\u5ea6"],["REWIND","\u5dfb\u304d\u623b\u3057"],["SEEK","\u30b7\u30fc\u30af\u518d\u751f"],["SKIP_AD","\u5e83\u544a\u3092\u30b9\u30ad\u30c3\u30d7"],["SKIP_TO_LIVE","\u30e9\u30a4\u30d6\u914d\u4fe1\u307e\u3067\u30b9\u30ad\u30c3\u30d7"],["UNDETERMINED_LANGUAGE","\u4e0d\u660e"],["UNMUTE","\u30df\u30e5\u30fc\u30c8\u3092\u89e3\u9664"],["UNRECOGNIZED_LANGUAGE","\u4e0d\u660e"],["VOLUME","\u97f3\u91cf"]])),t.insert("ko",new Map([["AD_DURATION","\uad11\uace0 \uae30\uac04"],["AD_PROGRESS","\uad11\uace0 [AD_ON]/[NUM_ADS]"],["AD_TIME","\uad11\uace0: [AD_TIME]"],["AUTO_QUALITY","\uc790\ub3d9"],["BACK","\ub4a4\ub85c"],["CAPTIONS","\uc790\ub9c9"],["CAST","\uc804\uc1a1..."],["ENTER_LOOP_MODE","\ud604\uc7ac \ub3d9\uc601\uc0c1 \ubc18\ubcf5 \uc7ac\uc0dd"],["ENTER_PICTURE_IN_PICTURE","PIP \ubaa8\ub4dc \uc2dc\uc791"],["EXIT_FULL_SCREEN","\uc804\uccb4\ud654\uba74 \ub2eb\uae30"],["EXIT_LOOP_MODE","\ud604\uc7ac \ub3d9\uc601\uc0c1 \ubc18\ubcf5 \uc7ac\uc0dd \uc911\uc9c0"],["EXIT_PICTURE_IN_PICTURE","PIP \ubaa8\ub4dc \uc885\ub8cc"],["FAST_FORWARD","\ube68\ub9ac \uac10\uae30"],["FULL_SCREEN","\uc804\uccb4\ud654\uba74"],["LANGUAGE","\uc5b8\uc5b4"],["LIVE","\uc2e4\uc2dc\uac04"],["LOOP","\ubc18\ubcf5 \uc7ac\uc0dd"],["MORE_SETTINGS","\uc124\uc815 \ub354\ubcf4\uae30"],["MULTIPLE_LANGUAGES","\uc5ec\ub7ec \uc5b8\uc5b4"],["MUTE","\uc74c\uc18c\uac70"],["NOT_APPLICABLE","\ud574\ub2f9 \uc0ac\ud56d \uc5c6\uc74c"],["OFF","\uc0ac\uc6a9 \uc548\ud568"],["ON","\uc0ac\uc6a9"],["PAUSE","\uc77c\uc2dc\uc911\uc9c0"],["PICTURE_IN_PICTURE","PIP \ubaa8\ub4dc"],["PLAY","\uc7ac\uc0dd"],["PLAYBACK_RATE","\uc7ac\uc0dd \uc18d\ub3c4"],["RESOLUTION","\ud574\uc0c1\ub3c4"],["REWIND","\ub418\uac10\uae30"],["SEEK","\ucc3e\uae30"],["SKIP_AD","\uad11\uace0 \uac74\ub108\ub6f0\uae30"],["SKIP_TO_LIVE","\ub77c\uc774\ube0c \ub3d9\uc601\uc0c1\uc73c\ub85c \uac74\ub108\ub6f0\uae30"],["UNDETERMINED_LANGUAGE","\ubbf8\uc815"],["UNMUTE","\uc74c\uc18c\uac70 \ud574\uc81c"],["UNRECOGNIZED_LANGUAGE","\uc54c \uc218 \uc5c6\uc74c"],["VOLUME","\ubcfc\ub968"]])),t.insert("nl",new Map([["AD_DURATION","Advertentieduur"],["AD_PROGRESS","Advertentie [AD_ON] van [NUM_ADS]"],["AD_TIME","Advertentie: [AD_TIME]"],["AUTO_QUALITY","Automatisch"],["BACK","Terug"],["CAPTIONS","Ondertiteling"],["CAST","Casten..."],["ENTER_LOOP_MODE","De huidige video lussen"],["ENTER_PICTURE_IN_PICTURE","Scherm-in-scherm openen"],["EXIT_FULL_SCREEN","Volledig scherm sluiten"],["EXIT_LOOP_MODE","De huidige video niet meer lussen"],["EXIT_PICTURE_IN_PICTURE","Scherm-in-scherm afsluiten"],["FAST_FORWARD","Vooruitspoelen"],["FULL_SCREEN","Volledig scherm"],["LANGUAGE","Taal"],["LIVE","Live"],["LOOP","Lussen"],["MORE_SETTINGS","Meer instellingen"],["MULTIPLE_LANGUAGES","Meerdere talen"],["MUTE","Dempen"],["NOT_APPLICABLE","Niet van toepassing"],["OFF","Uit"],["ON","Aan"],["PAUSE","Onderbreken"],["PICTURE_IN_PICTURE","Scherm-in-scherm"],["PLAY","Afspelen"],["PLAYBACK_RATE","Afspeelsnelheid"],["RESOLUTION","Resolutie"],["REWIND","Terugspoelen"],["SEEK","Zoeken"],["SKIP_AD","Advertentie overslaan"],["SKIP_TO_LIVE","Doorgaan naar live"],["UNDETERMINED_LANGUAGE","Onbepaald"],["UNMUTE","Dempen opheffen"],["UNRECOGNIZED_LANGUAGE","Onbekend"],["VOLUME","Volume"]])),t.insert("pl",new Map([["AD_DURATION","Czas trwania reklamy"],["AD_PROGRESS","Reklama\xa0[AD_ON] z\xa0[NUM_ADS]"],["AD_TIME","Reklama: [AD_TIME]"],["AUTO_QUALITY","Automatycznie"],["BACK","Wstecz"],["CAPTIONS","Napisy"],["CAST","Przesy\u0142aj..."],["ENTER_LOOP_MODE","Odtwarzaj bie\u017c\u0105cy film w\xa0p\u0119tli"],["ENTER_PICTURE_IN_PICTURE","W\u0142\u0105cz tryb obrazu w\xa0obrazie"],["EXIT_FULL_SCREEN","Zamknij pe\u0142ny ekran"],["EXIT_LOOP_MODE","Wy\u0142\u0105cz odtwarzanie bie\u017c\u0105cego filmu w\xa0p\u0119tli"],["EXIT_PICTURE_IN_PICTURE","Wy\u0142\u0105cz tryb obrazu w\xa0obrazie"],["FAST_FORWARD","Przewi\u0144 do przodu"],["FULL_SCREEN","Pe\u0142ny ekran"],["LANGUAGE","J\u0119zyk"],["LIVE","Na \u017cywo"],["LOOP","Odtwarzaj w\xa0p\u0119tli"],["MORE_SETTINGS","Wi\u0119cej ustawie\u0144"],["MULTIPLE_LANGUAGES","Wiele j\u0119zyk\xf3w"],["MUTE","Wycisz"],["NOT_APPLICABLE","Nie dotyczy"],["OFF","Wy\u0142\u0105czone"],["ON","W\u0142\u0105czone"],["PAUSE","Wstrzymaj"],["PICTURE_IN_PICTURE","Obraz w\xa0obrazie"],["PLAY","Odtw\xf3rz"],["PLAYBACK_RATE","Szybko\u015b\u0107 odtwarzania"],["RESOLUTION","Rozdzielczo\u015b\u0107"],["REWIND","Przewi\u0144 do ty\u0142u"],["SEEK","Szukaj"],["SKIP_AD","Pomi\u0144 reklam\u0119"],["SKIP_TO_LIVE","Przejd\u017a do transmisji na \u017cywo"],["UNDETERMINED_LANGUAGE","Nie okre\u015blono"],["UNMUTE","Wy\u0142\u0105cz wyciszenie"],["UNRECOGNIZED_LANGUAGE","Nierozpoznany"],["VOLUME","G\u0142o\u015bno\u015b\u0107"]])),t.insert("pt-BR",new Map([["AD_DURATION","Dura\xe7\xe3o do an\xfancio"],["AD_PROGRESS","An\xfancio [AD_ON] de [NUM_ADS]"],["AD_TIME","An\xfancio: [AD_TIME]"],["AUTO_QUALITY","Autom\xe1tica"],["BACK","Voltar"],["CAPTIONS","Legendas"],["CAST","Transmitir..."],["ENTER_LOOP_MODE","Repetir o v\xeddeo atual"],["ENTER_PICTURE_IN_PICTURE","Entrar no modo picture-in-picture"],["EXIT_FULL_SCREEN","Sair do modo tela cheia"],["EXIT_LOOP_MODE","Parar repeti\xe7\xe3o do v\xeddeo atual"],["EXIT_PICTURE_IN_PICTURE","Sair de picture-in-picture"],["FAST_FORWARD","Avan\xe7ar"],["FULL_SCREEN","Tela cheia"],["LANGUAGE","Idioma"],["LIVE","Ao vivo"],["LOOP","Repetir"],["MORE_SETTINGS","Mais defini\xe7\xf5es"],["MULTIPLE_LANGUAGES","V\xe1rios idiomas"],["MUTE","Desativar som"],["NOT_APPLICABLE","N\xe3o relevante"],["OFF","Desativado"],["ON","Ativado"],["PAUSE","Pausar"],["PICTURE_IN_PICTURE","Picture-in-picture"],["PLAY","Reproduzir"],["PLAYBACK_RATE","Velocidade da reprodu\xe7\xe3o"],["RESOLUTION","Resolu\xe7\xe3o"],["REWIND","Retroceder"],["SEEK","Procurar"],["SKIP_AD","Pular an\xfancio"],["SKIP_TO_LIVE","Pular para transmiss\xe3o ao vivo"],["UNDETERMINED_LANGUAGE","Indeterminado"],["UNMUTE","Ativar som"],["UNRECOGNIZED_LANGUAGE","N\xe3o reconhecido"],["VOLUME","Volume"]])),t.insert("ru",new Map([["AD_DURATION","\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u044f"],["AD_PROGRESS","\u041e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u0435 [AD_ON] \u0438\u0437 [NUM_ADS]"],["AD_TIME","\u041e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u0435: [AD_TIME]"],["AUTO_QUALITY","\u0410\u0432\u0442\u043e"],["BACK","\u041d\u0430\u0437\u0430\u0434"],["CAPTIONS","\u0422\u0438\u0442\u0440\u044b"],["CAST","\u0422\u0440\u0430\u043d\u0441\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c..."],["ENTER_LOOP_MODE","\u0417\u0430\u0446\u0438\u043a\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0432\u0438\u0434\u0435\u043e"],["ENTER_PICTURE_IN_PICTURE",'\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0440\u0435\u0436\u0438\u043c "\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0432 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0435"'],["EXIT_FULL_SCREEN","\u041e\u0431\u044b\u0447\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c"],["EXIT_LOOP_MODE","\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u0430\u0446\u0438\u043a\u043b\u0438\u0432\u0430\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0432\u0438\u0434\u0435\u043e"],["EXIT_PICTURE_IN_PICTURE",'\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u0440\u0435\u0436\u0438\u043c\u0430 "\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0432 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0435"'],["FAST_FORWARD","\u041f\u0435\u0440\u0435\u043c\u043e\u0442\u043a\u0430 \u0432\u043f\u0435\u0440\u0435\u0434"],["FULL_SCREEN","\u041f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c"],["LANGUAGE","\u042f\u0437\u044b\u043a"],["LIVE","\u041f\u0440\u044f\u043c\u043e\u0439 \u044d\u0444\u0438\u0440"],["LOOP","\u0417\u0430\u0446\u0438\u043a\u043b\u0438\u0442\u044c"],["MORE_SETTINGS","\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"],["MULTIPLE_LANGUAGES","\u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u044f\u0437\u044b\u043a\u043e\u0432"],["MUTE","\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0432\u0443\u043a"],["NOT_APPLICABLE","\u041d\u0435\u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u043e"],["OFF","\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c"],["ON","\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c"],["PAUSE","\u041f\u0430\u0443\u0437\u0430"],["PICTURE_IN_PICTURE","\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0432 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0435"],["PLAY","\u0412\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0441\u0442\u0438"],["PLAYBACK_RATE","\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f"],["RESOLUTION","\u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435"],["REWIND","\u041f\u0435\u0440\u0435\u043c\u043e\u0442\u0430\u0442\u044c \u043d\u0430\u0437\u0430\u0434"],["SEEK","\u041f\u0435\u0440\u0435\u043c\u043e\u0442\u043a\u0430"],["SKIP_AD","\u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c"],["SKIP_TO_LIVE","\u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0438 \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043f\u0440\u044f\u043c\u043e\u0439 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u0438"],["UNDETERMINED_LANGUAGE","\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e"],["UNMUTE","\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0432\u0443\u043a"],["UNRECOGNIZED_LANGUAGE","\u041d\u0435 \u0440\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u043d\u043e"],["VOLUME","\u0413\u0440\u043e\u043c\u043a\u043e\u0441\u0442\u044c"]])),t.insert("th",new Map([["AD_DURATION","\u0e23\u0e30\u0e22\u0e30\u0e40\u0e27\u0e25\u0e32\u0e42\u0e06\u0e29\u0e13\u0e32"],["AD_PROGRESS","\u0e42\u0e06\u0e29\u0e13\u0e32 [AD_ON] \u0e08\u0e32\u0e01 [NUM_ADS] \u0e23\u0e32\u0e22\u0e01\u0e32\u0e23"],["AD_TIME","\u0e42\u0e06\u0e29\u0e13\u0e32: [AD_TIME]"],["AUTO_QUALITY","\u0e2d\u0e31\u0e15\u0e42\u0e19\u0e21\u0e31\u0e15\u0e34"],["BACK","\u0e01\u0e25\u0e31\u0e1a"],["CAPTIONS","\u0e04\u0e33\u0e1a\u0e23\u0e23\u0e22\u0e32\u0e22"],["CAST","\u0e41\u0e04\u0e2a\u0e15\u0e4c..."],["ENTER_LOOP_MODE","\u0e27\u0e19\u0e0b\u0e49\u0e33\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d\u0e1b\u0e31\u0e08\u0e08\u0e38\u0e1a\u0e31\u0e19"],["ENTER_PICTURE_IN_PICTURE","\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e01\u0e32\u0e23\u0e41\u0e2a\u0e14\u0e07\u0e20\u0e32\u0e1e\u0e0b\u0e49\u0e2d\u0e19\u0e20\u0e32\u0e1e"],["EXIT_FULL_SCREEN","\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e01\u0e32\u0e23\u0e41\u0e2a\u0e14\u0e07\u0e41\u0e1a\u0e1a\u0e40\u0e15\u0e47\u0e21\u0e2b\u0e19\u0e49\u0e32\u0e08\u0e2d"],["EXIT_LOOP_MODE","\u0e2b\u0e22\u0e38\u0e14\u0e27\u0e19\u0e0b\u0e49\u0e33\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d\u0e1b\u0e31\u0e08\u0e08\u0e38\u0e1a\u0e31\u0e19"],["EXIT_PICTURE_IN_PICTURE","\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e01\u0e32\u0e23\u0e41\u0e2a\u0e14\u0e07\u0e20\u0e32\u0e1e\u0e0b\u0e49\u0e2d\u0e19\u0e20\u0e32\u0e1e"],["FAST_FORWARD","\u0e01\u0e23\u0e2d\u0e44\u0e1b\u0e02\u0e49\u0e32\u0e07\u0e2b\u0e19\u0e49\u0e32"],["FULL_SCREEN","\u0e40\u0e15\u0e47\u0e21\u0e2b\u0e19\u0e49\u0e32\u0e08\u0e2d"],["LANGUAGE","\u0e20\u0e32\u0e29\u0e32"],["LIVE","\u0e2a\u0e14"],["LOOP","\u0e25\u0e39\u0e1b"],["MORE_SETTINGS","\u0e01\u0e32\u0e23\u0e15\u0e31\u0e49\u0e07\u0e04\u0e48\u0e32\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e40\u0e15\u0e34\u0e21"],["MULTIPLE_LANGUAGES","\u0e2b\u0e25\u0e32\u0e22\u0e20\u0e32\u0e29\u0e32"],["MUTE","\u0e1b\u0e34\u0e14\u0e40\u0e2a\u0e35\u0e22\u0e07"],["NOT_APPLICABLE","\u0e44\u0e21\u0e48\u0e40\u0e01\u0e35\u0e48\u0e22\u0e27\u0e02\u0e49\u0e2d\u0e07"],["OFF","\u0e1b\u0e34\u0e14"],["ON","\u0e40\u0e1b\u0e34\u0e14"],["PAUSE","\u0e2b\u0e22\u0e38\u0e14\u0e0a\u0e31\u0e48\u0e27\u0e04\u0e23\u0e32\u0e27"],["PICTURE_IN_PICTURE","\u0e01\u0e32\u0e23\u0e41\u0e2a\u0e14\u0e07\u0e20\u0e32\u0e1e\u0e0b\u0e49\u0e2d\u0e19\u0e20\u0e32\u0e1e"],["PLAY","\u0e40\u0e25\u0e48\u0e19"],["PLAYBACK_RATE","\u0e04\u0e27\u0e32\u0e21\u0e40\u0e23\u0e47\u0e27\u0e43\u0e19\u0e01\u0e32\u0e23\u0e40\u0e25\u0e48\u0e19"],["RESOLUTION","\u0e04\u0e27\u0e32\u0e21\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14"],["REWIND","\u0e01\u0e23\u0e2d\u0e01\u0e25\u0e31\u0e1a"],["SEEK","\u0e04\u0e49\u0e19\u0e2b\u0e32"],["SKIP_AD","\u0e02\u0e49\u0e32\u0e21\u0e42\u0e06\u0e29\u0e13\u0e32"],["SKIP_TO_LIVE","\u0e02\u0e49\u0e32\u0e21\u0e44\u0e1b\u0e17\u0e35\u0e48\u0e01\u0e32\u0e23\u0e16\u0e48\u0e32\u0e22\u0e17\u0e2d\u0e14\u0e2a\u0e14"],["UNDETERMINED_LANGUAGE","\u0e44\u0e21\u0e48\u0e01\u0e33\u0e2b\u0e19\u0e14"],["UNMUTE","\u0e40\u0e1b\u0e34\u0e14\u0e40\u0e2a\u0e35\u0e22\u0e07"],["UNRECOGNIZED_LANGUAGE","\u0e17\u0e35\u0e48\u0e44\u0e21\u0e48\u0e23\u0e39\u0e49\u0e08\u0e31\u0e01"],["VOLUME","\u0e23\u0e30\u0e14\u0e31\u0e1a\u0e40\u0e2a\u0e35\u0e22\u0e07"]])),t.insert("tr",new Map([["AD_DURATION","Reklam s\xfcresi"],["AD_PROGRESS","[AD_ON]/[NUM_ADS] reklam"],["AD_TIME","Reklam: [AD_TIME]"],["AUTO_QUALITY","Otomatik"],["BACK","Geri"],["CAPTIONS","Altyaz\u0131lar"],["CAST","Yay\u0131nla..."],["ENTER_LOOP_MODE","Mevcut videoyu d\xf6ng\xfcye al"],["ENTER_PICTURE_IN_PICTURE","Pencere i\xe7inde Pencere moduna gir"],["EXIT_FULL_SCREEN","Tam ekrandan \xe7\u0131k"],["EXIT_LOOP_MODE","Mevcut videonun d\xf6ng\xfcs\xfcn\xfc durdur"],["EXIT_PICTURE_IN_PICTURE","Pencere \u0130\xe7inde Pencereden \xc7\u0131k"],["FAST_FORWARD","\u0130leri sar"],["FULL_SCREEN","Tam ekran"],["LANGUAGE","Dil"],["LIVE","Canl\u0131"],["LOOP","D\xf6ng\xfc"],["MORE_SETTINGS","Daha fazla ayar"],["MULTIPLE_LANGUAGES","Birden \xe7ok dil"],["MUTE","Sesi kapat"],["NOT_APPLICABLE","Ge\xe7erli de\u011fil"],["OFF","Kapal\u0131"],["ON","A\xe7\u0131k"],["PAUSE","Duraklat"],["PICTURE_IN_PICTURE","Pencere \u0130\xe7inde Pencere"],["PLAY","Oynat"],["PLAYBACK_RATE","\xc7alma h\u0131z\u0131"],["RESOLUTION","\xc7\xf6z\xfcn\xfcrl\xfck"],["REWIND","Geri sar"],["SEEK","Ara"],["SKIP_AD","Reklam\u0131 Atla"],["SKIP_TO_LIVE","Canl\u0131 yay\u0131na atla"],["UNDETERMINED_LANGUAGE","Belirsiz"],["UNMUTE","Sesi a\xe7"],["UNRECOGNIZED_LANGUAGE","Tan\u0131nmayan"],["VOLUME","Ses"]])),t.insert("zh",new Map([["AD_DURATION","\u5e7f\u544a\u6301\u7eed\u65f6\u95f4"],["AD_PROGRESS","\u5e7f\u544a [AD_ON]/[NUM_ADS]"],["AD_TIME","\u5e7f\u544a\uff1a[AD_TIME]"],["AUTO_QUALITY","\u81ea\u52a8"],["BACK","\u8fd4\u56de"],["CAPTIONS","\u5b57\u5e55"],["CAST","\u6295\u5c04\u2026"],["ENTER_LOOP_MODE","\u5faa\u73af\u64ad\u653e\u5f53\u524d\u89c6\u9891"],["ENTER_PICTURE_IN_PICTURE","\u8fdb\u5165\u201c\u753b\u4e2d\u753b\u201d\u6a21\u5f0f"],["EXIT_FULL_SCREEN","\u9000\u51fa\u5168\u5c4f\u6a21\u5f0f"],["EXIT_LOOP_MODE","\u505c\u6b62\u5faa\u73af\u64ad\u653e\u5f53\u524d\u89c6\u9891"],["EXIT_PICTURE_IN_PICTURE","\u9000\u51fa\u201c\u753b\u4e2d\u753b\u201d\u6a21\u5f0f"],["FAST_FORWARD","\u5feb\u8fdb"],["FULL_SCREEN","\u5168\u5c4f"],["LANGUAGE","\u8bed\u8a00"],["LIVE","\u76f4\u64ad"],["LOOP","\u5faa\u73af\u64ad\u653e"],["MORE_SETTINGS","\u66f4\u591a\u8bbe\u7f6e"],["MULTIPLE_LANGUAGES","\u591a\u79cd\u8bed\u8a00"],["MUTE","\u9759\u97f3"],["NOT_APPLICABLE","\u4e0d\u9002\u7528"],["OFF","\u5173\u95ed"],["ON","\u5f00\u542f"],["PAUSE","\u6682\u505c"],["PICTURE_IN_PICTURE","\u753b\u4e2d\u753b"],["PLAY","\u64ad\u653e"],["PLAYBACK_RATE","\u64ad\u653e\u901f\u5ea6"],["RESOLUTION","\u5206\u8fa8\u7387"],["REWIND","\u5feb\u9000"],["SEEK","\u8fdb\u5ea6"],["SKIP_AD","\u8df3\u8fc7\u5e7f\u544a"],["SKIP_TO_LIVE","\u8df3\u81f3\u5f53\u524d\u76f4\u64ad"],["UNDETERMINED_LANGUAGE","\u672a\u786e\u5b9a"],["UNMUTE","\u53d6\u6d88\u9759\u97f3"],["UNRECOGNIZED_LANGUAGE","\u65e0\u6cd5\u8bc6\u522b"],["VOLUME","\u97f3\u91cf"]])),t.insert("zh-TW",new Map([["AD_DURATION","\u5ee3\u544a\u9577\u5ea6"],["AD_PROGRESS","\u5ee3\u544a [AD_ON]/[NUM_ADS]"],["AD_TIME","\u5ee3\u544a\uff1a[AD_TIME]"],["AUTO_QUALITY","\u81ea\u52d5"],["BACK","\u8fd4\u56de"],["CAPTIONS","\u5b57\u5e55"],["CAST","\u6295\u653e..."],["ENTER_LOOP_MODE","\u5faa\u74b0\u64ad\u653e\u76ee\u524d\u7684\u5f71\u7247"],["ENTER_PICTURE_IN_PICTURE","\u9032\u5165\u5b50\u6bcd\u756b\u9762"],["EXIT_FULL_SCREEN","\u9000\u51fa\u5168\u87a2\u5e55\u6a21\u5f0f"],["EXIT_LOOP_MODE","\u505c\u6b62\u5faa\u74b0\u64ad\u653e\u76ee\u524d\u7684\u5f71\u7247"],["EXIT_PICTURE_IN_PICTURE","\u96e2\u958b\u5b50\u6bcd\u756b\u9762"],["FAST_FORWARD","\u5feb\u8f49"],["FULL_SCREEN","\u5168\u87a2\u5e55"],["LANGUAGE","\u8a9e\u8a00"],["LIVE","\u76f4\u64ad"],["LOOP","\u5faa\u74b0\u64ad\u653e"],["MORE_SETTINGS","\u986f\u793a\u66f4\u591a\u8a2d\u5b9a"],["MULTIPLE_LANGUAGES","\u591a\u7a2e\u8a9e\u8a00"],["MUTE","\u975c\u97f3"],["NOT_APPLICABLE","\u4e0d\u9069\u7528"],["OFF","\u95dc\u9589"],["ON","\u958b\u555f"],["PAUSE","\u66ab\u505c"],["PICTURE_IN_PICTURE","\u5b50\u6bcd\u756b\u9762"],["PLAY","\u64ad\u653e"],["PLAYBACK_RATE","\u64ad\u653e\u901f\u5ea6"],["RESOLUTION","\u89e3\u6790\u5ea6"],["REWIND","\u5012\u8f49"],["SEEK","\u641c\u5c0b"],["SKIP_AD","\u7565\u904e\u5ee3\u544a"],["SKIP_TO_LIVE","\u8df3\u81f3\u5f53\u524d\u76f4\u64ad"],["UNDETERMINED_LANGUAGE","\u4e0d\u660e"],["UNMUTE","\u53d6\u6d88\u975c\u97f3"],["UNRECOGNIZED_LANGUAGE","\u7121\u6cd5\u8fa8\u8b58"],["VOLUME","\u97f3\u91cf"]]))},shaka.ui.Locales.Ids={MUTE:"MUTE",AUTO_QUALITY:"AUTO_QUALITY",CAPTIONS:"CAPTIONS",AD_DURATION:"AD_DURATION",PICTURE_IN_PICTURE:"PICTURE_IN_PICTURE",CAST:"CAST",ENTER_LOOP_MODE:"ENTER_LOOP_MODE",LOOP:"LOOP",OFF:"OFF",AIRPLAY:"AIRPLAY",FULL_SCREEN:"FULL_SCREEN",BACK:"BACK",EXIT_FULL_SCREEN:"EXIT_FULL_SCREEN",VOLUME:"VOLUME",SKIP_TO_LIVE:"SKIP_TO_LIVE",UNMUTE:"UNMUTE",MULTIPLE_LANGUAGES:"MULTIPLE_LANGUAGES",SKIP_AD:"SKIP_AD",ON:"ON",LIVE:"LIVE",SEEK:"SEEK",UNDETERMINED_LANGUAGE:"UNDETERMINED_LANGUAGE",UNRECOGNIZED_LANGUAGE:"UNRECOGNIZED_LANGUAGE",NOT_APPLICABLE:"NOT_APPLICABLE",PAUSE:"PAUSE",FAST_FORWARD:"FAST_FORWARD",RESOLUTION:"RESOLUTION",EXIT_LOOP_MODE:"EXIT_LOOP_MODE",SUBTITLE_FORCED:"SUBTITLE_FORCED",AD_TIME:"AD_TIME",MORE_SETTINGS:"MORE_SETTINGS",LANGUAGE:"LANGUAGE",PLAYBACK_RATE:"PLAYBACK_RATE",AD_PROGRESS:"AD_PROGRESS",REWIND:"REWIND",ENTER_PICTURE_IN_PICTURE:"ENTER_PICTURE_IN_PICTURE",PLAY:"PLAY",EXIT_PICTURE_IN_PICTURE:"EXIT_PICTURE_IN_PICTURE"},shaka.abr={},shaka.abr.Ewma=function(t){goog.asserts.assert(0<t,"expected halfLife to be positive"),this.alpha_=Math.exp(Math.log(.5)/t),this.totalWeight_=this.estimate_=0},shaka.abr.Ewma.prototype.sample=function(t,i){var r=Math.pow(this.alpha_,t);r=i*(1-r)+r*this.estimate_,isNaN(r)||(this.estimate_=r,this.totalWeight_+=t)},shaka.abr.Ewma.prototype.getEstimate=function(){return this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_))},shaka.abr.EwmaBandwidthEstimator=function(){this.fast_=new shaka.abr.Ewma(2),this.slow_=new shaka.abr.Ewma(5),this.bytesSampled_=0,this.minTotalBytes_=128e3,this.minBytes_=16e3},shaka.abr.EwmaBandwidthEstimator.prototype.sample=function(t,i){if(!(i<this.minBytes_)){var r=8e3*i/t,o=t/1e3;this.bytesSampled_+=i,this.fast_.sample(o,r),this.slow_.sample(o,r)}},shaka.abr.EwmaBandwidthEstimator.prototype.getBandwidthEstimate=function(t){return this.bytesSampled_<this.minTotalBytes_?t:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())},shaka.abr.EwmaBandwidthEstimator.prototype.hasGoodEstimate=function(){return this.bytesSampled_>=this.minTotalBytes_},shaka.util.BufferUtils=function(){},shaka.util.BufferUtils.equal=function(t,i){var r=shaka.util.BufferUtils;if(!t&&!i)return!0;if(!t||!i||t.byteLength!=i.byteLength)return!1;if(r.unsafeGetArrayBuffer_(t)==r.unsafeGetArrayBuffer_(i)&&(t.byteOffset||0)==(i.byteOffset||0))return!0;r=shaka.util.BufferUtils.toUint8(t);for(var o=shaka.util.BufferUtils.toUint8(i),l=$jscomp.makeIterator(shaka.util.Iterables.range(t.byteLength)),g=l.next();!g.done;g=l.next())if(r[g=g.value]!=o[g])return!1;return!0},shaka.util.BufferUtils.unsafeGetArrayBuffer_=function(t){return t instanceof ArrayBuffer?t:t.buffer},shaka.util.BufferUtils.toArrayBuffer=function(t){return t instanceof ArrayBuffer?t:0==t.byteOffset&&t.byteLength==t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer},shaka.util.BufferUtils.toUint8=function(t,i,r){return shaka.util.BufferUtils.view_(t,void 0===i?0:i,r=void 0===r?1/0:r,Uint8Array)},shaka.util.BufferUtils.toDataView=function(t,i,r){return shaka.util.BufferUtils.view_(t,void 0===i?0:i,r=void 0===r?1/0:r,DataView)},shaka.util.BufferUtils.view_=function(t,i,r,o){var l=shaka.util.BufferUtils.unsafeGetArrayBuffer_(t),g=(t.byteOffset||0)+t.byteLength;return new o(l,t=Math.max(0,Math.min((t.byteOffset||0)+i,g)),Math.min(t+Math.max(r,0),g)-t)},goog.exportSymbol("shaka.util.BufferUtils",shaka.util.BufferUtils),goog.exportProperty(shaka.util.BufferUtils,"toDataView",shaka.util.BufferUtils.toDataView),goog.exportProperty(shaka.util.BufferUtils,"toUint8",shaka.util.BufferUtils.toUint8),goog.exportProperty(shaka.util.BufferUtils,"toArrayBuffer",shaka.util.BufferUtils.toArrayBuffer),goog.exportProperty(shaka.util.BufferUtils,"equal",shaka.util.BufferUtils.equal),shaka.util.Lazy=function(t){this.gen_=t,this.value_=void 0},shaka.util.Lazy.prototype.value=function(){return null==this.value_&&(this.value_=this.gen_(),goog.asserts.assert(null!=this.value_,"Unable to create lazy value")),this.value_},shaka.util.Lazy.prototype.reset=function(){this.value_=void 0},shaka.util.StringUtils=function(){},shaka.util.StringUtils.fromUTF8=function(t){return t?(239==(t=shaka.util.BufferUtils.toUint8(t))[0]&&187==t[1]&&191==t[2]&&(t=t.subarray(3)),(t=(new TextDecoder).decode(t)).includes("\ufffd")&&shaka.log.alwaysError('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),t):""},shaka.util.StringUtils.fromUTF16=function(t,i,r){if(!t)return"";if(!r&&t.byteLength%2!=0)throw shaka.log.error("Data has an incorrect length, must be even."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING);var o=Math.floor(t.byteLength/2);r=new Uint16Array(o),t=shaka.util.BufferUtils.toDataView(t);for(var l=(o=$jscomp.makeIterator(shaka.util.Iterables.range(o))).next();!l.done;l=o.next())r[l=l.value]=t.getUint16(2*l,i);return shaka.util.StringUtils.fromCharCode(r)},shaka.util.StringUtils.fromBytesAutoDetect=function(t){var i=shaka.util.StringUtils;if(!t)return"";var r=shaka.util.BufferUtils.toUint8(t);if(239==r[0]&&187==r[1]&&191==r[2])return i.fromUTF8(r);if(254==r[0]&&255==r[1])return i.fromUTF16(r.subarray(2),!1);if(255==r[0]&&254==r[1])return i.fromUTF16(r.subarray(2),!0);var o=function(l){return r.byteLength<=l||32<=r[l]&&126>=r[l]};if(shaka.log.debug("Unable to find byte-order-mark, making an educated guess."),0==r[0]&&0==r[2])return i.fromUTF16(t,!1);if(0==r[1]&&0==r[3])return i.fromUTF16(t,!0);if(o(0)&&o(1)&&o(2)&&o(3))return i.fromUTF8(t);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.UNABLE_TO_DETECT_ENCODING)},shaka.util.StringUtils.toUTF8=function(t){var i=new TextEncoder;return shaka.util.BufferUtils.toArrayBuffer(i.encode(t))},shaka.util.StringUtils.toUTF16=function(t,i){for(var r=new ArrayBuffer(2*t.length),o=new DataView(r),l=$jscomp.makeIterator(shaka.util.Iterables.enumerate(t)),g=l.next();!g.done;g=l.next()){var _=g.value;g=_.i,_=_.item.charCodeAt(0),o.setUint16(2*g,_,i)}return r},shaka.util.StringUtils.fromCharCode=function(t){return shaka.util.StringUtils.fromCharCodeImpl_.value()(t)},shaka.util.StringUtils.resetFromCharCode=function(){shaka.util.StringUtils.fromCharCodeImpl_.reset()},goog.exportSymbol("shaka.util.StringUtils",shaka.util.StringUtils),goog.exportProperty(shaka.util.StringUtils,"resetFromCharCode",shaka.util.StringUtils.resetFromCharCode),goog.exportProperty(shaka.util.StringUtils,"toUTF16",shaka.util.StringUtils.toUTF16),goog.exportProperty(shaka.util.StringUtils,"toUTF8",shaka.util.StringUtils.toUTF8),goog.exportProperty(shaka.util.StringUtils,"fromBytesAutoDetect",shaka.util.StringUtils.fromBytesAutoDetect),goog.exportProperty(shaka.util.StringUtils,"fromUTF16",shaka.util.StringUtils.fromUTF16),goog.exportProperty(shaka.util.StringUtils,"fromUTF8",shaka.util.StringUtils.fromUTF8),shaka.util.StringUtils.fromCharCodeImpl_=new shaka.util.Lazy(function(){for(var t=function(r){try{var o=new Uint8Array(r),l=String.fromCharCode.apply(null,o);return goog.asserts.assert(l,"Should get value"),0<l.length}catch(g){return!1}},i={$jscomp$loop$prop$size$617:65536};0<i.$jscomp$loop$prop$size$617;(i={$jscomp$loop$prop$size$617:i.$jscomp$loop$prop$size$617}).$jscomp$loop$prop$size$617/=2)if(t(i.$jscomp$loop$prop$size$617))return function(r){return function(o){for(var l="",g=0;g<o.length;g+=r.$jscomp$loop$prop$size$617){var _=o.subarray(g,g+r.$jscomp$loop$prop$size$617);l+=String.fromCharCode.apply(null,_)}return l}}(i);return goog.asserts.assert(!1,"Unable to create a fromCharCode method"),null}),shaka.util.DataViewReader=function(t,i){this.dataView_=shaka.util.BufferUtils.toDataView(t),this.littleEndian_=i==shaka.util.DataViewReader.Endianness.LITTLE_ENDIAN,this.position_=0},shaka.util.DataViewReader.prototype.getDataView=function(){return this.dataView_},shaka.util.DataViewReader.prototype.hasMoreData=function(){return this.position_<this.dataView_.byteLength},shaka.util.DataViewReader.prototype.getPosition=function(){return this.position_},shaka.util.DataViewReader.prototype.getLength=function(){return this.dataView_.byteLength},shaka.util.DataViewReader.prototype.readUint8=function(){try{var t=this.dataView_.getUint8(this.position_);return this.position_+=1,t}catch(i){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint16=function(){try{var t=this.dataView_.getUint16(this.position_,this.littleEndian_);return this.position_+=2,t}catch(i){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint32=function(){try{var t=this.dataView_.getUint32(this.position_,this.littleEndian_);return this.position_+=4,t}catch(i){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readInt32=function(){try{var t=this.dataView_.getInt32(this.position_,this.littleEndian_);return this.position_+=4,t}catch(i){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint64=function(){try{if(this.littleEndian_)var t=this.dataView_.getUint32(this.position_,!0),i=this.dataView_.getUint32(this.position_+4,!0);else i=this.dataView_.getUint32(this.position_,!1),t=this.dataView_.getUint32(this.position_+4,!1)}catch(r){throw this.outOfBounds_()}if(2097151<i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);return this.position_+=8,i*Math.pow(2,32)+t},shaka.util.DataViewReader.prototype.readBytes=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.readBytes"),this.position_+t>this.dataView_.byteLength)throw this.outOfBounds_();var i=shaka.util.BufferUtils.toUint8(this.dataView_,this.position_,t);return this.position_+=t,i},shaka.util.DataViewReader.prototype.skip=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.skip"),this.position_+t>this.dataView_.byteLength)throw this.outOfBounds_();this.position_+=t},shaka.util.DataViewReader.prototype.rewind=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.rewind"),this.position_<t)throw this.outOfBounds_();this.position_-=t},shaka.util.DataViewReader.prototype.seek=function(t){if(goog.asserts.assert(0<=t,"Bad call to DataViewReader.seek"),0>t||t>this.dataView_.byteLength)throw this.outOfBounds_();this.position_=t},shaka.util.DataViewReader.prototype.readTerminatedString=function(){for(var t=this.position_;this.hasMoreData()&&0!=this.dataView_.getUint8(this.position_);)this.position_+=1;return t=shaka.util.BufferUtils.toUint8(this.dataView_,t,this.position_-t),this.position_+=1,shaka.util.StringUtils.fromUTF8(t)},shaka.util.DataViewReader.prototype.outOfBounds_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)},goog.exportSymbol("shaka.util.DataViewReader",shaka.util.DataViewReader),goog.exportProperty(shaka.util.DataViewReader.prototype,"readTerminatedString",shaka.util.DataViewReader.prototype.readTerminatedString),goog.exportProperty(shaka.util.DataViewReader.prototype,"seek",shaka.util.DataViewReader.prototype.seek),goog.exportProperty(shaka.util.DataViewReader.prototype,"rewind",shaka.util.DataViewReader.prototype.rewind),goog.exportProperty(shaka.util.DataViewReader.prototype,"skip",shaka.util.DataViewReader.prototype.skip),goog.exportProperty(shaka.util.DataViewReader.prototype,"readBytes",shaka.util.DataViewReader.prototype.readBytes),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint64",shaka.util.DataViewReader.prototype.readUint64),goog.exportProperty(shaka.util.DataViewReader.prototype,"readInt32",shaka.util.DataViewReader.prototype.readInt32),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint32",shaka.util.DataViewReader.prototype.readUint32),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint16",shaka.util.DataViewReader.prototype.readUint16),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint8",shaka.util.DataViewReader.prototype.readUint8),goog.exportProperty(shaka.util.DataViewReader.prototype,"getLength",shaka.util.DataViewReader.prototype.getLength),goog.exportProperty(shaka.util.DataViewReader.prototype,"getPosition",shaka.util.DataViewReader.prototype.getPosition),goog.exportProperty(shaka.util.DataViewReader.prototype,"hasMoreData",shaka.util.DataViewReader.prototype.hasMoreData),shaka.util.DataViewReader.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:1},goog.exportProperty(shaka.util.DataViewReader,"Endianness",shaka.util.DataViewReader.Endianness),shaka.util.Mp4Parser=function(){this.headers_=[],this.boxDefinitions_=[],this.done_=!1},shaka.util.Mp4Parser.prototype.box=function(t,i){var r=shaka.util.Mp4Parser.typeFromString_(t);return this.headers_[r]=shaka.util.Mp4Parser.BoxType_.BASIC_BOX,this.boxDefinitions_[r]=i,this},shaka.util.Mp4Parser.prototype.fullBox=function(t,i){var r=shaka.util.Mp4Parser.typeFromString_(t);return this.headers_[r]=shaka.util.Mp4Parser.BoxType_.FULL_BOX,this.boxDefinitions_[r]=i,this},shaka.util.Mp4Parser.prototype.stop=function(){this.done_=!0},shaka.util.Mp4Parser.prototype.parse=function(t,i,r){for(t=new shaka.util.DataViewReader(t,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),this.done_=!1;t.hasMoreData()&&!this.done_;)this.parseNext(0,t,i,r)},shaka.util.Mp4Parser.prototype.parseNext=function(t,i,r,o){var l=i.getPosition(),g=i.readUint32(),_=i.readUint32(),v=shaka.util.Mp4Parser.typeToString(_),E=!1;switch(shaka.log.v2("Parsing MP4 box",v),g){case 0:g=i.getLength()-l;break;case 1:g=i.readUint64(),E=!0}if(v=this.boxDefinitions_[_]){var P=null,M=null;this.headers_[_]==shaka.util.Mp4Parser.BoxType_.FULL_BOX&&(P=(M=i.readUint32())>>>24,M&=16777215),_=l+g,r&&_>i.getLength()&&(_=i.getLength()),o&&_>i.getLength()?this.done_=!0:(o=_-i.getPosition(),i=0<o?i.readBytes(o):new Uint8Array(0),v({parser:this,partialOkay:r||!1,version:P,flags:M,reader:i=new shaka.util.DataViewReader(i,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),size:g,start:l+t,has64BitSize:E}))}else t=Math.min(l+g-i.getPosition(),i.getLength()-i.getPosition()),i.skip(t)},shaka.util.Mp4Parser.children=function(t){for(var i=shaka.util.Mp4Parser.headerSize(t);t.reader.hasMoreData()&&!t.parser.done_;)t.parser.parseNext(t.start+i,t.reader,t.partialOkay)},shaka.util.Mp4Parser.sampleDescription=function(t){for(var i=shaka.util.Mp4Parser.headerSize(t),r=t.reader.readUint32(),o=(r=$jscomp.makeIterator(shaka.util.Iterables.range(r))).next();!o.done&&(shaka.util.Functional.ignored(o.value),t.parser.parseNext(t.start+i,t.reader,t.partialOkay),!t.parser.done_);o=r.next());},shaka.util.Mp4Parser.allData=function(t){return function(i){var r=i.reader.getLength()-i.reader.getPosition();t(i.reader.readBytes(r))}},shaka.util.Mp4Parser.typeFromString_=function(t){goog.asserts.assert(4==t.length,"Mp4 box names must be 4 characters long");for(var i=0,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())i=i<<8|r.value.charCodeAt(0);return i},shaka.util.Mp4Parser.typeToString=function(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)},shaka.util.Mp4Parser.headerSize=function(t){return 8+(t.has64BitSize?8:0)+(null!=t.flags?4:0)},goog.exportSymbol("shaka.util.Mp4Parser",shaka.util.Mp4Parser),goog.exportProperty(shaka.util.Mp4Parser,"headerSize",shaka.util.Mp4Parser.headerSize),goog.exportProperty(shaka.util.Mp4Parser,"typeToString",shaka.util.Mp4Parser.typeToString),goog.exportProperty(shaka.util.Mp4Parser,"allData",shaka.util.Mp4Parser.allData),goog.exportProperty(shaka.util.Mp4Parser,"sampleDescription",shaka.util.Mp4Parser.sampleDescription),goog.exportProperty(shaka.util.Mp4Parser,"children",shaka.util.Mp4Parser.children),goog.exportProperty(shaka.util.Mp4Parser.prototype,"parseNext",shaka.util.Mp4Parser.prototype.parseNext),goog.exportProperty(shaka.util.Mp4Parser.prototype,"parse",shaka.util.Mp4Parser.prototype.parse),goog.exportProperty(shaka.util.Mp4Parser.prototype,"stop",shaka.util.Mp4Parser.prototype.stop),goog.exportProperty(shaka.util.Mp4Parser.prototype,"fullBox",shaka.util.Mp4Parser.prototype.fullBox),goog.exportProperty(shaka.util.Mp4Parser.prototype,"box",shaka.util.Mp4Parser.prototype.box),shaka.util.Mp4Parser.BoxType_={BASIC_BOX:0,FULL_BOX:1},shaka.util.DelayedTick=function(t){this.onTick_=t,this.cancelPending_=null},shaka.util.DelayedTick.prototype.tickAfter=function(t){var i=this;this.stop();var r=!0,o=null;return this.cancelPending_=function(){window.clearTimeout(o),r=!1},o=window.setTimeout(function(){r&&i.onTick_()},1e3*t),this},shaka.util.DelayedTick.prototype.stop=function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)},shaka.util.Timer=function(t){this.onTick_=t,this.ticker_=null},shaka.util.Timer.prototype.tickNow=function(){return this.stop(),this.onTick_(),this},shaka.util.Timer.prototype.tickAfter=function(t){var i=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick(function(){i.onTick_()}).tickAfter(t),this},shaka.util.Timer.prototype.tickEvery=function(t){var i=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick(function(){i.ticker_.tickAfter(t),i.onTick_()}).tickAfter(t),this},shaka.util.Timer.prototype.stop=function(){this.ticker_&&(this.ticker_.stop(),this.ticker_=null)},goog.exportSymbol("shaka.util.Timer",shaka.util.Timer),goog.exportProperty(shaka.util.Timer.prototype,"stop",shaka.util.Timer.prototype.stop),goog.exportProperty(shaka.util.Timer.prototype,"tickEvery",shaka.util.Timer.prototype.tickEvery),goog.exportProperty(shaka.util.Timer.prototype,"tickAfter",shaka.util.Timer.prototype.tickAfter),goog.exportProperty(shaka.util.Timer.prototype,"tickNow",shaka.util.Timer.prototype.tickNow),shaka.util.Platform=function(){},shaka.util.Platform.supportsMediaSource=function(){return!(!window.MediaSource||!MediaSource.isTypeSupported)},shaka.util.Platform.supportsMediaType=function(t){return""!=shaka.util.Platform.anyMediaElement().canPlayType(t)},shaka.util.Platform.isEdge=function(){return!!navigator.userAgent.match(/Edge?\//)},shaka.util.Platform.isLegacyEdge=function(){return!!navigator.userAgent.match(/Edge\//)},shaka.util.Platform.isIE=function(){return shaka.util.Platform.userAgentContains_("Trident/")},shaka.util.Platform.isXboxOne=function(){return shaka.util.Platform.userAgentContains_("Xbox One")},shaka.util.Platform.isTizen=function(){return shaka.util.Platform.userAgentContains_("Tizen")},shaka.util.Platform.isTizen4=function(){return shaka.util.Platform.userAgentContains_("Tizen 4")},shaka.util.Platform.isTizen3=function(){return shaka.util.Platform.userAgentContains_("Tizen 3")},shaka.util.Platform.isTizen2=function(){return shaka.util.Platform.userAgentContains_("Tizen 2")},shaka.util.Platform.isWebOS=function(){return shaka.util.Platform.userAgentContains_("Web0S")},shaka.util.Platform.isChromecast=function(){return shaka.util.Platform.userAgentContains_("CrKey")},shaka.util.Platform.isChrome=function(){return shaka.util.Platform.userAgentContains_("Chrome")&&!shaka.util.Platform.isEdge()},shaka.util.Platform.isApple=function(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!shaka.util.Platform.isTizen()},shaka.util.Platform.safariVersion=function(){if(!shaka.util.Platform.isApple())return null;var t=navigator.userAgent.match(/Version\/(\d+)/);return t||(t=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(t[1],10):null},shaka.util.Platform.isMobile=function(){return!!/(?:iPhone|iPad|iPod|Android)/.test(navigator.userAgent)||shaka.util.Platform.isApple()&&1<navigator.maxTouchPoints},shaka.util.Platform.userAgentContains_=function(t){return(navigator.userAgent||"").includes(t)},shaka.util.Platform.anyMediaElement=function(){var t=shaka.util.Platform;return t.cachedMediaElement_||(t.cacheExpirationTimer_||(t.cacheExpirationTimer_=new shaka.util.Timer(function(){t.cachedMediaElement_=null})),t.cachedMediaElement_=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0],t.cachedMediaElement_||(t.cachedMediaElement_=document.createElement("video")),t.cacheExpirationTimer_.tickAfter(1)),t.cachedMediaElement_},shaka.util.Platform.requiresEncryptionInfoInAllInitSegments=function(){var t=shaka.util.Platform;return t.isTizen()||t.isXboxOne()},shaka.util.Platform.cacheExpirationTimer_=null,shaka.util.Platform.cachedMediaElement_=null,shaka.util.Uint8ArrayUtils=function(){},shaka.util.Uint8ArrayUtils.equal=function(t,i){return shaka.Deprecate.deprecateFeature(4,"shaka.util.Uint8ArrayUtils.equal","Please use shaka.util.BufferUtils.equal instead."),shaka.util.BufferUtils.equal(t,i)},shaka.util.Uint8ArrayUtils.toStandardBase64=function(t){return t=shaka.util.StringUtils.fromCharCode(shaka.util.BufferUtils.toUint8(t)),btoa(t)},shaka.util.Uint8ArrayUtils.toBase64=function(t,i){i=null==i||i;var r=shaka.util.Uint8ArrayUtils.toStandardBase64(t).replace(/\+/g,"-").replace(/\//g,"_");return i?r:r.replace(/[=]*$/,"")},shaka.util.Uint8ArrayUtils.fromBase64=function(t){var i=window.atob(t.replace(/-/g,"+").replace(/_/g,"/"));t=new Uint8Array(i.length);for(var r=(i=$jscomp.makeIterator(shaka.util.Iterables.enumerate(i))).next();!r.done;r=i.next())t[(r=r.value).i]=r.item.charCodeAt(0);return t},shaka.util.Uint8ArrayUtils.fromHex=function(t){for(var i=t.length/2,r=new Uint8Array(i),o=(i=$jscomp.makeIterator(shaka.util.Iterables.range(i))).next();!o.done;o=i.next())r[o=o.value]=window.parseInt(t.substr(2*o,2),16);return r},shaka.util.Uint8ArrayUtils.toHex=function(t){var i=shaka.util.BufferUtils.toUint8(t);t="";for(var r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())1==(r=(r=r.value).toString(16)).length&&(r="0"+r),t+=r;return t},shaka.util.Uint8ArrayUtils.concat=function(t){for(var i=[],r=0;r<arguments.length;++r)i[r-0]=arguments[r];var o=0,l=$jscomp.makeIterator(i);for(r=l.next();!r.done;r=l.next())o+=r.value.byteLength;for(o=new Uint8Array(o),l=0,r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())o.set(shaka.util.BufferUtils.toUint8(r=r.value),l),l+=r.byteLength;return o},goog.exportSymbol("shaka.util.Uint8ArrayUtils",shaka.util.Uint8ArrayUtils),goog.exportProperty(shaka.util.Uint8ArrayUtils,"concat",shaka.util.Uint8ArrayUtils.concat),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toHex",shaka.util.Uint8ArrayUtils.toHex),goog.exportProperty(shaka.util.Uint8ArrayUtils,"fromHex",shaka.util.Uint8ArrayUtils.fromHex),goog.exportProperty(shaka.util.Uint8ArrayUtils,"fromBase64",shaka.util.Uint8ArrayUtils.fromBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toBase64",shaka.util.Uint8ArrayUtils.toBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toStandardBase64",shaka.util.Uint8ArrayUtils.toStandardBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"equal",shaka.util.Uint8ArrayUtils.equal),shaka.media={},shaka.media.ContentWorkarounds=function(){},shaka.media.ContentWorkarounds.fakeEncryption=function(t){var i=shaka.media.ContentWorkarounds;t=shaka.util.BufferUtils.toUint8(t);var o,r=!1,l=[],g=function(P){l.push(P),shaka.util.Mp4Parser.children(P)},_=function(P){r=!0},v=[];if((new shaka.util.Mp4Parser).box("moov",g).box("trak",g).box("mdia",g).box("minf",g).box("stbl",g).fullBox("stsd",function(P){o=P,l.push(P),shaka.util.Mp4Parser.sampleDescription(P)}).fullBox("encv",_).fullBox("enca",_).fullBox("avc1",function(P){v.push({box:P,newType:i.BOX_TYPE_ENCV_})}).fullBox("mp4a",function(P){v.push({box:P,newType:i.BOX_TYPE_ENCA_})}).parse(t),r)return shaka.log.debug("Init segment already indicates encryption."),t;if(0==v.length||!o)throw shaka.log.error("Failed to find boxes needed to fake encryption!"),shaka.log.v2("Failed init segment (hex):",shaka.util.Uint8ArrayUtils.toHex(t)),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.CONTENT_TRANSFORMATION_FAILED);for(v.reverse(),_=(g=$jscomp.makeIterator(v)).next();!_.done;_=g.next()){var E=shaka.util.Mp4Parser.typeToString((_=_.value).newType);shaka.log.debug('Inserting "'+E+'" box into init segment.'),t=i.insertEncryptionMetadata_(t,o,_.box,l,_.newType)}return t},shaka.media.ContentWorkarounds.insertEncryptionMetadata_=function(t,i,r,o,l){var g=shaka.media.ContentWorkarounds,_=g.createEncryptionMetadata_(t,r,l);l=new Uint8Array(t.byteLength+_.byteLength),r=shaka.util.Platform.isXboxOne()?r.start:r.start+r.size;var v=t.subarray(0,r);for(t=t.subarray(r),l.set(v),l.set(_,r),l.set(t,r+_.byteLength),t=(o=$jscomp.makeIterator(o)).next();!t.done;t=o.next())goog.asserts.assert((t=t.value).start<r,"Ancestor MP4 box found in the wrong location!  Modified init segment will not make sense!"),g.updateBoxSize_(l,t.start,t.size+_.byteLength);return g=shaka.util.BufferUtils.toDataView(l,i.start),i=shaka.util.Mp4Parser.headerSize(i),_=g.getUint32(i),g.setUint32(i,_+1),l},shaka.media.ContentWorkarounds.createEncryptionMetadata_=function(t,i,r){var o=shaka.media.ContentWorkarounds,l=o.CANNED_SINF_BOX_.value(),g=t.subarray(i.start,i.start+i.size),_=shaka.util.BufferUtils.toDataView(g);return(t=new Uint8Array(i.size+l.byteLength)).set(g,0),(g=shaka.util.BufferUtils.toDataView(t)).setUint32(o.BOX_TYPE_OFFSET_,r),t.set(l,i.size),r=_.getUint32(o.BOX_TYPE_OFFSET_),g.setUint32(i.size+o.CANNED_SINF_BOX_FORMAT_OFFSET_,r),o.updateBoxSize_(t,0,t.byteLength),t},shaka.media.ContentWorkarounds.updateBoxSize_=function(t,i,r){var o=shaka.media.ContentWorkarounds;0!=(i=(t=shaka.util.BufferUtils.toDataView(t,i)).getUint32(o.BOX_SIZE_OFFSET_))&&(1==i?(t.setUint32(o.BOX_SIZE_64_OFFSET_,r>>32),t.setUint32(o.BOX_SIZE_64_OFFSET_+4,4294967295&r)):t.setUint32(o.BOX_SIZE_OFFSET_,r))},shaka.media.ContentWorkarounds.CANNED_SINF_BOX_=new shaka.util.Lazy(function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}),shaka.media.ContentWorkarounds.CANNED_SINF_BOX_FORMAT_OFFSET_=16,shaka.media.ContentWorkarounds.BOX_SIZE_OFFSET_=0,shaka.media.ContentWorkarounds.BOX_TYPE_OFFSET_=4,shaka.media.ContentWorkarounds.BOX_SIZE_64_OFFSET_=8,shaka.media.ContentWorkarounds.BOX_TYPE_ENCV_=1701733238,shaka.media.ContentWorkarounds.BOX_TYPE_ENCA_=1701733217,shaka.util.ArrayUtils=function(){},shaka.util.ArrayUtils.defaultEquals=function(t,i){return!("number"!=typeof t||"number"!=typeof i||!isNaN(t)||!isNaN(i))||t===i},shaka.util.ArrayUtils.remove=function(t,i){var r=t.indexOf(i);-1<r&&t.splice(r,1)},shaka.util.ArrayUtils.count=function(t,i){for(var r=0,o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())r+=i(l.value)?1:0;return r},shaka.util.ArrayUtils.hasSameElements=function(t,i,r){if(r||(r=shaka.util.ArrayUtils.defaultEquals),t.length!=i.length)return!1;i=i.slice();for(var o={},l=(t=$jscomp.makeIterator(t)).next();!l.done;o={$jscomp$loop$prop$item$619:o.$jscomp$loop$prop$item$619},l=t.next()){if(o.$jscomp$loop$prop$item$619=l.value,-1==(l=i.findIndex(function(g){return function(_){return r(g.$jscomp$loop$prop$item$619,_)}}(o))))return!1;i[l]=i[i.length-1],i.pop()}return 0==i.length},shaka.util.ArrayUtils.equal=function(t,i,r){if(r||(r=shaka.util.ArrayUtils.defaultEquals),t.length!=i.length)return!1;for(var o=0;o<t.length;o++)if(!r(t[o],i[o]))return!1;return!0},shaka.text={},shaka.text.Cue=function(t,i,r){var o=shaka.text.Cue;this.startTime=t,this.direction=o.direction.HORIZONTAL_LEFT_TO_RIGHT,this.endTime=i,this.payload=r,this.region=new shaka.text.CueRegion,this.position=null,this.positionAlign=o.positionAlign.AUTO,this.size=0,this.textAlign=o.textAlign.CENTER,this.writingMode=o.writingMode.HORIZONTAL_TOP_TO_BOTTOM,this.lineInterpretation=o.lineInterpretation.LINE_NUMBER,this.line=null,this.lineHeight="",this.lineAlign=o.lineAlign.START,this.displayAlign=o.displayAlign.AFTER,this.fontSize=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=o.fontWeight.NORMAL,this.fontStyle=o.fontStyle.NORMAL,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=this.lineBreak=!1,this.cellResolution={columns:32,rows:15}},shaka.text.Cue.prototype.clone=function(){var i,t=new shaka.text.Cue(0,0,"");for(i in this)t[i]=this[i],t[i]&&t[i].constructor==Array&&(t[i]=t[i].slice());return t},shaka.text.Cue.equal=function(t,i){if(t.startTime!=i.startTime||t.endTime!=i.endTime||t.payload!=i.payload)return!1;for(var r in t)if("startTime"!=r&&"endTime"!=r&&"payload"!=r)if("nestedCues"==r){if(!shaka.util.ArrayUtils.equal(t.nestedCues,i.nestedCues,shaka.text.Cue.equal))return!1}else if("region"==r||"cellResolution"==r){for(var o in t[r])if(t[r][o]!=i[r][o])return!1}else if(Array.isArray(t[r])){if(!shaka.util.ArrayUtils.equal(t[r],i[r]))return!1}else if(t[r]!=i[r])return!1;return!0},goog.exportSymbol("shaka.text.Cue",shaka.text.Cue),shaka.text.Cue.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:"auto"},goog.exportProperty(shaka.text.Cue,"positionAlign",shaka.text.Cue.positionAlign),shaka.text.Cue.textAlign={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"textAlign",shaka.text.Cue.textAlign),shaka.text.Cue.displayAlign={BEFORE:"before",CENTER:"center",AFTER:"after"},goog.exportProperty(shaka.text.Cue,"displayAlign",shaka.text.Cue.displayAlign),shaka.text.Cue.direction={HORIZONTAL_LEFT_TO_RIGHT:"ltr",HORIZONTAL_RIGHT_TO_LEFT:"rtl"},goog.exportProperty(shaka.text.Cue,"direction",shaka.text.Cue.direction),shaka.text.Cue.writingMode={HORIZONTAL_TOP_TO_BOTTOM:"horizontal-tb",VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"},goog.exportProperty(shaka.text.Cue,"writingMode",shaka.text.Cue.writingMode),shaka.text.Cue.lineInterpretation={LINE_NUMBER:0,PERCENTAGE:1},goog.exportProperty(shaka.text.Cue,"lineInterpretation",shaka.text.Cue.lineInterpretation),shaka.text.Cue.lineAlign={CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"lineAlign",shaka.text.Cue.lineAlign),shaka.text.Cue.defaultTextColor={white:"#FFF",lime:"#0F0",cyan:"#0FF",red:"#F00",yellow:"#FF0",magenta:"#F0F",blue:"#00F",black:"#000"},goog.exportProperty(shaka.text.Cue,"defaultTextColor",shaka.text.Cue.defaultTextColor),shaka.text.Cue.defaultTextBackgroundColor={bg_white:"#FFF",bg_lime:"#0F0",bg_cyan:"#0FF",bg_red:"#F00",bg_yellow:"#FF0",bg_magenta:"#F0F",bg_blue:"#00F",bg_black:"#000"},goog.exportProperty(shaka.text.Cue,"defaultTextBackgroundColor",shaka.text.Cue.defaultTextBackgroundColor),shaka.text.Cue.fontWeight={NORMAL:400,BOLD:700},goog.exportProperty(shaka.text.Cue,"fontWeight",shaka.text.Cue.fontWeight),shaka.text.Cue.fontStyle={NORMAL:"normal",ITALIC:"italic",OBLIQUE:"oblique"},goog.exportProperty(shaka.text.Cue,"fontStyle",shaka.text.Cue.fontStyle),shaka.text.Cue.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},goog.exportProperty(shaka.text.Cue,"textDecoration",shaka.text.Cue.textDecoration),shaka.text.CueRegion=function(){var t=shaka.text.CueRegion;this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=t.units.PERCENTAGE,this.scroll=t.scrollMode.NONE},goog.exportSymbol("shaka.text.CueRegion",shaka.text.CueRegion),shaka.text.CueRegion.units={PX:0,PERCENTAGE:1,LINES:2},goog.exportProperty(shaka.text.CueRegion,"units",shaka.text.CueRegion.units),shaka.text.CueRegion.scrollMode={NONE:"",UP:"up"},goog.exportProperty(shaka.text.CueRegion,"scrollMode",shaka.text.CueRegion.scrollMode),shaka.cea={},shaka.cea.ICaptionDecoder=function(){},shaka.cea.ICaptionDecoder.prototype.extract=function(t,i){},shaka.cea.ICaptionDecoder.prototype.decode=function(){},shaka.cea.ICaptionDecoder.prototype.clear=function(){},shaka.cea.CeaUtils=function(){},shaka.cea.CeaUtils.getParsedCaption=function(t,i,r,o,l){if(o>=l)return null;for(var g=-1,_=-1,v=0;v<r.length;v++)if(r[v].some(function(te){return null!=te&&""!=te.getChar().trim()})){g=v;break}for(v=r.length-1;0<=v;v--)if(r[v].some(function(te){return null!=te&&""!=te.getChar().trim()})){_=v;break}if(-1===g||-1===_)return null;for(var E=v=!1,P=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,M=shaka.cea.CeaUtils.DEFAULT_BG_COLOR,R=shaka.cea.CeaUtils.createStyledCue(o,l,v,E,P,M);g<=_;g++){for(var U=r[g],$=-1,G=-1,z=0;z<U.length;z++)if(null!=U[z]&&""!==U[z].getChar().trim()){$=z;break}for(z=U.length-1;0<=z;z--)if(null!=U[z]&&""!==U[z].getChar().trim()){G=z;break}if(-1===$||-1===G)U=shaka.cea.CeaUtils.createLineBreakCue(o,l),t.nestedCues.push(U);else{for(;$<=G;$++)if(z=U[$]){var Z=z.isUnderlined(),Y=z.isItalicized(),se=z.getTextColor(),Q=z.getBackgroundColor();(Z!=v||Y!=E||se!=P||Q!=M)&&(R.payload&&t.nestedCues.push(R),R=shaka.cea.CeaUtils.createStyledCue(o,l,Z,Y,se,Q),v=Z,E=Y,P=se,M=Q),R.payload+=z.getChar()}else R.payload+=" ";R.payload&&t.nestedCues.push(R),g!==_&&(R=shaka.cea.CeaUtils.createLineBreakCue(o,l),t.nestedCues.push(R)),R=shaka.cea.CeaUtils.createStyledCue(o,l,v,E,P,M)}}return t.nestedCues.length?{cue:t,stream:i}:null},shaka.cea.CeaUtils.createStyledCue=function(t,i,r,o,l,g){return t=new shaka.text.Cue(t,i,""),r&&t.textDecoration.push(shaka.text.Cue.textDecoration.UNDERLINE),o&&(t.fontStyle=shaka.text.Cue.fontStyle.ITALIC),t.color=l,t.backgroundColor=g,t},shaka.cea.CeaUtils.createLineBreakCue=function(t,i){var r=new shaka.text.Cue(t,i,"");return r.lineBreak=!0,r},shaka.cea.CeaUtils.StyledChar=function(t,i,r,o,l){this.character_=t,this.underline_=i,this.italics_=r,this.backgroundColor_=o,this.textColor_=l},shaka.cea.CeaUtils.StyledChar.prototype.getChar=function(){return this.character_},shaka.cea.CeaUtils.StyledChar.prototype.isUnderlined=function(){return this.underline_},shaka.cea.CeaUtils.StyledChar.prototype.isItalicized=function(){return this.italics_},shaka.cea.CeaUtils.StyledChar.prototype.getBackgroundColor=function(){return this.backgroundColor_},shaka.cea.CeaUtils.StyledChar.prototype.getTextColor=function(){return this.textColor_},shaka.cea.CeaUtils.DEFAULT_BG_COLOR="black",shaka.cea.CeaUtils.DEFAULT_TXT_COLOR="white",shaka.cea.Cea708Window=function(t){this.windowNum_=t,this.relativeToggle_=this.visible_=!1,this.colCount_=this.rowCount_=this.anchorId_=this.verticalAnchor_=this.horizontalAnchor_=0,this.justification_=shaka.cea.Cea708Window.TextJustification.CENTER,this.memory_=[],this.col_=this.row_=this.startTime_=0,this.underline_=this.italics_=!1,this.textColor_=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.CeaUtils.DEFAULT_BG_COLOR,this.resetMemory(),shaka.util.Functional.ignored(this.verticalAnchor_,this.relativeToggle_,this.horizontalAnchor_,this.anchorId_,this.windowNum_)},shaka.cea.Cea708Window.prototype.defineWindow=function(t,i,r,o,l,g,_){this.visible_=t,this.verticalAnchor_=i,this.horizontalAnchor_=r,this.anchorId_=o,this.relativeToggle_=l,this.rowCount_=g,this.colCount_=_},shaka.cea.Cea708Window.prototype.resetMemory=function(){this.memory_=[];for(var t=0;t<shaka.cea.Cea708Window.MAX_ROWS;t++)this.memory_.push(this.createNewRow_())},shaka.cea.Cea708Window.prototype.createNewRow_=function(){for(var t=[],i=0;i<shaka.cea.Cea708Window.MAX_COLS;i++)t.push(null);return t},shaka.cea.Cea708Window.prototype.setCharacter=function(t){this.isPenInBounds_()&&(t=new shaka.cea.CeaUtils.StyledChar(t,this.underline_,this.italics_,this.backgroundColor_,this.textColor_),this.memory_[this.row_][this.col_]=t,this.col_++)},shaka.cea.Cea708Window.prototype.backspace=function(){!this.isPenInBounds_()||0>=this.col_&&0>=this.row_||(0>=this.col_?(this.col_=this.colCount_-1,this.row_--):this.col_--,this.memory_[this.row_][this.col_]=null)},shaka.cea.Cea708Window.prototype.isPenInBounds_=function(){return this.row_<this.rowCount_&&0<=this.row_&&this.col_<this.colCount_&&0<=this.col_},shaka.cea.Cea708Window.prototype.isVisible=function(){return this.visible_},shaka.cea.Cea708Window.prototype.moveUpRows_=function(t){for(var i=0,r=t;r<shaka.cea.Cea708Window.MAX_ROWS;r++,i++)this.memory_[i]=this.memory_[r];for(r=0;r<t;r++,i++)this.memory_[i]=this.createNewRow_()},shaka.cea.Cea708Window.prototype.carriageReturn=function(){this.row_+1>=this.rowCount_?this.moveUpRows_(1):this.row_++,this.col_=0},shaka.cea.Cea708Window.prototype.horizontalCarriageReturn=function(){this.memory_[this.row_]=this.createNewRow_(),this.col_=0},shaka.cea.Cea708Window.prototype.forceEmit=function(t,i){var r="svc"+i,o=shaka.cea.Cea708Window.TextJustification,l=new shaka.text.Cue(this.startTime_,t,"");return l.textAlign=this.justification_===o.LEFT?shaka.text.Cue.textAlign.LEFT:this.justification_===o.RIGHT?shaka.text.Cue.textAlign.RIGHT:shaka.text.Cue.textAlign.CENTER,(r=shaka.cea.CeaUtils.getParsedCaption(l,r,this.memory_,this.startTime_,t))&&this.setStartTime(t),r},shaka.cea.Cea708Window.prototype.setPenLocation=function(t,i){this.row_=t,this.col_=i},shaka.cea.Cea708Window.prototype.setPenBackgroundColor=function(t){this.backgroundColor_=t},shaka.cea.Cea708Window.prototype.setPenTextColor=function(t){this.textColor_=t},shaka.cea.Cea708Window.prototype.setPenUnderline=function(t){this.underline_=t},shaka.cea.Cea708Window.prototype.setPenItalics=function(t){this.italics_=t},shaka.cea.Cea708Window.prototype.resetPen=function(){this.col_=this.row_=0,this.italics_=this.underline_=!1,this.textColor_=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.CeaUtils.DEFAULT_BG_COLOR},shaka.cea.Cea708Window.prototype.setJustification=function(t){this.justification_=t},shaka.cea.Cea708Window.prototype.display=function(){this.visible_=!0},shaka.cea.Cea708Window.prototype.hide=function(){this.visible_=!1},shaka.cea.Cea708Window.prototype.toggle=function(){this.visible_=!this.visible_},shaka.cea.Cea708Window.prototype.setStartTime=function(t){this.startTime_=t},shaka.cea.Cea708Window.TextJustification={LEFT:0,RIGHT:1,CENTER:2,FULL:3},shaka.cea.Cea708Window.MAX_COLS=42,shaka.cea.Cea708Window.MAX_ROWS=15,shaka.cea.DtvccPacketBuilder=function(){this.builtPackets_=[],this.currentPacketBeingBuilt_=null,this.bytesLeftToAddInCurrentPacket_=0},shaka.cea.DtvccPacketBuilder.prototype.addByte=function(t){t.type===shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_START?(this.bytesLeftToAddInCurrentPacket_=2*(63&t.value)-1,this.currentPacketBeingBuilt_=[]):this.currentPacketBeingBuilt_&&(0<this.bytesLeftToAddInCurrentPacket_&&(this.currentPacketBeingBuilt_.push(t),this.bytesLeftToAddInCurrentPacket_--),0===this.bytesLeftToAddInCurrentPacket_&&(t=new shaka.cea.DtvccPacket(this.currentPacketBeingBuilt_),this.builtPackets_.push(t),this.currentPacketBeingBuilt_=null,this.bytesLeftToAddInCurrentPacket_=0))},shaka.cea.DtvccPacketBuilder.prototype.getBuiltPackets=function(){return this.builtPackets_},shaka.cea.DtvccPacketBuilder.prototype.clearBuiltPackets=function(){this.builtPackets_=[]},shaka.cea.DtvccPacketBuilder.prototype.clear=function(){this.builtPackets_=[],this.currentPacketBeingBuilt_=[],this.bytesLeftToAddInCurrentPacket_=0},shaka.cea.DtvccPacket=function(t){this.pos_=0,this.packetData_=t},shaka.cea.DtvccPacket.prototype.hasMoreData=function(){return this.pos_<this.packetData_.length},shaka.cea.DtvccPacket.prototype.getPosition=function(){return this.pos_},shaka.cea.DtvccPacket.prototype.readByte=function(){if(!this.hasMoreData())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS);return this.packetData_[this.pos_++]},shaka.cea.DtvccPacket.prototype.skip=function(t){if(this.pos_+t>this.packetData_.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS);this.pos_+=t},shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_DATA=2,shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_START=3,shaka.cea.Cea708Service=function(t){this.serviceNumber_=t,this.windows_=[null,null,null,null,null,null,null,null],this.currentWindow_=null},shaka.cea.Cea708Service.prototype.handleCea708ControlCode=function(t){var i=t.readByte(),r=i.value;return i=i.pts,r===shaka.cea.Cea708Service.EXT_CEA708_CTRL_CODE_BYTE1&&(r=r<<16|t.readByte().value),0<=r&&31>=r?this.handleC0_(r,i):128<=r&&159>=r?this.handleC1_(t,r,i):(4096<=r&&4127>=r?this.handleC2_(t,255&r):4224<=r&&4255>=r?this.handleC3_(t,255&r):32<=r&&127>=r?this.handleG0_(r):160<=r&&255>=r?this.handleG1_(r):4128<=r&&4223>=r?this.handleG2_(255&r):4256<=r&&4351>=r&&this.handleG3_(255&r),null)},shaka.cea.Cea708Service.prototype.handleG0_=function(t){this.currentWindow_&&this.currentWindow_.setCharacter(127===t?"\u266a":String.fromCharCode(t))},shaka.cea.Cea708Service.prototype.handleG1_=function(t){this.currentWindow_&&this.currentWindow_.setCharacter(String.fromCharCode(t))},shaka.cea.Cea708Service.prototype.handleG2_=function(t){this.currentWindow_&&(shaka.cea.Cea708Service.G2Charset.has(t)?(t=shaka.cea.Cea708Service.G2Charset.get(t),this.currentWindow_.setCharacter(t)):this.currentWindow_.setCharacter("_"))},shaka.cea.Cea708Service.prototype.handleG3_=function(t){this.currentWindow_&&this.currentWindow_.setCharacter(160!=t?"_":"[CC]")},shaka.cea.Cea708Service.prototype.handleC0_=function(t,i){if(!this.currentWindow_)return null;var r=this.currentWindow_,o=null;switch(t){case shaka.cea.Cea708Service.ASCII_BACKSPACE:r.backspace();break;case shaka.cea.Cea708Service.ASCII_CARRIAGE_RETURN:r.isVisible()&&(o=r.forceEmit(i,this.serviceNumber_)),r.carriageReturn();break;case shaka.cea.Cea708Service.ASCII_HOR_CARRIAGE_RETURN:r.isVisible()&&(o=r.forceEmit(i,this.serviceNumber_)),r.horizontalCarriageReturn();break;case shaka.cea.Cea708Service.ASCII_FORM_FEED:r.isVisible()&&(o=r.forceEmit(i,this.serviceNumber_)),r.resetMemory(),r.setPenLocation(0,0)}return o},shaka.cea.Cea708Service.prototype.handleC1_=function(t,i,r){if(128<=i&&135>=i)this.setCurrentWindow_(7&i);else{if(136===i)return t=t.readByte().value,this.clearWindows_(t,r);if(137===i)t=t.readByte().value,this.displayWindows_(t,r);else{if(138===i)return t=t.readByte().value,this.hideWindows_(t,r);if(139===i)return t=t.readByte().value,this.toggleWindows_(t,r);if(140===i)return t=t.readByte().value,this.deleteWindows_(t,r);if(143===i)return this.reset_(r);144===i?this.setPenAttributes_(t):145===i?this.setPenColor_(t):146===i?this.setPenLocation_(t):151===i?this.setWindowAttributes_(t):152<=i&&159>=i&&this.defineWindow_(t,(15&i)-8,r)}}return null},shaka.cea.Cea708Service.prototype.handleC2_=function(t,i){8<=i&&15>=i?t.skip(1):16<=i&&23>=i?t.skip(2):24<=i&&31>=i&&t.skip(3)},shaka.cea.Cea708Service.prototype.handleC3_=function(t,i){128<=i&&135>=i?t.skip(4):136<=i&&143>=i&&t.skip(5)},shaka.cea.Cea708Service.prototype.setCurrentWindow_=function(t){this.windows_[t]&&(this.currentWindow_=this.windows_[t])},shaka.cea.Cea708Service.prototype.getSpecifiedWindowIds_=function t(i){var r,l=this;return $jscomp.generator.createGenerator(t,function(g){return 1==g.nextAddress&&(r=0),5!=g.nextAddress?8>r?1==(1&i)&&l.windows_[r]?g.yield(r,5):g.jumpTo(5):g.jumpTo(0):(i>>=1,r++,g.jumpTo(2))})},shaka.cea.Cea708Service.prototype.clearWindows_=function(t,i){for(var r=null,o=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),l=o.next();!l.done;l=o.next())(l=this.windows_[l.value]).isVisible()&&(r=l.forceEmit(i,this.serviceNumber_)),l.resetMemory();return r},shaka.cea.Cea708Service.prototype.displayWindows_=function(t,i){for(var r=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),o=r.next();!o.done;o=r.next())(o=this.windows_[o.value]).isVisible()||o.setStartTime(i),o.display()},shaka.cea.Cea708Service.prototype.hideWindows_=function(t,i){for(var r=null,o=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),l=o.next();!l.done;l=o.next())(l=this.windows_[l.value]).isVisible()&&(r=l.forceEmit(i,this.serviceNumber_)),l.hide();return r},shaka.cea.Cea708Service.prototype.toggleWindows_=function(t,i){for(var r=null,o=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),l=o.next();!l.done;l=o.next())(l=this.windows_[l.value]).isVisible()?r=l.forceEmit(i,this.serviceNumber_):l.setStartTime(i),l.toggle();return r},shaka.cea.Cea708Service.prototype.deleteWindows_=function(t,i){for(var r=null,o=$jscomp.makeIterator(this.getSpecifiedWindowIds_(t)),l=o.next();!l.done;l=o.next()){var g=this.windows_[l=l.value];g.isVisible()&&(r=g.forceEmit(i,this.serviceNumber_)),this.windows_[l]=null}return r},shaka.cea.Cea708Service.prototype.reset_=function(t){return t=this.deleteWindows_(255,t),this.clear(),t},shaka.cea.Cea708Service.prototype.clear=function(){this.currentWindow_=null,this.windows_=[null,null,null,null,null,null,null,null]},shaka.cea.Cea708Service.prototype.setPenAttributes_=function(t){if(t.skip(1),t=t.readByte().value,this.currentWindow_){var i=0<(64&t);this.currentWindow_.setPenItalics(0<(128&t)),this.currentWindow_.setPenUnderline(i)}},shaka.cea.Cea708Service.prototype.setPenColor_=function(t){var i=t.readByte().value,r=t.readByte().value;if(t.skip(1),this.currentWindow_){t=3&r;var o=(12&r)>>2;r=(48&r)>>4,i=this.rgbColorToHex_((48&i)>>4,(12&i)>>2,3&i),t=this.rgbColorToHex_(r,o,t),this.currentWindow_.setPenTextColor(i),this.currentWindow_.setPenBackgroundColor(t)}},shaka.cea.Cea708Service.prototype.setPenLocation_=function(t){var i=t.readByte().value;t=t.readByte().value,this.currentWindow_&&this.currentWindow_.setPenLocation(15&i,63&t)},shaka.cea.Cea708Service.prototype.setWindowAttributes_=function(t){t.skip(1),t.skip(1);var i=t.readByte().value;t.skip(1),this.currentWindow_&&this.currentWindow_.setJustification(3&i)},shaka.cea.Cea708Service.prototype.defineWindow_=function(t,i,r){var o=null!==this.windows_[i];if(!o){var l=new shaka.cea.Cea708Window(i);l.setStartTime(r),this.windows_[i]=l}var g=t.readByte().value,_=t.readByte().value;r=t.readByte().value;var v=t.readByte().value;l=t.readByte().value,t=t.readByte().value,g=0<(32&g);var E=127&_;_=0<(128&_);var P=1+(15&v);v=(240&v)>>4,l=1+(63&l),o&&0==(7&t)||this.windows_[i].resetPen(),this.windows_[i].defineWindow(g,E,r,v,_,P,l),this.currentWindow_=this.windows_[i]},shaka.cea.Cea708Service.prototype.rgbColorToHex_=function(t,i,r){var o={0:0,1:0,2:1,3:1};return shaka.cea.Cea708Service.Colors[(t=o[t])<<2|(i=o[i])<<1|(r=o[r])]},shaka.cea.Cea708Service.ASCII_BACKSPACE=8,shaka.cea.Cea708Service.ASCII_FORM_FEED=12,shaka.cea.Cea708Service.ASCII_CARRIAGE_RETURN=13,shaka.cea.Cea708Service.ASCII_HOR_CARRIAGE_RETURN=14,shaka.cea.Cea708Service.EXT_CEA708_CTRL_CODE_BYTE1=16,shaka.cea.Cea708Service.G2Charset=new Map([[32," "],[33,"\xa0"],[37,"\u2026"],[42,"\u0160"],[44,"\u0152"],[48,"\u2588"],[49,"\u2018"],[50,"\u2019"],[51,"\u201c"],[52,"\u201d"],[53,"\u2022"],[57,"\u2122"],[58,"\u0161"],[60,"\u0153"],[61,"\u2120"],[63,"\u0178"],[118,"\u215b"],[119,"\u215c"],[120,"\u215d"],[121,"\u215e"],[122,"\u2502"],[123,"\u2510"],[124,"\u2514"],[125,"\u2500"],[126,"\u2518"],[127,"\u250c"]]),shaka.cea.Cea708Service.Colors="black blue green cyan red magenta yellow white".split(" "),shaka.cea.Cea608Memory=function(t,i){this.rows_=[],this.row_=1,this.scrollRows_=0,this.fieldNum_=t,this.channelNum_=i,this.italics_=this.underline_=!1,this.textColor_=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.CeaUtils.DEFAULT_BG_COLOR,this.reset()},shaka.cea.Cea608Memory.prototype.forceEmit=function(t,i){var r="CC"+(this.fieldNum_<<1|this.channelNum_+1),o=new shaka.text.Cue(t,i,"");return shaka.cea.CeaUtils.getParsedCaption(o,r,this.rows_,t,i)},shaka.cea.Cea608Memory.prototype.reset=function(){this.resetAllRows(),this.row_=1},shaka.cea.Cea608Memory.prototype.getRow=function(){return this.row_},shaka.cea.Cea608Memory.prototype.setRow=function(t){this.row_=t},shaka.cea.Cea608Memory.prototype.getScrollSize=function(){return this.scrollRows_},shaka.cea.Cea608Memory.prototype.setScrollSize=function(t){this.scrollRows_=t},shaka.cea.Cea608Memory.prototype.addChar=function(t,i){if(!(32>i||127<i)){var r="";switch(t){case shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN:r=shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars.has(i)?shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars.get(i):String.fromCharCode(i);break;case shaka.cea.Cea608Memory.CharSet.SPECIAL_NORTH_AMERICAN:r=shaka.cea.Cea608Memory.CharSet.SpecialNorthAmericanChars.get(i);break;case shaka.cea.Cea608Memory.CharSet.SPANISH_FRENCH:this.eraseChar(),r=shaka.cea.Cea608Memory.CharSet.ExtendedSpanishFrench.get(i);break;case shaka.cea.Cea608Memory.CharSet.PORTUGUESE_GERMAN:this.eraseChar(),r=shaka.cea.Cea608Memory.CharSet.ExtendedPortugueseGerman.get(i)}r&&(r=new shaka.cea.CeaUtils.StyledChar(r,this.underline_,this.italics_,this.backgroundColor_,this.textColor_),this.rows_[this.row_].push(r))}},shaka.cea.Cea608Memory.prototype.eraseChar=function(){this.rows_[this.row_].pop()},shaka.cea.Cea608Memory.prototype.moveRows=function(t,i,r){if(t>=i)for(--r;0<=r;r--)this.rows_[t+r]=this.rows_[i+r].map(function(l){return l});else for(var o=0;o<r;o++)this.rows_[t+o]=this.rows_[i+o].map(function(l){return l})},shaka.cea.Cea608Memory.prototype.resetRows=function(t,i){for(var r=0;r<=i;r++)this.rows_[t+r]=[]},shaka.cea.Cea608Memory.prototype.resetAllRows=function(){this.resetRows(0,shaka.cea.Cea608Memory.CC_ROWS)},shaka.cea.Cea608Memory.prototype.eraseBuffer=function(){this.row_=0<this.scrollRows_?this.scrollRows_:0,this.resetAllRows()},shaka.cea.Cea608Memory.prototype.setUnderline=function(t){this.underline_=t},shaka.cea.Cea608Memory.prototype.setItalics=function(t){this.italics_=t},shaka.cea.Cea608Memory.prototype.setTextColor=function(t){this.textColor_=t},shaka.cea.Cea608Memory.prototype.setBackgroundColor=function(t){this.backgroundColor_=t},shaka.cea.Cea608Memory.CC_ROWS=15,shaka.cea.Cea608Memory.CharSet={BASIC_NORTH_AMERICAN:0,SPECIAL_NORTH_AMERICAN:1,SPANISH_FRENCH:2,PORTUGUESE_GERMAN:3},shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars=new Map([[39,"\u2019"],[42,"\xe1"],[92,"\xe9"],[92,"\xe9"],[94,"\xed"],[95,"\xf3"],[96,"\xfa"],[123,"\xe7"],[124,"\xf7"],[125,"\xd1"],[126,"\xf1"],[127,"\u2588"]]),shaka.cea.Cea608Memory.CharSet.SpecialNorthAmericanChars=new Map([[48,"\xae"],[49,"\xb0"],[50,"\xbd"],[51,"\xbf"],[52,"\u2122"],[53,"\xa2"],[54,"\xa3"],[55,"\u266a"],[56,"\xe0"],[57,"\u2800"],[58,"\xe8"],[59,"\xe2"],[60,"\xea"],[61,"\xee"],[62,"\xf4"],[63,"\xfb"]]),shaka.cea.Cea608Memory.CharSet.ExtendedSpanishFrench=new Map([[32,"\xc1"],[33,"\xc9"],[34,"\xd3"],[35,"\xda"],[36,"\xdc"],[37,"\xfc"],[38,"\u2018"],[39,"\xa1"],[40,"*"],[41,"'"],[42,"\u2500"],[43,"\xa9"],[44,"\u2120"],[45,"\xb7"],[46,"\u201c"],[47,"\u201d"],[48,"\xc0"],[49,"\xc2"],[50,"\xc7"],[51,"\xc8"],[52,"\xca"],[53,"\xcb"],[54,"\xeb"],[55,"\xce"],[56,"\xcf"],[57,"\xef"],[58,"\xd4"],[59,"\xd9"],[60,"\xf9"],[61,"\xdb"],[62,"\xab"],[63,"\xbb"]]),shaka.cea.Cea608Memory.CharSet.ExtendedPortugueseGerman=new Map([[32,"\xc3"],[33,"\xe3"],[34,"\xcd"],[35,"\xcc"],[36,"\xec"],[37,"\xd2"],[38,"\xf2"],[39,"\xd5"],[40,"\xf5"],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,"\xc4"],[49,"\xe4"],[50,"\xd6"],[51,"\xf6"],[52,"\xdf"],[53,"\xa5"],[54,"\xa4"],[55,"\u2502"],[56,"\xc5"],[57,"\xe5"],[58,"\xd8"],[59,"\xf8"],[60,"\u250c"],[61,"\u2510"],[62,"\u2514"],[63,"\u2518"]]),shaka.cea.Cea608DataChannel=function(t,i){this.type_=shaka.cea.Cea608DataChannel.CaptionType.NONE,this.text_=new shaka.cea.Cea608Memory(t,i),this.displayedMemory_=new shaka.cea.Cea608Memory(t,i),this.nonDisplayedMemory_=new shaka.cea.Cea608Memory(t,i),this.curbuf_=this.displayedMemory_,this.prevEndTime_=0,this.lastcp_=null},shaka.cea.Cea608DataChannel.prototype.reset=function(){this.type_=shaka.cea.Cea608DataChannel.CaptionType.PAINTON,this.curbuf_=this.displayedMemory_,this.lastcp_=null,this.displayedMemory_.reset(),this.nonDisplayedMemory_.reset(),this.text_.reset()},shaka.cea.Cea608DataChannel.prototype.pacToRow_=function(t,i){return[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(7&t)<<1|i>>5&1]},shaka.cea.Cea608DataChannel.prototype.controlPac_=function(t,i){var r=this.pacToRow_(t,i),o=(30&i)>>1,l=shaka.cea.CeaUtils.DEFAULT_TXT_COLOR,g=!1;if(7>o?l=shaka.cea.Cea608DataChannel.TEXT_COLORS[o]:7===o&&(g=!0),o=1==(1&i),this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT){var _=this.curbuf_;if(this.type_===shaka.cea.Cea608DataChannel.CaptionType.ROLLUP&&r!==_.getRow()){var v=1+_.getRow()-_.getScrollSize(),E=1+r-_.getScrollSize();_.moveRows(E,v,_.getScrollSize()),_.resetRows(0,E-1),_.resetRows(r+1,shaka.cea.Cea608Memory.CC_ROWS-r)}_.setRow(r),this.curbuf_.setUnderline(o),this.curbuf_.setItalics(g),this.curbuf_.setTextColor(l),this.curbuf_.setBackgroundColor(shaka.cea.CeaUtils.DEFAULT_BG_COLOR)}},shaka.cea.Cea608DataChannel.prototype.controlMidrow_=function(t){this.curbuf_.setUnderline(!1),this.curbuf_.setItalics(!1),this.curbuf_.setTextColor(shaka.cea.CeaUtils.DEFAULT_TXT_COLOR),this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,32);var i=!1,r=shaka.cea.Cea608DataChannel.TEXT_COLORS[(14&t)>>1];"white_italics"===r&&(r="white",i=!0),this.curbuf_.setUnderline(1==(1&t)),this.curbuf_.setItalics(i),this.curbuf_.setTextColor(r)},shaka.cea.Cea608DataChannel.prototype.controlBackgroundAttribute_=function(t,i){var r=shaka.cea.CeaUtils.DEFAULT_BG_COLOR;0==(7&t)&&(r=shaka.cea.Cea608DataChannel.BG_COLORS[(14&i)>>1]),this.curbuf_.setBackgroundColor(r)},shaka.cea.Cea608DataChannel.prototype.controlMiscellaneous_=function(t){var i=shaka.cea.Cea608DataChannel.MiscCmd_,r=t.pts,o=null;switch(t.ccData2){case i.RCL:this.controlRcl_();break;case i.BS:this.controlBs_();break;case i.RU2:o=this.controlRu_(2,r);break;case i.RU3:o=this.controlRu_(3,r);break;case i.RU4:o=this.controlRu_(4,r);break;case i.FON:this.controlFon_();break;case i.RDC:this.controlRdc_(r);break;case i.TR:this.controlTr_();break;case i.RTD:this.controlRtd_();break;case i.EDM:o=this.controlEdm_(r);break;case i.CR:o=this.controlCr_(r);break;case i.ENM:this.controlEnm_();break;case i.EOC:o=this.controlEoc_(r)}return o},shaka.cea.Cea608DataChannel.prototype.controlCr_=function(t){var i=this.curbuf_;if(this.type_!==shaka.cea.Cea608DataChannel.CaptionType.ROLLUP)return null;var r=i.forceEmit(this.prevEndTime_,t),o=i.getRow()-i.getScrollSize()+1;return i.moveRows(o-1,o,i.getScrollSize()),i.resetRows(0,o-1),i.resetRows(i.getRow(),shaka.cea.Cea608Memory.CC_ROWS-i.getRow()),this.prevEndTime_=t,r},shaka.cea.Cea608DataChannel.prototype.controlRu_=function(t,i){var r=this.curbuf_=this.displayedMemory_,o=null;return this.type_!==shaka.cea.Cea608DataChannel.CaptionType.ROLLUP&&this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(o=r.forceEmit(this.prevEndTime_,i),this.displayedMemory_.eraseBuffer(),this.nonDisplayedMemory_.eraseBuffer(),r.setRow(shaka.cea.Cea608Memory.CC_ROWS)),this.type_=shaka.cea.Cea608DataChannel.CaptionType.ROLLUP,r.setScrollSize(t),o},shaka.cea.Cea608DataChannel.prototype.controlFon_=function(){this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,32)},shaka.cea.Cea608DataChannel.prototype.controlEdm_=function(t){var i=this.displayedMemory_,r=null;return this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(r=i.forceEmit(this.prevEndTime_,t)),i.resetAllRows(),r},shaka.cea.Cea608DataChannel.prototype.controlRdc_=function(t){this.type_=shaka.cea.Cea608DataChannel.CaptionType.PAINTON,this.curbuf_=this.displayedMemory_,this.curbuf_.setScrollSize(0),this.prevEndTime_=t},shaka.cea.Cea608DataChannel.prototype.controlEnm_=function(){this.nonDisplayedMemory_.resetAllRows()},shaka.cea.Cea608DataChannel.prototype.controlEoc_=function(t){var i=null;this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(i=this.displayedMemory_.forceEmit(this.prevEndTime_,t));var r=this.nonDisplayedMemory_;return this.nonDisplayedMemory_=this.displayedMemory_,this.displayedMemory_=r,this.controlRcl_(),this.prevEndTime_=t,i},shaka.cea.Cea608DataChannel.prototype.controlRcl_=function(){this.type_=shaka.cea.Cea608DataChannel.CaptionType.POPON,this.curbuf_=this.nonDisplayedMemory_,this.curbuf_.setScrollSize(0)},shaka.cea.Cea608DataChannel.prototype.controlBs_=function(){this.curbuf_.eraseChar()},shaka.cea.Cea608DataChannel.prototype.controlTr_=function(){this.text_.reset(),this.controlRtd_()},shaka.cea.Cea608DataChannel.prototype.controlRtd_=function(){shaka.log.warnOnce("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),this.curbuf_=this.text_,this.type_=shaka.cea.Cea608DataChannel.CaptionType.TEXT},shaka.cea.Cea608DataChannel.prototype.handleBasicNorthAmericanChar=function(t,i){this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,t),this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,i)},shaka.cea.Cea608DataChannel.prototype.handleExtendedWesternEuropeanChar_=function(t,i){this.curbuf_.addChar(1&t?shaka.cea.Cea608Memory.CharSet.PORTUGUESE_GERMAN:shaka.cea.Cea608Memory.CharSet.SPANISH_FRENCH,i)},shaka.cea.Cea608DataChannel.prototype.handleControlCode=function(t){var i=t.ccData1,r=t.ccData2;if(this.lastcp_===(i<<8|r))return this.lastcp_=null;if(this.lastcp_=i<<8|r,this.isPAC_(i,r))this.controlPac_(i,r);else if(this.isMidrowStyleChange_(i,r))this.controlMidrow_(r);else if(this.isBackgroundAttribute_(i,r))this.controlBackgroundAttribute_(i,r);else if(this.isSpecialNorthAmericanChar_(i,r))this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.SPECIAL_NORTH_AMERICAN,r);else if(this.isExtendedWesternEuropeanChar_(i,r))this.handleExtendedWesternEuropeanChar_(i,r);else if(this.isMiscellaneous_(i,r))return this.controlMiscellaneous_(t);return null},shaka.cea.Cea608DataChannel.prototype.isMiscellaneous_=function(t,i){return 20==(246&t)&&32==(240&i)},shaka.cea.Cea608DataChannel.prototype.isPAC_=function(t,i){return 16==(240&t)&&64==(192&i)},shaka.cea.Cea608DataChannel.prototype.isMidrowStyleChange_=function(t,i){return 17==(247&t)&&32==(240&i)},shaka.cea.Cea608DataChannel.prototype.isBackgroundAttribute_=function(t,i){return 16==(247&t)&&32==(240&i)||23==(247&t)&&45==(255&i)},shaka.cea.Cea608DataChannel.prototype.isSpecialNorthAmericanChar_=function(t,i){return 17==(247&t)&&48==(240&i)},shaka.cea.Cea608DataChannel.prototype.isExtendedWesternEuropeanChar_=function(t,i){return 18==(246&t)&&32==(224&i)},shaka.cea.Cea608DataChannel.isControlCode=function(t){return 16==(112&t)},shaka.cea.Cea608DataChannel.MiscCmd_={RCL:32,BS:33,AOD:34,AON:35,DER:36,RU2:37,RU3:38,RU4:39,FON:40,RDC:41,TR:42,RTD:43,EDM:44,CR:45,ENM:46,EOC:47},shaka.cea.Cea608DataChannel.CaptionType={NONE:0,POPON:1,PAINTON:2,ROLLUP:3,TEXT:4},shaka.cea.Cea608DataChannel.BG_COLORS="black green blue cyan red yellow magenta black".split(" "),shaka.cea.Cea608DataChannel.TEXT_COLORS="white green blue cyan red yellow magenta white_italics".split(" "),shaka.cea.CeaDecoder=function(){this.cea608DataArray_=[],this.cea708DataArray_=[],this.dtvccPacketBuilder_=new shaka.cea.DtvccPacketBuilder,this.badFrames_=0,this.cea608ModeToStream_=new Map([["CC1",new shaka.cea.Cea608DataChannel(0,0)],["CC2",new shaka.cea.Cea608DataChannel(0,1)],["CC3",new shaka.cea.Cea608DataChannel(1,0)],["CC4",new shaka.cea.Cea608DataChannel(1,1)]]),this.currentField2Channel_=this.currentField1Channel_=0,this.serviceNumberToService_=new Map,this.reset()},shaka.cea.CeaDecoder.prototype.clear=function(){this.badFrames_=0,this.cea608DataArray_=[],this.cea708DataArray_=[],this.dtvccPacketBuilder_.clear(),this.reset();for(var t=$jscomp.makeIterator(this.serviceNumberToService_.values()),i=t.next();!i.done;i=t.next())i.value.clear()},shaka.cea.CeaDecoder.prototype.reset=function(){this.currentField2Channel_=this.currentField1Channel_=0;for(var t=$jscomp.makeIterator(this.cea608ModeToStream_.values()),i=t.next();!i.done;i=t.next())i.value.reset()},shaka.cea.CeaDecoder.prototype.extract=function(t,i){var r=new shaka.util.DataViewReader(t,shaka.util.DataViewReader.Endianness.BIG_ENDIAN);if(r.readUint8()===shaka.cea.CeaDecoder.USA_COUNTRY_CODE&&r.readUint16()===shaka.cea.CeaDecoder.ATSC_PROVIDER_CODE&&r.readUint32()===shaka.cea.CeaDecoder.ATSC1_USER_IDENTIFIER&&3===r.readUint8()){var o=r.readUint8();if(0!=(64&o)){o&=31,r.skip(1);for(var l=0;l<o;l++){var g=r.readUint8(),_=(4&g)>>2,v=r.readUint8(),E=r.readUint8();_&&((g&=3)===shaka.cea.CeaDecoder.NTSC_CC_FIELD_1||g===shaka.cea.CeaDecoder.NTSC_CC_FIELD_2?this.cea608DataArray_.push({pts:i,type:g,ccData1:v,ccData2:E,order:this.cea608DataArray_.length}):(this.cea708DataArray_.push({pts:i,type:g,value:v,order:this.cea708DataArray_.length}),this.cea708DataArray_.push({pts:i,type:shaka.cea.DtvccPacketBuilder.DTVCC_PACKET_DATA,value:E,order:this.cea708DataArray_.length})))}}}},shaka.cea.CeaDecoder.prototype.decode=function(){var t=[],i=function(o,l){return o.pts-l.pts||o.order-l.order};this.cea608DataArray_.sort(i),this.cea708DataArray_.sort(i);for(var r=(i=$jscomp.makeIterator(this.cea608DataArray_)).next();!r.done;r=i.next())(r=this.decodeCea608_(r.value))&&t.push(r);for(r=(i=$jscomp.makeIterator(this.cea708DataArray_)).next();!r.done;r=i.next())this.dtvccPacketBuilder_.addByte(r.value);for(i=this.dtvccPacketBuilder_.getBuiltPackets(),r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())r=this.decodeCea708_(r.value),t.push.apply(t,$jscomp.arrayFromIterable(r));return this.dtvccPacketBuilder_.clearBuiltPackets(),this.cea608DataArray_=[],this.cea708DataArray_=[],t},shaka.cea.CeaDecoder.prototype.decodeCea608_=function(t){var i=t.type;if(shaka.cea.Cea608DataChannel.isControlCode(t.ccData1)){var r=t.ccData1>>3&1;0===i?this.currentField1Channel_=r:this.currentField2Channel_=r}return i=this.cea608ModeToStream_.get("CC"+(i<<1|(i?this.currentField2Channel_:this.currentField1Channel_)+1)),255===t.ccData1&&255===t.ccData2||!t.ccData1&&!t.ccData2||!this.isOddParity_(t.ccData1)||!this.isOddParity_(t.ccData2)?(45<=++this.badFrames_&&this.reset(),null):(this.badFrames_=0,t.ccData1&=127,t.ccData2&=127,t.ccData1||t.ccData2?(r=null,shaka.cea.Cea608DataChannel.isControlCode(t.ccData1)?r=i.handleControlCode(t):i.handleBasicNorthAmericanChar(t.ccData1,t.ccData2),r):null)},shaka.cea.CeaDecoder.prototype.decodeCea708_=function(t){var i=[];try{for(;t.hasMoreData();){var r=t.readByte().value,o=(224&r)>>5,l=31&r;if(7===o&&0!=l&&(o=63&t.readByte().value),0!=o){if(!this.serviceNumberToService_.has(o)){var g=new shaka.cea.Cea708Service(o);this.serviceNumberToService_.set(o,g)}for(var _=this.serviceNumberToService_.get(o),v=t.getPosition();t.getPosition()-v<l;){var E=_.handleCea708ControlCode(t);E&&i.push(E)}}}}catch(P){if(!(P instanceof shaka.util.Error&&P.code===shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS))throw P;shaka.log.warnOnce("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.")}return i},shaka.cea.CeaDecoder.prototype.isOddParity_=function(t){for(var i=0;t;)i^=1&t,t>>=1;return 1===i},shaka.cea.CeaDecoder.ATSC_PROVIDER_CODE=49,shaka.cea.CeaDecoder.ATSC1_USER_IDENTIFIER=1195456820,shaka.cea.CeaDecoder.NTSC_CC_FIELD_1=0,shaka.cea.CeaDecoder.NTSC_CC_FIELD_2=1,shaka.cea.CeaDecoder.USA_COUNTRY_CODE=181,shaka.cea.ICeaParser=function(){},shaka.cea.ICeaParser.prototype.init=function(t){},shaka.cea.ICeaParser.prototype.parse=function(t){},shaka.cea.ICeaParser.NALU_TYPE_SEI=6,shaka.cea.ICeaParser.DEFAULT_TIMESCALE_VALUE=9e4,shaka.cea.SeiProcessor=function(){},shaka.cea.SeiProcessor.prototype.process=function t(i){var o,l,g,_,r=this;return $jscomp.generator.createGenerator(t,function(v){if(1==v.nextAddress&&(o=r.removeEmu_(i),l=0),4!=v.nextAddress){if(!(l+o<i.length))return v.jumpTo(0);for(g=0;255==i[l];)g+=255,l++;for(g+=i[l++],_=0;255==i[l];)_+=255,l++;return _+=i[l++],4!=g?v.jumpTo(4):v.yield(i.subarray(l,l+_),4)}return l+=_,v.jumpTo(2)})},shaka.cea.SeiProcessor.prototype.removeEmu_=function(t){for(var i=0,r=0,o=0;r<t.length;)2==i&&3==t[r]?i=0:(0==t[r]?i++:i=0,t[o]=t[r],o++),r++;return r-o},shaka.util.Mp4BoxParsers=function(){},shaka.util.Mp4BoxParsers.parseTFHD=function(t,i){var r=null,o=null,l=t.readUint32();return 1&i&&t.skip(8),2&i&&t.skip(4),8&i&&(r=t.readUint32()),16&i&&(o=t.readUint32()),{trackId:l,defaultSampleDuration:r,defaultSampleSize:o}},shaka.util.Mp4BoxParsers.parseTFDT=function(t,i){return{baseMediaDecodeTime:1==i?t.readUint64():t.readUint32()}},shaka.util.Mp4BoxParsers.parseMDHD=function(t,i){return 1==i?(t.skip(8),t.skip(8)):(t.skip(4),t.skip(4)),{timescale:t.readUint32()}},shaka.util.Mp4BoxParsers.parseTREX=function(t){return t.skip(4),t.skip(4),{defaultSampleDuration:t.readUint32(),defaultSampleSize:t=t.readUint32()}},shaka.util.Mp4BoxParsers.parseTRUN=function(t,i,r){var o=t.readUint32(),l=[];1&r&&t.skip(4),4&r&&t.skip(4);for(var g=$jscomp.makeIterator(shaka.util.Iterables.range(o)),_=g.next();!_.done;_=g.next())shaka.util.Functional.ignored(_.value),_={sampleDuration:null,sampleSize:null,sampleCompositionTimeOffset:null},256&r&&(_.sampleDuration=t.readUint32()),512&r&&(_.sampleSize=t.readUint32()),1024&r&&t.skip(4),2048&r&&(_.sampleCompositionTimeOffset=0==i?t.readUint32():t.readInt32()),l.push(_);return{sampleCount:o,sampleData:l}},shaka.util.Mp4BoxParsers.parseTKHD=function(t,i){if(1==i){t.skip(8),t.skip(8);var r=t.readUint64()}else t.skip(4),t.skip(4),r=t.readUint32();return{trackId:r}},shaka.cea.Mp4CeaParser=function(){this.seiProcessor_=new shaka.cea.SeiProcessor,this.trackIdToTimescale_=new Map,this.defaultSampleSize_=this.defaultSampleDuration_=0},shaka.cea.Mp4CeaParser.prototype.init=function(t){var i=this,r=shaka.util.Mp4Parser,o=[],l=[];if((new r).box("moov",r.children).box("mvex",r.children).fullBox("trex",function(g){g=shaka.util.Mp4BoxParsers.parseTREX(g.reader),i.defaultSampleDuration_=g.defaultSampleDuration,i.defaultSampleSize_=g.defaultSampleSize}).box("trak",r.children).fullBox("tkhd",function(g){goog.asserts.assert(null!=g.version,"TKHD is a full box and should have a valid version."),g=shaka.util.Mp4BoxParsers.parseTKHD(g.reader,g.version),o.push(g.trackId)}).box("mdia",r.children).fullBox("mdhd",function(g){goog.asserts.assert(null!=g.version,"MDHD is a full box and should have a valid version."),g=shaka.util.Mp4BoxParsers.parseMDHD(g.reader,g.version),l.push(g.timescale)}).parse(t,!0),!o.length||!l.length||o.length!=l.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_CEA);o.forEach(function(g,_){i.trackIdToTimescale_.set(g,l[_])})},shaka.cea.Mp4CeaParser.prototype.parse=function(t){var i=this,r=shaka.util.Mp4Parser,o=[],l=this.defaultSampleDuration_,g=this.defaultSampleSize_,_=[],v=null,E=shaka.cea.ICeaParser.DEFAULT_TIMESCALE_VALUE;return(new r).box("moof",r.children).box("traf",r.children).fullBox("trun",function(P){goog.asserts.assert(null!=P.version&&null!=P.flags,"TRUN is a full box and should have a valid version & flags."),_=shaka.util.Mp4BoxParsers.parseTRUN(P.reader,P.version,P.flags).sampleData}).fullBox("tfhd",function(P){goog.asserts.assert(null!=P.flags,"TFHD is a full box and should have valid flags."),P=shaka.util.Mp4BoxParsers.parseTFHD(P.reader,P.flags),l=P.defaultSampleDuration||i.defaultSampleDuration_,g=P.defaultSampleSize||i.defaultSampleSize_,i.trackIdToTimescale_.has(P=P.trackId)&&(E=i.trackIdToTimescale_.get(P))}).fullBox("tfdt",function(P){goog.asserts.assert(null!=P.version,"TFDT is a full box and should have a valid version."),v=shaka.util.Mp4BoxParsers.parseTFDT(P.reader,P.version).baseMediaDecodeTime}).box("mdat",function(P){if(null===v)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_CEA);i.parseMdat_(P.reader,v,E,l,g,_,o)}).parse(t,!1),o},shaka.cea.Mp4CeaParser.prototype.parseMdat_=function(t,i,r,o,l,g,_){var v=0,E=l;for(g.length&&(E=g[0].sampleSize||l);t.hasMoreData();){var P=t.readUint32();if((31&t.readUint8())==shaka.cea.ICeaParser.NALU_TYPE_SEI){var M=0;g.length>v&&(M=g[v].sampleCompositionTimeOffset||0),M=(i+M)/r;for(var R=$jscomp.makeIterator(this.seiProcessor_.process(t.readBytes(P-1))),U=R.next();!U.done;U=R.next())_.push({packet:U.value,pts:M})}else t.skip(P-1);0==(E-=P+4)&&(i=g.length>v?i+(g[v].sampleDuration||o):i+o,v++,E=g.length>v&&g[v].sampleSize||l)}},shaka.media.IClosedCaptionParser=function(){},shaka.media.IClosedCaptionParser.prototype.init=function(t){},shaka.media.IClosedCaptionParser.prototype.parseFrom=function(t){},shaka.media.IClosedCaptionParser.prototype.reset=function(){},shaka.media.ClosedCaptionParser=function(){this.ceaParser_=new shaka.cea.Mp4CeaParser,this.ceaDecoder_=new shaka.cea.CeaDecoder},shaka.media.ClosedCaptionParser.prototype.init=function(t){this.ceaParser_.init(t)},shaka.media.ClosedCaptionParser.prototype.parseFrom=function(t){t=this.ceaParser_.parse(t);for(var i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){var r=shaka.util.BufferUtils.toUint8((i=i.value).packet);this.ceaDecoder_.extract(r,i.pts)}return this.ceaDecoder_.decode()},shaka.media.ClosedCaptionParser.prototype.reset=function(){this.ceaDecoder_.clear()},shaka.media.TimeRangesUtils=function(){},shaka.media.TimeRangesUtils.bufferStart=function(t){return!t||1==t.length&&1e-6>t.end(0)-t.start(0)?null:1==t.length&&0>t.start(0)?0:t.length?t.start(0):null},shaka.media.TimeRangesUtils.bufferEnd=function(t){return!t||1==t.length&&1e-6>t.end(0)-t.start(0)?null:t.length?t.end(t.length-1):null},shaka.media.TimeRangesUtils.isBuffered=function(t,i,r){return r=void 0===r?0:r,!(!t||!t.length||1==t.length&&1e-6>t.end(0)-t.start(0)||i>t.end(t.length-1))&&i+r>=t.start(0)},shaka.media.TimeRangesUtils.bufferedAheadOf=function(t,i){if(!t||!t.length||1==t.length&&1e-6>t.end(0)-t.start(0))return 0;for(var r=0,o=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(t)),l=o.next();!l.done;l=o.next()){var g=l.value;l=g.start,(g=g.end)>i&&(r+=g-Math.max(l,i))}return r},shaka.media.TimeRangesUtils.getGapIndex=function(t,i,r){var o=shaka.media.TimeRangesUtils;return!t||!t.length||1==t.length&&1e-6>t.end(0)-t.start(0)?null:0<=(t=o.getBufferedInfo(t).findIndex(function(l,g,_){return l.start>i&&(0==g||_[g-1].end-i<=r)}))?t:null},shaka.media.TimeRangesUtils.getBufferedInfo=function(t){if(!t)return[];for(var i=[],r=$jscomp.makeIterator(shaka.util.Iterables.range(t.length)),o=r.next();!o.done;o=r.next())i.push({start:t.start(o=o.value),end:t.end(o)});return i},shaka.util.IDestroyable=function(){},shaka.util.IDestroyable.prototype.destroy=function(){},shaka.util.PublicPromise=function(){var t,i,r=new Promise(function(o,l){t=o,i=l});return r.resolve=t,r.reject=i,r},shaka.util.PublicPromise.prototype.resolve=function(t){},shaka.util.PublicPromise.prototype.reject=function(t){},shaka.dependencies=function(){},shaka.dependencies.add=function(t,i){if(!shaka.dependencies.Allowed[t])throw Error(t+" is not supported");shaka.dependencies.dependencies_.set(t,i)},shaka.dependencies.has=function(t){return shaka.dependencies.dependencies_.has(t)},shaka.dependencies.muxjs=function(){return shaka.dependencies.dependencies_.get(shaka.dependencies.Allowed.muxjs)},goog.exportSymbol("shaka.dependencies",shaka.dependencies),goog.exportProperty(shaka.dependencies,"has",shaka.dependencies.has),goog.exportProperty(shaka.dependencies,"add",shaka.dependencies.add),shaka.dependencies.dependencies_=new Map,shaka.dependencies.Allowed={muxjs:"muxjs"},goog.exportProperty(shaka.dependencies,"Allowed",shaka.dependencies.Allowed),shaka.dependencies.dependencies_.set(shaka.dependencies.Allowed.muxjs,window.muxjs),shaka.media.Transmuxer=function(){var t=this;this.muxjs_=shaka.dependencies.muxjs(),this.muxTransmuxer_=new this.muxjs_.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.transmuxPromise_=null,this.transmuxedData_=[],this.captions_=[],this.metadata_=[],this.isTransmuxing_=!1,this.muxTransmuxer_.on("data",function(i){return t.onTransmuxed_(i)}),this.muxTransmuxer_.on("done",function(){return t.onTransmuxDone_()})},shaka.media.Transmuxer.prototype.destroy=function(){return this.muxTransmuxer_.dispose(),this.muxTransmuxer_=null,Promise.resolve()},shaka.media.Transmuxer.isSupported=function(t,i){var r=shaka.media.Transmuxer;if(!shaka.dependencies.muxjs()||!r.isTsContainer(t))return!1;if(i)return MediaSource.isTypeSupported(r.convertTsCodecs(i,t));var o=shaka.util.ManifestParserUtils.ContentType,l=r.convertTsCodecs(o.AUDIO,t);return r=r.convertTsCodecs(o.VIDEO,t),MediaSource.isTypeSupported(l)||MediaSource.isTypeSupported(r)},shaka.media.Transmuxer.isTsContainer=function(t){return"mp2t"==t.toLowerCase().split(";")[0].split("/")[1]},shaka.media.Transmuxer.convertTsCodecs=function(t,i){var r=shaka.util.ManifestParserUtils.ContentType,o=i.replace(/mp2t/i,"mp4");if(t==r.AUDIO&&(o=o.replace("video","audio")),r=/avc1\.(66|77|100)\.(\d+)/.exec(o)){var l="avc1.",g=r[1];"66"==g?l+="4200":"77"==g?l+="4d00":(goog.asserts.assert("100"==g,"Legacy avc1 parsing code out of sync with regex!"),l+="6400"),g=Number(r[2]),goog.asserts.assert(256>g,"Invalid legacy avc1 level number!"),l+=(g>>4).toString(16),l+=(15&g).toString(16),o=o.replace(r[0],l)}return o},shaka.media.Transmuxer.prototype.transmux=function(t){return goog.asserts.assert(!this.isTransmuxing_,"No transmuxing should be in progress."),this.isTransmuxing_=!0,this.transmuxPromise_=new shaka.util.PublicPromise,this.transmuxedData_=[],this.captions_=[],this.metadata_=[],t=shaka.util.BufferUtils.toUint8(t),this.muxTransmuxer_.push(t),this.muxTransmuxer_.flush(),this.isTransmuxing_&&this.transmuxPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.TRANSMUXING_FAILED)),this.transmuxPromise_},shaka.media.Transmuxer.prototype.onTransmuxed_=function(t){this.captions_=t.captions,this.metadata_=t.metadata,this.transmuxedData_.push(shaka.util.Uint8ArrayUtils.concat(t.initSegment,t.data))},shaka.media.Transmuxer.prototype.onTransmuxDone_=function(){var t={data:shaka.util.Uint8ArrayUtils.concat.apply(shaka.util.Uint8ArrayUtils,$jscomp.arrayFromIterable(this.transmuxedData_)),captions:this.captions_,metadata:this.metadata_};this.transmuxPromise_.resolve(t),this.isTransmuxing_=!1},shaka.util.MimeUtils=function(){},shaka.util.MimeUtils.getFullType=function(t,i){var r=t;return i&&(r+='; codecs="'+i+'"'),r},shaka.util.MimeUtils.getFullOrConvertedType=function(t,i,r){return t=shaka.util.MimeUtils.getFullType(t,i),shaka.dependencies.muxjs()&&shaka.media.Transmuxer.isTsContainer(t)?shaka.media.Transmuxer.convertTsCodecs(r,t):t},shaka.util.MimeUtils.getExtendedType=function(t){var i=[t.mimeType];return shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_.forEach(function(r,o){var l=t[o];l&&i.push(r+'="'+l+'"')}),"PQ"==t.hdr&&i.push('eotf="smpte2084"'),i.join(";")},shaka.util.MimeUtils.getContainerType=function(t){return t.split(";")[0].split("/")[1]},shaka.util.MimeUtils.splitCodecs=function(t){return t.split(",")},shaka.util.MimeUtils.getCodecBase=function(t){return shaka.util.MimeUtils.getCodecParts_(t)[0]},shaka.util.MimeUtils.getBasicType=function(t){return t.split(";")[0]},shaka.util.MimeUtils.getCodecs=function(t){return(t=t.split(/ *; */)).shift(),(t=t.find(function(i){return i.startsWith("codecs=")}))?t.split("=")[1].replace(/^"|"$/g,""):""},shaka.util.MimeUtils.getCodecParts_=function(t){var i=t.split(".");return t=i[0],i.pop(),[t,i=i.join(".")]},shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE="application/cea-608",shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE="application/cea-708",shaka.text.TextEngine=function(t){this.parser_=null,this.displayer_=t,this.appendWindowStart_=this.timestampOffset_=0,this.appendWindowEnd_=1/0,this.bufferEnd_=this.bufferStart_=null,this.selectedClosedCaptionId_="",this.closedCaptionsMap_=new Map},shaka.text.TextEngine.registerParser=function(t,i){shaka.text.TextEngine.parserMap_[t]=i},shaka.text.TextEngine.unregisterParser=function(t){delete shaka.text.TextEngine.parserMap_[t]},shaka.text.TextEngine.findParser=function(t){return shaka.text.TextEngine.parserMap_[t]},shaka.text.TextEngine.isTypeSupported=function(t){return!(!shaka.text.TextEngine.parserMap_[t]&&t!=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE&&t!=shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE)},shaka.text.TextEngine.prototype.destroy=function(){return this.displayer_=this.parser_=null,this.closedCaptionsMap_.clear(),Promise.resolve()},shaka.text.TextEngine.prototype.setDisplayer=function(t){this.displayer_=t},shaka.text.TextEngine.prototype.initParser=function(t){t!=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE&&t!=shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE&&(goog.asserts.assert(t=shaka.text.TextEngine.parserMap_[t],"Text type negotiation should have happened already"),this.parser_=shaka.util.Functional.callFactory(t))},shaka.text.TextEngine.prototype.appendBuffer=function(t,i,r){var l,g,_,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(goog.asserts.assert(o.parser_,"The parser should already be initialized"),v.yield(Promise.resolve(),2)):o.parser_&&o.displayer_?null==i||null==r?(o.parser_.parseInit(shaka.util.BufferUtils.toUint8(t)),v.return()):(l={periodStart:o.timestampOffset_,segmentStart:i,segmentEnd:r},g=o.parser_.parseMedia(shaka.util.BufferUtils.toUint8(t),l),_=g.filter(function(E){return E.startTime>=o.appendWindowStart_&&E.startTime<o.appendWindowEnd_}),o.displayer_.append(_),null==o.bufferStart_?o.bufferStart_=Math.max(i,o.appendWindowStart_):(goog.asserts.assert(null!=o.bufferEnd_,"There should already be a buffered range end."),goog.asserts.assert(1>=i-o.bufferEnd_,"There should not be a gap in text references >1s")),o.bufferEnd_=Math.min(r,o.appendWindowEnd_),void v.jumpToEnd()):v.return()})},shaka.text.TextEngine.prototype.remove=function(t,i){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){if(1==o.nextAddress)return o.yield(Promise.resolve(),2);r.displayer_&&r.displayer_.remove(t,i)&&(null==r.bufferStart_?goog.asserts.assert(null==r.bufferEnd_,"end must be null if startTime is null"):(goog.asserts.assert(null!=r.bufferEnd_,"end must be non-null if startTime is non-null"),i<=r.bufferStart_||t>=r.bufferEnd_||(t<=r.bufferStart_&&i>=r.bufferEnd_?r.bufferStart_=r.bufferEnd_=null:t<=r.bufferStart_&&i<r.bufferEnd_?r.bufferStart_=i:t>r.bufferStart_&&i>=r.bufferEnd_?r.bufferEnd_=t:goog.asserts.assert(!1,"removal from the middle is not supported by TextEngine")))),o.jumpToEnd()})},shaka.text.TextEngine.prototype.setTimestampOffset=function(t){this.timestampOffset_=t},shaka.text.TextEngine.prototype.setAppendWindow=function(t,i){this.appendWindowStart_=t,this.appendWindowEnd_=i},shaka.text.TextEngine.prototype.bufferStart=function(){return this.bufferStart_},shaka.text.TextEngine.prototype.bufferEnd=function(){return this.bufferEnd_},shaka.text.TextEngine.prototype.isBuffered=function(t){return null!=this.bufferStart_&&null!=this.bufferEnd_&&t>=this.bufferStart_&&t<this.bufferEnd_},shaka.text.TextEngine.prototype.bufferedAheadOf=function(t){return null==this.bufferEnd_||this.bufferEnd_<t?0:(goog.asserts.assert(null!=this.bufferStart_,"start should not be null if end is not null"),this.bufferEnd_-Math.max(t,this.bufferStart_))},shaka.text.TextEngine.prototype.setSelectedClosedCaptionId=function(t,i){this.selectedClosedCaptionId_=t;var r=this.closedCaptionsMap_.get(t);if(r)for(var o=$jscomp.makeIterator(r.keys()),l=o.next();!l.done;l=o.next())(l=r.get(l.value).filter(function(g){return g.endTime<=i}))&&this.displayer_.append(l)},shaka.text.TextEngine.prototype.convertMuxjsCaptionsToShakaCaptions=function(t){for(var i=[],r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){var o=new shaka.text.Cue((r=r.value).startTime,r.endTime,r.text);i.push({stream:r.stream,cue:o})}return i},shaka.text.TextEngine.prototype.storeAndAppendClosedCaptions=function(t,i,r,o){for(var l=i+" "+r,g=new Map,_=(t=$jscomp.makeIterator(t)).next();!_.done;_=t.next()){var v=_.value;_=v.stream,v=v.cue,g.has(_)||g.set(_,new Map),g.get(_).has(l)||g.get(_).set(l,[]),v.startTime+=o,v.endTime+=o,v.startTime>=this.appendWindowStart_&&v.startTime<this.appendWindowEnd_&&(g.get(_).get(l).push(v),_==this.selectedClosedCaptionId_&&this.displayer_.append([v]))}for(l=(o=$jscomp.makeIterator(g.keys())).next();!l.done;l=o.next())for(this.closedCaptionsMap_.has(l=l.value)||this.closedCaptionsMap_.set(l,new Map),_=(t=$jscomp.makeIterator(g.get(l).keys())).next();!_.done;_=t.next())_=_.value,v=g.get(l).get(_),this.closedCaptionsMap_.get(l).set(_,v);this.bufferStart_=null==this.bufferStart_?Math.max(i,this.appendWindowStart_):Math.min(this.bufferStart_,Math.max(i,this.appendWindowStart_)),this.bufferEnd_=Math.max(this.bufferEnd_,Math.min(r,this.appendWindowEnd_))},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionChannels=function(){return this.closedCaptionsMap_.size},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionsInChannel=function(t){return(t=this.closedCaptionsMap_.get(t))?t.size:0},goog.exportSymbol("shaka.text.TextEngine",shaka.text.TextEngine),goog.exportProperty(shaka.text.TextEngine.prototype,"destroy",shaka.text.TextEngine.prototype.destroy),goog.exportProperty(shaka.text.TextEngine,"findParser",shaka.text.TextEngine.findParser),goog.exportProperty(shaka.text.TextEngine,"unregisterParser",shaka.text.TextEngine.unregisterParser),goog.exportProperty(shaka.text.TextEngine,"registerParser",shaka.text.TextEngine.registerParser),shaka.text.TextEngine.parserMap_={},shaka.util.Destroyer=function(t){this.destroyed_=!1,this.waitOnDestroy_=new shaka.util.PublicPromise,this.onDestroy_=t},shaka.util.Destroyer.prototype.destroyed=function(){return this.destroyed_},shaka.util.Destroyer.prototype.destroy=function(){var t=this;return this.destroyed_?this.waitOnDestroy_:(this.destroyed_=!0,this.onDestroy_().then(function(){t.waitOnDestroy_.resolve()},function(){t.waitOnDestroy_.resolve()}))},shaka.util.Destroyer.prototype.ensureNotDestroyed=function(t){if(this.destroyed_)throw t instanceof shaka.util.Error&&t.code==shaka.util.Error.Code.OBJECT_DESTROYED?t:shaka.util.Destroyer.destroyedError(t)},shaka.util.Destroyer.destroyedError=function(t){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OBJECT_DESTROYED,t)},shaka.util.IReleasable=function(){},shaka.util.IReleasable.prototype.release=function(){},shaka.util.EventManager=function(){this.bindingMap_=new shaka.util.MultiMap},shaka.util.EventManager.prototype.release=function(){this.removeAll(),this.bindingMap_=null},shaka.util.EventManager.prototype.listen=function(t,i,r,o){this.bindingMap_&&(t=new shaka.util.EventManager.Binding_(t,i,r,o),this.bindingMap_.push(i,t))},shaka.util.EventManager.prototype.listenOnce=function(t,i,r,o){var l=this,g=function(_){l.unlisten(t,i,g),r(_)};this.listen(t,i,g,o)},shaka.util.EventManager.prototype.unlisten=function(t,i,r){if(this.bindingMap_)for(var o=this.bindingMap_.get(i)||[],l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next())(l=l.value).target!=t||r!=l.listener&&r||(l.unlisten(),this.bindingMap_.remove(i,l))},shaka.util.EventManager.prototype.removeAll=function(){if(this.bindingMap_){for(var t=this.bindingMap_.getAll(),i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next())i.value.unlisten();this.bindingMap_.clear()}},goog.exportSymbol("shaka.util.EventManager",shaka.util.EventManager),goog.exportProperty(shaka.util.EventManager.prototype,"removeAll",shaka.util.EventManager.prototype.removeAll),goog.exportProperty(shaka.util.EventManager.prototype,"unlisten",shaka.util.EventManager.prototype.unlisten),goog.exportProperty(shaka.util.EventManager.prototype,"listenOnce",shaka.util.EventManager.prototype.listenOnce),goog.exportProperty(shaka.util.EventManager.prototype,"listen",shaka.util.EventManager.prototype.listen),goog.exportProperty(shaka.util.EventManager.prototype,"release",shaka.util.EventManager.prototype.release),shaka.util.EventManager.Binding_=function(t,i,r,o){this.target=t,this.type=i,this.listener=r,this.options=shaka.util.EventManager.Binding_.convertOptions_(t,o),this.target.addEventListener(i,r,this.options)},shaka.util.EventManager.Binding_.prototype.unlisten=function(){goog.asserts.assert(this.target,"Missing target"),this.target.removeEventListener(this.type,this.listener,this.options),this.listener=this.target=null,this.options=!1},shaka.util.EventManager.Binding_.convertOptions_=function(t,i){if(null==i)return!1;if("boolean"==typeof i)return i;var r=new Set(["passive","capture"]),o=Object.keys(i).filter(function(l){return!r.has(l)});return goog.asserts.assert(0==o.length,"Unsupported flag(s) to addEventListener: "+o.join(",")),shaka.util.EventManager.Binding_.doesSupportObject_(t)?i:i.capture||!1},shaka.util.EventManager.Binding_.doesSupportObject_=function(t){var i=shaka.util.EventManager.Binding_.supportsObject_;if(null==i){i=!1;try{var r={},o={get:function(){return i=!0,!1}};Object.defineProperty(r,"passive",o),Object.defineProperty(r,"capture",o),t.addEventListener("test",o=function(){},r),t.removeEventListener("test",o,r)}catch(l){i=!1}shaka.util.EventManager.Binding_.supportsObject_=i}return i||!1},shaka.util.EventManager.Binding_.supportsObject_=void 0,shaka.media.MediaSourceEngine=function(t,i,r,o){var l=this;this.video_=t,this.textDisplayer_=r,this.sourceBuffers_={},this.sourceBufferTypes_={},this.textEngine_=null,t=function(g,_,v){},this.onMetadata_=o||t,this.queues_={},this.eventManager_=new shaka.util.EventManager,this.transmuxers_={},this.captionParser_=i,this.mediaSourceOpen_=new shaka.util.PublicPromise,this.mediaSource_=this.createMediaSource(this.mediaSourceOpen_),this.destroyer_=new shaka.util.Destroyer(function(){return l.doDestroy_()}),this.url_=""},shaka.media.MediaSourceEngine.prototype.createMediaSource=function(t){var i=this,r=new MediaSource;return this.eventManager_.listenOnce(r,"sourceopen",function(){return i.onSourceOpen_(t)}),this.url_=shaka.media.MediaSourceEngine.createObjectURL(r),this.video_.src=this.url_,r},shaka.media.MediaSourceEngine.prototype.onSourceOpen_=function(t){URL.revokeObjectURL(this.url_),t.resolve()},shaka.media.MediaSourceEngine.isStreamSupported=function(t){var i=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),r=shaka.util.MimeUtils.getExtendedType(t);return shaka.text.TextEngine.isTypeSupported(i)||MediaSource.isTypeSupported(r)||shaka.media.Transmuxer.isSupported(i,t.type)},shaka.media.MediaSourceEngine.probeSupport=function(){for(var t={},i=$jscomp.makeIterator('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),r=i.next();!r.done;r=i.next()){t[r=r.value]=shaka.util.Platform.supportsMediaSource()?!!shaka.text.TextEngine.isTypeSupported(r)||MediaSource.isTypeSupported(r)||shaka.media.Transmuxer.isSupported(r):shaka.util.Platform.supportsMediaType(r);var o=r.split(";")[0];t[o]=t[o]||t[r]}return t},shaka.media.MediaSourceEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.MediaSourceEngine.prototype.doDestroy_=function(){var i,r,o,l,g,_,v,P,M,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){if(1==R.nextAddress){for(o in i=shaka.util.Functional,r=[],t.queues_)for(g=(l=t.queues_[o])[0],t.queues_[o]=l.slice(0,1),g&&r.push(g.p.catch(i.noop)),_=$jscomp.makeIterator(l.slice(1)),v=_.next();!v.done;v=_.next())v.value.p.reject(shaka.util.Destroyer.destroyedError());for(P in t.textEngine_&&r.push(t.textEngine_.destroy()),t.textDisplayer_&&r.push(t.textDisplayer_.destroy()),t.transmuxers_)r.push(t.transmuxers_[P].destroy());return R.yield(Promise.all(r),2)}if(t.eventManager_&&(t.eventManager_.release(),t.eventManager_=null),t.video_&&(t.video_.removeAttribute("src"),t.video_.load(),t.video_=null),t.mediaSource_=null,t.textEngine_=null,t.textDisplayer_=null,t.sourceBuffers_={},t.transmuxers_={},t.captionParser_=null,goog.DEBUG)for(M in t.queues_)goog.asserts.assert(0==t.queues_[M].length,M+" queue should be empty after destroy!");t.queues_={},R.jumpToEnd()})},shaka.media.MediaSourceEngine.prototype.open=function(){return this.mediaSourceOpen_},shaka.media.MediaSourceEngine.prototype.init=function(t,i){var o,l,g,_,v,E,P,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress)return o=shaka.util.ManifestParserUtils.ContentType,M.yield(r.mediaSourceOpen_,2);for(l={},g=$jscomp.makeIterator(t.keys()),_=g.next();!_.done;l={$jscomp$loop$prop$contentType$622:l.$jscomp$loop$prop$contentType$622},_=g.next())l.$jscomp$loop$prop$contentType$622=_.value,v=t.get(l.$jscomp$loop$prop$contentType$622),goog.asserts.assert(shaka.media.MediaSourceEngine.isStreamSupported(v),"Type negotiation should happen before MediaSourceEngine.init!"),E=shaka.util.MimeUtils.getFullType(v.mimeType,v.codecs),l.$jscomp$loop$prop$contentType$622==o.TEXT?r.reinitText(E):(!i&&MediaSource.isTypeSupported(E)||!shaka.media.Transmuxer.isSupported(E,l.$jscomp$loop$prop$contentType$622)||(r.transmuxers_[l.$jscomp$loop$prop$contentType$622]=new shaka.media.Transmuxer,E=shaka.media.Transmuxer.convertTsCodecs(l.$jscomp$loop$prop$contentType$622,E)),P=r.mediaSource_.addSourceBuffer(E),r.eventManager_.listen(P,"error",function(R){return function(){return r.onError_(R.$jscomp$loop$prop$contentType$622)}}(l)),r.eventManager_.listen(P,"updateend",function(R){return function(){return r.onUpdateEnd_(R.$jscomp$loop$prop$contentType$622)}}(l)),r.sourceBuffers_[l.$jscomp$loop$prop$contentType$622]=P,r.sourceBufferTypes_[l.$jscomp$loop$prop$contentType$622]=E,r.queues_[l.$jscomp$loop$prop$contentType$622]=[]);M.jumpToEnd()})},shaka.media.MediaSourceEngine.prototype.reinitText=function(t){this.textEngine_||(this.textEngine_=new shaka.text.TextEngine(this.textDisplayer_)),this.textEngine_.initParser(t)},shaka.media.MediaSourceEngine.prototype.ended=function(){return!this.mediaSource_||"ended"==this.mediaSource_.readyState},shaka.media.MediaSourceEngine.prototype.bufferStart=function(t){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferStart():shaka.media.TimeRangesUtils.bufferStart(this.getBuffered_(t))},shaka.media.MediaSourceEngine.prototype.bufferEnd=function(t){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferEnd():shaka.media.TimeRangesUtils.bufferEnd(this.getBuffered_(t))},shaka.media.MediaSourceEngine.prototype.isBuffered=function(t,i,r){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.isBuffered(i):(t=this.getBuffered_(t),shaka.media.TimeRangesUtils.isBuffered(t,i,r))},shaka.media.MediaSourceEngine.prototype.bufferedAheadOf=function(t,i){if(t==shaka.util.ManifestParserUtils.ContentType.TEXT)return this.textEngine_.bufferedAheadOf(i);var r=this.getBuffered_(t);return shaka.media.TimeRangesUtils.bufferedAheadOf(r,i)},shaka.media.MediaSourceEngine.prototype.getBufferedInfo=function(){var t=shaka.util.ManifestParserUtils.ContentType,i=shaka.media.TimeRangesUtils;if(t={total:i.getBufferedInfo(this.video_.buffered),audio:i.getBufferedInfo(this.getBuffered_(t.AUDIO)),video:i.getBufferedInfo(this.getBuffered_(t.VIDEO)),text:[]},this.textEngine_){i=this.textEngine_.bufferStart();var r=this.textEngine_.bufferEnd();null!=i&&null!=r&&t.text.push({start:i,end:r})}return t},shaka.media.MediaSourceEngine.prototype.getBuffered_=function(t){try{return this.sourceBuffers_[t].buffered}catch(i){return t in this.sourceBuffers_&&shaka.log.error("failed to get buffered range for "+t,i),null}},shaka.media.MediaSourceEngine.prototype.appendBuffer=function(t,i,r,o,l){var _,v,P,R,U,$,g=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return 1==G.nextAddress?t==(_=shaka.util.ManifestParserUtils.ContentType).TEXT?G.yield(g.textEngine_.appendBuffer(i,r,o),0):g.transmuxers_[t]?G.yield(g.transmuxers_[t].transmux(i),10):l?(g.textEngine_||g.reinitText("text/vtt"),null==r&&null==o?g.captionParser_.init(i):(v=g.captionParser_.parseFrom(i)).length&&g.textEngine_.storeAndAppendClosedCaptions(v,r,o,g.sourceBuffers_[_.VIDEO].timestampOffset),i=g.workAroundBrokenPlatforms_(i,r,t),G.yield(g.enqueueOperation_(t,function(){return g.append_(t,i)}),0)):(i=g.workAroundBrokenPlatforms_(i,r,t),G.yield(g.enqueueOperation_(t,function(){return g.append_(t,i)}),0)):(P=G.yieldResult,g.textEngine_||g.reinitText("text/vtt"),P.metadata&&g.onMetadata_(P.metadata,g.sourceBuffers_[t].timestampOffset,o),P.captions&&P.captions.length&&(R=g.sourceBuffers_[_.VIDEO].timestampOffset,U=g.textEngine_.convertMuxjsCaptionsToShakaCaptions(P.captions),g.textEngine_.storeAndAppendClosedCaptions(U,r,o,R)),$=g.workAroundBrokenPlatforms_($=P.data,r,t),G.yield(g.enqueueOperation_(t,function(){return g.append_(t,$)}),0))})},shaka.media.MediaSourceEngine.prototype.setSelectedClosedCaptionId=function(t){var i=this.bufferEnd(shaka.util.ManifestParserUtils.ContentType.VIDEO)||0;this.textEngine_.setSelectedClosedCaptionId(t,i)},shaka.media.MediaSourceEngine.prototype.clearSelectedClosedCaptionId=function(){this.textEngine_&&this.textEngine_.setSelectedClosedCaptionId("",0)},shaka.media.MediaSourceEngine.prototype.remove=function(t,i,r){var o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){return g.yield(t==shaka.util.ManifestParserUtils.ContentType.TEXT?o.textEngine_.remove(i,r):o.enqueueOperation_(t,function(){return o.remove_(t,i,r)}),0)})},shaka.media.MediaSourceEngine.prototype.clear=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?i.textEngine_?o.yield(i.textEngine_.remove(0,1/0),0):o.return():o.yield(i.enqueueOperation_(t,function(){return i.remove_(t,0,i.mediaSource_.duration)}),0)})},shaka.media.MediaSourceEngine.prototype.resetCaptionParser=function(){this.captionParser_.reset()},shaka.media.MediaSourceEngine.prototype.flush=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?o.return():o.yield(i.enqueueOperation_(t,function(){return i.flush_(t)}),0)})},shaka.media.MediaSourceEngine.prototype.setStreamProperties=function(t,i,r,o){var l=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_){return t==shaka.util.ManifestParserUtils.ContentType.TEXT?(l.textEngine_.setTimestampOffset(i),l.textEngine_.setAppendWindow(r,o),_.return()):_.yield(Promise.all([l.enqueueOperation_(t,function(){return l.abort_(t)}),l.enqueueOperation_(t,function(){return l.setTimestampOffset_(t,i)}),l.enqueueOperation_(t,function(){return l.setAppendWindow_(t,r,o)})]),0)})},shaka.media.MediaSourceEngine.prototype.endOfStream=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return r.yield(i.enqueueBlockingOperation_(function(){i.ended()||(t?i.mediaSource_.endOfStream(t):i.mediaSource_.endOfStream())}),0)})},shaka.media.MediaSourceEngine.prototype.setDuration=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return goog.asserts.assert(isNaN(i.mediaSource_.duration)||i.mediaSource_.duration<=t,"duration cannot decrease: "+i.mediaSource_.duration+" -> "+t),r.yield(i.enqueueBlockingOperation_(function(){i.mediaSource_.duration=t}),0)})},shaka.media.MediaSourceEngine.prototype.getDuration=function(){return this.mediaSource_.duration},shaka.media.MediaSourceEngine.prototype.append_=function(t,i){this.sourceBuffers_[t].appendBuffer(i)},shaka.media.MediaSourceEngine.prototype.remove_=function(t,i,r){r<=i?this.onUpdateEnd_(t):this.sourceBuffers_[t].remove(i,r)},shaka.media.MediaSourceEngine.prototype.abort_=function(t){var i=this.sourceBuffers_[t].appendWindowStart,r=this.sourceBuffers_[t].appendWindowEnd;this.sourceBuffers_[t].abort(),this.sourceBuffers_[t].appendWindowStart=i,this.sourceBuffers_[t].appendWindowEnd=r,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.flush_=function(t){goog.asserts.assert(0==this.video_.buffered.length,"MediaSourceEngine.flush_ should only be used after clearing all data!"),this.video_.currentTime-=.001,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.setTimestampOffset_=function(t,i){0>i&&(i+=.001),this.sourceBuffers_[t].timestampOffset=i,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.setAppendWindow_=function(t,i,r){this.sourceBuffers_[t].appendWindowStart=0,this.sourceBuffers_[t].appendWindowEnd=r,this.sourceBuffers_[t].appendWindowStart=i,this.onUpdateEnd_(t)},shaka.media.MediaSourceEngine.prototype.onError_=function(t){var i=this.queues_[t][0];goog.asserts.assert(i,"Spurious error event!"),goog.asserts.assert(!this.sourceBuffers_[t].updating,"SourceBuffer should not be updating on error!"),i.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_FAILED,this.video_.error?this.video_.error.code:0))},shaka.media.MediaSourceEngine.prototype.onUpdateEnd_=function(t){var i=this.queues_[t][0];goog.asserts.assert(i,"Spurious updateend event!"),i&&(goog.asserts.assert(!this.sourceBuffers_[t].updating,"SourceBuffer should not be updating on updateend!"),i.p.resolve(),this.popFromQueue_(t))},shaka.media.MediaSourceEngine.prototype.enqueueOperation_=function(t,i){this.destroyer_.ensureNotDestroyed();var r={start:i,p:new shaka.util.PublicPromise};return this.queues_[t].push(r),1==this.queues_[t].length&&this.startOperation_(t),r.p},shaka.media.MediaSourceEngine.prototype.enqueueBlockingOperation_=function(t){var r,o,l,g,_,v,E,P,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){switch(M.nextAddress){case 1:for(l in i.destroyer_.ensureNotDestroyed(),r=[],o={},i.sourceBuffers_)o.$jscomp$loop$prop$ready$624=new shaka.util.PublicPromise,g={start:function(R){return function(){return R.$jscomp$loop$prop$ready$624.resolve()}}(o),p:o.$jscomp$loop$prop$ready$624},i.queues_[l].push(g),r.push(o.$jscomp$loop$prop$ready$624),1==i.queues_[l].length&&g.start(),o={$jscomp$loop$prop$ready$624:o.$jscomp$loop$prop$ready$624};return M.setCatchFinallyBlocks(2),M.yield(Promise.all(r),4);case 4:M.leaveTryBlock(3);break;case 2:if(_=M.enterCatchBlock(),goog.asserts.assert(i.destroyer_.destroyed(),"Should be destroyed by now"),goog.DEBUG)for(v in i.sourceBuffers_)i.queues_[v].length&&(goog.asserts.assert(1==i.queues_[v].length,"Should be at most one item in queue!"),goog.asserts.assert(r.includes(i.queues_[v][0].p),"The item in queue should be one of our waiters!"),i.queues_[v].shift());throw _;case 3:if(goog.DEBUG)for(E in i.sourceBuffers_)goog.asserts.assert(0==i.sourceBuffers_[E].updating,"SourceBuffers should not be updating after a blocking op!");try{t()}catch(R){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,R)}finally{for(P in i.sourceBuffers_)i.popFromQueue_(P)}M.jumpToEnd()}})},shaka.media.MediaSourceEngine.prototype.popFromQueue_=function(t){this.queues_[t].shift(),this.startOperation_(t)},shaka.media.MediaSourceEngine.prototype.startOperation_=function(t){var i=this.queues_[t][0];if(i)try{i.start()}catch(r){i.p.reject("QuotaExceededError"==r.name?new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR,t):new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,r)),this.popFromQueue_(t)}},shaka.media.MediaSourceEngine.prototype.getTextDisplayer=function(){return goog.asserts.assert(this.textDisplayer_,"TextDisplayer should only be null when this is destroyed"),this.textDisplayer_},shaka.media.MediaSourceEngine.prototype.setTextDisplayer=function(t){var i=this.textDisplayer_;this.textDisplayer_=t,i&&(t.setTextVisibility(i.isTextVisible()),i.destroy()),this.textEngine_&&this.textEngine_.setDisplayer(t)},shaka.media.MediaSourceEngine.prototype.workAroundBrokenPlatforms_=function(t,i,r){return null==i&&this.video_.mediaKeys&&shaka.util.Platform.requiresEncryptionInfoInAllInitSegments()&&"mp4"==shaka.util.MimeUtils.getContainerType(this.sourceBufferTypes_[r])&&(shaka.log.debug("Forcing fake encryption information in init segment."),t=shaka.media.ContentWorkarounds.fakeEncryption(t)),t},shaka.media.MediaSourceEngine.createObjectURL=window.URL.createObjectURL,shaka.util.StreamUtils=function(){},shaka.util.StreamUtils.chooseCodecsAndFilterManifest=function(t,i,r){var o=shaka.util.StreamUtils;i=o.filterVariantsByAudioChannelCount(t.variants,i),i=o.getVariantsByCodecs_(i),i=o.filterVariantsByDensity_(i);var l=o.chooseCodecs_(i,r);t.variants=t.variants.filter(function(g){return o.getVariantCodecs_(g)==l||(shaka.log.debug("Dropping Variant (better codec available)",g),!1)})},shaka.util.StreamUtils.getVariantsByCodecs_=function(t){for(var i=new shaka.util.MultiMap,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){var o=shaka.util.StreamUtils.getVariantCodecs_(r=r.value);i.push(o,r)}return i},shaka.util.StreamUtils.filterVariantsByDensity_=function(t){var i=0,r=new Map,o=t.size();return t.forEach(function(l,g){for(var _=$jscomp.makeIterator(g),v=_.next();!v.done;v=_.next()){var E=(v=v.value).video;if(E&&E.width&&E.height){r.has(E=E.width*E.height*(E.frameRate||1))||r.set(E,new shaka.util.MultiMap);var P=r.get(E);P.push(l,v),P.size()===o&&(i=Math.max(i,E))}}}),i?r.get(i):t},shaka.util.StreamUtils.chooseCodecs_=function(t,i){for(var r=shaka.util.StreamUtils,o=$jscomp.makeIterator(i),l=o.next();!l.done;l=o.next())if((l=l.value)==r.DecodingAttributes.SMOOTH||l==r.DecodingAttributes.POWER){if(1==(t=r.chooseCodecsByMediaCapabilitiesInfo_(t,l)).size())return t.keys()[0]}else if(l==r.DecodingAttributes.BANDWIDTH)break;return r.findCodecsByLowestBandwidth_(t)},shaka.util.StreamUtils.chooseCodecsByMediaCapabilitiesInfo_=function(t,i){var r=0,o=new shaka.util.MultiMap;return t.forEach(function(l,g){for(var _=0,v=0,E=$jscomp.makeIterator(g),P=E.next();!P.done;P=E.next())(P=P.value).decodingInfos.length&&(_+=P.decodingInfos[0][i]?1:0,v++);shaka.log.info("codecs",l,"avg",i,_/=v),_>r?(o.clear(),o.push(l,g),r=_):_==r&&o.push(l,g)}),o},shaka.util.StreamUtils.findCodecsByLowestBandwidth_=function(t){var i="",r=1/0;return t.forEach(function(o,l){for(var g=0,_=0,v=$jscomp.makeIterator(l),E=v.next();!E.done;E=v.next())g+=E.value.bandwidth||0,++_;shaka.log.debug("codecs",o,"avg bandwidth",g/=_),g<r&&(i=o,r=g)}),goog.asserts.assert(""!==i,"Should have chosen codecs!"),goog.asserts.assert(!isNaN(r),"Bandwidth should be a number!"),i},shaka.util.StreamUtils.getVariantCodecs_=function(t){var i="";t.video&&(i=shaka.util.MimeUtils.getCodecBase(t.video.codecs));var r="";return t.audio&&(r=shaka.util.MimeUtils.getCodecBase(t.audio.codecs)),i+"-"+r},shaka.util.StreamUtils.filterByRestrictions=function(t,i,r){t.variants=t.variants.filter(function(o){return shaka.util.StreamUtils.meetsRestrictions(o,i,r)})},shaka.util.StreamUtils.meetsRestrictions=function(t,i,r){var o=function(g,_,v){return g>=_&&g<=v},l=t.video;return!(l&&l.width&&l.height&&(!o(l.width,i.minWidth,Math.min(i.maxWidth,r.width))||!o(l.height,i.minHeight,Math.min(i.maxHeight,r.height))||!o(l.width*l.height,i.minPixels,i.maxPixels))||t&&t.video&&t.video.frameRate&&!o(t.video.frameRate,i.minFrameRate,i.maxFrameRate)||!o(t.bandwidth,i.minBandwidth,i.maxBandwidth))},shaka.util.StreamUtils.applyRestrictions=function(t,i,r){for(var o=!1,l=(t=$jscomp.makeIterator(t)).next();!l.done;l=t.next()){var g=(l=l.value).allowedByApplication;l.allowedByApplication=shaka.util.StreamUtils.meetsRestrictions(l,i,r),g!=l.allowedByApplication&&(o=!0)}return o},shaka.util.StreamUtils.filterManifest=function(t,i,r,o){return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return o?l.yield(shaka.util.StreamUtils.filterManifestByMediaCapabilities(r,0<r.offlineSessionIds.length),2):(shaka.util.StreamUtils.filterManifestByDrm(r,t),shaka.util.StreamUtils.filterManifestByMediaSource(r),l.jumpTo(2));shaka.util.StreamUtils.filterManifestByCurrentVariant(i,r),shaka.util.StreamUtils.filterTextStreams_(r),shaka.util.StreamUtils.filterImageStreams_(r),l.jumpToEnd()})},shaka.util.StreamUtils.filterManifestByDrm=function(t,i){t.variants=t.variants.filter(function(r){return i&&i.initialized()&&!i.supportsVariant(r)?(shaka.log.debug("Dropping variant - not compatible with key system",r),!1):(shaka.log.debug("DrmEngine is not initialized yet."),!0)})},shaka.util.StreamUtils.filterManifestByMediaCapabilities=function(t,i){return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return goog.asserts.assert(navigator.mediaCapabilities,"MediaCapabilities should be valid."),r.yield(shaka.util.StreamUtils.getDecodingInfosForVariants(t.variants,i),2);t.variants=t.variants.filter(function(o){var l=o.decodingInfos.some(function(g){return g.supported});return l||shaka.log.debug("Dropping variant - not compatible with platform",shaka.util.StreamUtils.getVariantSummaryString_(o)),l}),r.jumpToEnd()})},shaka.util.StreamUtils.filterManifestByMediaSource=function(t){var i=shaka.util.StreamUtils;t.variants=t.variants.filter(function(r){var o=r.audio;return r=r.video,o&&!shaka.media.MediaSourceEngine.isStreamSupported(o)?(shaka.log.debug("Dropping variant - audio not compatible with platform",i.getStreamSummaryString_(o)),!1):!(r&&!shaka.media.MediaSourceEngine.isStreamSupported(r)&&(shaka.log.debug("Dropping variant - video not compatible with platform",i.getStreamSummaryString_(r)),1))})},shaka.util.StreamUtils.getDecodingInfosForVariants=function(t,i){var o,l,g,_,v,E,P,M,R;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){if(t.some(function(G){return G.decodingInfos.length}))return shaka.log.debug("Already got the variants' decodingInfo."),$.return();for(o=navigator.mediaCapabilities,l=[],g=function(G,z){var Y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){return 1==se.nextAddress?(se.setCatchFinallyBlocks(2),se.yield(o.decodingInfo(z),4)):2!=se.nextAddress?(G.decodingInfos.push(se.yieldResult),se.leaveTryBlock(0)):(Y=se.enterCatchBlock(),shaka.log.info("MediaCapabilities.decodingInfo() failed.",JSON.stringify(z),Y),void se.jumpToEnd())})},_=$jscomp.makeIterator(t),v=_.next();!v.done;v=_.next())for(P=shaka.util.StreamUtils.getDecodingConfigs_(E=v.value,i),M=$jscomp.makeIterator(P),R=M.next();!R.done;R=M.next())l.push(g(E,R.value));return $.yield(Promise.all(l),0)})},shaka.util.StreamUtils.getDecodingConfigs_=function(t,i){var r=t.audio,o=t.video,l=shaka.util.ManifestParserUtils.ContentType,g={type:"media-source"};if(o){var _=o.codecs;if(o.codecs.includes(",")){var v=o.codecs.split(",");_=shaka.util.ManifestParserUtils.guessCodecs(l.VIDEO,v),_=shaka.util.StreamUtils.patchVp9(_),v=shaka.util.ManifestParserUtils.guessCodecs(l.AUDIO,v),v=shaka.util.MimeUtils.getFullOrConvertedType(o.mimeType,v,l.AUDIO),g.audio={contentType:v,channels:2,bitrate:t.bandwidth||1,samplerate:1,spatialRendering:!1}}_=shaka.util.StreamUtils.patchVp9(_),_=shaka.util.MimeUtils.getFullOrConvertedType(o.mimeType,_,l.VIDEO),g.video={contentType:_,width:o.width||1,height:o.height||1,bitrate:o.bandwidth||t.bandwidth||1,framerate:o.frameRate||1}}if(r&&(_="ac-3"==r.codecs.toLowerCase()&&shaka.util.Platform.isTizen()?"ec-3":r.codecs,l=shaka.util.MimeUtils.getFullOrConvertedType(r.mimeType,_,l.AUDIO),g.audio={contentType:l,channels:r.channelsCount||2,bitrate:r.bandwidth||t.bandwidth||1,samplerate:r.audioSamplingRate||1,spatialRendering:r.spatialAudio}),!(v=(t.video?t.video.drmInfos:[]).concat(t.audio?t.audio.drmInfos:[])).length)return[g];l=[],_=new Map;for(var E=(v=$jscomp.makeIterator(v)).next();!E.done;E=v.next()){var P=E.value;_.get(P.keySystem)||_.set(P.keySystem,[]),_.get(P.keySystem).push(P)}v=i?"required":"optional",P=i?["persistent-license"]:["temporary"];for(var M=$jscomp.makeIterator(_.keys()),R=M.next();!R.done;R=M.next()){var U=R.value;R=Object.assign({},g);var $=_.get(U);for(U={keySystem:U,initDataType:"cenc",persistentState:v,distinctiveIdentifier:"optional",sessionTypes:P},E=($=$jscomp.makeIterator($)).next();!E.done;E=$.next()){if((E=E.value).initData&&E.initData.length){for(var G=new Set,z=$jscomp.makeIterator(E.initData),Z=z.next();!Z.done;Z=z.next())G.add(Z.value.initDataType);1<G.size&&shaka.log.v2("DrmInfo contains more than one initDataType,","and we use the initDataType of the first initData.",E),U.initDataType=E.initData[0].initDataType}E.distinctiveIdentifierRequired&&(U.distinctiveIdentifier="required"),E.persistentStateRequired&&(U.persistentState="required"),E.sessionType&&(U.sessionTypes=[E.sessionType]),r&&(U.audio?U.audio.robustness=U.audio.robustness||E.audioRobustness:U.audio={robustness:E.audioRobustness}),o&&(U.video?U.video.robustness=U.video.robustness||E.videoRobustness:U.video={robustness:E.videoRobustness})}R.keySystemConfiguration=U,l.push(R)}return l},shaka.util.StreamUtils.patchVp9=function(t){return"vp9"==t?"vp09.00.10.08":t},shaka.util.StreamUtils.filterManifestByCurrentVariant=function(t,i){var r=shaka.util.StreamUtils;i.variants=i.variants.filter(function(o){var l=o.audio;return o=o.video,l&&t&&t.audio&&!r.areStreamsCompatible_(l,t.audio)?(shaka.log.debug("Droping variant - not compatible with active audio","active audio",r.getStreamSummaryString_(t.audio),"variant.audio",r.getStreamSummaryString_(l)),!1):!(o&&t&&t.video&&!r.areStreamsCompatible_(o,t.video)&&(shaka.log.debug("Droping variant - not compatible with active video","active video",r.getStreamSummaryString_(t.video),"variant.video",r.getStreamSummaryString_(o)),1))})},shaka.util.StreamUtils.filterTextStreams_=function(t){t.textStreams=t.textStreams.filter(function(i){var r=shaka.util.MimeUtils.getFullType(i.mimeType,i.codecs);return(r=shaka.text.TextEngine.isTypeSupported(r))||shaka.log.debug("Dropping text stream. Is not supported by the platform.",i),r})},shaka.util.StreamUtils.filterImageStreams_=function(t){t.imageStreams=t.imageStreams.filter(function(i){var r=["image/svg+xml","image/png","image/jpeg"],o=shaka.util.Platform;return(o.isWebOS()||o.isTizen()||o.isChromecast())&&r.push("image/webp"),(r=r.includes(i.mimeType))||shaka.log.debug("Dropping image stream. Is not supported by the platform.",i),r})},shaka.util.StreamUtils.areStreamsCompatible_=function(t,i){return!(t.mimeType!=i.mimeType||t.codecs.split(".")[0]!=i.codecs.split(".")[0])},shaka.util.StreamUtils.variantToTrack=function(t){var i=t.audio,r=t.video,o=i?i.codecs:null,l=r?r.codecs:null,g=[];l&&g.push(l),o&&g.push(o);var _=[];r&&_.push(r.mimeType),i&&_.push(i.mimeType),_=_[0]||null;var v=[];i&&v.push(i.kind),r&&v.push(r.kind),v=v[0]||null;var E=new Set;if(i)for(var P=$jscomp.makeIterator(i.roles),M=P.next();!M.done;M=P.next())E.add(M.value);if(r)for(M=(P=$jscomp.makeIterator(r.roles)).next();!M.done;M=P.next())E.add(M.value);return t={id:t.id,active:!1,type:"variant",bandwidth:t.bandwidth,language:t.language,label:null,kind:v,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:_,codecs:g.join(", "),audioCodec:o,videoCodec:l,primary:t.primary,roles:Array.from(E),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null},r&&(t.videoId=r.id,t.originalVideoId=r.originalId,t.width=r.width||null,t.height=r.height||null,t.frameRate=r.frameRate||null,t.pixelAspectRatio=r.pixelAspectRatio||null,t.videoBandwidth=r.bandwidth||null),i&&(t.audioId=i.id,t.originalAudioId=i.originalId,t.channelsCount=i.channelsCount,t.audioSamplingRate=i.audioSamplingRate,t.audioBandwidth=i.bandwidth||null,t.label=i.label,t.audioRoles=i.roles),t},shaka.util.StreamUtils.textStreamToTrack=function(t){return{id:t.id,active:!1,type:shaka.util.ManifestParserUtils.ContentType.TEXT,bandwidth:0,language:t.language,label:t.label,kind:t.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:t.mimeType,codecs:t.codecs||null,audioCodec:null,videoCodec:null,primary:t.primary,roles:t.roles,audioRoles:null,forced:t.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:t.originalId,originalImageId:null}},shaka.util.StreamUtils.imageStreamToTrack=function(t){return{id:t.id,active:!1,type:shaka.util.ManifestParserUtils.ContentType.IMAGE,bandwidth:t.bandwidth||0,language:"",label:null,kind:null,width:t.width||null,height:t.height||null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:t.mimeType,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:t.tilesLayout||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:t.originalId}},shaka.util.StreamUtils.html5TrackId=function(t){return t.__shaka_id||(t.__shaka_id=shaka.util.StreamUtils.nextTrackId_++),t.__shaka_id},shaka.util.StreamUtils.html5TextTrackToTrack=function(t){var i=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE,r=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(t);return r.active="disabled"!=t.mode,r.type="text",r.originalTextId=t.id,"captions"==t.kind&&(r.mimeType=i),t.kind&&(r.roles=[t.kind]),"forced"==t.kind&&(r.forced=!0),r},shaka.util.StreamUtils.html5AudioTrackToTrack=function(t){var i=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(t);return i.active=t.enabled,i.type="variant",i.originalAudioId=t.id,"main"==t.kind&&(i.primary=!0),t.kind&&(i.roles=[t.kind],i.audioRoles=[t.kind],i.label=t.label),i},shaka.util.StreamUtils.html5TrackToGenericShakaTrack_=function(t){return{id:shaka.util.StreamUtils.html5TrackId(t),active:!1,type:"",bandwidth:0,language:shaka.util.LanguageUtils.normalize(t.language),label:t.label,kind:t.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null}},shaka.util.StreamUtils.isPlayable=function(t){return t.allowedByApplication&&t.allowedByKeySystem},shaka.util.StreamUtils.getPlayableVariants=function(t){return t.filter(function(i){return shaka.util.StreamUtils.isPlayable(i)})},shaka.util.StreamUtils.filterVariantsByAudioChannelCount=function(t,i){for(var r=t.filter(function(_){return _.audio&&_.audio.channelsCount}),o=new Map,l=(r=$jscomp.makeIterator(r)).next();!l.done;l=r.next()){var g=(l=l.value).audio.channelsCount;goog.asserts.assert(null!=g,"Must have count after filtering!"),o.has(g)||o.set(g,[]),o.get(g).push(l)}return 0==(r=Array.from(o.keys())).length?t:(l=r.filter(function(_){return _<=i}),o.get(l.length?Math.max.apply(Math,$jscomp.arrayFromIterable(l)):Math.min.apply(Math,$jscomp.arrayFromIterable(r))))},shaka.util.StreamUtils.filterStreamsByLanguageAndRole=function(t,i,r,o){var l=shaka.util.LanguageUtils,g=t,_=t.filter(function(P){return P.primary});_.length&&(g=_);var v=g.length?g[0].language:"";if(g=g.filter(function(P){return P.language==v}),i){var E=l.findClosestLocale(l.normalize(i),t.map(function(P){return P.language}));E&&(g=t.filter(function(P){return l.normalize(P.language)==E}))}if(g=g.filter(function(P){return P.forced==o}),r){if((t=shaka.util.StreamUtils.filterTextStreamsByRole_(g,r)).length)return t;shaka.log.warning("No exact match for the text role could be found.")}else if((t=g.filter(function(P){return 0==P.roles.length})).length)return t;return(t=g.map(function(P){return P.roles}).reduce(shaka.util.Functional.collapseArrays,[])).length?shaka.util.StreamUtils.filterTextStreamsByRole_(g,t[0]):g},shaka.util.StreamUtils.filterTextStreamsByRole_=function(t,i){return t.filter(function(r){return r.roles.includes(i)})},shaka.util.StreamUtils.isAudio=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.util.StreamUtils.isVideo=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.util.StreamUtils.getVariantStreams=function(t){var i=[];return t.audio&&i.push(t.audio),t.video&&i.push(t.video),i},shaka.util.StreamUtils.getVariantSummaryString_=function(t){var i=[];return t.audio&&i.push(shaka.util.StreamUtils.getStreamSummaryString_(t.audio)),t.video&&i.push(shaka.util.StreamUtils.getStreamSummaryString_(t.video)),i.join(", ")},shaka.util.StreamUtils.getStreamSummaryString_=function(t){return shaka.util.StreamUtils.isAudio(t)?"type=audio codecs="+t.codecs+" bandwidth="+t.bandwidth+" channelsCount="+t.channelsCount+" audioSamplingRate="+t.audioSamplingRate:shaka.util.StreamUtils.isVideo(t)?"type=video codecs="+t.codecs+" bandwidth="+t.bandwidth+" frameRate="+t.frameRate+" width="+t.width+" height="+t.height:"unexpected stream type"},shaka.util.StreamUtils.nextTrackId_=0,shaka.util.StreamUtils.DecodingAttributes={SMOOTH:"smooth",POWER:"powerEfficient",BANDWIDTH:"bandwidth"},shaka.abr.SimpleAbrManager=function(){var t=this;this.switch_=null,this.enabled_=!1,this.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator,navigator.connection&&navigator.connection.addEventListener("change",function(){if(t.config_.useNetworkInformation&&t.enabled_){t.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator;var i=t.chooseVariant();i&&t.switch_(i)}}),this.variants_=[],this.playbackRate_=1,this.startupComplete_=!1,this.config_=this.lastTimeChosenMs_=null},shaka.abr.SimpleAbrManager.prototype.stop=function(){this.switch_=null,this.enabled_=!1,this.variants_=[],this.playbackRate_=1,this.lastTimeChosenMs_=null},shaka.abr.SimpleAbrManager.prototype.init=function(t){this.switch_=t},shaka.abr.SimpleAbrManager.prototype.chooseVariant=function(){var t=shaka.abr.SimpleAbrManager,i=t.filterAndSortVariants_(this.config_.restrictions,this.variants_),r=this.getDefaultBandwidth_();r=this.bandwidthEstimator_.getBandwidthEstimate(r),this.variants_.length&&!i.length&&(shaka.log.warning("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),i=[(i=t.filterAndSortVariants_(null,this.variants_))[0]]),t=i[0]||null;for(var o=(i=$jscomp.makeIterator(shaka.util.Iterables.enumerate(i))).next();!o.done;o=i.next()){var l=o.value;o=l.item;var g=l.next,_=isNaN(this.playbackRate_)?1:Math.abs(this.playbackRate_),v=(l=_*o.bandwidth)/this.config_.bandwidthDowngradeTarget;g=_*(g||{bandwidth:1/0}).bandwidth/this.config_.bandwidthUpgradeTarget,shaka.log.v2("Bandwidth ranges:",(l/1e6).toFixed(3),(v/1e6).toFixed(3),(g/1e6).toFixed(3)),r>=v&&r<=g&&(t=o)}return this.lastTimeChosenMs_=Date.now(),t},shaka.abr.SimpleAbrManager.prototype.enable=function(){this.enabled_=!0},shaka.abr.SimpleAbrManager.prototype.disable=function(){this.enabled_=!1},shaka.abr.SimpleAbrManager.prototype.segmentDownloaded=function(t,i){shaka.log.v2("Segment downloaded:","deltaTimeMs="+t,"numBytes="+i,"lastTimeChosenMs="+this.lastTimeChosenMs_,"enabled="+this.enabled_),goog.asserts.assert(0<=t,"expected a non-negative duration"),this.bandwidthEstimator_.sample(t,i),null!=this.lastTimeChosenMs_&&this.enabled_&&this.suggestStreams_()},shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate=function(){return this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate)},shaka.abr.SimpleAbrManager.prototype.setVariants=function(t){this.variants_=t},shaka.abr.SimpleAbrManager.prototype.playbackRateChanged=function(t){this.playbackRate_=t},shaka.abr.SimpleAbrManager.prototype.configure=function(t){this.config_=t},shaka.abr.SimpleAbrManager.prototype.suggestStreams_=function(){if(shaka.log.v2("Suggesting Streams..."),goog.asserts.assert(null!=this.lastTimeChosenMs_,"lastTimeChosenMs_ should not be null"),this.startupComplete_){if(Date.now()-this.lastTimeChosenMs_<1e3*this.config_.switchInterval)return void shaka.log.v2("Still within switch interval...")}else{if(!this.bandwidthEstimator_.hasGoodEstimate())return void shaka.log.v2("Still waiting for a good estimate...");this.startupComplete_=!0}var t=this.chooseVariant(),i=this.getDefaultBandwidth_();i=this.bandwidthEstimator_.getBandwidthEstimate(i),i=Math.round(i/1e3),t&&(shaka.log.debug("Calling switch_(), bandwidth="+i+" kbps"),this.switch_(t))},shaka.abr.SimpleAbrManager.prototype.getDefaultBandwidth_=function(){var t=this.config_.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&this.config_.useNetworkInformation&&(t=1e6*navigator.connection.downlink),t},shaka.abr.SimpleAbrManager.filterAndSortVariants_=function(t,i){return t&&(i=i.filter(function(r){return goog.asserts.assert(t,"Restrictions should exist!"),shaka.util.StreamUtils.meetsRestrictions(r,t,{width:1/0,height:1/0})})),i.sort(function(r,o){return r.bandwidth-o.bandwidth})},goog.exportSymbol("shaka.abr.SimpleAbrManager",shaka.abr.SimpleAbrManager),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"configure",shaka.abr.SimpleAbrManager.prototype.configure),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"playbackRateChanged",shaka.abr.SimpleAbrManager.prototype.playbackRateChanged),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"setVariants",shaka.abr.SimpleAbrManager.prototype.setVariants),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"getBandwidthEstimate",shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"segmentDownloaded",shaka.abr.SimpleAbrManager.prototype.segmentDownloaded),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"disable",shaka.abr.SimpleAbrManager.prototype.disable),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"enable",shaka.abr.SimpleAbrManager.prototype.enable),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"chooseVariant",shaka.abr.SimpleAbrManager.prototype.chooseVariant),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"init",shaka.abr.SimpleAbrManager.prototype.init),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"stop",shaka.abr.SimpleAbrManager.prototype.stop),shaka.media.AdaptationSet=function(t,i){this.root_=t,this.variants_=new Set([t]);for(var r=$jscomp.makeIterator(i=i||[]),o=r.next();!o.done;o=r.next())this.add(o.value)},shaka.media.AdaptationSet.prototype.add=function(t){return this.canInclude(t)?(this.variants_.add(t),!0):(shaka.log.warning("Rejecting variant - not compatible with root."),!1)},shaka.media.AdaptationSet.prototype.canInclude=function(t){return shaka.media.AdaptationSet.areAdaptable(this.root_,t)},shaka.media.AdaptationSet.areAdaptable=function(t,i){var r=shaka.media.AdaptationSet;return!(!!t.audio!=!!i.audio||!!t.video!=!!i.video||t.language!=i.language||(goog.asserts.assert(!!t.audio==!!i.audio,"Both should either have audio or not have audio."),t.audio&&i.audio&&!r.areAudiosCompatible_(t.audio,i.audio))||(goog.asserts.assert(!!t.video==!!i.video,"Both should either have video or not have video."),t.video&&i.video&&!r.areVideosCompatible_(t.video,i.video)))},shaka.media.AdaptationSet.prototype.values=function(){return this.variants_.values()},shaka.media.AdaptationSet.areAudiosCompatible_=function(t,i){var r=shaka.media.AdaptationSet;return!((!t.channelsCount||!i.channelsCount||2<t.channelsCount||2<i.channelsCount)&&t.channelsCount!=i.channelsCount||!r.canTransitionBetween_(t,i)||!r.areRolesEqual_(t.roles,i.roles))},shaka.media.AdaptationSet.areVideosCompatible_=function(t,i){var r=shaka.media.AdaptationSet;return!(!r.canTransitionBetween_(t,i)||!r.areRolesEqual_(t.roles,i.roles))},shaka.media.AdaptationSet.canTransitionBetween_=function(t,i){if(t.mimeType!=i.mimeType)return!1;var r=shaka.util.MimeUtils.splitCodecs(t.codecs).map(function(_){return shaka.util.MimeUtils.getCodecBase(_)}),o=shaka.util.MimeUtils.splitCodecs(i.codecs).map(function(_){return shaka.util.MimeUtils.getCodecBase(_)});if(r.length!=o.length)return!1;r.sort(),o.sort();for(var l=$jscomp.makeIterator(shaka.util.Iterables.range(r.length)),g=l.next();!g.done;g=l.next())if(r[g=g.value]!=o[g])return!1;return!0},shaka.media.AdaptationSet.areRolesEqual_=function(t,i){var r=new Set(t),o=new Set(i);if(r.delete("main"),o.delete("main"),r.size!=o.size)return!1;for(var l=(r=$jscomp.makeIterator(r)).next();!l.done;l=r.next())if(!o.has(l.value))return!1;return!0},shaka.media.AdaptationSetCriteria=function(){},shaka.media.AdaptationSetCriteria.prototype.create=function(t){},shaka.media.ExampleBasedCriteria=function(t){this.example_=t,this.fallback_=new shaka.media.PreferenceBasedCriteria(t.language,"",t.audio&&t.audio.channelsCount?t.audio.channelsCount:0,"")},shaka.media.ExampleBasedCriteria.prototype.create=function(t){var i=this,r=t.filter(function(o){return shaka.media.AdaptationSet.areAdaptable(i.example_,o)});return r.length?new shaka.media.AdaptationSet(r[0],r):this.fallback_.create(t)},shaka.media.PreferenceBasedCriteria=function(t,i,r,o){this.language_=t,this.role_=i,this.channelCount_=r,this.label_=void 0===o?"":o},shaka.media.PreferenceBasedCriteria.prototype.create=function(t){var i=shaka.media.PreferenceBasedCriteria,r=shaka.util.StreamUtils,o=[];o=i.filterByLanguage_(t,this.language_);var l=t.filter(function(g){return g.primary});for((t=i.filterVariantsByRole_(o=o.length?o:l.length?l:t,this.role_)).length?o=t:shaka.log.warning("No exact match for variant role could be found."),this.channelCount_&&((r=r.filterVariantsByAudioChannelCount(o,this.channelCount_)).length?o=r:shaka.log.warning("No exact match for the channel count could be found.")),this.label_&&((i=i.filterVariantsByLabel_(o,this.label_)).length?o=i:shaka.log.warning("No exact match for variant label could be found.")),i=new shaka.media.AdaptationSet(o[0]),r=(o=$jscomp.makeIterator(o)).next();!r.done;r=o.next())i.canInclude(r=r.value)&&i.add(r);return i},shaka.media.PreferenceBasedCriteria.filterByLanguage_=function(t,i){var r=shaka.util.LanguageUtils,o=r.normalize(i),l=r.findClosestLocale(o,t.map(function(g){return r.getLocaleForVariant(g)}));return l?t.filter(function(g){return l==r.getLocaleForVariant(g)}):[]},shaka.media.PreferenceBasedCriteria.filterVariantsByRole_=function(t,i){return t.filter(function(r){return!!r.audio&&(i?r.audio.roles.includes(i):0==r.audio.roles.length)})},shaka.media.PreferenceBasedCriteria.filterVariantsByLabel_=function(t,i){return t.filter(function(r){return!!r.audio&&(r=r.audio.label.toLowerCase())==i.toLowerCase()})},shaka.media.BufferingObserver=function(t,i){var r=shaka.media.BufferingObserver.State;this.previousState_=r.SATISFIED,this.thresholds_=(new Map).set(r.SATISFIED,i).set(r.STARVING,t)},shaka.media.BufferingObserver.prototype.setThresholds=function(t,i){var r=shaka.media.BufferingObserver.State;this.thresholds_.set(r.SATISFIED,i).set(r.STARVING,t)},shaka.media.BufferingObserver.prototype.update=function(t,i){var r=shaka.media.BufferingObserver.State,o=this.thresholds_.get(this.previousState_),l=this.previousState_;return this.previousState_=r=i||t>=o?r.SATISFIED:r.STARVING,l!=r},shaka.media.BufferingObserver.prototype.setState=function(t){this.previousState_=t},shaka.media.BufferingObserver.prototype.getState=function(){return this.previousState_},shaka.media.BufferingObserver.State={STARVING:0,SATISFIED:1},shaka.net={},shaka.net.Backoff=function(t,i){i=void 0!==i&&i;var r=shaka.net.Backoff.defaultRetryParameters();this.maxAttempts_=null==t.maxAttempts?r.maxAttempts:t.maxAttempts,goog.asserts.assert(1<=this.maxAttempts_,"maxAttempts should be >= 1"),this.baseDelay_=null==t.baseDelay?r.baseDelay:t.baseDelay,goog.asserts.assert(0<=this.baseDelay_,"baseDelay should be >= 0"),this.fuzzFactor_=null==t.fuzzFactor?r.fuzzFactor:t.fuzzFactor,goog.asserts.assert(0<=this.fuzzFactor_,"fuzzFactor should be >= 0"),this.backoffFactor_=null==t.backoffFactor?r.backoffFactor:t.backoffFactor,goog.asserts.assert(0<=this.backoffFactor_,"backoffFactor should be >= 0"),this.numAttempts_=0,this.nextUnfuzzedDelay_=this.baseDelay_,(this.autoReset_=i)&&(goog.asserts.assert(2<=this.maxAttempts_,"maxAttempts must be >= 2 for autoReset == true"),this.numAttempts_=1)},shaka.net.Backoff.prototype.attempt=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){if(1==o.nextAddress){if(t.numAttempts_>=t.maxAttempts_){if(!t.autoReset_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.ATTEMPTS_EXHAUSTED);t.reset_()}return i=t.numAttempts_,t.numAttempts_++,0==i?(goog.asserts.assert(!t.autoReset_,"Failed to delay with auto-reset!"),o.return()):(r=shaka.net.Backoff.fuzz_(t.nextUnfuzzedDelay_,t.fuzzFactor_),o.yield(new Promise(function(l){shaka.net.Backoff.defer(r,l)}),2))}t.nextUnfuzzedDelay_*=t.backoffFactor_,o.jumpToEnd()})},shaka.net.Backoff.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}},shaka.net.Backoff.fuzz_=function(t,i){return t*(1+(2*Math.random()-1)*i)},shaka.net.Backoff.prototype.reset_=function(){goog.asserts.assert(this.autoReset_,"Should only be used for auto-reset!"),this.numAttempts_=1,this.nextUnfuzzedDelay_=this.baseDelay_},shaka.net.Backoff.defer=function(t,i){new shaka.util.Timer(i).tickAfter(t/1e3)},shaka.util.AbortableOperation=function(t,i){this.promise=t,this.onAbort_=i,this.aborted_=!1},shaka.util.AbortableOperation.failed=function(t){return new shaka.util.AbortableOperation(Promise.reject(t),function(){return Promise.resolve()})},shaka.util.AbortableOperation.aborted=function(){var t=Promise.reject(shaka.util.AbortableOperation.abortError());return t.catch(function(){}),new shaka.util.AbortableOperation(t,function(){return Promise.resolve()})},shaka.util.AbortableOperation.abortError=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.util.AbortableOperation.completed=function(t){return new shaka.util.AbortableOperation(Promise.resolve(t),function(){return Promise.resolve()})},shaka.util.AbortableOperation.notAbortable=function(t){return new shaka.util.AbortableOperation(t,function(){return t.catch(function(){})})},shaka.util.AbortableOperation.prototype.abort=function(){return this.aborted_=!0,this.onAbort_()},shaka.util.AbortableOperation.all=function(t){return new shaka.util.AbortableOperation(Promise.all(t.map(function(i){return i.promise})),function(){return Promise.all(t.map(function(i){return i.abort()}))})},shaka.util.AbortableOperation.prototype.finally=function(t){return this.promise.then(function(i){return t(!0)},function(i){return t(!1)}),this},shaka.util.AbortableOperation.prototype.chain=function(t,i){var r=this,o=new shaka.util.PublicPromise,l=shaka.util.AbortableOperation.abortError(),g=function(){return o.reject(l),r.abort()},_=function(v){return function(E){if(r.aborted_&&v)o.reject(l);else{var P=v?t:i;P?g=shaka.util.AbortableOperation.wrapChainCallback_(P,E,o):(v?o.resolve:o.reject)(E)}}};return this.promise.then(_(!0),_(!1)),new shaka.util.AbortableOperation(o,function(){return g()})},shaka.util.AbortableOperation.wrapChainCallback_=function(t,i,r){try{var o=t(i);return o&&o.promise&&o.abort?(r.resolve(o.promise),function(){return o.abort()}):(r.resolve(o),function(){return Promise.resolve(o).then(function(){},function(){})})}catch(l){return r.reject(l),function(){return Promise.resolve()}}},goog.exportSymbol("shaka.util.AbortableOperation",shaka.util.AbortableOperation),goog.exportProperty(shaka.util.AbortableOperation.prototype,"chain",shaka.util.AbortableOperation.prototype.chain),goog.exportProperty(shaka.util.AbortableOperation.prototype,"finally",shaka.util.AbortableOperation.prototype.finally),goog.exportProperty(shaka.util.AbortableOperation,"all",shaka.util.AbortableOperation.all),goog.exportProperty(shaka.util.AbortableOperation.prototype,"abort",shaka.util.AbortableOperation.prototype.abort),goog.exportProperty(shaka.util.AbortableOperation,"notAbortable",shaka.util.AbortableOperation.notAbortable),goog.exportProperty(shaka.util.AbortableOperation,"completed",shaka.util.AbortableOperation.completed),goog.exportProperty(shaka.util.AbortableOperation,"aborted",shaka.util.AbortableOperation.aborted),goog.exportProperty(shaka.util.AbortableOperation,"failed",shaka.util.AbortableOperation.failed),shaka.util.ObjectUtils=function(){},shaka.util.ObjectUtils.cloneObject=function(t){var i=new Set,r=function(o){switch(typeof o){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return o;default:if(!o||o.buffer&&o.buffer.constructor==ArrayBuffer)return o;if(i.has(o))return null;var l=o.constructor==Array;if(o.constructor!=Object&&!l)return null;i.add(o);var _,g=l?[]:{};for(_ in o)g[_]=r(o[_]);return l&&(g.length=o.length),g}};return r(t)},shaka.util.ObjectUtils.shallowCloneObject=function(t){var r,i={};for(r in t)i[r]=t[r];return i},shaka.util.OperationManager=function(){this.operations_=[]},shaka.util.OperationManager.prototype.manage=function(t){var i=this;this.operations_.push(t.finally(function(){shaka.util.ArrayUtils.remove(i.operations_,t)}))},shaka.util.OperationManager.prototype.destroy=function(){for(var t=[],i=$jscomp.makeIterator(this.operations_),r=i.next();!r.done;r=i.next())(r=r.value).promise.catch(function(){}),t.push(r.abort());return this.operations_=[],Promise.all(t)},shaka.net.NetworkingEngine=function(t){shaka.util.FakeEventTarget.call(this),this.destroyed_=!1,this.operationManager_=new shaka.util.OperationManager,this.requestFilters_=new Set,this.responseFilters_=new Set,this.onProgressUpdated_=t||null,this.forceHTTPS_=!1},$jscomp.inherits(shaka.net.NetworkingEngine,shaka.util.FakeEventTarget),shaka.net.NetworkingEngine.prototype.setForceHTTPS=function(t){this.forceHTTPS_=t},shaka.net.NetworkingEngine.registerScheme=function(t,i,r,o){o=void 0!==o&&o,goog.asserts.assert(null==r||0<r,"explicit priority must be > 0"),r=r||shaka.net.NetworkingEngine.PluginPriority.APPLICATION;var l=shaka.net.NetworkingEngine.schemes_[t];(!l||r>=l.priority)&&(shaka.net.NetworkingEngine.schemes_[t]={priority:r,plugin:i,progressSupport:o})},shaka.net.NetworkingEngine.unregisterScheme=function(t){delete shaka.net.NetworkingEngine.schemes_[t]},shaka.net.NetworkingEngine.prototype.registerRequestFilter=function(t){this.requestFilters_.add(t)},shaka.net.NetworkingEngine.prototype.unregisterRequestFilter=function(t){this.requestFilters_.delete(t)},shaka.net.NetworkingEngine.prototype.clearAllRequestFilters=function(){this.requestFilters_.clear()},shaka.net.NetworkingEngine.prototype.registerResponseFilter=function(t){this.responseFilters_.add(t)},shaka.net.NetworkingEngine.prototype.unregisterResponseFilter=function(t){this.responseFilters_.delete(t)},shaka.net.NetworkingEngine.prototype.clearAllResponseFilters=function(){this.responseFilters_.clear()},shaka.net.NetworkingEngine.defaultRetryParameters=function(){return shaka.net.Backoff.defaultRetryParameters()},shaka.net.NetworkingEngine.makeRequest=function(t,i,r){return{uris:t,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:i,licenseRequestType:null,sessionId:null,streamDataCallback:void 0===r?null:r}},shaka.net.NetworkingEngine.prototype.destroy=function(){return this.destroyed_=!0,this.requestFilters_.clear(),this.responseFilters_.clear(),this.operationManager_.destroy()},shaka.net.NetworkingEngine.prototype.request=function(t,i){var r=this,o=shaka.util.ObjectUtils,l=new shaka.net.NetworkingEngine.NumBytesRemainingClass;if(this.destroyed_)return(o=Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED))).catch(function(){}),new shaka.net.NetworkingEngine.PendingRequest(o,function(){return Promise.resolve()},l);goog.asserts.assert(i.uris&&i.uris.length,"Request without URIs!"),i.method=i.method||"GET",i.headers=i.headers||{},i.retryParameters=i.retryParameters?o.cloneObject(i.retryParameters):shaka.net.NetworkingEngine.defaultRetryParameters(),i.uris=o.cloneObject(i.uris);var g=(o=this.filterRequest_(t,i)).chain(function(){return r.makeRequestWithRetry_(t,i,l)}),_=g.chain(function(R){return r.filterResponse_(t,R)}),v=Date.now(),E=0;o.promise.then(function(){E=Date.now()-v},function(){});var P=0;g.promise.then(function(){P=Date.now()},function(){});var M=_.chain(function(R){var U=Date.now()-P,$=R.response;return $.timeMs+=E,$.timeMs+=U,!R.gotProgress&&r.onProgressUpdated_&&!$.fromCache&&t==shaka.net.NetworkingEngine.RequestType.SEGMENT&&r.onProgressUpdated_($.timeMs,$.data.byteLength),$},function(R){throw R&&(goog.asserts.assert(R instanceof shaka.util.Error,"Wrong error type"),R.severity=shaka.util.Error.Severity.CRITICAL),R});return o=new shaka.net.NetworkingEngine.PendingRequest(M.promise,function(){return M.abort()},l),this.operationManager_.manage(o),o},shaka.net.NetworkingEngine.prototype.filterRequest_=function(t,i){for(var r=shaka.util.AbortableOperation.completed(void 0),o={},l=$jscomp.makeIterator(this.requestFilters_),g=l.next();!g.done;o={$jscomp$loop$prop$requestFilter$626:o.$jscomp$loop$prop$requestFilter$626},g=l.next())o.$jscomp$loop$prop$requestFilter$626=g.value,r=r.chain(function(_){return function(){return i.body&&(i.body=shaka.util.BufferUtils.toArrayBuffer(i.body)),_.$jscomp$loop$prop$requestFilter$626(t,i)}}(o));return r.chain(void 0,function(_){throw _ instanceof shaka.util.Error&&_.code==shaka.util.Error.Code.OPERATION_ABORTED?_:new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.REQUEST_FILTER_ERROR,_)})},shaka.net.NetworkingEngine.prototype.makeRequestWithRetry_=function(t,i,r){var o=new shaka.net.Backoff(i.retryParameters,!1);return this.send_(t,i,o,0,null,r)},shaka.net.NetworkingEngine.prototype.send_=function(t,i,r,o,l,g){var _=this;this.forceHTTPS_&&(i.uris[o]=i.uris[o].replace("http://","https://"));var v=new goog.Uri(i.uris[o]),E=v.getScheme(),P=!1;E||(E=shaka.net.NetworkingEngine.getLocationProtocol_(),goog.asserts.assert(":"==E[E.length-1],"location.protocol expected to end with a colon!"),E=E.slice(0,-1),v.setScheme(E),i.uris[o]=v.toString()),E=E.toLowerCase();var M=(E=shaka.net.NetworkingEngine.schemes_[E])?E.plugin:null;if(!M)return shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.UNSUPPORTED_SCHEME,v));var z,R=E.progressSupport,U=null,$=null,G=!1;return shaka.util.AbortableOperation.notAbortable(r.attempt()).chain(function(){if(_.destroyed_)return shaka.util.AbortableOperation.aborted();z=Date.now();var Z=shaka.net.NetworkingEngine.RequestType.SEGMENT,Y=M(i.uris[o],i,t,function(te,ce,me){U&&U.stop(),$&&$.tickAfter(Q/1e3),_.onProgressUpdated_&&t==Z&&(_.onProgressUpdated_(te,ce),P=!0,g.setBytes(me))});if(!R)return Y;var se=i.retryParameters.connectionTimeout;se&&(U=new shaka.util.Timer(function(){G=!0,Y.abort()})).tickAfter(se/1e3);var Q=i.retryParameters.stallTimeout;return Q&&($=new shaka.util.Timer(function(){G=!0,Y.abort()})),Y}).chain(function(Z){return U&&U.stop(),$&&$.stop(),null==Z.timeMs&&(Z.timeMs=Date.now()-z),{response:Z,gotProgress:P}},function(Z){if(U&&U.stop(),$&&$.stop(),_.destroyed_)return shaka.util.AbortableOperation.aborted();if(G&&(Z=new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,i.uris[o],t)),Z instanceof shaka.util.Error){if(Z.code==shaka.util.Error.Code.OPERATION_ABORTED)throw Z;if(Z.code==shaka.util.Error.Code.ATTEMPTS_EXHAUSTED)throw goog.asserts.assert(l,"Should have last error"),l;if(Z.severity==shaka.util.Error.Severity.RECOVERABLE){var Y=new shaka.util.FakeEvent("retry",{error:Z});return _.dispatchEvent(Y),_.send_(t,i,r,o=(o+1)%i.uris.length,Z,g)}}throw Z})},shaka.net.NetworkingEngine.prototype.filterResponse_=function(t,i){for(var r=shaka.util.AbortableOperation.completed(void 0),o={},l=$jscomp.makeIterator(this.responseFilters_),g=l.next();!g.done;o={$jscomp$loop$prop$responseFilter$628:o.$jscomp$loop$prop$responseFilter$628},g=l.next())o.$jscomp$loop$prop$responseFilter$628=g.value,r=r.chain(function(_){return function(){var v=i.response;return v.data&&(v.data=shaka.util.BufferUtils.toArrayBuffer(v.data)),_.$jscomp$loop$prop$responseFilter$628(t,v)}}(o));return r.chain(function(){return i},function(_){var v=shaka.util.Error.Severity.CRITICAL;if(_ instanceof shaka.util.Error){if(_.code==shaka.util.Error.Code.OPERATION_ABORTED)throw _;v=_.severity}throw new shaka.util.Error(v,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.RESPONSE_FILTER_ERROR,_)})},shaka.net.NetworkingEngine.getLocationProtocol_=function(){return location.protocol},goog.exportSymbol("shaka.net.NetworkingEngine",shaka.net.NetworkingEngine),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"request",shaka.net.NetworkingEngine.prototype.request),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"destroy",shaka.net.NetworkingEngine.prototype.destroy),goog.exportProperty(shaka.net.NetworkingEngine,"makeRequest",shaka.net.NetworkingEngine.makeRequest),goog.exportProperty(shaka.net.NetworkingEngine,"defaultRetryParameters",shaka.net.NetworkingEngine.defaultRetryParameters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllResponseFilters",shaka.net.NetworkingEngine.prototype.clearAllResponseFilters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterResponseFilter",shaka.net.NetworkingEngine.prototype.unregisterResponseFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerResponseFilter",shaka.net.NetworkingEngine.prototype.registerResponseFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllRequestFilters",shaka.net.NetworkingEngine.prototype.clearAllRequestFilters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterRequestFilter",shaka.net.NetworkingEngine.prototype.unregisterRequestFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerRequestFilter",shaka.net.NetworkingEngine.prototype.registerRequestFilter),goog.exportProperty(shaka.net.NetworkingEngine,"unregisterScheme",shaka.net.NetworkingEngine.unregisterScheme),goog.exportProperty(shaka.net.NetworkingEngine,"registerScheme",shaka.net.NetworkingEngine.registerScheme),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"setForceHTTPS",shaka.net.NetworkingEngine.prototype.setForceHTTPS),shaka.net.NetworkingEngine.NumBytesRemainingClass=function(){this.bytesToLoad_=0},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.setBytes=function(t){this.bytesToLoad_=t},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.getBytes=function(){return this.bytesToLoad_},goog.exportProperty(shaka.net.NetworkingEngine,"NumBytesRemainingClass",shaka.net.NetworkingEngine.NumBytesRemainingClass),shaka.net.NetworkingEngine.PendingRequest=function(t,i,r){shaka.util.AbortableOperation.call(this,t,i),this.bytesRemaining_=r},$jscomp.inherits(shaka.net.NetworkingEngine.PendingRequest,shaka.util.AbortableOperation),shaka.net.NetworkingEngine.PendingRequest.prototype.getBytesRemaining=function(){return this.bytesRemaining_.getBytes()},goog.exportProperty(shaka.net.NetworkingEngine,"PendingRequest",shaka.net.NetworkingEngine.PendingRequest),shaka.net.NetworkingEngine.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5},goog.exportProperty(shaka.net.NetworkingEngine,"RequestType",shaka.net.NetworkingEngine.RequestType),shaka.net.NetworkingEngine.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3},goog.exportProperty(shaka.net.NetworkingEngine,"PluginPriority",shaka.net.NetworkingEngine.PluginPriority),shaka.net.NetworkingEngine.schemes_={},shaka.util.FairPlayUtils=function(){},shaka.util.FairPlayUtils.defaultGetContentId=function(t){return t=shaka.util.StringUtils.fromBytesAutoDetect(t),new goog.Uri(t).getDomain()},shaka.util.FairPlayUtils.initDataTransform=function(t,i,r){if(!r||!r.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.SERVER_CERTIFICATE_REQUIRED);i="string"==typeof i?shaka.util.StringUtils.toUTF16(i,!0):i,t=shaka.util.StringUtils.fromBytesAutoDetect(t),t=shaka.util.StringUtils.toUTF16(t,!0);var o=new Uint8Array(12+t.byteLength+i.byteLength+r.byteLength),l=0,g=function(_){shaka.util.BufferUtils.toDataView(o).setUint32(l,_.byteLength,!0),l+=4,o.set(shaka.util.BufferUtils.toUint8(_),l),l+=_.byteLength};return g(t),g(i),g(r),goog.asserts.assert(l==o.length,"Inconsistent init data length"),o},goog.exportSymbol("shaka.util.FairPlayUtils",shaka.util.FairPlayUtils),goog.exportProperty(shaka.util.FairPlayUtils,"initDataTransform",shaka.util.FairPlayUtils.initDataTransform),goog.exportProperty(shaka.util.FairPlayUtils,"defaultGetContentId",shaka.util.FairPlayUtils.defaultGetContentId),shaka.util.MapUtils=function(){},shaka.util.MapUtils.asMap=function(t){for(var i=new Map,r=$jscomp.makeIterator(Object.keys(t)),o=r.next();!o.done;o=r.next())i.set(o=o.value,t[o]);return i},shaka.util.MapUtils.asObject=function(t){var i={};return t.forEach(function(r,o){i[o]=r}),i},shaka.util.MapUtils.hasSameElements=function(t,i){if(!t&&!i)return!0;if(t&&!i||i&&!t)return!1;if(t.size!=i.size)return!1;for(var r=$jscomp.makeIterator(t),o=r.next();!o.done;o=r.next()){var l=$jscomp.makeIterator(o.value);if(o=l.next().value,l=l.next().value,!i.has(o)||(o=i.get(o))!=l||null==o)return!1}return!0},shaka.media.DrmEngine=function(t,i){var r=this;i=void 0===i?1:i,this.playerInterface_=t,this.supportedTypes_=new Set,this.video_=this.mediaKeys_=null,this.initializedForStorage_=this.initialized_=!1,this.licenseTimeSeconds_=0,this.currentDrmInfo_=null,this.eventManager_=new shaka.util.EventManager,this.activeSessions_=new Map,this.offlineSessionIds_=[],this.allSessionsLoaded_=new shaka.util.PublicPromise,this.config_=null,this.onError_=function(o){r.allSessionsLoaded_.reject(o),t.onError(o)},this.keyStatusByKeyId_=new Map,this.announcedKeyStatusByKeyId_=new Map,this.keyStatusTimer_=new shaka.util.Timer(function(){return r.processKeyStatusChanges_()}),this.usePersistentLicenses_=!1,this.mediaKeyMessageEvents_=[],this.initialRequestsSent_=!1,this.expirationTimer_=new shaka.util.Timer(function(){r.pollExpiration_()}).tickEvery(i),this.allSessionsLoaded_.catch(function(){}),this.destroyer_=new shaka.util.Destroyer(function(){return r.destroyNow_()})},shaka.media.DrmEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.DrmEngine.prototype.destroyNow_=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){switch(i.nextAddress){case 1:return t.eventManager_.release(),t.eventManager_=null,t.allSessionsLoaded_.reject(),t.expirationTimer_.stop(),t.expirationTimer_=null,t.keyStatusTimer_.stop(),t.keyStatusTimer_=null,i.yield(t.closeOpenSessions_(),2);case 2:if(!t.video_){i.jumpTo(3);break}return goog.asserts.assert(!t.video_.src,"video src must be removed first!"),i.setCatchFinallyBlocks(4),i.yield(t.video_.setMediaKeys(null),6);case 6:i.leaveTryBlock(5);break;case 4:i.enterCatchBlock();case 5:t.video_=null;case 3:t.currentDrmInfo_=null,t.supportedTypes_.clear(),t.mediaKeys_=null,t.offlineSessionIds_=[],t.config_=null,t.onError_=function(){},t.playerInterface_=null,i.jumpToEnd()}})},shaka.media.DrmEngine.prototype.configure=function(t){this.config_=t},shaka.media.DrmEngine.prototype.initForStorage=function(t,i,r){return this.initializedForStorage_=!0,this.offlineSessionIds_=[],this.usePersistentLicenses_=i,this.init_(t,!!r)},shaka.media.DrmEngine.prototype.initForPlayback=function(t,i,r){return this.offlineSessionIds_=i,this.usePersistentLicenses_=0<i.length,this.init_(t,!!r)},shaka.media.DrmEngine.prototype.initForRemoval=function(t,i,r,o,l){var g=new Map;return(o={audioCapabilities:o,videoCapabilities:l,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t}).drmInfos=[{keySystem:t,licenseServerUri:i,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:r,serverCertificateUri:"",initData:null,keyIds:null}],g.set(t,o),this.queryMediaKeys_(g,[],!1)},shaka.media.DrmEngine.prototype.init_=function(t,i){var o,l,g,_,v,E,P,R,U,$,z,Y,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){if(1==se.nextAddress){if(goog.asserts.assert(r.config_,"DrmEngine configure() must be called before init()!"),o=r.configureClearKey_())for(l=$jscomp.makeIterator(t),g=l.next();!g.done;g=l.next())(_=g.value).video&&(_.video.drmInfos=[o]),_.audio&&(_.audio.drmInfos=[o]);for((v=t.some(function(Q){return!!(Q.video&&Q.video.drmInfos.length||Q.audio&&Q.audio.drmInfos.length)}))||(E=shaka.util.MapUtils.asMap(r.config_.servers),shaka.media.DrmEngine.replaceDrmInfo_(t,E)),P=$jscomp.makeIterator(t),g=P.next();!g.done;g=P.next())for(R=r.getVariantDrmInfos_(g.value),U=$jscomp.makeIterator(R),$=U.next();!$.done;$=U.next())shaka.media.DrmEngine.fillInDrmInfoDefaults_($.value,shaka.util.MapUtils.asMap(r.config_.servers),shaka.util.MapUtils.asMap(r.config_.advanced||{}));return i?se.yield(shaka.util.StreamUtils.getDecodingInfosForVariants(t,r.usePersistentLicenses_),2):(z=r.prepareMediaKeyConfigsForVariants_(t),se.jumpTo(2))}return v||Object.keys(r.config_.servers).length?(Y=r.queryMediaKeys_(z,t,i),se.return(v?Y:Y.catch(function(){}))):(r.initialized_=!0,se.return(Promise.resolve()))})},shaka.media.DrmEngine.prototype.attach=function(t){var r,o,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return i.mediaKeys_?(i.video_=t,i.eventManager_.listenOnce(i.video_,"play",function(){return i.onPlay_()}),"webkitCurrentPlaybackTargetIsWireless"in i.video_&&i.eventManager_.listen(i.video_,"webkitcurrentplaybacktargetiswirelesschanged",function(){return i.closeOpenSessions_()}),r=(r=i.video_.setMediaKeys(i.mediaKeys_)).catch(function(g){return goog.asserts.assert(g instanceof Error,"Wrong error type!"),Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_ATTACH_TO_VIDEO,g.message))}),l.yield(r,2)):(i.eventManager_.listenOnce(t,"encrypted",function(g){i.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.ENCRYPTED_CONTENT_WITHOUT_DRM_INFO))}),l.return());i.destroyer_.ensureNotDestroyed(),i.createOrLoad(),i.currentDrmInfo_.initData.length||i.offlineSessionIds_.length||(o=function(g){return i.newInitData(g.initDataType,shaka.util.BufferUtils.toUint8(g.initData))},i.eventManager_.listen(i.video_,"encrypted",o)),l.jumpToEnd()})},shaka.media.DrmEngine.prototype.setServerCertificate=function(){var i,r,l,_,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){switch(v.nextAddress){case 1:if(goog.asserts.assert(t.initialized_,"Must call init() before setServerCertificate"),!t.mediaKeys_||!t.currentDrmInfo_)return v.return();if(!t.currentDrmInfo_.serverCertificateUri||t.currentDrmInfo_.serverCertificate&&t.currentDrmInfo_.serverCertificate.length){v.jumpTo(2);break}return i=shaka.net.NetworkingEngine.makeRequest([t.currentDrmInfo_.serverCertificateUri],t.config_.retryParameters),v.setCatchFinallyBlocks(3),r=t.playerInterface_.netEngine.request(shaka.net.NetworkingEngine.RequestType.SERVER_CERTIFICATE,i),v.yield(r.promise,5);case 5:t.currentDrmInfo_.serverCertificate=shaka.util.BufferUtils.toUint8(v.yieldResult.data),v.leaveTryBlock(4);break;case 3:throw l=v.enterCatchBlock(),goog.asserts.assert(l instanceof shaka.util.Error,"Wrong NetworkingEngine error type!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.SERVER_CERTIFICATE_REQUEST_FAILED,l);case 4:if(t.destroyer_.destroyed())return v.return();case 2:return t.currentDrmInfo_.serverCertificate&&t.currentDrmInfo_.serverCertificate.length?(v.setCatchFinallyBlocks(6),v.yield(t.mediaKeys_.setServerCertificate(t.currentDrmInfo_.serverCertificate),8)):v.return();case 8:v.yieldResult||shaka.log.warning("Server certificates are not supported by the key system.  The server certificate has been ignored."),v.leaveTryBlock(0);break;case 6:throw _=v.enterCatchBlock(),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INVALID_SERVER_CERTIFICATE,_.message)}})},shaka.media.DrmEngine.prototype.removeSession=function(t){var r,o,l,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){return 1==g.nextAddress?(goog.asserts.assert(i.mediaKeys_,"Must call init() before removeSession"),g.yield(i.loadOfflineSession_(t),2)):(r=g.yieldResult)?(o=[],(l=i.activeSessions_.get(r))&&(l.updatePromise=new shaka.util.PublicPromise,o.push(l.updatePromise)),shaka.log.v2("Attempting to remove session",t),o.push(r.remove()),g.yield(Promise.all(o),0)):(shaka.log.v2("Ignoring attempt to remove missing session",t),g.return())})},shaka.media.DrmEngine.prototype.createOrLoad=function(){for(var t=(this.currentDrmInfo_?this.currentDrmInfo_.initData:[])||[],i=$jscomp.makeIterator(t),r=i.next();!r.done;r=i.next())this.newInitData((r=r.value).initDataType,r.initData);for(r=(i=$jscomp.makeIterator(this.offlineSessionIds_)).next();!r.done;r=i.next())this.loadOfflineSession_(r.value);return t.length||this.offlineSessionIds_.length||this.allSessionsLoaded_.resolve(),this.allSessionsLoaded_},shaka.media.DrmEngine.prototype.newInitData=function(t,i){for(var r=this.activeSessions_.values(),o=(r=$jscomp.makeIterator(r)).next();!o.done;o=r.next())if(shaka.util.BufferUtils.equal(i,o.value.initData)&&!shaka.util.Platform.isTizen2())return void shaka.log.debug("Ignoring duplicate init data.");this.createTemporarySession_(t,i)},shaka.media.DrmEngine.prototype.initialized=function(){return this.initialized_},shaka.media.DrmEngine.keySystem=function(t){return t?t.keySystem:""},shaka.media.DrmEngine.isPlayReadyKeySystem=function(t){return!!t&&!!t.match(/^com\.(microsoft|chromecast)\.playready/)},shaka.media.DrmEngine.isFairPlayKeySystem=function(t){return!!t&&!!t.match(/^com\.apple\.fps/)},shaka.media.DrmEngine.prototype.willSupport=function(t){if(shaka.util.Platform.isLegacyEdge())return!0;if(t=t.toLowerCase(),shaka.util.Platform.isTizen()&&t.includes('codecs="ac-3"')){var i=t.replace("ac-3","ec-3");return this.supportedTypes_.has(t)||this.supportedTypes_.has(i)}return this.supportedTypes_.has(t)},shaka.media.DrmEngine.prototype.getSessionIds=function(){var t=this.activeSessions_.keys();return t=shaka.util.Iterables.map(t,function(i){return i.sessionId}),Array.from(t)},shaka.media.DrmEngine.prototype.getExpiration=function(){for(var t=1/0,i=this.activeSessions_.keys(),r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())r=r.value,isNaN(r.expiration)||(t=Math.min(t,r.expiration));return t},shaka.media.DrmEngine.prototype.getLicenseTime=function(){return this.licenseTimeSeconds_?this.licenseTimeSeconds_:NaN},shaka.media.DrmEngine.prototype.getDrmInfo=function(){return this.currentDrmInfo_},shaka.media.DrmEngine.prototype.getMediaKeys=function(){return this.mediaKeys_},shaka.media.DrmEngine.prototype.getKeyStatuses=function(){return shaka.util.MapUtils.asObject(this.announcedKeyStatusByKeyId_)},shaka.media.DrmEngine.prototype.prepareMediaKeyConfigsForVariants_=function(t){for(var i=shaka.util.ManifestParserUtils.ContentType,r=new Set,o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next()){l=this.getVariantDrmInfos_(l.value);var g=$jscomp.makeIterator(l);for(l=g.next();!l.done;l=g.next())r.add(l.value)}for(l=(o=$jscomp.makeIterator(r)).next();!l.done;l=o.next())shaka.media.DrmEngine.fillInDrmInfoDefaults_(l.value,shaka.util.MapUtils.asMap(this.config_.servers),shaka.util.MapUtils.asMap(this.config_.advanced||{}));g=this.usePersistentLicenses_?"required":"optional";var _=this.usePersistentLicenses_?["persistent-license"]:["temporary"];for(o=new Map,l=(r=$jscomp.makeIterator(r)).next();!l.done;l=r.next())o.set((l=l.value).keySystem,{initDataTypes:["cenc"],audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:g,sessionTypes:_,label:l.keySystem,drmInfos:[]});for(l=(t=$jscomp.makeIterator(t)).next();!l.done;l=t.next())for(l=(r=$jscomp.makeIterator([(l=l.value).audio,l.video])).next();!l.done;l=r.next())if(g=l.value){_=shaka.media.DrmEngine.computeMimeType_(g);var v=null;"ac-3"==g.codecs.toLowerCase()&&shaka.util.Platform.isTizen()&&(v=shaka.media.DrmEngine.computeMimeType_(g,"ec-3"));var E=$jscomp.makeIterator(g.drmInfos);for(l=E.next();!l.done;l=E.next()){var P=l.value;l=o.get(P.keySystem),goog.asserts.assert(l,"Any missing configs should have be filled in before."),l.drmInfos.push(P),P.initData&&P.initData.length&&(l.initDataTypes=[].concat($jscomp.arrayFromIterable(new Set(P.initData.map(function(R){return R.initDataType}))))),shaka.media.DrmEngine.isFairPlayKeySystem(P.keySystem)&&(l.distinctiveIdentifier="not-allowed",l.persistentState="not-allowed",l.sessionTypes=["temporary"]),P.distinctiveIdentifierRequired&&(l.distinctiveIdentifier="required"),P.persistentStateRequired&&(l.persistentState="required"),P.sessionType&&(l.sessionTypes=[P.sessionType]);var M={robustness:(P=g.type==i.AUDIO?P.audioRobustness:P.videoRobustness)||"",contentType:_};g.type==i.AUDIO?l.audioCapabilities.push(M):l.videoCapabilities.push(M),v&&(P={robustness:P||"",contentType:v},g.type==i.AUDIO?l.audioCapabilities.push(P):l.videoCapabilities.push(P))}}return o},shaka.media.DrmEngine.computeMimeType_=function(t,i){var r=shaka.util.MimeUtils.getFullType(t.mimeType,i||t.codecs);return shaka.media.Transmuxer.isSupported(r)?shaka.media.Transmuxer.convertTsCodecs(t.type,r):r},shaka.media.DrmEngine.prototype.queryMediaKeys_=function(t,i,r){var l,g,_,v,P,M,R,$,z,Z,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Y){switch(Y.nextAddress){case 1:if(l=new Map,r){g=o.getKeySystemAccessFromVariants_(i,l),Y.jumpTo(2);break}return Y.yield(o.getKeySystemAccessByConfigs_(t),3);case 3:g=Y.yieldResult;case 2:if(!(_=g))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE);for(o.destroyer_.ensureNotDestroyed(),Y.setCatchFinallyBlocks(4),o.supportedTypes_.clear(),v=_.getConfiguration(),shaka.log.v2("Got MediaKeySystemAccess with configuration",v),P=v.videoCapabilities||[],M=$jscomp.makeIterator(v.audioCapabilities||[]),R=M.next();!R.done;R=M.next())o.supportedTypes_.add(R.value.contentType.toLowerCase());for($=$jscomp.makeIterator(P),R=$.next();!R.done;R=$.next())o.supportedTypes_.add(R.value.contentType.toLowerCase());if(goog.asserts.assert(o.supportedTypes_.size,"We should get at least one supported MIME type"),o.currentDrmInfo_=r?o.createDrmInfoByInfos_(_.keySystem,l.get(_.keySystem)):shaka.media.DrmEngine.createDrmInfoByConfigs_(_.keySystem,t.get(_.keySystem)),!o.currentDrmInfo_.licenseServerUri)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_LICENSE_SERVER_GIVEN,o.currentDrmInfo_.keySystem);return Y.yield(_.createMediaKeys(),6);case 6:return z=Y.yieldResult,o.destroyer_.ensureNotDestroyed(),shaka.log.info("Created MediaKeys object for key system",o.currentDrmInfo_.keySystem),o.mediaKeys_=z,o.initialized_=!0,Y.yield(o.setServerCertificate(),7);case 7:o.destroyer_.ensureNotDestroyed(),Y.leaveTryBlock(0);break;case 4:throw Z=Y.enterCatchBlock(),o.destroyer_.ensureNotDestroyed(Z),o.currentDrmInfo_=null,o.supportedTypes_.clear(),Z instanceof shaka.util.Error?Z:new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_CDM,Z.message)}})},shaka.media.DrmEngine.prototype.getKeySystemAccessFromVariants_=function(t,i){for(var r=$jscomp.makeIterator(t),o=r.next();!o.done;o=r.next()){var l=this.getVariantDrmInfos_(o.value);for(o=(l=$jscomp.makeIterator(l)).next();!o.done;o=l.next()){var g=o.value;i.has(g.keySystem)||i.set(g.keySystem,[]),i.get(g.keySystem).push(g)}}if(1==i.size&&i.has(""))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS);for(r={},g=(l=$jscomp.makeIterator(this.config_.preferredKeySystems)).next();!g.done;r={$jscomp$loop$prop$preferredKeySystem$630:r.$jscomp$loop$prop$preferredKeySystem$630},g=l.next())for(r.$jscomp$loop$prop$preferredKeySystem$630=g.value,o=(g=$jscomp.makeIterator(t)).next();!o.done;o=g.next())if(o=o.value.decodingInfos.find(function(P){return function(M){return M.supported&&null!=M.keySystemAccess&&M.keySystemAccess.keySystem==P.$jscomp$loop$prop$preferredKeySystem$630}}(r)))return o.keySystemAccess;for(l=(r=$jscomp.makeIterator([!0,!1])).next();!l.done;l=r.next())for(l=l.value,o=(g=$jscomp.makeIterator(t)).next();!o.done;o=g.next()){var _=$jscomp.makeIterator(o.value.decodingInfos);for(o=_.next();!o.done;o=_.next()){var v=o.value;if(v.supported&&v.keySystemAccess){o=i.get(v.keySystemAccess.keySystem);var E=$jscomp.makeIterator(o);for(o=E.next();!o.done;o=E.next())if(!!o.value.licenseServerUri==l)return v.keySystemAccess}}}return null},shaka.media.DrmEngine.prototype.getKeySystemAccessByConfigs_=function(t){var r,o,l,g,_,v,E,P,M,R,U,$,G,z,Z,se,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){switch(Q.nextAddress){case 1:if(1==t.size&&t.has(""))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS);for(o=$jscomp.makeIterator(t.values()),l=o.next();!l.done;l=o.next())0==(g=l.value).audioCapabilities.length&&delete g.audioCapabilities,0==g.videoCapabilities.length&&delete g.videoCapabilities;_=$jscomp.makeIterator(i.config_.preferredKeySystems),v=_.next();case 2:if(v.done){Q.jumpTo(4);break}if(!t.has(E=v.value)){Q.jumpTo(3);break}return P=t.get(E),Q.setCatchFinallyBlocks(6),Q.yield(navigator.requestMediaKeySystemAccess(E,[P]),8);case 8:return Q.return(r=Q.yieldResult);case 6:M=Q.enterCatchBlock(),shaka.log.v2("Requesting",E,"failed with config",P,M);case 7:i.destroyer_.ensureNotDestroyed();case 3:v=_.next(),Q.jumpTo(2);break;case 4:R=$jscomp.makeIterator([!0,!1]),U=R.next();case 9:if(U.done){Q.jumpTo(11);break}$=U.value,G=$jscomp.makeIterator(t.keys()),v=G.next();case 12:if(v.done){U=R.next(),Q.jumpTo(9);break}if((Z=t.get(z=v.value)).drmInfos.some(function(te){return!!te.licenseServerUri})!=$){Q.jumpTo(13);break}return Q.setCatchFinallyBlocks(15),Q.yield(navigator.requestMediaKeySystemAccess(z,[Z]),17);case 17:return Q.return(r=Q.yieldResult);case 15:se=Q.enterCatchBlock(),shaka.log.v2("Requesting",z,"failed with config",Z,se);case 16:i.destroyer_.ensureNotDestroyed();case 13:v=G.next(),Q.jumpTo(12);break;case 11:return Q.return(r)}})},shaka.media.DrmEngine.prototype.configureClearKey_=function(){var t=shaka.util.MapUtils.asMap(this.config_.clearKeys);if(0==t.size)return null;var i=shaka.util.StringUtils,r=shaka.util.Uint8ArrayUtils,o=[],l=[];t.forEach(function(_,v){var E=r.fromHex(v),P=r.fromHex(_);E={kty:"oct",kid:r.toBase64(E,!1),k:r.toBase64(P,!1)},o.push(E),l.push(E.kid)}),t=JSON.stringify({keys:o});var g=JSON.stringify({kids:l});return i=[{initData:shaka.util.BufferUtils.toUint8(i.toUTF8(g)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+window.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:i,keyIds:new Set(l)}},shaka.media.DrmEngine.prototype.loadOfflineSession_=function(t){var r,o,l,g,_,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){switch(v.nextAddress){case 1:try{shaka.log.v1("Attempting to load an offline session",t),r=i.mediaKeys_.createSession("persistent-license")}catch(E){return o=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,E.message),i.onError_(o),v.return(Promise.reject(o))}return i.eventManager_.listen(r,"message",function(E){return i.onSessionMessage_(E)}),i.eventManager_.listen(r,"keystatuseschange",function(E){return i.onKeyStatusesChange_(E)}),i.activeSessions_.set(r,l={initData:null,loaded:!1,oldExpiration:1/0,updatePromise:null,type:"persistent-license"}),v.setCatchFinallyBlocks(2),v.yield(r.load(t),4);case 4:return g=v.yieldResult,i.destroyer_.ensureNotDestroyed(),shaka.log.v2("Loaded offline session",t,g),g?(l.loaded=!0,i.areAllSessionsLoaded_()&&i.allSessionsLoaded_.resolve(),v.return(r)):(i.activeSessions_.delete(r),i.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.OFFLINE_SESSION_REMOVED)),v.return(Promise.resolve()));case 2:_=v.enterCatchBlock(),i.destroyer_.ensureNotDestroyed(_),i.activeSessions_.delete(r),i.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,_.message));case 3:return v.return(Promise.resolve())}})},shaka.media.DrmEngine.prototype.createTemporarySession_=function(t,i){var r=this;goog.asserts.assert(this.mediaKeys_,"mediaKeys_ should be valid when creating temporary session.");var o=this.currentDrmInfo_.sessionType;try{shaka.log.info("Creating new",o,"session");var l=this.mediaKeys_.createSession(o)}catch(g){return void this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,g.message))}this.eventManager_.listen(l,"message",function(g){return r.onSessionMessage_(g)}),this.eventManager_.listen(l,"keystatuseschange",function(g){return r.onKeyStatusesChange_(g)}),this.activeSessions_.set(l,{initData:i,loaded:!1,oldExpiration:1/0,updatePromise:null,type:o});try{i=this.config_.initDataTransform(i,t,this.currentDrmInfo_)}catch(g){return o=g,g instanceof shaka.util.Error||(o=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INIT_DATA_TRANSFORM_ERROR,g)),void this.onError_(o)}this.config_.logLicenseExchange&&(o=shaka.util.Uint8ArrayUtils.toBase64(i),shaka.log.info("EME init data: type=",t,"data=",o)),l.generateRequest(t,i).catch(function(g){if(!r.destroyer_.destroyed()){goog.asserts.assert(g instanceof Error,"Wrong error type!"),r.activeSessions_.delete(l);var _=g.errorCode;if(_&&_.systemCode){var v=_.systemCode;0>v&&(v+=Math.pow(2,32)),v="0x"+v.toString(16)}r.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_GENERATE_LICENSE_REQUEST,g.message,g,v))}})},shaka.media.DrmEngine.defaultInitDataTransform=function(t,i,r){return"skd"==i&&(i=r.serverCertificate,r=shaka.util.FairPlayUtils.defaultGetContentId(t),t=shaka.util.FairPlayUtils.initDataTransform(t,r,i)),t},shaka.media.DrmEngine.prototype.onSessionMessage_=function(t){this.delayLicenseRequest_()?this.mediaKeyMessageEvents_.push(t):this.sendLicenseRequest_(t)},shaka.media.DrmEngine.prototype.delayLicenseRequest_=function(){return!!this.video_&&this.config_.delayLicenseRequestUntilPlayed&&this.video_.paused&&!this.initialRequestsSent_},shaka.media.DrmEngine.prototype.sendLicenseRequest_=function(t){var r,o,l,g,_,v,E,P,M,R,U,$,G,z,Z,Y,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){switch(Q.nextAddress){case 1:return shaka.log.v1("Sending license request for session",(r=t.target).sessionId,"of type",t.messageType),i.config_.logLicenseExchange&&(o=shaka.util.Uint8ArrayUtils.toBase64(t.message),shaka.log.info("EME license request",o)),l=i.activeSessions_.get(r),g=i.currentDrmInfo_.licenseServerUri,_=i.config_.advanced[i.currentDrmInfo_.keySystem],"individualization-request"==t.messageType&&_&&_.individualizationServer&&(g=_.individualizationServer),v=shaka.net.NetworkingEngine.RequestType.LICENSE,(E=shaka.net.NetworkingEngine.makeRequest([g],i.config_.retryParameters)).body=t.message,E.method="POST",E.licenseRequestType=t.messageType,E.sessionId=r.sessionId,shaka.media.DrmEngine.isPlayReadyKeySystem(i.currentDrmInfo_.keySystem)&&i.unpackPlayReadyRequest_(E),P=Date.now(),Q.setCatchFinallyBlocks(2),R=i.playerInterface_.netEngine.request(v,E),Q.yield(R.promise,4);case 4:M=Q.yieldResult,Q.leaveTryBlock(3);break;case 2:return U=Q.enterCatchBlock(),goog.asserts.assert(U instanceof shaka.util.Error,"Wrong NetworkingEngine error type!"),$=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_REQUEST_FAILED,U),i.onError_($),l&&l.updatePromise&&l.updatePromise.reject($),Q.return();case 3:return i.destroyer_.destroyed()?Q.return():(i.licenseTimeSeconds_+=(Date.now()-P)/1e3,i.config_.logLicenseExchange&&(G=shaka.util.Uint8ArrayUtils.toBase64(M.data),shaka.log.info("EME license response",G)),Q.setCatchFinallyBlocks(5),shaka.log.v1("Updating session",r.sessionId),Q.yield(r.update(M.data),7));case 7:Q.leaveTryBlock(6);break;case 5:return z=Q.enterCatchBlock(),Z=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_RESPONSE_REJECTED,z.message),i.onError_(Z),l&&l.updatePromise&&l.updatePromise.reject(Z),Q.return();case 6:Y=new shaka.util.FakeEvent("drmsessionupdate"),i.playerInterface_.onEvent(Y),l&&(l.updatePromise&&l.updatePromise.resolve(),new shaka.util.Timer(function(){l.loaded=!0,i.areAllSessionsLoaded_()&&i.allSessionsLoaded_.resolve()}).tickAfter(shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_)),Q.jumpToEnd()}})},shaka.media.DrmEngine.prototype.unpackPlayReadyRequest_=function(t){var i=shaka.util.StringUtils.fromUTF16(t.body,!0,!0);if(i.includes("PlayReadyKeyMessage")){shaka.log.debug("Unwrapping PlayReady request.");for(var r=(i=(new DOMParser).parseFromString(i,"application/xml")).getElementsByTagName("HttpHeader"),o=(r=$jscomp.makeIterator(r)).next();!o.done;o=r.next()){var l=o.value;o=l.getElementsByTagName("name")[0],l=l.getElementsByTagName("value")[0],goog.asserts.assert(o&&l,"Malformed PlayReady headers!"),t.headers[o.textContent]=l.textContent}i=i.getElementsByTagName("Challenge")[0],goog.asserts.assert(i,"Malformed PlayReady challenge!"),goog.asserts.assert("base64encoded"==i.getAttribute("encoding"),"Unexpected PlayReady challenge encoding!"),t.body=shaka.util.Uint8ArrayUtils.fromBase64(i.textContent)}else shaka.log.debug("PlayReady request is already unwrapped."),t.headers["Content-Type"]="text/xml; charset=utf-8"},shaka.media.DrmEngine.prototype.onKeyStatusesChange_=function(t){var i=this;shaka.log.v2("Key status changed for session",(t=t.target).sessionId);var r=this.activeSessions_.get(t),o=!1;t.keyStatuses.forEach(function(g,_){if("string"==typeof _){var v=_;_=g,g=v}if(shaka.media.DrmEngine.isPlayReadyKeySystem(i.currentDrmInfo_.keySystem)&&16==_.byteLength&&shaka.util.Platform.isEdge()){var E=(v=shaka.util.BufferUtils.toDataView(_)).getUint32(0,!0),P=v.getUint16(4,!0),M=v.getUint16(6,!0);v.setUint32(0,E,!1),v.setUint16(4,P,!1),v.setUint16(6,M,!1)}"status-pending"!=g&&(r.loaded=!0),r||goog.asserts.assert("usable"!=g,"Usable keys found in closed session"),"expired"==g&&(o=!0),v=shaka.util.Uint8ArrayUtils.toHex(_),i.keyStatusByKeyId_.set(v,g)});var l=t.expiration-Date.now();(0>l||o&&1e3>l)&&r&&!r.updatePromise&&(shaka.log.debug("Session has expired",t.sessionId),this.activeSessions_.delete(t),t.close().catch(function(){})),this.areAllSessionsLoaded_()&&(this.allSessionsLoaded_.resolve(),this.keyStatusTimer_.tickAfter(shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME))},shaka.media.DrmEngine.prototype.processKeyStatusChanges_=function(){var t=this.keyStatusByKeyId_,i=this.announcedKeyStatusByKeyId_;i.clear(),t.forEach(function(r,o){return i.set(o,r)}),(t=Array.from(i.values())).length&&t.every(function(r){return"expired"==r})&&this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.EXPIRED)),this.playerInterface_.onKeyStatus(shaka.util.MapUtils.asObject(i))},shaka.media.DrmEngine.isBrowserSupported=function(){return!!(window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)},shaka.media.DrmEngine.probeSupport=function(){var t,i,l,g,_,v;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?(goog.asserts.assert(shaka.media.DrmEngine.isBrowserSupported(),"Must have basic EME support"),t="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.recommendation com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" "),l=[{videoCapabilities:i=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],persistentState:"required",sessionTypes:["persistent-license"]},{initDataTypes:["cenc"],videoCapabilities:i}],g=new Map,_=function(P){var M,R,U;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){switch($.nextAddress){case 1:return $.setCatchFinallyBlocks(2),$.yield(navigator.requestMediaKeySystemAccess(P,l),4);case 4:return U=!!(R=(M=$.yieldResult).getConfiguration().sessionTypes)&&R.includes("persistent-license"),shaka.util.Platform.isTizen3()&&(U=!1),g.set(P,{persistentState:U}),$.yield(M.createMediaKeys(),5);case 5:$.leaveTryBlock(0);break;case 2:$.enterCatchBlock(),g.set(P,null),$.jumpToEnd()}})},v=t.map(function(P){return _(P)}),E.yield(Promise.all(v),2)):E.return(shaka.util.MapUtils.asObject(g))})},shaka.media.DrmEngine.prototype.onPlay_=function(){for(var t=$jscomp.makeIterator(this.mediaKeyMessageEvents_),i=t.next();!i.done;i=t.next())this.sendLicenseRequest_(i.value);this.initialRequestsSent_=!0,this.mediaKeyMessageEvents_=[]},shaka.media.DrmEngine.prototype.closeSession_=function(t){var i,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?(i=shaka.media.DrmEngine,r=new Promise(function(l,g){new shaka.util.Timer(g).tickAfter(i.CLOSE_TIMEOUT_)}),o.setCatchFinallyBlocks(2),o.yield(Promise.race([Promise.all([t.close(),t.closed]),r]),4)):2!=o.nextAddress?o.leaveTryBlock(0):(o.enterCatchBlock(),shaka.log.warning("Timeout waiting for session close"),void o.jumpToEnd())})},shaka.media.DrmEngine.prototype.closeOpenSessions_=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return i=Array.from(t.activeSessions_.entries()),t.activeSessions_.clear(),r.yield(Promise.all(i.map(function(o){var _,l=(o=$jscomp.makeIterator(o)).next().value,g=o.next().value;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(v.setCatchFinallyBlocks(2),t.initializedForStorage_||t.offlineSessionIds_.includes(l.sessionId)||"persistent-license"!==g.type?(shaka.log.v1("Closing session",l.sessionId,g),v.yield(t.closeSession_(l),5)):(shaka.log.v1("Removing session",l.sessionId),v.yield(l.remove(),5))):2!=v.nextAddress?v.leaveTryBlock(0):(_=v.enterCatchBlock(),shaka.log.error("Failed to close or remove the session",_),void v.jumpToEnd())})})),0)})},shaka.media.DrmEngine.prototype.supportsVariant=function(t){var i=t.audio,r=t.video;if(i&&i.encrypted&&(i=shaka.media.DrmEngine.computeMimeType_(i),!this.willSupport(i))||r&&r.encrypted&&(r=shaka.media.DrmEngine.computeMimeType_(r),!this.willSupport(r)))return!1;var o=shaka.media.DrmEngine.keySystem(this.currentDrmInfo_);return 0==(t=this.getVariantDrmInfos_(t)).length||t.some(function(l){return l.keySystem==o})},shaka.media.DrmEngine.areDrmCompatible=function(t,i){return!t.length||!i.length||0<shaka.media.DrmEngine.getCommonDrmInfos(t,i).length},shaka.media.DrmEngine.getCommonDrmInfos=function(t,i){if(!t.length)return i;if(!i.length)return t;for(var r=[],o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next()){l=l.value;for(var g=$jscomp.makeIterator(i),_=g.next();!_.done;_=g.next())if(l.keySystem==(_=_.value).keySystem){g=(g=(g=[]).concat(l.initData||[])).concat(_.initData||[]);var v=l.keyIds&&_.keyIds?new Set([].concat($jscomp.arrayFromIterable(l.keyIds),$jscomp.arrayFromIterable(_.keyIds))):l.keyIds||_.keyIds;r.push({keySystem:l.keySystem,licenseServerUri:l.licenseServerUri||_.licenseServerUri,distinctiveIdentifierRequired:l.distinctiveIdentifierRequired||_.distinctiveIdentifierRequired,persistentStateRequired:l.persistentStateRequired||_.persistentStateRequired,videoRobustness:l.videoRobustness||_.videoRobustness,audioRobustness:l.audioRobustness||_.audioRobustness,serverCertificate:l.serverCertificate||_.serverCertificate,serverCertificateUri:l.serverCertificateUri||_.serverCertificateUri,initData:g,keyIds:v});break}}return r},shaka.media.DrmEngine.prototype.getVariantDrmInfos_=function(t){return(t.video?t.video.drmInfos:[]).concat(t.audio?t.audio.drmInfos:[])},shaka.media.DrmEngine.prototype.pollExpiration_=function(){var t=this;this.activeSessions_.forEach(function(i,r){var o=i.oldExpiration,l=r.expiration;isNaN(l)&&(l=1/0),l!=o&&(t.playerInterface_.onExpirationUpdated(r.sessionId,l),i.oldExpiration=l)})},shaka.media.DrmEngine.prototype.areAllSessionsLoaded_=function(){var t=this.activeSessions_.values();return shaka.util.Iterables.every(t,function(i){return i.loaded})},shaka.media.DrmEngine.replaceDrmInfo_=function(t,i){var r=[];i.forEach(function(g,_){r.push({keySystem:_,licenseServerUri:g,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})});for(var o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())(l=l.value).video&&(l.video.drmInfos=r),l.audio&&(l.audio.drmInfos=r)},shaka.media.DrmEngine.prototype.createDrmInfoByInfos_=function(t,i){var r=[],o=[],l=[],g=[],_=new Set;for(shaka.media.DrmEngine.processDrmInfos_(i,r,l,o,g,_),1<l.length&&shaka.log.warning("Multiple unique server certificates found! Only the first will be used."),1<r.length&&shaka.log.warning("Multiple unique license server URIs found! Only the first will be used."),1<o.length&&shaka.log.warning("Multiple unique server certificate URIs found! Only the first will be used."),r={keySystem:t,licenseServerUri:r[0],distinctiveIdentifierRequired:i[0].distinctiveIdentifierRequired,persistentStateRequired:i[0].persistentStateRequired,sessionType:i[0].sessionType||(this.usePersistentLicenses_?"persistent-license":"temporary"),audioRobustness:i[0].audioRobustness||"",videoRobustness:i[0].videoRobustness||"",serverCertificate:l[0],serverCertificateUri:o[0],initData:g,keyIds:_},l=(o=$jscomp.makeIterator(i)).next();!l.done;l=o.next())(l=l.value).distinctiveIdentifierRequired&&(r.distinctiveIdentifierRequired=l.distinctiveIdentifierRequired),l.persistentStateRequired&&(r.persistentStateRequired=l.persistentStateRequired);return r},shaka.media.DrmEngine.createDrmInfoByConfigs_=function(t,i){var r=[],o=[],l=[],g=[],_=new Set;return shaka.media.DrmEngine.processDrmInfos_(i.drmInfos,r,l,o,g,_),1<l.length&&shaka.log.warning("Multiple unique server certificates found! Only the first will be used."),1<o.length&&shaka.log.warning("Multiple unique server certificate URIs found! Only the first will be used."),1<r.length&&shaka.log.warning("Multiple unique license server URIs found! Only the first will be used."),{keySystem:t,licenseServerUri:r[0],distinctiveIdentifierRequired:"required"==i.distinctiveIdentifier,persistentStateRequired:"required"==i.persistentState,sessionType:i.sessionTypes[0]||"temporary",audioRobustness:(i.audioCapabilities?i.audioCapabilities[0].robustness:"")||"",videoRobustness:(i.videoCapabilities?i.videoCapabilities[0].robustness:"")||"",serverCertificate:l[0],serverCertificateUri:o[0],initData:g,keyIds:_}},shaka.media.DrmEngine.processDrmInfos_=function(t,i,r,o,l,g){for(var _={},v=(t=$jscomp.makeIterator(t)).next();!v.done;_={$jscomp$loop$prop$drmInfo$632:_.$jscomp$loop$prop$drmInfo$632},v=t.next()){if(_.$jscomp$loop$prop$drmInfo$632=v.value,i.includes(_.$jscomp$loop$prop$drmInfo$632.licenseServerUri)||i.push(_.$jscomp$loop$prop$drmInfo$632.licenseServerUri),o.includes(_.$jscomp$loop$prop$drmInfo$632.serverCertificateUri)||o.push(_.$jscomp$loop$prop$drmInfo$632.serverCertificateUri),_.$jscomp$loop$prop$drmInfo$632.serverCertificate&&(r.some(function(M){return function(R){return shaka.util.BufferUtils.equal(R,M.$jscomp$loop$prop$drmInfo$632.serverCertificate)}}(_))||r.push(_.$jscomp$loop$prop$drmInfo$632.serverCertificate)),_.$jscomp$loop$prop$drmInfo$632.initData){v={};for(var E=$jscomp.makeIterator(_.$jscomp$loop$prop$drmInfo$632.initData),P=E.next();!P.done;v={$jscomp$loop$prop$initDataOverride$634:v.$jscomp$loop$prop$initDataOverride$634},P=E.next())v.$jscomp$loop$prop$initDataOverride$634=P.value,l.some(function(M){return function(R){var U=M.$jscomp$loop$prop$initDataOverride$634;return!(!R.keyId||R.keyId!=U.keyId)||R.initDataType==U.initDataType&&shaka.util.BufferUtils.equal(R.initData,U.initData)}}(v))||l.push(v.$jscomp$loop$prop$initDataOverride$634)}if(_.$jscomp$loop$prop$drmInfo$632.keyIds)for(E=(v=$jscomp.makeIterator(_.$jscomp$loop$prop$drmInfo$632.keyIds)).next();!E.done;E=v.next())g.add(E.value)}},shaka.media.DrmEngine.fillInDrmInfoDefaults_=function(t,i,r){t.keySystem&&("org.w3.clearkey"!=t.keySystem||!t.licenseServerUri)&&(i.size&&(i=i.get(t.keySystem)||"",t.licenseServerUri=i),t.keyIds||(t.keyIds=new Set),(r=r.get(t.keySystem))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=r.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=r.persistentStateRequired),t.videoRobustness||(t.videoRobustness=r.videoRobustness),t.audioRobustness||(t.audioRobustness=r.audioRobustness),t.serverCertificate||(t.serverCertificate=r.serverCertificate),r.sessionType&&(t.sessionType=r.sessionType),t.serverCertificateUri||(t.serverCertificateUri=r.serverCertificateUri)),window.cast&&window.cast.__platform__&&"com.microsoft.playready"==t.keySystem&&(t.keySystem="com.chromecast.playready"))},shaka.media.DrmEngine.CLOSE_TIMEOUT_=1,shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_=5,shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME=.5,shaka.media.DrmEngine.DUMMY_KEY_ID=new shaka.util.Lazy(function(){return shaka.util.BufferUtils.toArrayBuffer(new Uint8Array([0]))}),shaka.media.ManifestParser=function(){},shaka.media.ManifestParser.registerParserByExtension=function(t,i){shaka.media.ManifestParser.parsersByExtension[t]=i},shaka.media.ManifestParser.registerParserByMime=function(t,i){shaka.media.ManifestParser.parsersByMime[t]=i},shaka.media.ManifestParser.unregisterParserByMime=function(t){delete shaka.media.ManifestParser.parsersByMime[t]},shaka.media.ManifestParser.probeSupport=function(){var t=shaka.media.ManifestParser,i={};if(shaka.util.Platform.supportsMediaSource()){for(var r in t.parsersByMime)i[r]=!0;for(var o in t.parsersByExtension)i[o]=!0}r={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var l=(o=$jscomp.makeIterator(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!l.done;l=o.next())i[l=l.value]=shaka.util.Platform.supportsMediaSource()?!!t.parsersByMime[l]:shaka.util.Platform.supportsMediaType(l);for(var g in r)i[g]=shaka.util.Platform.supportsMediaSource()?!!t.parsersByExtension[g]:shaka.util.Platform.supportsMediaType(r[g]);return i},shaka.media.ManifestParser.getFactory=function(t,i,r,o){var l,g,_,v,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){if(1==P.nextAddress){if(l=shaka.media.ManifestParser,o){if(g=l.parsersByMime[o.toLowerCase()])return P.return(g);shaka.log.warning("Could not determine manifest type using MIME type ",o)}if(_=l.getExtension(t)){if(v=l.parsersByExtension[_])return P.return(v);shaka.log.warning("Could not determine manifest type for extension ",_)}else shaka.log.warning("Could not find extension for ",t);return o?P.jumpTo(2):P.yield(l.getMimeType(t,i,r),3)}if(2!=P.nextAddress&&(o=P.yieldResult)){if(E=shaka.media.ManifestParser.parsersByMime[o])return P.return(E);shaka.log.warning("Could not determine manifest type using MIME type",o)}throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.UNABLE_TO_GUESS_MANIFEST_TYPE,t)})},shaka.media.ManifestParser.getMimeType=function(t,i,r){var o,l,_;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(o=shaka.net.NetworkingEngine.RequestType.MANIFEST,(l=shaka.net.NetworkingEngine.makeRequest([t],r)).method="HEAD",v.yield(i.request(o,l).promise,2)):v.return((_=v.yieldResult.headers["content-type"])?_.toLowerCase().split(";").shift():"")})},shaka.media.ManifestParser.getExtension=function(t){return 1==(t=new goog.Uri(t).getPath().split("/").pop().split(".")).length?"":t.pop().toLowerCase()},shaka.media.ManifestParser.isSupported=function(t,i){return!!shaka.util.Platform.supportsMediaSource()&&(i in shaka.media.ManifestParser.parsersByMime||shaka.media.ManifestParser.getExtension(t)in shaka.media.ManifestParser.parsersByExtension)},goog.exportSymbol("shaka.media.ManifestParser",shaka.media.ManifestParser),goog.exportProperty(shaka.media.ManifestParser,"unregisterParserByMime",shaka.media.ManifestParser.unregisterParserByMime),goog.exportProperty(shaka.media.ManifestParser,"registerParserByMime",shaka.media.ManifestParser.registerParserByMime),goog.exportProperty(shaka.media.ManifestParser,"registerParserByExtension",shaka.media.ManifestParser.registerParserByExtension),shaka.media.ManifestParser.parsersByMime={},shaka.media.ManifestParser.parsersByExtension={},shaka.media.InitSegmentReference=function(t,i,r){this.getUris=t,this.startByte=i,this.endByte=r},shaka.media.InitSegmentReference.prototype.getStartByte=function(){return this.startByte},shaka.media.InitSegmentReference.prototype.getEndByte=function(){return this.endByte},shaka.media.InitSegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.InitSegmentReference.equal=function(t,i){var r=shaka.util.ArrayUtils;return t&&i?t.getStartByte()==i.getStartByte()&&t.getEndByte()==i.getEndByte()&&r.equal(t.getUris(),i.getUris()):t==i},goog.exportSymbol("shaka.media.InitSegmentReference",shaka.media.InitSegmentReference),goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getEndByte",shaka.media.InitSegmentReference.prototype.getEndByte),goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getStartByte",shaka.media.InitSegmentReference.prototype.getStartByte),shaka.media.SegmentReference=function(t,i,r,o,l,g,_,v,E,P){P=void 0===P?[]:P,goog.asserts.assert(t<=i,"startTime must be less than or equal to endTime"),goog.asserts.assert(null==l||o<l,"startByte must be < endByte"),this.startTime=t,this.endTime=i,this.getUrisInner=r,this.startByte=o,this.endByte=l,this.initSegmentReference=g,this.timestampOffset=_,this.appendWindowStart=v,this.appendWindowEnd=E,this.partialReferences=P},shaka.media.SegmentReference.prototype.getUris=function(){return this.getUrisInner()},shaka.media.SegmentReference.prototype.getStartTime=function(){return this.startTime},shaka.media.SegmentReference.prototype.getEndTime=function(){return this.endTime},shaka.media.SegmentReference.prototype.getStartByte=function(){return this.startByte},shaka.media.SegmentReference.prototype.getEndByte=function(){return this.endByte},shaka.media.SegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.SegmentReference.prototype.hasPartialSegments=function(){return 0<this.partialReferences.length},goog.exportSymbol("shaka.media.SegmentReference",shaka.media.SegmentReference),goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndByte",shaka.media.SegmentReference.prototype.getEndByte),goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartByte",shaka.media.SegmentReference.prototype.getStartByte),goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndTime",shaka.media.SegmentReference.prototype.getEndTime),goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartTime",shaka.media.SegmentReference.prototype.getStartTime),goog.exportProperty(shaka.media.SegmentReference.prototype,"getUris",shaka.media.SegmentReference.prototype.getUris),shaka.media.PresentationTimeline=function(t,i,r){this.presentationStartTime_=t,this.presentationDelay_=i,this.segmentAvailabilityDuration_=this.duration_=1/0,this.maxSegmentDuration_=1,this.maxSegmentEndTime_=this.minSegmentStartTime_=null,this.clockOffset_=0,this.static_=!0,this.userSeekStart_=0,this.autoCorrectDrift_=void 0===r||r,this.availabilityTimeOffset_=0},shaka.media.PresentationTimeline.prototype.getDuration=function(){return this.duration_},shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration=function(){return this.maxSegmentDuration_},shaka.media.PresentationTimeline.prototype.setDuration=function(t){goog.asserts.assert(0<t,"duration must be > 0"),this.duration_=t},shaka.media.PresentationTimeline.prototype.getPresentationStartTime=function(){return this.presentationStartTime_},shaka.media.PresentationTimeline.prototype.setClockOffset=function(t){this.clockOffset_=t},shaka.media.PresentationTimeline.prototype.setStatic=function(t){this.static_=t},shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration=function(t){goog.asserts.assert(0<=t,"segmentAvailabilityDuration must be >= 0"),this.segmentAvailabilityDuration_=t},shaka.media.PresentationTimeline.prototype.setDelay=function(t){goog.asserts.assert(0<=t,"delay must be >= 0"),this.presentationDelay_=t},shaka.media.PresentationTimeline.prototype.getDelay=function(){return this.presentationDelay_},shaka.media.PresentationTimeline.prototype.notifySegments=function(t){if(0!=t.length){var i=t[t.length-1].endTime;this.notifyMinSegmentStartTime(t[0].startTime),this.maxSegmentDuration_=t.reduce(function(r,o){return Math.max(r,o.endTime-o.startTime)},this.maxSegmentDuration_),this.maxSegmentEndTime_=Math.max(this.maxSegmentEndTime_,i),null!=this.presentationStartTime_&&this.autoCorrectDrift_&&(this.presentationStartTime_=(Date.now()+this.clockOffset_)/1e3-this.maxSegmentEndTime_-this.maxSegmentDuration_),shaka.log.v1("notifySegments:","maxSegmentDuration="+this.maxSegmentDuration_)}},shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime=function(t){this.minSegmentStartTime_=null==this.minSegmentStartTime_?t:Math.min(this.minSegmentStartTime_,t)},shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration=function(t){this.maxSegmentDuration_=Math.max(this.maxSegmentDuration_,t),shaka.log.v1("notifyNewSegmentDuration:","maxSegmentDuration="+this.maxSegmentDuration_)},shaka.media.PresentationTimeline.prototype.offset=function(t){null!=this.minSegmentStartTime_&&(this.minSegmentStartTime_+=t),null!=this.maxSegmentEndTime_&&(this.maxSegmentEndTime_+=t)},shaka.media.PresentationTimeline.prototype.isLive=function(){return this.duration_==1/0&&!this.static_},shaka.media.PresentationTimeline.prototype.isInProgress=function(){return this.duration_!=1/0&&!this.static_},shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart=function(){goog.asserts.assert(0<=this.segmentAvailabilityDuration_,"The availability duration should be positive");var t=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return Math.max(this.userSeekStart_,t)},shaka.media.PresentationTimeline.prototype.setUserSeekStart=function(t){this.userSeekStart_=t},shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd=function(){return this.isLive()||this.isInProgress()?Math.min(this.getLiveEdge_()+this.availabilityTimeOffset_,this.duration_):this.duration_},shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart=function(t){var i=Math.max(this.minSegmentStartTime_,this.userSeekStart_);if(this.segmentAvailabilityDuration_==1/0)return Math.ceil(1e3*i)/1e3;var r=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return t=Math.min(r+t,this.getSeekRangeEnd()),Math.max(i,t)},shaka.media.PresentationTimeline.prototype.getSeekRangeStart=function(){return this.getSafeSeekRangeStart(0)},shaka.media.PresentationTimeline.prototype.getSeekRangeEnd=function(){var t=this.isLive()||this.isInProgress()?this.presentationDelay_:0;return Math.max(0,this.getSegmentAvailabilityEnd()-t)},shaka.media.PresentationTimeline.prototype.usingPresentationStartTime=function(){return!(null==this.presentationStartTime_||null!=this.maxSegmentEndTime_&&this.autoCorrectDrift_)},shaka.media.PresentationTimeline.prototype.getLiveEdge_=function(){goog.asserts.assert(null!=this.presentationStartTime_,"Cannot compute timeline live edge without start time");var t=(Date.now()+this.clockOffset_)/1e3;return Math.max(0,t-this.maxSegmentDuration_-this.presentationStartTime_)},shaka.media.PresentationTimeline.prototype.setAvailabilityTimeOffset=function(t){this.availabilityTimeOffset_=t},shaka.media.PresentationTimeline.prototype.assertIsValid=function(){goog.DEBUG&&(this.isLive()?goog.asserts.assert(null!=this.presentationStartTime_,"Detected as live stream, but does not match our model of live!"):this.isInProgress()?goog.asserts.assert(null!=this.presentationStartTime_&&this.segmentAvailabilityDuration_==1/0,"Detected as IPR stream, but does not match our model of IPR!"):goog.asserts.assert(this.segmentAvailabilityDuration_==1/0&&this.duration_!=1/0&&this.static_,"Detected as VOD stream, but does not match our model of VOD!"))},goog.exportSymbol("shaka.media.PresentationTimeline",shaka.media.PresentationTimeline),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setAvailabilityTimeOffset",shaka.media.PresentationTimeline.prototype.setAvailabilityTimeOffset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"usingPresentationStartTime",shaka.media.PresentationTimeline.prototype.usingPresentationStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeEnd",shaka.media.PresentationTimeline.prototype.getSeekRangeEnd),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSeekRangeStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSafeSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityEnd",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setUserSeekStart",shaka.media.PresentationTimeline.prototype.setUserSeekStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityStart",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isInProgress",shaka.media.PresentationTimeline.prototype.isInProgress),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isLive",shaka.media.PresentationTimeline.prototype.isLive),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"offset",shaka.media.PresentationTimeline.prototype.offset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMinSegmentStartTime",shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifySegments",shaka.media.PresentationTimeline.prototype.notifySegments),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDelay",shaka.media.PresentationTimeline.prototype.getDelay),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDelay",shaka.media.PresentationTimeline.prototype.setDelay),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setSegmentAvailabilityDuration",shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setStatic",shaka.media.PresentationTimeline.prototype.setStatic),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setClockOffset",shaka.media.PresentationTimeline.prototype.setClockOffset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getPresentationStartTime",shaka.media.PresentationTimeline.prototype.getPresentationStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDuration",shaka.media.PresentationTimeline.prototype.setDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDuration",shaka.media.PresentationTimeline.prototype.getDuration),shaka.media.StallDetector=function(t,i){this.implementation_=t,this.wasMakingProgress_=t.shouldBeMakingProgress(),this.value_=t.getPresentationSeconds(),this.lastUpdateSeconds_=t.getWallSeconds(),this.didJump_=!1,this.stallThresholdSeconds_=i,this.onStall_=function(){}},shaka.media.StallDetector.prototype.release=function(){this.implementation_=null,this.onStall_=function(){}},shaka.media.StallDetector.prototype.onStall=function(t){this.onStall_=t},shaka.media.StallDetector.prototype.poll=function(){var t=this.implementation_,i=t.shouldBeMakingProgress(),r=t.getPresentationSeconds(),o=t.getWallSeconds();return(this.value_!=r||this.wasMakingProgress_!=i)&&(this.lastUpdateSeconds_=o,this.value_=r,this.wasMakingProgress_=i,this.didJump_=!1),(i=(r=o-this.lastUpdateSeconds_)>=this.stallThresholdSeconds_&&i&&!this.didJump_)&&(this.onStall_(this.value_,r),this.didJump_=!0,this.value_=t.getPresentationSeconds()),i},shaka.media.StallDetector.Implementation=function(){},shaka.media.StallDetector.Implementation.prototype.shouldBeMakingProgress=function(){},shaka.media.StallDetector.Implementation.prototype.getPresentationSeconds=function(){},shaka.media.StallDetector.Implementation.prototype.getWallSeconds=function(){},shaka.media.StallDetector.MediaElementImplementation=function(t){this.mediaElement_=t},shaka.media.StallDetector.MediaElementImplementation.prototype.shouldBeMakingProgress=function(){return!this.mediaElement_.paused&&0!=this.mediaElement_.playbackRate&&0!=this.mediaElement_.buffered.length&&shaka.media.StallDetector.MediaElementImplementation.hasContentFor_(this.mediaElement_.buffered,this.mediaElement_.currentTime)},shaka.media.StallDetector.MediaElementImplementation.prototype.getPresentationSeconds=function(){return this.mediaElement_.currentTime},shaka.media.StallDetector.MediaElementImplementation.prototype.getWallSeconds=function(){return Date.now()/1e3},shaka.media.StallDetector.MediaElementImplementation.hasContentFor_=function(t,i){for(var r=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(t)),o=r.next();!o.done;o=r.next())if(!(i<(o=o.value).start-.1||i>o.end-.5))return!0;return!1},shaka.media.GapJumpingController=function(t,i,r,o,l){var g=this;this.video_=t,this.timeline_=i,this.config_=r,this.onEvent_=l,this.eventManager_=new shaka.util.EventManager,this.seekingEventReceived_=!1,this.prevReadyState_=t.readyState,this.didFireLargeGap_=!1,this.stallDetector_=o,this.hadSegmentAppended_=!1,this.eventManager_.listen(t,"waiting",function(){return g.onPollGapJump_()}),this.gapJumpTimer_=new shaka.util.Timer(function(){g.onPollGapJump_()}).tickEvery(.25)},shaka.media.GapJumpingController.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.gapJumpTimer_&&(this.gapJumpTimer_.stop(),this.gapJumpTimer_=null),this.stallDetector_&&(this.stallDetector_.release(),this.stallDetector_=null),this.video_=this.timeline_=this.onEvent_=null},shaka.media.GapJumpingController.prototype.onSegmentAppended=function(){this.hadSegmentAppended_=!0,this.onPollGapJump_()},shaka.media.GapJumpingController.prototype.onSeeking=function(){this.seekingEventReceived_=!0,this.didFireLargeGap_=this.hadSegmentAppended_=!1},shaka.media.GapJumpingController.prototype.onPollGapJump_=function(){if(0!=this.video_.readyState){if(this.video_.seeking){if(!this.seekingEventReceived_)return}else this.seekingEventReceived_=!1;if(!(this.video_.paused&&0!=this.video_.currentTime||(this.video_.readyState!=this.prevReadyState_&&(this.didFireLargeGap_=!1,this.prevReadyState_=this.video_.readyState),this.stallDetector_&&this.stallDetector_.poll()))){var t=this.config_.smallGapLimit,i=this.video_.currentTime,r=this.video_.buffered,o=shaka.media.TimeRangesUtils.getGapIndex(r,i,this.config_.gapDetectionThreshold);if(null!=o&&(0!=o||this.hadSegmentAppended_)){var l=r.start(o),g=this.timeline_.getSeekRangeEnd();if(!(l>=g)){t=(g=l-i)<=t;var _=!1;if(!(g<shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE)){if(!t&&!this.didFireLargeGap_){this.didFireLargeGap_=!0;var v=new shaka.util.FakeEvent("largegap",{currentTime:i,gapSize:g});v.cancelable=!0,this.onEvent_(v),this.config_.jumpLargeGaps&&!v.defaultPrevented?_=!0:shaka.log.info("Ignoring large gap at",i,"size",g)}(t||_)&&(0==o?shaka.log.info("Jumping forward",g,"seconds because of gap before start time of",l):shaka.log.info("Jumping forward",g,"seconds because of gap starting at",r.end(o-1),"and ending at",l),this.video_.currentTime=l)}}}}}},shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE=.001,shaka.util.MediaReadyState=function(){},shaka.util.MediaReadyState.waitForReadyState=function(t,i,r,o){i==HTMLMediaElement.HAVE_NOTHING||t.readyState>=i?o():(i=shaka.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_.value().get(i),r.listenOnce(t,i,o))},shaka.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_=new shaka.util.Lazy(function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])}),shaka.media.VideoWrapper=function(t,i,r){var o=this;this.video_=t,this.onSeek_=i,this.startTime_=r,this.started_=!1,this.eventManager_=new shaka.util.EventManager,this.mover_=new shaka.media.VideoWrapper.PlayheadMover(t,10),shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){o.setStartTime_(o.startTime_)})},shaka.media.VideoWrapper.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.mover_&&(this.mover_.release(),this.mover_=null),this.onSeek_=function(){},this.video_=null},shaka.media.VideoWrapper.prototype.getTime=function(){return this.started_?this.video_.currentTime:this.startTime_},shaka.media.VideoWrapper.prototype.setTime=function(t){var i=this;0<this.video_.readyState?this.mover_.moveTo(t):shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){i.setStartTime_(i.startTime_)})},shaka.media.VideoWrapper.prototype.setStartTime_=function(t){var i=this;.001>Math.abs(this.video_.currentTime-t)?this.startListeningToSeeks_():(this.eventManager_.listenOnce(this.video_,"seeking",function(){i.startListeningToSeeks_()}),this.mover_.moveTo(0==this.video_.currentTime?t:this.video_.currentTime))},shaka.media.VideoWrapper.prototype.startListeningToSeeks_=function(){var t=this;goog.asserts.assert(0<this.video_.readyState,"The media element should be ready before we listen for seeking."),this.started_=!0,this.eventManager_.listen(this.video_,"seeking",function(){return t.onSeek_()})},shaka.media.VideoWrapper.PlayheadMover=function(t,i){var r=this;this.mediaElement_=t,this.maxAttempts_=i,this.targetTime_=this.originTime_=this.remainingAttempts_=0,this.timer_=new shaka.util.Timer(function(){return r.onTick_()})},shaka.media.VideoWrapper.PlayheadMover.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.mediaElement_=null},shaka.media.VideoWrapper.PlayheadMover.prototype.moveTo=function(t){this.originTime_=this.mediaElement_.currentTime,this.targetTime_=t,this.remainingAttempts_=this.maxAttempts_,this.mediaElement_.currentTime=t,this.timer_.tickEvery(.1)},shaka.media.VideoWrapper.PlayheadMover.prototype.onTick_=function(){0>=this.remainingAttempts_?(shaka.log.warning(["Failed to move playhead from",this.originTime_,"to",this.targetTime_].join(" ")),this.timer_.stop()):this.mediaElement_.currentTime!=this.originTime_?this.timer_.stop():(this.mediaElement_.currentTime=this.targetTime_,this.remainingAttempts_--)},shaka.media.Playhead=function(){},shaka.media.Playhead.prototype.setStartTime=function(t){},shaka.media.Playhead.prototype.getTime=function(){},shaka.media.Playhead.prototype.notifyOfBufferingChange=function(){},shaka.media.SrcEqualsPlayhead=function(t){var i=this;this.mediaElement_=t,this.started_=!1,this.startTime_=null,this.eventManager_=new shaka.util.EventManager,shaka.util.MediaReadyState.waitForReadyState(this.mediaElement_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,function(){null==i.startTime_?i.started_=!0:(i.eventManager_.listenOnce(i.mediaElement_,"seeking",function(){i.started_=!0}),i.mediaElement_.currentTime=Math.max(0,i.mediaElement_.currentTime+i.startTime_))})},shaka.media.SrcEqualsPlayhead.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.mediaElement_=null},shaka.media.SrcEqualsPlayhead.prototype.setStartTime=function(t){this.startTime_=this.started_?this.startTime_:t},shaka.media.SrcEqualsPlayhead.prototype.getTime=function(){return(this.started_?this.mediaElement_.currentTime:this.startTime_)||0},shaka.media.SrcEqualsPlayhead.prototype.notifyOfBufferingChange=function(){},shaka.media.MediaSourcePlayhead=function(t,i,r,o,l,g){var _=this;this.minSeekRange_=3,this.mediaElement_=t,this.timeline_=i.presentationTimeline,this.minBufferTime_=i.minBufferTime||0,this.config_=r,this.onSeek_=l,this.lastCorrectiveSeek_=null,this.gapController_=new shaka.media.GapJumpingController(t,i.presentationTimeline,r,this.createStallDetector_(t,r),g),this.videoWrapper_=new shaka.media.VideoWrapper(t,function(){return _.onSeeking_()},this.getStartTime_(o)),this.checkWindowTimer_=new shaka.util.Timer(function(){_.onPollWindow_()}).tickEvery(.25)},shaka.media.MediaSourcePlayhead.prototype.release=function(){this.videoWrapper_&&(this.videoWrapper_.release(),this.videoWrapper_=null),this.gapController_&&(this.gapController_.release(),this.gapController_=null),this.checkWindowTimer_&&(this.checkWindowTimer_.stop(),this.checkWindowTimer_=null),this.mediaElement_=this.videoWrapper_=this.timeline_=this.config_=null,this.onSeek_=function(){}},shaka.media.MediaSourcePlayhead.prototype.setStartTime=function(t){this.videoWrapper_.setTime(t)},shaka.media.MediaSourcePlayhead.prototype.getTime=function(){var t=this.videoWrapper_.getTime();return 0<this.mediaElement_.readyState&&!this.mediaElement_.paused?this.clampTime_(t):t},shaka.media.MediaSourcePlayhead.prototype.getStartTime_=function(t){return null==t?t=1/0>this.timeline_.getDuration()?this.timeline_.getSeekRangeStart():this.timeline_.getSeekRangeEnd():0>t&&(t=this.timeline_.getSeekRangeEnd()+t),this.clampSeekToDuration_(this.clampTime_(t))},shaka.media.MediaSourcePlayhead.prototype.notifyOfBufferingChange=function(){this.gapController_.onSegmentAppended()},shaka.media.MediaSourcePlayhead.prototype.onPollWindow_=function(){if(0!=this.mediaElement_.readyState&&!this.mediaElement_.paused){var t=this.videoWrapper_.getTime(),i=this.timeline_.getSeekRangeStart(),r=this.timeline_.getSeekRangeEnd();r-i<this.minSeekRange_&&(i=r-this.minSeekRange_),t<i&&(i=this.reposition_(t),shaka.log.info("Jumping forward "+(i-t)+" seconds to catch up with the seek range."),this.mediaElement_.currentTime=i)}},shaka.media.MediaSourcePlayhead.prototype.onSeeking_=function(){this.gapController_.onSeeking();var t=this.videoWrapper_.getTime(),i=this.reposition_(t);if(Math.abs(i-t)>shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE){var r=Date.now()/1e3;if(!this.lastCorrectiveSeek_||this.lastCorrectiveSeek_<r-1)return this.lastCorrectiveSeek_=r,void this.videoWrapper_.setTime(i)}shaka.log.v1("Seek to "+t),this.onSeek_()},shaka.media.MediaSourcePlayhead.prototype.clampSeekToDuration_=function(t){var i=this.timeline_.getDuration();return t>=i?(goog.asserts.assert(0<=this.config_.durationBackoff,"Duration backoff must be non-negative!"),i-this.config_.durationBackoff):t},shaka.media.MediaSourcePlayhead.prototype.reposition_=function(t){goog.asserts.assert(this.config_,"Cannot reposition playhead when it has beeen destroyed");var i=Math.max(this.minBufferTime_,this.config_.rebufferingGoal),r=this.config_.safeSeekOffset,o=this.timeline_.getSeekRangeStart(),l=this.timeline_.getSeekRangeEnd(),g=this.timeline_.getDuration();l-o<this.minSeekRange_&&(o=l-this.minSeekRange_);var _=this.timeline_.getSafeSeekRangeStart(i),v=this.timeline_.getSafeSeekRangeStart(r);return i=this.timeline_.getSafeSeekRangeStart(i+r),t>=g?(shaka.log.v1("Playhead past duration."),this.clampSeekToDuration_(t)):t>l?(shaka.log.v1("Playhead past end."),l):t<o?shaka.media.TimeRangesUtils.isBuffered(this.mediaElement_.buffered,v)?(shaka.log.v1("Playhead before start & start is buffered"),v):(shaka.log.v1("Playhead before start & start is unbuffered"),i):t>=_||shaka.media.TimeRangesUtils.isBuffered(this.mediaElement_.buffered,t)?(shaka.log.v1("Playhead in safe region or in buffered region."),t):(shaka.log.v1("Playhead outside safe region & in unbuffered region."),i)},shaka.media.MediaSourcePlayhead.prototype.clampTime_=function(t){var i=this.timeline_.getSeekRangeStart();return t<i||t>(i=this.timeline_.getSeekRangeEnd())?i:t},shaka.media.MediaSourcePlayhead.prototype.createStallDetector_=function(t,i){if(!i.stallEnabled)return null;var r=i.stallThreshold,o=i.stallSkip;return(r=new shaka.media.StallDetector(new shaka.media.StallDetector.MediaElementImplementation(t),r)).onStall(function(l,g){shaka.log.debug("Stall detected at "+l+" for "+g+" seconds."),o?(shaka.log.debug("Seeking forward "+o+" seconds to break stall."),t.currentTime+=o):(shaka.log.debug("Pausing and unpausing to break stall."),t.pause(),t.play())}),r},shaka.media.SegmentIndex=function(t){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(t),this.references=t,this.timer_=null,this.numEvicted=0,this.immutable_=!1},shaka.media.SegmentIndex.prototype.destroy=function(){return shaka.Deprecate.deprecateFeature(4,"shaka.media.SegmentIndex","Please use release() instead of destroy()."),this.release(),Promise.resolve()},shaka.media.SegmentIndex.prototype.release=function(){this.immutable_||(this.references=[],this.timer_&&this.timer_.stop(),this.timer_=null)},shaka.media.SegmentIndex.prototype.markImmutable=function(){this.immutable_=!0},shaka.media.SegmentIndex.prototype.find=function(t){for(var i=this.references.length-1,r=i;0<=r;--r){var o=this.references[r];if(t>=o.startTime&&t<(r<i?this.references[r+1].startTime:o.endTime))return r+this.numEvicted}return this.references.length&&t<this.references[0].startTime?this.numEvicted:null},shaka.media.SegmentIndex.prototype.get=function(t){return 0==this.references.length||0>(t-=this.numEvicted)||t>=this.references.length?null:this.references[t]},shaka.media.SegmentIndex.prototype.offset=function(t){if(!this.immutable_)for(var i=$jscomp.makeIterator(this.references),r=i.next();!r.done;r=i.next())(r=r.value).startTime+=t,r.endTime+=t,r.timestampOffset+=t},shaka.media.SegmentIndex.prototype.merge=function(t){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(t),!this.immutable_&&t.length&&(this.references=this.references.filter(function(i){return i.startTime<t[0].startTime}),this.references.push.apply(this.references,$jscomp.arrayFromIterable(t)),goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(this.references))},shaka.media.SegmentIndex.prototype.mergeAndEvict=function(t,i){t=t.filter(function(r){return r.endTime>i}),this.merge(t),this.evict(i)},shaka.media.SegmentIndex.prototype.evict=function(t){if(!this.immutable_){var i=this.references.length;this.references=this.references.filter(function(r){return r.endTime>t}),this.numEvicted+=i-this.references.length}},shaka.media.SegmentIndex.prototype.fit=function(t,i,r){if(r=void 0!==r&&r,goog.asserts.assert(null!=i,"Content duration must be known for static content!"),goog.asserts.assert(i!=1/0,"Content duration must be finite for static content!"),!this.immutable_){for(;this.references.length&&this.references[this.references.length-1].startTime>=i;)this.references.pop();for(;this.references.length&&this.references[0].endTime<=t;)this.references.shift(),r||this.numEvicted++;0!=this.references.length&&(this.references[this.references.length-1]=new shaka.media.SegmentReference((t=this.references[this.references.length-1]).startTime,i,t.getUrisInner,t.startByte,t.endByte,t.initSegmentReference,t.timestampOffset,t.appendWindowStart,t.appendWindowEnd))}},shaka.media.SegmentIndex.prototype.updateEvery=function(t,i){var r=this;goog.asserts.assert(!this.timer_,"SegmentIndex timer already started!"),this.immutable_||(this.timer_&&this.timer_.stop(),this.timer_=new shaka.util.Timer(function(){var o=i();o?r.references.push.apply(r.references,$jscomp.arrayFromIterable(o)):(r.timer_.stop(),r.timer_=null)}),this.timer_.tickEvery(t))},shaka.media.SegmentIndex.prototype[Symbol.iterator]=function(){return this.getIteratorForTime(0)},shaka.media.SegmentIndex.prototype.getIteratorForTime=function(t){var i=this.find(t);null==i?i=-1:i--;var r=this.get(i+1),o=-1;if(r&&r.hasPartialSegments())for(var l=r.partialReferences.length-1;0<=l;--l){var g=r.partialReferences[l];if(t>=g.startTime&&t<g.endTime){i++,o=l-1;break}}return new shaka.media.SegmentIterator(this,i,o)},shaka.media.SegmentIndex.forSingleSegment=function(t,i,r){return t=new shaka.media.SegmentReference(t,t+i,function(){return r},0,null,null,t,t,t+i),new shaka.media.SegmentIndex([t])},goog.exportSymbol("shaka.media.SegmentIndex",shaka.media.SegmentIndex),goog.exportProperty(shaka.media.SegmentIndex,"forSingleSegment",shaka.media.SegmentIndex.forSingleSegment),goog.exportProperty(shaka.media.SegmentIndex.prototype,"getIteratorForTime",shaka.media.SegmentIndex.prototype.getIteratorForTime),goog.exportProperty(shaka.media.SegmentIndex.prototype,"updateEvery",shaka.media.SegmentIndex.prototype.updateEvery),goog.exportProperty(shaka.media.SegmentIndex.prototype,"fit",shaka.media.SegmentIndex.prototype.fit),goog.exportProperty(shaka.media.SegmentIndex.prototype,"evict",shaka.media.SegmentIndex.prototype.evict),goog.exportProperty(shaka.media.SegmentIndex.prototype,"mergeAndEvict",shaka.media.SegmentIndex.prototype.mergeAndEvict),goog.exportProperty(shaka.media.SegmentIndex.prototype,"merge",shaka.media.SegmentIndex.prototype.merge),goog.exportProperty(shaka.media.SegmentIndex.prototype,"offset",shaka.media.SegmentIndex.prototype.offset),goog.exportProperty(shaka.media.SegmentIndex.prototype,"get",shaka.media.SegmentIndex.prototype.get),goog.exportProperty(shaka.media.SegmentIndex.prototype,"find",shaka.media.SegmentIndex.prototype.find),goog.exportProperty(shaka.media.SegmentIndex.prototype,"markImmutable",shaka.media.SegmentIndex.prototype.markImmutable),goog.exportProperty(shaka.media.SegmentIndex.prototype,"release",shaka.media.SegmentIndex.prototype.release),goog.exportProperty(shaka.media.SegmentIndex.prototype,"destroy",shaka.media.SegmentIndex.prototype.destroy),goog.DEBUG&&(shaka.media.SegmentIndex.assertCorrectReferences_=function(t){goog.asserts.assert(t.every(function(i,r){if(0==r)return!0;var o=t[r-1];return o.startTime<i.startTime||!(o.startTime>i.startTime)&&o.endTime<=i.endTime}),"SegmentReferences are incorrect")}),shaka.media.SegmentIterator=function(t,i,r){this.segmentIndex_=t,this.currentPosition_=i,this.currentPartialPosition_=r},shaka.media.SegmentIterator.prototype.seek=function(t){return shaka.Deprecate.deprecateFeature(4,"shaka.media.SegmentIterator","Please use SegmentIndex.getIteratorForTime instead of seek()."),t=this.segmentIndex_.getIteratorForTime(t),this.currentPosition_=t.currentPosition_,this.currentPartialPosition_=t.currentPartialPosition_,this.next().value},shaka.media.SegmentIterator.prototype.current=function(){var t=this.segmentIndex_.get(this.currentPosition_);return t&&t.hasPartialSegments()&&t.getUris().length&&this.currentPartialPosition_>=t.partialReferences.length&&(this.currentPosition_++,this.currentPartialPosition_=0,t=this.segmentIndex_.get(this.currentPosition_)),t&&t.hasPartialSegments()?t.partialReferences[this.currentPartialPosition_]:t},shaka.media.SegmentIterator.prototype.next=function(){var t=this.segmentIndex_.get(this.currentPosition_);return t&&t.hasPartialSegments()?(this.currentPartialPosition_++,t.getUris().length&&this.currentPartialPosition_==t.partialReferences.length&&(this.currentPosition_++,this.currentPartialPosition_=0)):(this.currentPosition_++,this.currentPartialPosition_=0),{value:t=this.current(),done:!t}},goog.exportSymbol("shaka.media.SegmentIterator",shaka.media.SegmentIterator),goog.exportProperty(shaka.media.SegmentIterator.prototype,"next",shaka.media.SegmentIterator.prototype.next),goog.exportProperty(shaka.media.SegmentIterator.prototype,"current",shaka.media.SegmentIterator.prototype.current),goog.exportProperty(shaka.media.SegmentIterator.prototype,"seek",shaka.media.SegmentIterator.prototype.seek),shaka.media.MetaSegmentIndex=function(){shaka.media.SegmentIndex.call(this,[]),this.indexes_=[]},$jscomp.inherits(shaka.media.MetaSegmentIndex,shaka.media.SegmentIndex),shaka.media.MetaSegmentIndex.prototype.appendSegmentIndex=function(t){goog.asserts.assert(0==this.indexes_.length||0==t.numEvicted,"Should not append a new segment index with already-evicted segments"),this.indexes_.push(t)},shaka.media.MetaSegmentIndex.prototype.clone=function(){var t=new shaka.media.MetaSegmentIndex;return t.indexes_=this.indexes_.slice(),t},shaka.media.MetaSegmentIndex.prototype.release=function(){for(var t=$jscomp.makeIterator(this.indexes_),i=t.next();!i.done;i=t.next())i.value.release();this.indexes_=[]},shaka.media.MetaSegmentIndex.prototype.find=function(t){for(var i=0,r=$jscomp.makeIterator(this.indexes_),o=r.next();!o.done;o=r.next()){var l=(o=o.value).find(t);if(null!=l)return l+i;i+=o.numEvicted+o.references.length}return null},shaka.media.MetaSegmentIndex.prototype.get=function(t){for(var i=0,r=!1,o=$jscomp.makeIterator(this.indexes_),l=o.next();!l.done;l=o.next()){l=l.value,goog.asserts.assert(!r||0==l.numEvicted,"Should not see evicted segments after available segments");var g=l.get(t-i);if(g)return g;i+=l.numEvicted+l.references.length,r=r||0!=l.references.length}return null},shaka.media.MetaSegmentIndex.prototype.offset=function(t){goog.asserts.assert(!1,"offset() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.merge=function(t){goog.asserts.assert(!1,"merge() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.evict=function(t){goog.asserts.assert(!1,"evict() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.mergeAndEvict=function(t,i){goog.asserts.assert(!1,"mergeAndEvict() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.fit=function(t,i){goog.asserts.assert(!1,"fit() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.updateEvery=function(t,i){goog.asserts.assert(!1,"updateEvery() should not be used in MetaSegmentIndex!")},goog.exportSymbol("shaka.media.MetaSegmentIndex",shaka.media.MetaSegmentIndex),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"updateEvery",shaka.media.MetaSegmentIndex.prototype.updateEvery),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"fit",shaka.media.MetaSegmentIndex.prototype.fit),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"mergeAndEvict",shaka.media.MetaSegmentIndex.prototype.mergeAndEvict),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"evict",shaka.media.MetaSegmentIndex.prototype.evict),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"merge",shaka.media.MetaSegmentIndex.prototype.merge),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"offset",shaka.media.MetaSegmentIndex.prototype.offset),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"get",shaka.media.MetaSegmentIndex.prototype.get),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"find",shaka.media.MetaSegmentIndex.prototype.find),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"release",shaka.media.MetaSegmentIndex.prototype.release),shaka.media.PlayRateController=function(t){var i=this;this.harness_=t,this.isBuffering_=!1,this.rate_=this.harness_.getRate(),this.pollRate_=.25,this.timer_=new shaka.util.Timer(function(){i.harness_.movePlayhead(i.rate_*i.pollRate_)})},shaka.media.PlayRateController.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.harness_=null},shaka.media.PlayRateController.prototype.setBuffering=function(t){this.isBuffering_=t,this.apply_()},shaka.media.PlayRateController.prototype.set=function(t){goog.asserts.assert(0!=t,"Should never set rate of 0 explicitly!"),this.rate_=t,this.apply_()},shaka.media.PlayRateController.prototype.getRealRate=function(){return this.rate_},shaka.media.PlayRateController.prototype.getDefaultRate=function(){return this.harness_.getDefaultRate()},shaka.media.PlayRateController.prototype.apply_=function(){this.timer_.stop();var t=this.calculateCurrentRate_();if(shaka.log.v1("Changing effective playback rate to",t),0<=t)try{return void this.applyRate_(t)}catch(i){}this.timer_.tickEvery(this.pollRate_),this.applyRate_(0)},shaka.media.PlayRateController.prototype.calculateCurrentRate_=function(){return this.isBuffering_?0:this.rate_},shaka.media.PlayRateController.prototype.applyRate_=function(t){var i=this.harness_.getRate();return i!=t&&this.harness_.setRate(t),i!=t},shaka.media.IPlayheadObserver=function(){},shaka.media.IPlayheadObserver.prototype.poll=function(t,i){},shaka.media.PlayheadObserverManager=function(t){var i=this;this.mediaElement_=t,this.observers_=new Set,this.pollingLoop_=new shaka.util.Timer(function(){i.pollAllObservers_(!1)}).tickEvery(.25)},shaka.media.PlayheadObserverManager.prototype.release=function(){this.pollingLoop_.stop();for(var t=$jscomp.makeIterator(this.observers_),i=t.next();!i.done;i=t.next())i.value.release();this.observers_.clear()},shaka.media.PlayheadObserverManager.prototype.manage=function(t){this.observers_.add(t)},shaka.media.PlayheadObserverManager.prototype.notifyOfSeek=function(){this.pollAllObservers_(!0)},shaka.media.PlayheadObserverManager.prototype.pollAllObservers_=function(t){for(var i=$jscomp.makeIterator(this.observers_),r=i.next();!r.done;r=i.next())r.value.poll(this.mediaElement_.currentTime,t)},shaka.media.RegionTimeline=function(t){var i=this;this.onAddRegion_=function(r){},this.regions_=new Set,this.getSeekRange_=t,this.filterTimer_=new shaka.util.Timer(function(){i.filterBySeekRange_()}).tickEvery(shaka.media.RegionTimeline.REGION_FILTER_INTERVAL)},shaka.media.RegionTimeline.prototype.release=function(){this.onAddRegion_=function(t){},this.regions_.clear(),this.filterTimer_.stop()},shaka.media.RegionTimeline.prototype.setListeners=function(t){this.onAddRegion_=t},shaka.media.RegionTimeline.prototype.addRegion=function(t){null==this.findSimilarRegion_(t)&&(this.regions_.add(t),this.onAddRegion_(t))},shaka.media.RegionTimeline.prototype.filterBySeekRange_=function(){for(var t=this.getSeekRange_(),i=$jscomp.makeIterator(this.regions_),r=i.next();!r.done;r=i.next())(r=r.value).endTime<t.start&&this.regions_.delete(r)},shaka.media.RegionTimeline.prototype.findSimilarRegion_=function(t){for(var i=$jscomp.makeIterator(this.regions_),r=i.next();!r.done;r=i.next())if((r=r.value).schemeIdUri==t.schemeIdUri&&r.id==t.id&&r.startTime==t.startTime&&r.endTime==t.endTime)return r;return null},shaka.media.RegionTimeline.prototype.regions=function(){return this.regions_},shaka.media.RegionTimeline.REGION_FILTER_INTERVAL=2,shaka.media.RegionObserver=function(t){var i=this;this.timeline_=t,this.oldPosition_=new Map,this.onEnter_=function(l,g){},this.onExit_=function(l,g){},this.onSkip_=function(l,g){};var r=shaka.media.RegionObserver.RelativePosition_,o=r.IN_THE_REGION;this.rules_=[{weWere:null,weAre:o,invoke:function(l,g){return i.onEnter_(l,g)}},{weWere:t=r.BEFORE_THE_REGION,weAre:o,invoke:function(l,g){return i.onEnter_(l,g)}},{weWere:r=r.AFTER_THE_REGION,weAre:o,invoke:function(l,g){return i.onEnter_(l,g)}},{weWere:o,weAre:t,invoke:function(l,g){return i.onExit_(l,g)}},{weWere:o,weAre:r,invoke:function(l,g){return i.onExit_(l,g)}},{weWere:t,weAre:r,invoke:function(l,g){return i.onSkip_(l,g)}},{weWere:r,weAre:t,invoke:function(l,g){return i.onSkip_(l,g)}}]},shaka.media.RegionObserver.prototype.release=function(){this.timeline_=null,this.oldPosition_.clear(),this.onEnter_=function(t,i){},this.onExit_=function(t,i){},this.onSkip_=function(t,i){}},shaka.media.RegionObserver.prototype.poll=function(t,i){for(var r=shaka.media.RegionObserver,o=$jscomp.makeIterator(this.timeline_.regions()),l=o.next();!l.done;l=o.next()){var g=this.oldPosition_.get(l=l.value),_=r.determinePositionRelativeTo_(l,t);this.oldPosition_.set(l,_);for(var v=$jscomp.makeIterator(this.rules_),E=v.next();!E.done;E=v.next())(E=E.value).weWere==g&&E.weAre==_&&E.invoke(l,i)}},shaka.media.RegionObserver.prototype.setListeners=function(t,i,r){this.onEnter_=t,this.onExit_=i,this.onSkip_=r},shaka.media.RegionObserver.determinePositionRelativeTo_=function(t,i){var r=shaka.media.RegionObserver.RelativePosition_;return i<t.startTime?r.BEFORE_THE_REGION:i>t.endTime?r.AFTER_THE_REGION:r.IN_THE_REGION},shaka.media.RegionObserver.RelativePosition_={BEFORE_THE_REGION:1,IN_THE_REGION:2,AFTER_THE_REGION:3},shaka.util.Networking=function(){},shaka.util.Networking.createSegmentRequest=function(t,i,r,o,l){return t=shaka.net.NetworkingEngine.makeRequest(t,o,l),(0!=i||null!=r)&&(t.headers.Range=r?"bytes="+i+"-"+r:"bytes="+i+"-"),t},shaka.media.StreamingEngine=function(t,i){var r=this;this.playerInterface_=i,this.manifest_=t,this.config_=null,this.bufferingGoalScale_=1,this.currentTextStream_=this.currentVariant_=null,this.mediaStates_=new Map,this.startupComplete_=!1,this.failureCallbackBackoff_=null,this.fatalError_=!1,this.destroyer_=new shaka.util.Destroyer(function(){return r.doDestroy_()})},shaka.media.StreamingEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.StreamingEngine.prototype.doDestroy_=function(){var i,r,o,l,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress){for(i=[],r=$jscomp.makeIterator(t.mediaStates_.values()),o=r.next();!o.done;o=r.next())t.cancelUpdate_(l=o.value),i.push(t.abortOperations_(l));return g.yield(Promise.all(i),2)}t.mediaStates_.clear(),t.playerInterface_=null,t.manifest_=null,t.config_=null,g.jumpToEnd()})},shaka.media.StreamingEngine.prototype.configure=function(t){this.config_=t,this.failureCallbackBackoff_=new shaka.net.Backoff({maxAttempts:Math.max(t.retryParameters.maxAttempts,2),baseDelay:t.retryParameters.baseDelay,backoffFactor:t.retryParameters.backoffFactor,fuzzFactor:t.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0)},shaka.media.StreamingEngine.prototype.start=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(1==i.nextAddress)return goog.asserts.assert(t.config_,"StreamingEngine configure() must be called before init()!"),i.yield(t.initStreams_(),2);t.destroyer_.ensureNotDestroyed(),shaka.log.debug("init: completed initial Stream setup"),t.startupComplete_=!0,i.jumpToEnd()})},shaka.media.StreamingEngine.prototype.getCurrentVariant=function(){return this.currentVariant_},shaka.media.StreamingEngine.prototype.getCurrentTextStream=function(){return this.currentTextStream_},shaka.media.StreamingEngine.prototype.loadNewTextStream_=function(t){var r,o,l,v,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){switch(E.nextAddress){case 1:return goog.asserts.assert(!i.mediaStates_.has((r=shaka.util.ManifestParserUtils.ContentType).TEXT),"Should not call loadNewTextStream_ while streaming text!"),E.setCatchFinallyBlocks(2),E.yield(i.playerInterface_.mediaSourceEngine.clear(r.TEXT),4);case 4:E.leaveTryBlock(3);break;case 2:o=E.enterCatchBlock(),i.playerInterface_&&i.playerInterface_.onError(o);case 3:l=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),i.playerInterface_.mediaSourceEngine.reinitText(l),(i.playerInterface_.mediaSourceEngine.getTextDisplayer().isTextVisible()||i.config_.alwaysStreamText)&&(v=i.createMediaState_(t),i.mediaStates_.set(r.TEXT,v),i.scheduleUpdate_(v,0)),E.jumpToEnd()}})},shaka.media.StreamingEngine.prototype.unloadTextStream=function(){var t=shaka.util.ManifestParserUtils.ContentType,i=this.mediaStates_.get(t.TEXT);i&&(this.cancelUpdate_(i),this.abortOperations_(i).catch(function(){}),this.mediaStates_.delete(t.TEXT)),this.currentTextStream_=null},shaka.media.StreamingEngine.prototype.setTrickPlay=function(t){var i=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.VIDEO);if(i){var r=i.stream;r&&(shaka.log.debug("setTrickPlay",t),t?(t=r.trickModeVideo)&&!i.restoreStreamAfterTrickPlay&&(shaka.log.debug("Engaging trick mode stream",t),this.switchInternal_(t,!1,0,!1),i.restoreStreamAfterTrickPlay=r):(r=i.restoreStreamAfterTrickPlay)&&(shaka.log.debug("Restoring non-trick-mode stream",r),i.restoreStreamAfterTrickPlay=null,this.switchInternal_(r,!0,0,!1)))}},shaka.media.StreamingEngine.prototype.switchVariant=function(t,i,r){i=void 0!==i&&i,r=void 0===r?0:r,this.currentVariant_=t,this.startupComplete_&&(t.video&&this.switchInternal_(t.video,i,r,!1),t.audio&&this.switchInternal_(t.audio,i,r,!1))},shaka.media.StreamingEngine.prototype.switchTextStream=function(t){this.currentTextStream_=t,this.startupComplete_&&(goog.asserts.assert(t&&t.type==shaka.util.ManifestParserUtils.ContentType.TEXT,"Wrong stream type passed to switchTextStream!"),this.switchInternal_(t,!0,0,!1))},shaka.media.StreamingEngine.prototype.reloadTextStream=function(){var t=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.TEXT);t&&this.switchInternal_(t.stream,!0,0,!0)},shaka.media.StreamingEngine.prototype.switchInternal_=function(t,i,r,o){var l=this,g=shaka.util.ManifestParserUtils.ContentType,_=this.mediaStates_.get(t.type);_||t.type!=g.TEXT?(goog.asserts.assert(_,"switch: expected mediaState to exist"),_&&(_.restoreStreamAfterTrickPlay&&(shaka.log.debug("switch during trick play mode",t),t.trickModeVideo?(_.restoreStreamAfterTrickPlay=t,shaka.log.debug("switch found trick play stream",t=t.trickModeVideo)):(_.restoreStreamAfterTrickPlay=null,shaka.log.debug("switch found no special trick play stream"))),_.stream!=t||o?(t.type==g.TEXT&&(o=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),this.playerInterface_.mediaSourceEngine.reinitText(o)),_.stream=t,_.segmentIterator=null,t=shaka.media.StreamingEngine.logPrefix_(_),shaka.log.debug("switch: switching to Stream "+t),i&&(_.clearingBuffer?_.waitingToFlushBuffer=!0:_.performingUpdate?(_.waitingToClearBuffer=!0,_.clearBufferSafeMargin=r,_.waitingToFlushBuffer=!0):(this.cancelUpdate_(_),this.clearBuffer_(_,!0,r).catch(function(v){l.playerInterface_&&(goog.asserts.assert(v instanceof shaka.util.Error,"Wrong error type!"),l.playerInterface_.onError(v))}))),this.makeAbortDecision_(_).catch(function(v){l.playerInterface_&&(goog.asserts.assert(v instanceof shaka.util.Error,"Wrong error type!"),l.playerInterface_.onError(v))})):(i=shaka.media.StreamingEngine.logPrefix_(_),shaka.log.debug("switch: Stream "+i+" already active")))):this.loadNewTextStream_(t)},shaka.media.StreamingEngine.prototype.makeAbortDecision_=function(t){var r,o,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return 1==l.nextAddress?t.operation?(o=t.operation,(r=t.stream).segmentIndex?l.jumpTo(2):l.yield(r.createSegmentIndex(),2)):l.return():t.operation!=o||t.stream!=r?l.return():(goog.asserts.assert(t.stream.segmentIndex,"Segment index should exist by now!"),i.shouldAbortCurrentRequest_(t)&&(shaka.log.info("Aborting current segment request."),t.operation.abort()),void l.jumpToEnd())})},shaka.media.StreamingEngine.prototype.shouldAbortCurrentRequest_=function(t){goog.asserts.assert(t.operation,"Abort logic requires an ongoing operation!"),goog.asserts.assert(t.stream&&t.stream.segmentIndex,"Abort logic requires a segment index");var i=this.playerInterface_.getPresentationTime(),r=this.playerInterface_.mediaSourceEngine.bufferEnd(t.type),o=this.getTimeNeeded_(t,i),l=null==(o=t.stream.segmentIndex.find(o))?null:t.stream.segmentIndex.get(o);return o=l?l.getSize():null,l&&!o&&(o=(l.getEndTime()-l.getStartTime())*(t.stream.bandwidth||0)/8),!!o&&((l=l.initSegmentReference)&&(o+=l.getSize()||0),8*o/(l=this.playerInterface_.getBandwidthEstimate())<(r||0)-i-Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal)||t.operation.getBytesRemaining()>o)},shaka.media.StreamingEngine.prototype.seeked=function(){for(var t=this.playerInterface_.getPresentationTime(),i=this.config_.smallGapLimit,r=shaka.util.ManifestParserUtils.ContentType,o=!1,l=$jscomp.makeIterator(this.mediaStates_.keys()),g=l.next();!g.done;g=l.next()){var _=this.mediaStates_.get(g=g.value),v=shaka.media.StreamingEngine.logPrefix_(_);_.segmentIterator=null,this.playerInterface_.mediaSourceEngine.isBuffered(g,t,i)||(null!=this.playerInterface_.mediaSourceEngine.bufferEnd(g)&&(this.forceClearBuffer_(_),o=!0),_.operation&&(_.operation.abort(),shaka.log.debug(v,"Aborting operation due to seek"),_.operation=null),g===r.TEXT&&this.playerInterface_.mediaSourceEngine.resetCaptionParser())}o||shaka.log.debug("(all): seeked: buffered seek: presentationTime="+t)},shaka.media.StreamingEngine.prototype.forceClearBuffer_=function(t){var i=this,r=shaka.media.StreamingEngine.logPrefix_(t);t.clearingBuffer?shaka.log.debug(r,"clear: already clearing the buffer"):t.waitingToClearBuffer?shaka.log.debug(r,"clear: already waiting"):t.performingUpdate?(shaka.log.debug(r,"clear: currently updating"),t.waitingToClearBuffer=!0,t.clearBufferSafeMargin=0):null==this.playerInterface_.mediaSourceEngine.bufferStart(t.type)?(shaka.log.debug(r,"clear: nothing buffered"),null==t.updateTimer&&this.scheduleUpdate_(t,0)):(shaka.log.debug(r,"clear: handling right now"),this.cancelUpdate_(t),this.clearBuffer_(t,!1,0).catch(function(o){i.playerInterface_&&(goog.asserts.assert(o instanceof shaka.util.Error,"Wrong error type!"),i.playerInterface_.onError(o))}))},shaka.media.StreamingEngine.prototype.initStreams_=function(){var i,r,o,_,v,E,P,M,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){if(1==R.nextAddress){if(i=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(t.config_,"StreamingEngine configure() must be called before init()!"),!t.currentVariant_)throw shaka.log.error("init: no Streams chosen"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STREAMING,shaka.util.Error.Code.STREAMING_ENGINE_STARTUP_INVALID_STATE);return r=new Map,o=new Set,t.currentVariant_.audio&&(r.set(i.AUDIO,t.currentVariant_.audio),o.add(t.currentVariant_.audio)),t.currentVariant_.video&&(r.set(i.VIDEO,t.currentVariant_.video),o.add(t.currentVariant_.video)),t.currentTextStream_&&(r.set(i.TEXT,t.currentTextStream_),o.add(t.currentTextStream_)),R.yield(t.playerInterface_.mediaSourceEngine.init(r,t.config_.forceTransmuxTS),2)}for(t.destroyer_.ensureNotDestroyed(),t.setDuration_(),_=$jscomp.makeIterator(r.keys()),v=_.next();!v.done;v=_.next())P=r.get(E=v.value),t.mediaStates_.has(E)||(M=t.createMediaState_(P),t.mediaStates_.set(E,M),t.scheduleUpdate_(M,0));R.jumpToEnd()})},shaka.media.StreamingEngine.prototype.createMediaState_=function(t){return{stream:t,type:t.type,segmentIterator:null,lastSegmentReference:null,lastInitSegmentReference:null,lastTimestampOffset:null,lastAppendWindowStart:null,lastAppendWindowEnd:null,restoreStreamAfterTrickPlay:null,endOfStream:!1,performingUpdate:!1,updateTimer:null,waitingToClearBuffer:!1,clearBufferSafeMargin:0,waitingToFlushBuffer:!1,clearingBuffer:!1,recovering:!1,hasError:!1,operation:null}},shaka.media.StreamingEngine.prototype.setDuration_=function(){var t=this.manifest_.presentationTimeline.getDuration();this.playerInterface_.mediaSourceEngine.setDuration(1/0>t?t:Math.pow(2,32))},shaka.media.StreamingEngine.prototype.onUpdate_=function(t){var r,o,l,g,_,v,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){switch(E.nextAddress){case 1:if(i.destroyer_.ensureNotDestroyed(),r=shaka.media.StreamingEngine.logPrefix_(t),goog.asserts.assert(!t.performingUpdate&&null!=t.updateTimer,r+" unexpected call to onUpdate_()"),t.performingUpdate||null==t.updateTimer||(goog.asserts.assert(!t.clearingBuffer,r+" onUpdate_() should not be called when clearing the buffer"),t.clearingBuffer))return E.return();if(t.updateTimer=null,!t.waitingToClearBuffer){E.jumpTo(2);break}return shaka.log.debug(r,"skipping update and clearing the buffer"),E.yield(i.clearBuffer_(t,t.waitingToFlushBuffer,t.clearBufferSafeMargin),3);case 3:return E.return();case 2:if(t.stream.segmentIndex){E.jumpTo(4);break}return o=t.stream,E.yield(t.stream.createSegmentIndex(),5);case 5:if(o!=t.stream)return null==t.updateTimer&&i.scheduleUpdate_(t,0),E.return();case 4:E.setCatchFinallyBlocks(6),null!=(l=i.update_(t))&&(i.scheduleUpdate_(t,l),t.hasError=!1),E.leaveTryBlock(7);break;case 6:return g=E.enterCatchBlock(),E.yield(i.handleStreamingError_(g),8);case 8:return E.return();case 7:if(_=Array.from(i.mediaStates_.values()),!i.startupComplete_||!_.every(function(P){return P.endOfStream})){E.jumpTo(0);break}return shaka.log.v1(r,"calling endOfStream()..."),E.yield(i.playerInterface_.mediaSourceEngine.endOfStream(),10);case 10:i.destroyer_.ensureNotDestroyed(),0!=(v=i.playerInterface_.mediaSourceEngine.getDuration())&&v<i.manifest_.presentationTimeline.getDuration()&&i.manifest_.presentationTimeline.setDuration(v),E.jumpToEnd()}})},shaka.media.StreamingEngine.prototype.update_=function(t){goog.asserts.assert(this.manifest_,"manifest_ should not be null"),goog.asserts.assert(this.config_,"config_ should not be null");var i=shaka.util.ManifestParserUtils.ContentType;if(shaka.media.StreamingEngine.isEmbeddedText_(t))return this.playerInterface_.mediaSourceEngine.setSelectedClosedCaptionId(t.stream.originalId||""),null;t.type==i.TEXT&&this.playerInterface_.mediaSourceEngine.clearSelectedClosedCaptionId();var r=shaka.media.StreamingEngine.logPrefix_(t),o=this.playerInterface_.getPresentationTime(),l=this.getTimeNeeded_(t,o);shaka.log.v2(r,"timeNeeded="+l);var g=this.playerInterface_.mediaSourceEngine.bufferedAheadOf(t.type,o);shaka.log.v2(r,"update_:","presentationTime="+o,"bufferedAhead="+g);var _=Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal,this.config_.bufferingGoal)*this.bufferingGoalScale_;if(l>=this.manifest_.presentationTimeline.getDuration())return shaka.log.debug(r,"buffered to end of presentation"),t.endOfStream=!0,t.type==i.VIDEO&&(t=this.mediaStates_.get(i.TEXT))&&shaka.media.StreamingEngine.isEmbeddedText_(t)&&(t.endOfStream=!0),null;if(t.endOfStream=!1,g>=_)return shaka.log.v2(r,"buffering goal met"),.5;if(i=this.playerInterface_.mediaSourceEngine.bufferEnd(t.type),!(i=this.getSegmentReferenceNeeded_(t,o,i)))return 1;g=1/0,_=Array.from(this.mediaStates_.values());for(var v=(_=$jscomp.makeIterator(_)).next();!v.done;v=_.next())shaka.media.StreamingEngine.isEmbeddedText_(v=v.value)||v.segmentIterator&&!v.segmentIterator.current()||(v=this.getTimeNeeded_(v,o),g=Math.min(g,v));return l>=g+(_=this.manifest_.presentationTimeline.getMaxSegmentDuration()*shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_)?(shaka.log.v2(r,"waiting for other streams to buffer"),1):(this.fetchAndAppend_(t,o,i).catch(function(){}),null)},shaka.media.StreamingEngine.prototype.getTimeNeeded_=function(t,i){return t.lastSegmentReference?t.lastSegmentReference.endTime:i},shaka.media.StreamingEngine.prototype.getSegmentReferenceNeeded_=function(t,i,r){var o=shaka.media.StreamingEngine.logPrefix_(t);if(goog.asserts.assert(t.stream.segmentIndex,"segment index should have been generated already"),t.segmentIterator)return t.segmentIterator.current();if(t.lastSegmentReference||r)return goog.asserts.assert(null!=(i=t.lastSegmentReference?t.lastSegmentReference.endTime:r),"Should have a time to search"),shaka.log.v1(o,"looking up segment from new stream endTime:",i),t.segmentIterator=t.stream.segmentIndex.getIteratorForTime(i),null==(t=t.segmentIterator.next().value)&&shaka.log.warning(o,"cannot find segment","endTime:",i),t;r=this.config_.inaccurateManifestTolerance;var l=Math.max(i-r,0);shaka.log.v1(o,"looking up segment","lookupTime:",l,"presentationTime:",i);var g=null;return r&&(t.segmentIterator=t.stream.segmentIndex.getIteratorForTime(l),g=t.segmentIterator.next().value),g||(t.segmentIterator=t.stream.segmentIndex.getIteratorForTime(i),g=t.segmentIterator.next().value),null==g&&shaka.log.warning(o,"cannot find segment","lookupTime:",l,"presentationTime:",i),g},shaka.media.StreamingEngine.prototype.fetchAndAppend_=function(t,i,r){var l,_,v,E,P,M,R,U,$,G,z,Z,Y,Q,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){switch(te.nextAddress){case 1:return l=shaka.util.ManifestParserUtils.ContentType,_=shaka.media.StreamingEngine.logPrefix_(t),shaka.log.v1(_,"fetchAndAppend_:","presentationTime="+i,"reference.startTime="+r.startTime,"reference.endTime="+r.endTime),v=t.stream,E=t.segmentIterator,t.performingUpdate=!0,P=o.initSourceBuffer_(t,r),shaka.log.v2(_,"fetching segment"),te.setCatchFinallyBlocks(2),M="video/mp4"==v.mimeType||"audio/mp4"==v.mimeType,R=window.ReadableStream,o.config_.lowLatencyMode&&R&&M?(G=new Uint8Array(0),z=function(ce){var me,ye,fe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){return 1==le.nextAddress?le.yield(P,2):(o.destroyer_.ensureNotDestroyed(),o.fatalError_?le.return():(G=o.concatArray_(G,ce),me=!1,ye=0,(new shaka.util.Mp4Parser).box("mdat",function(be){ye=be.size+be.start,me=!0}).parse(G,!1,!0),me?(fe=G.subarray(0,ye),G=G.subarray(ye),le.yield(o.append_(t,i,v,r,fe),0)):le.jumpTo(0)))})},te.yield(o.fetch_(t,r,z),5)):(o.config_.lowLatencyMode&&!R&&shaka.log.warning("Low latency streaming mode is enabled, but ReadableStream is not supported by the browser."),U=o.fetch_(t,r),te.yield(Promise.all([P,U]),6));case 6:return $=te.yieldResult,o.destroyer_.ensureNotDestroyed(),o.fatalError_?te.return():t.waitingToClearBuffer?(shaka.log.info(_,"waitingToClearBuffer, skip append"),t.performingUpdate=!1,o.scheduleUpdate_(t,0),te.return()):te.yield(o.append_(t,i,v,r,$[1]),5);case 5:if(o.destroyer_.ensureNotDestroyed(),o.fatalError_)return te.return();t.lastSegmentReference=r,Z=E.next().value,shaka.log.v2(_,"advancing to next segment",Z),t.performingUpdate=!1,t.recovering=!1,Y=o.playerInterface_.mediaSourceEngine.getBufferedInfo(),shaka.log.v1(_,"finished fetch and append",JSON.stringify(Y[t.type])),t.waitingToClearBuffer||o.playerInterface_.onSegmentAppended(),o.scheduleUpdate_(t,0),te.leaveTryBlock(0);break;case 2:if(Q=te.enterCatchBlock(),o.destroyer_.ensureNotDestroyed(Q),o.fatalError_)return te.return();if(goog.asserts.assert(Q instanceof shaka.util.Error,"Should only receive a Shaka error"),t.performingUpdate=!1,t.type==l.TEXT&&o.config_.ignoreTextStreamFailures)shaka.log.warning(_,Q.code==shaka.util.Error.Code.BAD_HTTP_STATUS?"Text stream failed to download. Proceeding without it.":"Text stream failed to parse. Proceeding without it."),o.mediaStates_.delete(l.TEXT),te.jumpTo(0);else if(Q.code==shaka.util.Error.Code.OPERATION_ABORTED)t.performingUpdate=!1,t.updateTimer=null,o.scheduleUpdate_(t,0),te.jumpTo(0);else if(Q.code==shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR)o.handleQuotaExceeded_(t,Q),te.jumpTo(0);else{if(Q.code!=shaka.util.Error.Code.BAD_HTTP_STATUS||!Q.data||404!=Q.data[1])return shaka.log.error(_,"failed fetch and append: code="+Q.code),t.hasError=!0,Q.severity=shaka.util.Error.Severity.CRITICAL,te.yield(o.handleStreamingError_(Q),0);shaka.log.v2(_,"segment not available."),t.performingUpdate=!1,t.updateTimer=null,o.scheduleUpdate_(t,1),te.jumpTo(0)}}})},shaka.media.StreamingEngine.prototype.retry=function(){if(this.destroyer_.destroyed())return shaka.log.error("Unable to retry after StreamingEngine is destroyed!"),!1;if(this.fatalError_)return shaka.log.error("Unable to retry after StreamingEngine encountered a fatal error!"),!1;for(var t=$jscomp.makeIterator(this.mediaStates_.values()),i=t.next();!i.done;i=t.next()){var r=shaka.media.StreamingEngine.logPrefix_(i=i.value);i.hasError&&(shaka.log.info(r,"Retrying after failure..."),i.hasError=!1,this.scheduleUpdate_(i,.1))}return!0},shaka.media.StreamingEngine.prototype.concatArray_=function(t,i){var r=new Uint8Array(t.length+i.length);return r.set(t),r.set(i,t.length),r},shaka.media.StreamingEngine.prototype.handleQuotaExceeded_=function(t,i){var r=shaka.media.StreamingEngine.logPrefix_(t);if(Array.from(this.mediaStates_.values()).some(function(l){return l!=t&&l.recovering}))shaka.log.debug(r,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var o=Math.round(100*this.bufferingGoalScale_);if(20<o)this.bufferingGoalScale_-=.2;else{if(!(4<o))return shaka.log.error(r,"MediaSource threw QuotaExceededError too many times"),this.fatalError_=t.hasError=!0,void this.playerInterface_.onError(i);this.bufferingGoalScale_-=.04}shaka.log.warning(r,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*this.bufferingGoalScale_))+"%"),t.recovering=!0}this.scheduleUpdate_(t,4)},shaka.media.StreamingEngine.prototype.initSourceBuffer_=function(t,i){var o,l,g,_,v,E,M,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return l=(o=shaka.media.StreamingEngine).logPrefix_(t),g=[],_=Math.max(0,i.appendWindowStart-o.APPEND_WINDOW_START_FUDGE_),goog.asserts.assert(i.startTime<=(v=i.appendWindowEnd+o.APPEND_WINDOW_END_FUDGE_),l+" segment should start before append window end"),((E=i.timestampOffset)!=t.lastTimestampOffset||_!=t.lastAppendWindowStart||v!=t.lastAppendWindowEnd)&&(shaka.log.v1(l,"setting timestamp offset to "+E),shaka.log.v1(l,"setting append window start to "+_),shaka.log.v1(l,"setting append window end to "+v),g.push($jscomp.asyncExecutePromiseGeneratorProgram(function(G){if(1==G.nextAddress)return G.setCatchFinallyBlocks(2),t.lastAppendWindowStart=_,t.lastAppendWindowEnd=v,t.lastTimestampOffset=E,G.yield(r.playerInterface_.mediaSourceEngine.setStreamProperties(t.type,E,_,v),4);if(2!=G.nextAddress)return G.leaveTryBlock(0);throw $=G.enterCatchBlock(),t.lastAppendWindowStart=null,t.lastAppendWindowEnd=null,t.lastTimestampOffset=null,$}))),!shaka.media.InitSegmentReference.equal(i.initSegmentReference,t.lastInitSegmentReference)&&(t.lastInitSegmentReference=i.initSegmentReference)&&(shaka.log.v1(l,"fetching init segment"),M=r.fetch_(t,i.initSegmentReference),g.push(function(){var $,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Z){switch(Z.nextAddress){case 1:return Z.setCatchFinallyBlocks(2),Z.yield(M,4);case 4:return $=Z.yieldResult,r.destroyer_.ensureNotDestroyed(),shaka.log.v1(l,"appending init segment"),Z.yield(r.playerInterface_.mediaSourceEngine.appendBuffer(t.type,$,null,null,t.stream.closedCaptions&&0<t.stream.closedCaptions.size),5);case 5:Z.leaveTryBlock(0);break;case 2:throw z=Z.enterCatchBlock(),t.lastInitSegmentReference=null,z}})}())),U.yield(Promise.all(g),0);var $})},shaka.media.StreamingEngine.prototype.append_=function(t,i,r,o,l){var _,v,g=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?(_=shaka.media.StreamingEngine.logPrefix_(t),v=r.closedCaptions&&0<r.closedCaptions.size,null!=r.emsgSchemeIdUris&&0<r.emsgSchemeIdUris.length&&(new shaka.util.Mp4Parser).fullBox("emsg",function(P){return g.parseEMSG_(o,r.emsgSchemeIdUris,P)}).parse(l),E.yield(g.evict_(t,i),2)):3!=E.nextAddress?(g.destroyer_.ensureNotDestroyed(),shaka.log.v1(_,"appending media segment"),E.yield(g.playerInterface_.mediaSourceEngine.appendBuffer(t.type,l,o.startTime,o.endTime,v),3)):(g.destroyer_.ensureNotDestroyed(),shaka.log.v2(_,"appended media segment"),void E.jumpToEnd())})},shaka.media.StreamingEngine.prototype.parseEMSG_=function(t,i,r){if(0===r.version)var o=r.reader.readTerminatedString(),l=r.reader.readTerminatedString(),g=r.reader.readUint32(),_=r.reader.readUint32(),v=r.reader.readUint32(),E=r.reader.readUint32(),P=t.startTime+_/g;else g=r.reader.readUint32(),_=(P=r.reader.readUint64()/g+t.timestampOffset)-t.startTime,v=r.reader.readUint32(),E=r.reader.readUint32(),o=r.reader.readTerminatedString(),l=r.reader.readTerminatedString();t=r.reader.readBytes(r.reader.getLength()-r.reader.getPosition()),i.includes(o)&&("urn:mpeg:dash:event:2012"==o?this.playerInterface_.onManifestUpdate():(i=new shaka.util.FakeEvent(shaka.Player.EventName.Emsg,{detail:{startTime:P,endTime:P+v/g,schemeIdUri:o,value:l,timescale:g,presentationTimeDelta:_,eventDuration:v,id:E,messageData:t}}),this.playerInterface_.onEvent(i)))},shaka.media.StreamingEngine.prototype.evict_=function(t,i){var o,l,g,_,v,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(1==E.nextAddress)return o=shaka.media.StreamingEngine.logPrefix_(t),shaka.log.v2(o,"checking buffer length"),l=Math.max(r.config_.bufferBehind,r.manifest_.presentationTimeline.getMaxSegmentDuration()),null==(g=r.playerInterface_.mediaSourceEngine.bufferStart(t.type))?(shaka.log.v2(o,"buffer behind okay because nothing buffered:","presentationTime="+i,"bufferBehind="+l),E.return()):.01>=(v=(_=i-g)-l)?(shaka.log.v2(o,"buffer behind okay:","presentationTime="+i,"bufferedBehind="+_,"bufferBehind="+l,"underflow="+Math.abs(v)),E.return()):(shaka.log.v1(o,"buffer behind too large:","presentationTime="+i,"bufferedBehind="+_,"bufferBehind="+l,"overflow="+v),E.yield(r.playerInterface_.mediaSourceEngine.remove(t.type,g,g+v),2));r.destroyer_.ensureNotDestroyed(),shaka.log.v1(o,"evicted "+v+" seconds"),E.jumpToEnd()})},shaka.media.StreamingEngine.isEmbeddedText_=function(t){var i=shaka.util.MimeUtils,r=i.CEA608_CLOSED_CAPTION_MIMETYPE;return i=i.CEA708_CLOSED_CAPTION_MIMETYPE,t&&t.type==shaka.util.ManifestParserUtils.ContentType.TEXT&&(t.stream.mimeType==r||t.stream.mimeType==i)},shaka.media.StreamingEngine.prototype.fetch_=function(t,i,r){var l,g,_,v,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?(l=shaka.net.NetworkingEngine.RequestType.SEGMENT,g=shaka.util.Networking.createSegmentRequest(i.getUris(),i.startByte,i.endByte,o.config_.retryParameters,r),shaka.log.v2("fetching: reference=",i),_=o.playerInterface_.netEngine.request(l,g),t.operation=_,E.yield(_.promise,2)):(v=E.yieldResult,t.operation=null,E.return(v.data))})},shaka.media.StreamingEngine.prototype.clearBuffer_=function(t,i,r){var l,g,_,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(l=shaka.media.StreamingEngine.logPrefix_(t),goog.asserts.assert(!t.performingUpdate&&null==t.updateTimer,l+" unexpected call to clearBuffer_()"),t.waitingToClearBuffer=!1,t.waitingToFlushBuffer=!1,t.clearBufferSafeMargin=0,t.clearingBuffer=!0,t.lastSegmentReference=null,t.lastInitSegmentReference=null,t.segmentIterator=null,shaka.log.debug(l,"clearing buffer"),r?(g=o.playerInterface_.getPresentationTime(),_=o.playerInterface_.mediaSourceEngine.getDuration(),v.yield(o.playerInterface_.mediaSourceEngine.remove(t.type,g+r,_),3)):v.yield(o.playerInterface_.mediaSourceEngine.clear(t.type),4)):3!=v.nextAddress?(o.destroyer_.ensureNotDestroyed(),i?v.yield(o.playerInterface_.mediaSourceEngine.flush(t.type),3):v.jumpTo(3)):(o.destroyer_.ensureNotDestroyed(),shaka.log.debug(l,"cleared buffer"),t.clearingBuffer=!1,t.endOfStream=!1,o.scheduleUpdate_(t,0),void v.jumpToEnd())})},shaka.media.StreamingEngine.prototype.scheduleUpdate_=function(t,i){var r=this,o=shaka.media.StreamingEngine.logPrefix_(t),l=t.type;l!=shaka.util.ManifestParserUtils.ContentType.TEXT||this.mediaStates_.has(l)?(shaka.log.v2(o,"updating in "+i+" seconds"),goog.asserts.assert(null==t.updateTimer,o+" did not expect update to be scheduled"),t.updateTimer=new shaka.util.DelayedTick(function(){var g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_){return 1==_.nextAddress?(_.setCatchFinallyBlocks(2),_.yield(r.onUpdate_(t),4)):2!=_.nextAddress?_.leaveTryBlock(0):(g=_.enterCatchBlock(),r.playerInterface_&&r.playerInterface_.onError(g),void _.jumpToEnd())})}).tickAfter(i)):shaka.log.v1(o,"Text stream is unloaded. No update is needed.")},shaka.media.StreamingEngine.prototype.cancelUpdate_=function(t){null!=t.updateTimer&&(t.updateTimer.stop(),t.updateTimer=null)},shaka.media.StreamingEngine.prototype.abortOperations_=function(t){return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return t.operation?i.yield(t.operation.abort(),0):i.jumpTo(0)})},shaka.media.StreamingEngine.prototype.handleStreamingError_=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return r.yield(i.failureCallbackBackoff_.attempt(),2);i.destroyer_.ensureNotDestroyed(),i.playerInterface_.onError(t),t.handled||i.config_.failureCallback(t),r.jumpToEnd()})},shaka.media.StreamingEngine.logPrefix_=function(t){return"("+t.type+":"+t.stream.id+")"},shaka.media.StreamingEngine.APPEND_WINDOW_START_FUDGE_=.1,shaka.media.StreamingEngine.APPEND_WINDOW_END_FUDGE_=.01,shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_=1,shaka.routing={},shaka.routing.Walker=function(t,i,r){var o=this;this.implementation_=r,this.currentlyAt_=t,this.currentlyWith_=i,this.waitForWork_=null,this.requests_=[],this.currentStep_=this.currentRoute_=null,this.mainLoopPromise_=Promise.resolve().then(function(){return o.mainLoop_()}),this.destroyer_=new shaka.util.Destroyer(function(){return o.doDestroy_()})},shaka.routing.Walker.prototype.getCurrentPayload=function(){return this.currentlyWith_},shaka.routing.Walker.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.routing.Walker.prototype.doDestroy_=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return t.currentStep_&&t.currentStep_.abort(),t.unblockMainLoop_(),l.yield(t.mainLoopPromise_,2);for(t.currentRoute_&&t.currentRoute_.listeners.onCancel(),i=$jscomp.makeIterator(t.requests_),r=i.next();!r.done;r=i.next())r.value.listeners.onCancel();t.currentRoute_=null,t.requests_=[],t.implementation_=null,l.jumpToEnd()})},shaka.routing.Walker.prototype.startNewRoute=function(t){var i={onStart:function(){},onEnd:function(){},onCancel:function(){},onError:function(r){},onSkip:function(){},onEnter:function(){}};return this.requests_.push({create:t,listeners:i}),this.currentStep_&&this.currentStep_.abort(),this.unblockMainLoop_(),i},shaka.routing.Walker.prototype.mainLoop_=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return t.destroyer_.destroyed()?i.jumpTo(0):i.yield(t.doOneThing_(),1)})},shaka.routing.Walker.prototype.doOneThing_=function(){return this.tryNewRoute_()?Promise.resolve():this.currentRoute_?this.takeNextStep_():(goog.asserts.assert(null==this.waitForWork_,"We should not have a promise yet."),this.implementation_.onIdle(this.currentlyAt_),this.waitForWork_=new shaka.util.PublicPromise)},shaka.routing.Walker.prototype.tryNewRoute_=function(){if(goog.asserts.assert(null==this.currentStep_,"We should never have a current step between taking steps."),0==this.requests_.length||this.currentRoute_&&!this.currentRoute_.interruptible)return!1;this.currentRoute_&&(this.currentRoute_.listeners.onCancel(),this.currentRoute_=null);var t=this.requests_.shift(),i=t.create(this.currentlyWith_);return i?(t.listeners.onStart(),this.currentRoute_={node:i.node,payload:i.payload,interruptible:i.interruptible,listeners:t.listeners}):t.listeners.onSkip(),!0},shaka.routing.Walker.prototype.takeNextStep_=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){switch(o.nextAddress){case 1:return goog.asserts.assert(t.currentRoute_,"We need a current route to take the next step."),t.currentlyAt_=t.implementation_.getNext(t.currentlyAt_,t.currentlyWith_,t.currentRoute_.node,t.currentRoute_.payload),t.currentRoute_.listeners.onEnter(t.currentlyAt_),o.setCatchFinallyBlocks(2),t.currentStep_=t.implementation_.enterNode(t.currentlyAt_,t.currentlyWith_,t.currentRoute_.payload),o.yield(t.currentStep_.promise,4);case 4:t.currentStep_=null,t.currentlyAt_==t.currentRoute_.node&&(t.currentRoute_.listeners.onEnd(),t.currentRoute_=null),o.leaveTryBlock(0);break;case 2:return(i=o.enterCatchBlock()).code==shaka.util.Error.Code.OPERATION_ABORTED?(goog.asserts.assert(t.currentRoute_.interruptible,"Do not put abortable steps in non-interruptible routes!"),t.currentRoute_.listeners.onCancel()):t.currentRoute_.listeners.onError(i),t.currentRoute_=null,t.currentStep_=null,r=t,o.yield(t.implementation_.handleError(t.currentlyWith_,i),5);case 5:r.currentlyAt_=o.yieldResult,o.jumpToEnd()}})},shaka.routing.Walker.prototype.unblockMainLoop_=function(){this.waitForWork_&&(this.waitForWork_.resolve(),this.waitForWork_=null)},shaka.text.SimpleTextDisplayer=function(t){this.textTrack_=null;for(var i=$jscomp.makeIterator(Array.from(t.textTracks)),r=i.next();!r.done;r=i.next())(r=r.value).mode="disabled",r.label==shaka.Player.TextTrackLabel&&(this.textTrack_=r);this.textTrack_||(this.textTrack_=t.addTextTrack("subtitles",shaka.Player.TextTrackLabel)),this.textTrack_.mode="hidden"},shaka.text.SimpleTextDisplayer.prototype.remove=function(t,i){return!!this.textTrack_&&(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,function(r){return r.startTime<i&&r.endTime>t}),!0)},shaka.text.SimpleTextDisplayer.prototype.append=function(t){var i=function(_){var v=[],E=_.fontWeight>=shaka.text.Cue.fontWeight.BOLD,P=_.fontStyle==shaka.text.Cue.fontStyle.ITALIC,M=_.textDecoration.includes(shaka.text.Cue.textDecoration.UNDERLINE);return E&&v.push("b"),P&&v.push("i"),M&&v.push("u"),E=v.reduce(function(R,U){return R+"<"+U+">"},""),v=v.reduceRight(function(R,U){return R+"</"+U+">"},""),_.lineBreak||_.spacer?(_.spacer&&shaka.Deprecate.deprecateFeature(4,"shaka.extern.Cue","Please use lineBreak instead of spacer."),"\n"):_.nestedCues.length?_.nestedCues.map(i).join(""):E+_.payload+v},r=t.map(function(_){if(_.nestedCues.length){var v=_.clone();return v.nestedCues=[],v.payload=i(_),v}return _}),o=[];t=this.textTrack_.cues?Array.from(this.textTrack_.cues):[];for(var l={},g=(r=$jscomp.makeIterator(r)).next();!g.done;l={$jscomp$loop$prop$inCue$636:l.$jscomp$loop$prop$inCue$636},g=r.next())l.$jscomp$loop$prop$inCue$636=g.value,t.some(function(_){return function(v){return v.startTime==_.$jscomp$loop$prop$inCue$636.startTime&&v.endTime==_.$jscomp$loop$prop$inCue$636.endTime&&v.text==_.$jscomp$loop$prop$inCue$636.payload}}(l))||(g=shaka.text.SimpleTextDisplayer.convertToTextTrackCue_(l.$jscomp$loop$prop$inCue$636))&&o.push(g);for(t=o.slice().sort(function(_,v){return _.startTime!=v.startTime?_.startTime-v.startTime:_.endTime!=v.endTime?_.endTime-v.startTime:"line"in VTTCue.prototype?o.indexOf(v)-o.indexOf(_):o.indexOf(_)-o.indexOf(v)}),l=(t=$jscomp.makeIterator(t)).next();!l.done;l=t.next())this.textTrack_.addCue(l.value)},shaka.text.SimpleTextDisplayer.prototype.destroy=function(){return this.textTrack_&&(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,function(t){return!0}),this.textTrack_.mode="disabled"),this.textTrack_=null,Promise.resolve()},shaka.text.SimpleTextDisplayer.prototype.isTextVisible=function(){return"showing"==this.textTrack_.mode},shaka.text.SimpleTextDisplayer.prototype.setTextVisibility=function(t){this.textTrack_.mode=t?"showing":"hidden"},shaka.text.SimpleTextDisplayer.convertToTextTrackCue_=function(t){if(t.startTime>=t.endTime)return shaka.log.warning("Invalid cue times: "+t.startTime+" - "+t.endTime),null;var i=shaka.text.Cue,r=new VTTCue(t.startTime,t.endTime,t.payload);r.lineAlign=t.lineAlign,r.positionAlign=t.positionAlign,t.size&&(r.size=t.size);try{r.align=t.textAlign}catch(o){}return"center"==t.textAlign&&"center"!=r.align&&(r.align="middle"),t.writingMode==i.writingMode.VERTICAL_LEFT_TO_RIGHT?r.vertical="lr":t.writingMode==i.writingMode.VERTICAL_RIGHT_TO_LEFT&&(r.vertical="rl"),t.lineInterpretation==i.lineInterpretation.PERCENTAGE&&(r.snapToLines=!1),null!=t.line&&(r.line=t.line),null!=t.position&&(r.position=t.position),r},shaka.text.SimpleTextDisplayer.removeWhere_=function(t,i){var r=t.mode,o="showing"==r?"showing":"hidden";t.mode=o,goog.asserts.assert(t.cues,'Cues should be accessible when mode is set to "'+o+'".');for(var l=(o=$jscomp.makeIterator(Array.from(t.cues))).next();!l.done;l=o.next())(l=l.value)&&i(l)&&t.removeCue(l);t.mode=r},goog.exportSymbol("shaka.text.SimpleTextDisplayer",shaka.text.SimpleTextDisplayer),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"setTextVisibility",shaka.text.SimpleTextDisplayer.prototype.setTextVisibility),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"isTextVisible",shaka.text.SimpleTextDisplayer.prototype.isTextVisible),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"destroy",shaka.text.SimpleTextDisplayer.prototype.destroy),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"append",shaka.text.SimpleTextDisplayer.prototype.append),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"remove",shaka.text.SimpleTextDisplayer.prototype.remove),shaka.util.Dom=function(){},shaka.util.Dom.createHTMLElement=function(t){return document.createElement(t)},shaka.util.Dom.createButton=function(){return document.createElement("button")},shaka.util.Dom.asHTMLElement=function(t){return t},shaka.util.Dom.asHTMLMediaElement=function(t){return t},shaka.util.Dom.getElementByClassName=function(t,i){var r=i.getElementsByClassName(t);return goog.asserts.assert(1==r.length,"Should only be one element with class name "+t),shaka.util.Dom.asHTMLElement(r[0])},shaka.util.Dom.removeAllChildren=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},goog.exportSymbol("shaka.util.Dom",shaka.util.Dom),goog.exportProperty(shaka.util.Dom,"removeAllChildren",shaka.util.Dom.removeAllChildren),shaka.text.UITextDisplayer=function(t,i){var r=this;goog.asserts.assert(i,"videoContainer should be valid."),this.isTextVisible_=!1,this.cues_=[],this.video_=t,this.videoContainer_=i,this.textContainer_=shaka.util.Dom.createHTMLElement("div"),this.textContainer_.classList.add("shaka-text-container"),this.textContainer_.style.textAlign="center",this.textContainer_.style.display="flex",this.textContainer_.style.flexDirection="column",this.textContainer_.style.alignItems="center",this.textContainer_.style.justifyContent="flex-end",this.videoContainer_.appendChild(this.textContainer_),this.captionsTimer_=new shaka.util.Timer(function(){r.updateCaptions_()}).tickEvery(.25),this.currentCuesMap_=new Map},shaka.text.UITextDisplayer.prototype.append=function(t){for(var i=[].concat($jscomp.arrayFromIterable(this.cues_)),r={},o=(t=$jscomp.makeIterator(t)).next();!o.done;r={$jscomp$loop$prop$cue$638:r.$jscomp$loop$prop$cue$638},o=t.next())r.$jscomp$loop$prop$cue$638=o.value,i.some(function(l){return function(g){return shaka.text.Cue.equal(g,l.$jscomp$loop$prop$cue$638)}}(r))||this.cues_.push(r.$jscomp$loop$prop$cue$638);this.updateCaptions_()},shaka.text.UITextDisplayer.prototype.destroy=function(){this.videoContainer_.removeChild(this.textContainer_),this.textContainer_=null,this.isTextVisible_=!1,this.cues_=[],this.captionsTimer_&&this.captionsTimer_.stop(),this.currentCuesMap_.clear()},shaka.text.UITextDisplayer.prototype.remove=function(t,i){return!!this.textContainer_&&(this.cues_=this.cues_.filter(function(r){return r.startTime<t||r.endTime>=i}),this.updateCaptions_(),!0)},shaka.text.UITextDisplayer.prototype.isTextVisible=function(){return this.isTextVisible_},shaka.text.UITextDisplayer.prototype.setTextVisibility=function(t){this.isTextVisible_=t},shaka.text.UITextDisplayer.prototype.updateCaptions_=function(){for(var t=this,i=this.video_.currentTime,r=function(_){return t.cues_.includes(_)&&t.isTextVisible_&&_.startTime<=i&&_.endTime>i},o=$jscomp.makeIterator(this.currentCuesMap_.keys()),l=o.next();!l.done;l=o.next())if(!r(l=l.value)){var g=this.currentCuesMap_.get(l);this.textContainer_.removeChild(g),this.currentCuesMap_.delete(l)}for(o=new Set(this.currentCuesMap_.values()),g=(l=$jscomp.makeIterator(Array.from(this.textContainer_.childNodes))).next();!g.done;g=l.next())o.has(g=g.value)||this.textContainer_.removeChild(g);for(o=this.cues_.filter(function(_){return r(_)&&!t.currentCuesMap_.has(_)}).sort(function(_,v){return _.startTime!=v.startTime?_.startTime-v.startTime:_.endTime-v.endTime}),l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next())g=this.displayCue_(this.textContainer_,l=l.value,!1),this.currentCuesMap_.set(l,g)},shaka.text.UITextDisplayer.prototype.displayCue_=function(t,i,r){var o=r?"span":"div";(i.lineBreak||i.spacer)&&(i.spacer&&shaka.Deprecate.deprecateFeature(4,"shaka.extern.Cue","Please use lineBreak instead of spacer."),o="br");var l=shaka.util.Dom.createHTMLElement(o);if("br"!=o)for(this.setCaptionStyles_(l,i,r),r=(i=$jscomp.makeIterator(i.nestedCues)).next();!r.done;r=i.next())this.displayCue_(l,r.value,!0);return t.appendChild(l),l},shaka.text.UITextDisplayer.prototype.setCaptionStyles_=function(t,i,r){var o=shaka.text.Cue,l=t.style,g=0==i.nestedCues.length;l.whiteSpace="pre-wrap";var _=i.payload.replace(/\s+$/g,function(v){return"\xa0".repeat(v.length)});r?t.textContent=_:_.length&&((l=shaka.util.Dom.createHTMLElement("span")).textContent=_,t.appendChild(l),l=l.style),l.backgroundColor=i.backgroundColor,l.border=i.border,l.color=i.color,l.direction=i.direction,l.opacity=i.opacity,l.paddingLeft=shaka.text.UITextDisplayer.convertLengthValue_(i.linePadding,i,this.videoContainer_),l.paddingRight=shaka.text.UITextDisplayer.convertLengthValue_(i.linePadding,i,this.videoContainer_),i.backgroundImage&&(l.backgroundImage="url('"+i.backgroundImage+"')",l.backgroundRepeat="no-repeat",l.backgroundSize="contain",l.backgroundPosition="center",""==i.backgroundColor&&(l.backgroundColor="transparent")),l.verticalAlign=i.displayAlign==o.displayAlign.BEFORE?"top":i.displayAlign==o.displayAlign.CENTER?"middle":"bottom",g||(l.margin="0"),l.fontFamily=i.fontFamily,l.fontWeight=i.fontWeight.toString(),l.fontStyle=i.fontStyle,l.letterSpacing=i.letterSpacing,l.fontSize=shaka.text.UITextDisplayer.convertLengthValue_(i.fontSize,i,this.videoContainer_),i.line?i.lineInterpretation==o.lineInterpretation.PERCENTAGE&&(l.position="absolute",i.writingMode==o.writingMode.HORIZONTAL_TOP_TO_BOTTOM?i.lineAlign==o.lineAlign.START?l.top=i.line+"%":i.lineAlign==o.lineAlign.END&&(l.bottom=i.line+"%"):i.writingMode==o.writingMode.VERTICAL_LEFT_TO_RIGHT?i.lineAlign==o.lineAlign.START?l.left=i.line+"%":i.lineAlign==o.lineAlign.END&&(l.right=i.line+"%"):i.lineAlign==o.lineAlign.START?l.right=i.line+"%":i.lineAlign==o.lineAlign.END&&(l.left=i.line+"%")):i.region&&i.region.id&&(!r&&!g||i.backgroundImage)&&(r=i.region.widthUnits==(t=shaka.text.CueRegion.units.PERCENTAGE)?"%":"px",g=i.region.viewportAnchorUnits==t?"%":"px",l.height=i.region.height+(i.region.heightUnits==t?"%":"px"),l.width=i.region.width+r,l.position="absolute",l.top=i.region.viewportAnchorY+g,l.left=i.region.viewportAnchorX+g),l.lineHeight=i.lineHeight,i.position&&(i.writingMode==o.writingMode.HORIZONTAL_TOP_TO_BOTTOM?l.paddingLeft=i.position:l.paddingTop=i.position),i.positionAlign==o.positionAlign.LEFT?l.cssFloat="left":i.positionAlign==o.positionAlign.RIGHT&&(l.cssFloat="right"),l.textAlign=i.textAlign,l.textDecoration=i.textDecoration.join(" "),l.writingMode=i.writingMode,"writingMode"in document.documentElement.style&&l.writingMode==i.writingMode||(l.webkitWritingMode=i.writingMode),i.size&&(i.writingMode==o.writingMode.HORIZONTAL_TOP_TO_BOTTOM?l.width=i.size+"%":l.height=i.size+"%")},shaka.text.UITextDisplayer.getLengthValueInfo_=function(t){return(t=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(t))?{value:Number(t[1]),unit:t[2]}:null},shaka.text.UITextDisplayer.convertLengthValue_=function(t,i,r){var o=shaka.text.UITextDisplayer.getLengthValueInfo_(t);if(!o)return t;var l=o.value;switch(o.unit){case"%":return shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_(l/100,i,r);case"c":return shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_(l,i,r);default:return t}},shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_=function(t,i,r){return r.clientHeight*t/i.cellResolution.rows+"px"},goog.exportSymbol("shaka.text.UITextDisplayer",shaka.text.UITextDisplayer),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"setTextVisibility",shaka.text.UITextDisplayer.prototype.setTextVisibility),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"isTextVisible",shaka.text.UITextDisplayer.prototype.isTextVisible),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"remove",shaka.text.UITextDisplayer.prototype.remove),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"destroy",shaka.text.UITextDisplayer.prototype.destroy),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"append",shaka.text.UITextDisplayer.prototype.append),shaka.text.WebVttGenerator=function(){},shaka.text.WebVttGenerator.convert=function(t){var i=function(g){var _=[],v=g.fontWeight>=shaka.text.Cue.fontWeight.BOLD,E=g.fontStyle==shaka.text.Cue.fontStyle.ITALIC,P=g.textDecoration.includes(shaka.text.Cue.textDecoration.UNDERLINE);return v&&_.push("b"),E&&_.push("i"),P&&_.push("u"),v=_.reduce(function(M,R){return M+"<"+R+">"},""),_=_.reduceRight(function(M,R){return M+"</"+R+">"},""),g.lineBreak||g.spacer?(g.spacer&&shaka.Deprecate.deprecateFeature(4,"shaka.text.Cue","Please use lineBreak instead of spacer."),"\n"):g.nestedCues.length?g.nestedCues.map(i).join(""):v+g.payload+_},r=t.map(function(g){if(g.nestedCues.length){var _=g.clone();return _.nestedCues=[],_.payload=i(g),_}return g});t="WEBVTT\n\n";for(var o=(r=$jscomp.makeIterator(r)).next();!o.done;o=r.next()){var l=function(g){var _=Math.floor(g/3600),v=Math.floor(g/60%60),E=Math.floor(g%60);return(10>_?"0":"")+_+":"+(10>v?"0":"")+v+":"+(10>E?"0":"")+E+"."+(100>(g=Math.floor(1e3*g%1e3))?10>g?"00":"0":"")+g};t+=l((o=o.value).startTime)+" --\x3e "+l(o.endTime)+"\n",t+=o.payload+"\n\n"}return t},goog.exportSymbol("shaka.text.WebVttGenerator",shaka.text.WebVttGenerator),shaka.util.ConfigUtils=function(){},shaka.util.ConfigUtils.mergeConfigObjects=function(t,i,r,o,l){goog.asserts.assert(t,"Destination config must not be null!");var v,g=l in o,_=!0;for(v in i){var E=l+"."+v,P=g?o[l]:r[v];g||v in r?void 0===i[v]?void 0===P||g?delete t[v]:t[v]=shaka.util.ObjectUtils.cloneObject(P):P.constructor==Object&&i[v]&&i[v].constructor==Object?(t[v]||(t[v]=shaka.util.ObjectUtils.cloneObject(P)),E=shaka.util.ConfigUtils.mergeConfigObjects(t[v],i[v],P,o,E),_=_&&E):typeof i[v]!=typeof P||null==i[v]||"function"!=typeof i[v]&&i[v].constructor!=P.constructor?(shaka.log.alwaysError("Invalid config, wrong type for "+E),_=!1):("function"==typeof r[v]&&r[v].length!=i[v].length&&shaka.log.alwaysWarn("Unexpected number of arguments for "+E),t[v]=i[v]):(shaka.log.alwaysError("Invalid config, unrecognized key "+E),_=!1)}return _},shaka.util.ConfigUtils.convertToConfigObject=function(t,i){for(var r={},o=r,l=0,g=0;!(0>(l=t.indexOf(".",l)));)(0==l||"\\"!=t[l-1])&&(o[g=t.substring(g,l).replace(/\\\./g,".")]={},o=o[g],g=l+1),l+=1;return o[t.substring(g).replace(/\\\./g,".")]=i,r},goog.exportSymbol("shaka.util.ConfigUtils",shaka.util.ConfigUtils),goog.exportProperty(shaka.util.ConfigUtils,"convertToConfigObject",shaka.util.ConfigUtils.convertToConfigObject),goog.exportProperty(shaka.util.ConfigUtils,"mergeConfigObjects",shaka.util.ConfigUtils.mergeConfigObjects),shaka.util.PlayerConfiguration=function(){},shaka.util.PlayerConfiguration.createDefault=function(){var t=1/0;navigator.connection&&navigator.connection.saveData&&(t=360);var i={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:shaka.media.DrmEngine.defaultInitDataTransform,logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[]},r={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"}},hls:{ignoreTextStreamFailures:!1,useFullSegmentsForStartTime:!1}},o={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),failureCallback:function(_){return shaka.log.error("Unhandled streaming error",_),[_]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTPS:!1,preferNativeHls:!1};(shaka.util.Platform.isLegacyEdge()||shaka.util.Platform.isTizen()||shaka.util.Platform.isChromecast())&&(o.gapDetectionThreshold=.5),(shaka.util.Platform.isWebOS()||shaka.util.Platform.isTizen()||shaka.util.Platform.isChromecast())&&(o.stallSkip=0);var l={trackSelectionCallback:function(_){return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return v.return(_)})},downloadSizeCallback:function(_){var v;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?navigator.storage&&navigator.storage.estimate?E.yield(navigator.storage.estimate(),3):E.return(!0):E.return((v=E.yieldResult).usage+_<.95*v.quota)})},progressCallback:function(_,v){return[_,v]},usePersistentLicense:!0},g={drm:i,manifest:r,streaming:o,offline:l,abrFactory:function(){return new shaka.abr.SimpleAbrManager},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferForcedSubs:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,useMediaCapabilities:!0,textDisplayFactory:function(){return null}};return l.trackSelectionCallback=function(_){return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return v.return(shaka.util.PlayerConfiguration.defaultTrackSelect(_,g.preferredAudioLanguage))})},g},shaka.util.PlayerConfiguration.mergeConfigObjects=function(t,i,r){var o={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:""}};return shaka.util.ConfigUtils.mergeConfigObjects(t,i,r||shaka.util.PlayerConfiguration.createDefault(),o,"")},shaka.util.PlayerConfiguration.defaultTrackSelect=function(t,i){var r=shaka.util.ManifestParserUtils.ContentType,o=shaka.util.LanguageUtils,l=t.filter(function(P){return"variant"==P.type}),g=[],_=o.findClosestLocale(i,l.map(function(P){return P.language}));_&&(g=l.filter(function(P){return o.normalize(P.language)==_})),0==g.length&&(g=l.filter(function(P){return P.primary})),0==g.length&&(1<new Set(l.map(function(P){return P.language})).size&&shaka.log.warning("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),g=l);var v=g.filter(function(P){return P.height&&480>=P.height});if(v.length&&(v.sort(function(P,M){return goog.asserts.assert(null!=P.height,"Null height"),goog.asserts.assert(null!=M.height,"Null height"),M.height-P.height}),g=v.filter(function(P){return P.height==v[0].height})),l=[],g.length){var E=Math.floor(g.length/2);g.sort(function(P,M){return P.bandwidth-M.bandwidth}),l.push(g[E])}for(E=(g=$jscomp.makeIterator(t)).next();!E.done;E=g.next())(E=E.value).type!=r.TEXT&&E.type!=r.IMAGE||l.push(E);return l},goog.exportSymbol("shaka.util.PlayerConfiguration",shaka.util.PlayerConfiguration),goog.exportProperty(shaka.util.PlayerConfiguration,"mergeConfigObjects",shaka.util.PlayerConfiguration.mergeConfigObjects),shaka.util.StateHistory=function(){this.open_=null,this.closed_=[]},shaka.util.StateHistory.prototype.update=function(t){null==this.open_?this.start_(t):this.update_(t)},shaka.util.StateHistory.prototype.getTimeSpentIn=function(t){var i=0;this.open_&&this.open_.state==t&&(i+=this.open_.duration);for(var r=$jscomp.makeIterator(this.closed_),o=r.next();!o.done;o=r.next())i+=(o=o.value).state==t?o.duration:0;return i},shaka.util.StateHistory.prototype.getCopy=function(){for(var t=function(l){return{timestamp:l.timestamp,state:l.state,duration:l.duration}},i=[],r=$jscomp.makeIterator(this.closed_),o=r.next();!o.done;o=r.next())i.push(t(o.value));return this.open_&&i.push(t(this.open_)),i},shaka.util.StateHistory.prototype.start_=function(t){goog.asserts.assert(null==this.open_,"There must be no open entry in order when we start"),shaka.log.v1("Changing Player state to",t),this.open_={timestamp:this.getNowInSeconds_(),state:t,duration:0}},shaka.util.StateHistory.prototype.update_=function(t){goog.asserts.assert(this.open_,"There must be an open entry in order to update it");var i=this.getNowInSeconds_();this.open_.duration=i-this.open_.timestamp,this.open_.state!=t&&(shaka.log.v1("Changing Player state to",t),this.closed_.push(this.open_),this.open_={timestamp:i,state:t,duration:0})},shaka.util.StateHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory=function(){this.currentText_=this.currentVariant_=null,this.history_=[]},shaka.util.SwitchHistory.prototype.updateCurrentVariant=function(t,i){this.currentVariant_!=t&&(this.currentVariant_=t,this.history_.push({timestamp:this.getNowInSeconds_(),id:t.id,type:"variant",fromAdaptation:i,bandwidth:t.bandwidth}))},shaka.util.SwitchHistory.prototype.updateCurrentText=function(t,i){this.currentText_!=t&&(this.currentText_=t,this.history_.push({timestamp:this.getNowInSeconds_(),id:t.id,type:"text",fromAdaptation:i,bandwidth:null}))},shaka.util.SwitchHistory.prototype.getCopy=function(){for(var t=[],i=$jscomp.makeIterator(this.history_),r=i.next();!r.done;r=i.next())t.push(this.clone_(r.value));return t},shaka.util.SwitchHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory.prototype.clone_=function(t){return{timestamp:t.timestamp,id:t.id,type:t.type,fromAdaptation:t.fromAdaptation,bandwidth:t.bandwidth}},shaka.util.Stats=function(){this.bandwidthEstimate_=this.currentStreamBandwidth_=this.maxSegmentDurationSeconds_=this.liveLatencySeconds_=this.licenseTimeSeconds_=this.drmTimeSeconds_=this.manifestTimeSeconds_=this.loadLatencySeconds_=this.completionPercent_=this.totalCorruptedFrames_=this.totalDecodedFrames_=this.totalDroppedFrames_=this.height_=this.width_=NaN,this.stateHistory_=new shaka.util.StateHistory,this.switchHistory_=new shaka.util.SwitchHistory},shaka.util.Stats.prototype.setDroppedFrames=function(t,i){this.totalDroppedFrames_=t,this.totalDecodedFrames_=i},shaka.util.Stats.prototype.setCorruptedFrames=function(t){this.totalCorruptedFrames_=t},shaka.util.Stats.prototype.setResolution=function(t,i){this.width_=t,this.height_=i},shaka.util.Stats.prototype.setLoadLatency=function(t){this.loadLatencySeconds_=t},shaka.util.Stats.prototype.setManifestTime=function(t){this.manifestTimeSeconds_=t},shaka.util.Stats.prototype.setCompletionPercent=function(t){this.completionPercent_=isNaN(this.completionPercent_)?t:Math.max(this.completionPercent_,t)},shaka.util.Stats.prototype.setDrmTime=function(t){this.drmTimeSeconds_=t},shaka.util.Stats.prototype.setLicenseTime=function(t){this.licenseTimeSeconds_=t},shaka.util.Stats.prototype.setLiveLatency=function(t){this.liveLatencySeconds_=t},shaka.util.Stats.prototype.setMaxSegmentDuration=function(t){this.maxSegmentDurationSeconds_=t},shaka.util.Stats.prototype.setCurrentStreamBandwidth=function(t){this.currentStreamBandwidth_=t},shaka.util.Stats.prototype.setBandwidthEstimate=function(t){this.bandwidthEstimate_=t},shaka.util.Stats.prototype.getStateHistory=function(){return this.stateHistory_},shaka.util.Stats.prototype.getSwitchHistory=function(){return this.switchHistory_},shaka.util.Stats.prototype.getBlob=function(){return{width:this.width_,height:this.height_,streamBandwidth:this.currentStreamBandwidth_,decodedFrames:this.totalDecodedFrames_,droppedFrames:this.totalDroppedFrames_,corruptedFrames:this.totalCorruptedFrames_,estimatedBandwidth:this.bandwidthEstimate_,completionPercent:this.completionPercent_,loadLatency:this.loadLatencySeconds_,manifestTimeSeconds:this.manifestTimeSeconds_,drmTimeSeconds:this.drmTimeSeconds_,playTime:this.stateHistory_.getTimeSpentIn("playing"),pauseTime:this.stateHistory_.getTimeSpentIn("paused"),bufferingTime:this.stateHistory_.getTimeSpentIn("buffering"),licenseTime:this.licenseTimeSeconds_,liveLatency:this.liveLatencySeconds_,maxSegmentDuration:this.maxSegmentDurationSeconds_,stateHistory:this.stateHistory_.getCopy(),switchHistory:this.switchHistory_.getCopy()}},shaka.util.Stats.getEmptyBlob=function(){return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,switchHistory:[],stateHistory:[]}},shaka.Player=function(t,i){shaka.util.FakeEventTarget.call(this);var r=this;this.loadMode_=shaka.Player.LoadMode.NOT_LOADED,this.videoContainer_=this.video_=null,this.isTextVisible_=!1,this.eventManager_=new shaka.util.EventManager,this.abrManagerFactory_=this.abrManager_=this.assetUri_=this.manifest_=this.parserFactory_=this.parser_=this.streamingEngine_=this.regionTimeline_=this.bufferObserver_=this.bufferPoller_=this.playRateController_=this.playheadObservers_=this.playhead_=this.mediaSourceEngine_=this.drmEngine_=this.networkingEngine_=null,this.nextExternalStreamId_=1e9,this.config_=this.defaultConfig_(),this.maxHwRes_={width:1/0,height:1/0},this.stats_=null,this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(this.config_.preferredAudioLanguage,this.config_.preferredVariantRole,this.config_.preferredAudioChannelCount),this.currentTextLanguage_=this.config_.preferredTextLanguage,this.currentTextRole_=this.config_.preferredTextRole,this.currentTextForced_=this.config_.preferForcedSubs,this.cleanupOnUnload_=[],i&&i(this),this.networkingEngine_=this.createNetworkingEngine(),this.networkingEngine_.setForceHTTPS(this.config_.streaming.forceHTTPS),this.adManager_=null,shaka.Player.adManagerFactory_&&(this.adManager_=shaka.util.Functional.callFactory(shaka.Player.adManagerFactory_)),this.eventManager_.listen(window,"online",function(){r.retryStreaming()}),this.detachNode_={name:"detach"},this.attachNode_={name:"attach"},this.unloadNode_={name:"unload"},this.parserNode_={name:"manifest-parser"},this.manifestNode_={name:"manifest"},this.mediaSourceNode_={name:"media-source"},this.drmNode_={name:"drm-engine"},this.loadNode_={name:"load"},this.srcEqualsDrmNode_={name:"src-equals-drm-engine"},this.srcEqualsNode_={name:"src-equals"};var o=shaka.util.AbortableOperation,l=new Map;l.set(this.attachNode_,function(g,_){return o.notAbortable(r.onAttach_(g,_))}),l.set(this.detachNode_,function(g,_){return o.notAbortable(r.onDetach_(g,_))}),l.set(this.unloadNode_,function(g,_){return o.notAbortable(r.onUnload_(g,_))}),l.set(this.mediaSourceNode_,function(g,_){var v=r.onInitializeMediaSourceEngine_(g,_);return o.notAbortable(v)}),l.set(this.parserNode_,function(g,_){var v=r.onInitializeParser_(g,_);return o.notAbortable(v)}),l.set(this.manifestNode_,function(g,_){return r.onParseManifest_(g,_)}),l.set(this.drmNode_,function(g,_){var v=r.onInitializeDrm_(g,_);return o.notAbortable(v)}),l.set(this.loadNode_,function(g,_){return o.notAbortable(r.onLoad_(g,_))}),l.set(this.srcEqualsDrmNode_,function(g,_){var v=r.onInitializeSrcEqualsDrm_(g,_);return o.notAbortable(v)}),l.set(this.srcEqualsNode_,function(g,_){return r.onSrcEquals_(g,_)}),this.walker_=new shaka.routing.Walker(this.detachNode_,shaka.Player.createEmptyPayload_(),{getNext:function(g,_,v,E){return r.getNextStep_(g,_,v,E)},enterNode:function(g,_,v){return r.dispatchEvent(r.makeEvent_(shaka.Player.EventName.OnStateChange,{state:g.name})),l.get(g)(_,v)},handleError:function(g,_){return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(shaka.log.warning("The walker saw an error:"),_ instanceof shaka.util.Error?shaka.log.warning("Error Code:",_.code):(shaka.log.warning("Error Message:",_.message),shaka.log.warning("Error Stack:",_.stack)),v.yield(r.onUnload_(g,shaka.Player.createEmptyPayload_()),2)):v.return(g.mediaElement?r.attachNode_:r.detachNode_)})},onIdle:function(g){r.dispatchEvent(r.makeEvent_(shaka.Player.EventName.OnStateIdle,{state:g.name}))}}),t&&this.attach(t,!0)},$jscomp.inherits(shaka.Player,shaka.util.FakeEventTarget),shaka.Player.prototype.makeEvent_=function(t,i){return new shaka.util.FakeEvent(t,i)},shaka.Player.prototype.destroy=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:return t.loadMode_==shaka.Player.LoadMode.DESTROYED?r.return():(t.loadMode_=shaka.Player.LoadMode.DESTROYED,i=t.walker_.startNewRoute(function(o){return{node:t.detachNode_,payload:shaka.Player.createEmptyPayload_(),interruptible:!1}}),r.yield(new Promise(function(o){i.onStart=function(){shaka.log.info("Preparing to destroy walker...")},i.onEnd=function(){o()},i.onCancel=function(){goog.asserts.assert(!1,"Our final detach call should never be cancelled."),o()},i.onError=function(){goog.asserts.assert(!1,"Our final detach call should never see an error"),o()},i.onSkip=function(){goog.asserts.assert(!1,"Our final detach call should never be skipped"),o()}}),2));case 2:return r.yield(t.walker_.destroy(),3);case 3:if(t.eventManager_&&(t.eventManager_.release(),t.eventManager_=null),t.abrManagerFactory_=null,t.abrManager_=null,t.config_=null,t.stats_=null,t.videoContainer_=null,!t.networkingEngine_){r.jumpTo(0);break}return r.yield(t.networkingEngine_.destroy(),5);case 5:t.networkingEngine_=null,r.jumpToEnd()}})},shaka.Player.registerSupportPlugin=function(t,i){shaka.Player.supportPlugins_[t]=i},shaka.Player.setAdManagerFactory=function(t){shaka.Player.adManagerFactory_=t},shaka.Player.isBrowserSupported=function(){if(window.Promise||shaka.log.alwaysWarn("A Promise implementation or polyfill is required"),window.TextDecoder&&window.TextEncoder||shaka.log.alwaysWarn("A TextDecoder/TextEncoder implementation or polyfill is required"),!(window.Promise&&window.Uint8Array&&window.TextDecoder&&window.TextEncoder&&Array.prototype.forEach)||shaka.util.Platform.isIE())return!1;var t=shaka.util.Platform.safariVersion();return!(t&&12>t||!shaka.media.DrmEngine.isBrowserSupported())&&(!!shaka.util.Platform.supportsMediaSource()||shaka.util.Platform.supportsMediaType("application/x-mpegurl"))},shaka.Player.probeSupport=function(t){var i,r,o,l,g,_;return t=void 0===t||t,$jscomp.asyncExecutePromiseGeneratorProgram(function(v){if(1==v.nextAddress)return goog.asserts.assert(shaka.Player.isBrowserSupported(),"Must have basic support"),i={},t?v.yield(shaka.media.DrmEngine.probeSupport(),3):v.jumpTo(2);for(_ in 2!=v.nextAddress&&(i=v.yieldResult),r=shaka.media.ManifestParser.probeSupport(),o=shaka.media.MediaSourceEngine.probeSupport(),l={manifest:r,media:o,drm:i},g=shaka.Player.supportPlugins_)l[_]=g[_]();return v.return(l)})},shaka.Player.prototype.attach=function(t,i){if(i=void 0===i||i,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var r=shaka.Player.createEmptyPayload_();r.mediaElement=t,shaka.util.Platform.supportsMediaSource()||(i=!1);var o=i?this.mediaSourceNode_:this.attachNode_,l=this.walker_.startNewRoute(function(g){return{node:o,payload:r,interruptible:!1}});return l.onStart=function(){return shaka.log.info("Starting attach...")},this.wrapWalkerListenersWithPromise_(l)},shaka.Player.prototype.detach=function(){var t=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var i=this.walker_.startNewRoute(function(r){return{node:t.detachNode_,payload:shaka.Player.createEmptyPayload_(),interruptible:!1}});return i.onStart=function(){return shaka.log.info("Starting detach...")},this.wrapWalkerListenersWithPromise_(i)},shaka.Player.prototype.unload=function(t){var i=this;if(t=void 0===t||t,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());shaka.util.Platform.supportsMediaSource()||(t=!1);var r=shaka.Player.createEmptyPayload_(),o=this.walker_.startNewRoute(function(l){var g=l.mediaElement&&t?i.mediaSourceNode_:l.mediaElement?i.attachNode_:i.detachNode_;return goog.asserts.assert(g,"We should have picked a destination."),r.mediaElement=l.mediaElement,{node:g,payload:r,interruptible:!1}});return o.onStart=function(){return shaka.log.info("Starting unload...")},this.wrapWalkerListenersWithPromise_(o)},shaka.Player.prototype.load=function(t,i,r){var o=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Loading));var l=shaka.Player.createEmptyPayload_();l.uri=t,l.startTimeOfLoad=Date.now()/1e3,r&&(l.mimeType=r),void 0!==i&&(l.startTime=i);var g=this.shouldUseSrcEquals_(l)?this.srcEqualsNode_:this.loadNode_,_=this.walker_.startNewRoute(function(v){return null==v.mediaElement?null:(l.mediaElement=v.mediaElement,{node:g,payload:l,interruptible:!0})});return this.stats_=new shaka.util.Stats,_.onStart=function(){return shaka.log.info("Starting load of "+t+"...")},new Promise(function(v,E){_.onSkip=function(){return E(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.NO_VIDEO_ELEMENT))},_.onEnd=function(){v(),o.dispatchEvent(o.makeEvent_(shaka.Player.EventName.Loaded))},_.onCancel=function(){return E(o.createAbortLoadError_())},_.onError=function(P){return E(P)}})},shaka.Player.prototype.shouldUseSrcEquals_=function(t){var i=shaka.util.Platform;if(!i.supportsMediaSource())return!0;var r=t.mimeType,o=t.uri||"";if(r||(r=shaka.media.ManifestParser.getExtension(o),r=shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_[r]),r){if(!(t=""!=(t.mediaElement||i.anyMediaElement()).canPlayType(r)))return!1;if(!(o=shaka.media.ManifestParser.isSupported(o,r))||(goog.asserts.assert(t&&o,"Both native and MSE playback should be possible!"),this.config_.streaming.preferNativeHls))return!0;if(i.isApple())return this.config_.streaming.useNativeHlsOnSafari}return!1},shaka.Player.prototype.onAttach_=function(t,i){var r=this;return goog.asserts.assert(null==t.mediaElement||t.mediaElement==i.mediaElement,"The routing logic failed. MediaElement requirement failed."),null==t.mediaElement&&(t.mediaElement=i.mediaElement,this.eventManager_.listen(t.mediaElement,"error",function(o){return r.onVideoError_(o)})),this.video_=t.mediaElement,Promise.resolve()},shaka.Player.prototype.onDetach_=function(t,i){return t.mediaElement&&(this.eventManager_.unlisten(t.mediaElement,"error"),t.mediaElement=null),this.video_=null,Promise.resolve()},shaka.Player.prototype.onUnload_=function(t,i){var o,l,g,_,v,E,P,M,R,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){switch(U.nextAddress){case 1:return r.loadMode_!=shaka.Player.LoadMode.DESTROYED&&(r.loadMode_=shaka.Player.LoadMode.NOT_LOADED),o=r.cleanupOnUnload_.map(function($){return $()}),r.cleanupOnUnload_=[],U.yield(Promise.all(o),2);case 2:if(r.dispatchEvent(r.makeEvent_(shaka.Player.EventName.Unloading)),t.mimeType=null,t.startTime=null,t.uri=null,t.mediaElement&&(r.eventManager_.unlisten(t.mediaElement,"loadedmetadata"),r.eventManager_.unlisten(t.mediaElement,"playing"),r.eventManager_.unlisten(t.mediaElement,"pause"),r.eventManager_.unlisten(t.mediaElement,"ended"),r.eventManager_.unlisten(t.mediaElement,"ratechange")),r.playheadObservers_&&(r.playheadObservers_.release(),r.playheadObservers_=null),r.bufferPoller_&&(r.bufferPoller_.stop(),r.bufferPoller_=null),!r.parser_){U.jumpTo(3);break}return U.yield(r.parser_.stop(),4);case 4:r.parser_=null,r.parserFactory_=null;case 3:if(!r.abrManager_){U.jumpTo(5);break}return U.yield(r.abrManager_.stop(),5);case 5:if(!r.streamingEngine_){U.jumpTo(7);break}return U.yield(r.streamingEngine_.destroy(),8);case 8:r.streamingEngine_=null;case 7:if(r.playRateController_&&(r.playRateController_.release(),r.playRateController_=null),r.playhead_&&(r.playhead_.release(),r.playhead_=null),!r.mediaSourceEngine_){U.jumpTo(9);break}return U.yield(r.mediaSourceEngine_.destroy(),10);case 10:r.mediaSourceEngine_=null;case 9:if(r.adManager_&&r.adManager_.onAssetUnload(),!t.mediaElement||!t.mediaElement.src){U.jumpTo(11);break}return U.yield(new Promise(function($){return new shaka.util.Timer($).tickAfter(.1)}),12);case 12:for(t.mediaElement.removeAttribute("src"),t.mediaElement.load();t.mediaElement.lastChild;)t.mediaElement.removeChild(t.mediaElement.firstChild);case 11:if(!r.drmEngine_){U.jumpTo(13);break}return U.yield(r.drmEngine_.destroy(),14);case 14:r.drmEngine_=null;case 13:if(r.assetUri_=null,r.bufferObserver_=null,r.manifest_){for(l=$jscomp.makeIterator(r.manifest_.variants),g=l.next();!g.done;g=l.next())for(v=$jscomp.makeIterator([(_=g.value).audio,_.video]),E=v.next();!E.done;E=v.next())(P=E.value)&&P.segmentIndex&&P.segmentIndex.release();for(M=$jscomp.makeIterator(r.manifest_.textStreams),E=M.next();!E.done;E=M.next())(R=E.value).segmentIndex&&R.segmentIndex.release()}r.manifest_=null,r.stats_=new shaka.util.Stats,r.lastTextFactory_=null,r.updateBufferState_(),U.jumpToEnd()}})},shaka.Player.prototype.onInitializeMediaSourceEngine_=function(t,i){var o,l,g,_,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){if(1==v.nextAddress)return goog.asserts.assert(shaka.util.Platform.supportsMediaSource(),"We should not be initializing media source on a platform that does not support media source."),goog.asserts.assert(t.mediaElement,"We should have a media element when initializing media source."),goog.asserts.assert(t.mediaElement==i.mediaElement,"|has| and |wants| should have the same media element when initializing media source."),goog.asserts.assert(null==r.mediaSourceEngine_,"We should not have a media source engine yet."),o=new shaka.media.ClosedCaptionParser,g=shaka.util.Functional.callFactory(l=r.config_.textDisplayFactory),r.lastTextFactory_=l,_=r.createMediaSourceEngine(t.mediaElement,o,g,function(E,P,M){r.processTimedMetadataMediaSrc_(E,P,M)}),v.yield(_.open(),2);r.mediaSourceEngine_=_,v.jumpToEnd()})},shaka.Player.prototype.onInitializeParser_=function(t,i){var o,l,g,_,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){if(1==v.nextAddress)return goog.asserts.assert(t.mediaElement,"We should have a media element when initializing the parser."),goog.asserts.assert(t.mediaElement==i.mediaElement,"|has| and |wants| should have the same media element when initializing the parser."),goog.asserts.assert(r.networkingEngine_,"Need networking engine when initializing the parser."),goog.asserts.assert(r.config_,"Need player config when initializing the parser."),t.mimeType=i.mimeType,t.uri=i.uri,goog.asserts.assert(t.uri,"We should have an asset uri when initializing the parsing."),l=r.networkingEngine_,r.assetUri_=o=t.uri,g=r,v.yield(shaka.media.ManifestParser.getFactory(o,l,r.config_.manifest.retryParameters,t.mimeType),2);g.parserFactory_=v.yieldResult,goog.asserts.assert(r.parserFactory_,"Must have manifest parser"),r.parser_=shaka.util.Functional.callFactory(r.parserFactory_),_=shaka.util.ObjectUtils.cloneObject(r.config_.manifest),i.mediaElement&&"AUDIO"===i.mediaElement.nodeName&&(_.disableVideo=!0),r.parser_.configure(_),v.jumpToEnd()})},shaka.Player.prototype.onParseManifest_=function(t,i){var r=this;goog.asserts.assert(t.mimeType==i.mimeType,"|has| and |wants| should have the same mime type when parsing."),goog.asserts.assert(t.uri==i.uri,"|has| and |wants| should have the same uri when parsing."),goog.asserts.assert(t.uri,"|has| should have a valid uri when parsing."),goog.asserts.assert(t.uri==this.assetUri_,"|has.uri| should match the cached asset uri."),goog.asserts.assert(this.networkingEngine_,"Need networking engine to parse manifest."),goog.asserts.assert(this.config_,"Need player config to parse manifest."),goog.asserts.assert(this.parser_,"|this.parser_| should have been set in an earlier step.");var o=t.uri,l=this.networkingEngine_;this.regionTimeline_=new shaka.media.RegionTimeline(function(){return r.seekRange()}),this.regionTimeline_.setListeners(function(v){r.onRegionEvent_(shaka.Player.EventName.TimelineRegionAdded,v),r.adManager_&&r.adManager_.onDashTimedMetadata(v)});var v,E,P,g={networkingEngine:l,filter:function(v){return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return E.return(r.filterManifest_(v))})},makeTextStreamsForClosedCaptions:function(v){return r.makeTextStreamsForClosedCaptions_(v)},onTimelineRegionAdded:function(v){return r.regionTimeline_.addRegion(v)},onEvent:function(v){return r.dispatchEvent(v)},onError:function(v){return r.onError_(v)},isLowLatencyMode:function(){return r.isLowLatencyMode_()},isAutoLowLatencyMode:function(){return r.isAutoLowLatencyMode_()},enableLowLatencyMode:function(){r.configure("streaming.lowLatencyMode",!0)}},_=Date.now()/1e3;return new shaka.util.AbortableOperation($jscomp.asyncExecutePromiseGeneratorProgram(function(R){if(1==R.nextAddress)return v=r,R.yield(r.parser_.start(o,g),2);if(v.manifest_=R.yieldResult,E=r.makeEvent_(shaka.Player.EventName.ManifestParsed),r.dispatchEvent(E),0==r.manifest_.variants.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.NO_VARIANTS);shaka.Player.filterForAVVariants_(r.manifest_),P=Date.now()/1e3,r.stats_.setManifestTime(P-_),R.jumpToEnd()}),function(){return shaka.log.info("Aborting parser step..."),r.parser_.stop()})},shaka.Player.prototype.onInitializeDrm_=function(t,i){var o,l,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){return 1==g.nextAddress?(goog.asserts.assert(t.mimeType==i.mimeType,"The load graph should have ensured the mime types matched."),goog.asserts.assert(t.uri==i.uri,"The load graph should have ensured the uris matched"),goog.asserts.assert(r.networkingEngine_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(r.config_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(r.manifest_,"|this.manifest_| should have been set in an earlier step."),goog.asserts.assert(t.mediaElement,"We should have a media element when initializing the DRM Engine."),o=Date.now()/1e3,l=!0,r.drmEngine_=r.createDrmEngine({netEngine:r.networkingEngine_,onError:function(_){r.onError_(_)},onKeyStatus:function(_){r.onKeyStatus_(_)},onExpirationUpdated:function(_,v){r.onExpirationUpdated_(_,v)},onEvent:function(_){r.dispatchEvent(_),_.type==shaka.Player.EventName.DrmSessionUpdate&&l&&(l=!1,_=Date.now()/1e3-o,r.stats_.setDrmTime(_))}}),r.config_.useMediaCapabilities||shaka.util.StreamUtils.filterManifestByMediaSource(r.manifest_),r.drmEngine_.configure(r.config_.drm),g.yield(r.drmEngine_.initForPlayback(r.manifest_.variants,r.manifest_.offlineSessionIds,r.config_.useMediaCapabilities),2)):3!=g.nextAddress?g.yield(r.drmEngine_.attach(t.mediaElement),3):g.yield(r.filterManifest_(r.manifest_),0)})},shaka.Player.prototype.onLoad_=function(t,i){var o,g,_,v,E,P,M,R,$,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){switch(G.nextAddress){case 1:if(goog.asserts.assert(t.mimeType==i.mimeType,"|has| and |wants| should have the same mime type when loading."),goog.asserts.assert(t.uri==i.uri,"|has| and |wants| should have the same uri when loading."),goog.asserts.assert(t.mediaElement,"We should have a media element when loading."),goog.asserts.assert(!isNaN(i.startTimeOfLoad),"|wants| should tell us when the load was originally requested"),t.startTime=i.startTime,o=t.mediaElement,r.assetUri_=t.uri,r.playRateController_=new shaka.media.PlayRateController({getRate:function(){return t.mediaElement.playbackRate},getDefaultRate:function(){return t.mediaElement.defaultPlaybackRate},setRate:function(z){t.mediaElement.playbackRate=z},movePlayhead:function(z){t.mediaElement.currentTime+=z}}),g=function(){return r.updateStateHistory_()},_=function(){return r.onRateChange_()},r.eventManager_.listen(o,"playing",g),r.eventManager_.listen(o,"pause",g),r.eventManager_.listen(o,"ended",g),r.eventManager_.listen(o,"ratechange",_),v=r.config_.abrFactory,r.abrManager_&&r.abrManagerFactory_==v||(r.abrManagerFactory_=v,r.abrManager_=shaka.util.Functional.callFactory(v),"function"!=typeof r.abrManager_.playbackRateChanged&&(shaka.Deprecate.deprecateFeature(4,"AbrManager","Please use an AbrManager with playbackRateChanged function."),r.abrManager_.playbackRateChanged=function(z){}),r.abrManager_.configure(r.config_.abr)),r.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(r.config_.preferredAudioLanguage,r.config_.preferredVariantRole,r.config_.preferredAudioChannelCount),r.currentTextLanguage_=r.config_.preferredTextLanguage,r.currentTextRole_=r.config_.preferredTextRole,shaka.Player.applyPlayRange_(r.manifest_.presentationTimeline,r.config_.playRangeStart,r.config_.playRangeEnd),r.abrManager_.init(function(z,Z,Y){return r.switch_(z,Z,Y)}),r.playhead_=r.createPlayhead(t.startTime),r.playheadObservers_=r.createPlayheadObserversForMSE_(),E=Math.max(r.manifest_.minBufferTime,r.config_.streaming.rebufferingGoal),r.startBufferManagement_(E),shaka.util.StreamUtils.chooseCodecsAndFilterManifest(r.manifest_,r.config_.preferredAudioChannelCount,r.config_.preferredDecodingAttributes),r.streamingEngine_=r.createStreamingEngine(),r.streamingEngine_.configure(r.config_.streaming),r.loadMode_=shaka.Player.LoadMode.MEDIA_SOURCE,r.dispatchEvent(r.makeEvent_(shaka.Player.EventName.Streaming)),P=r.chooseVariant_(),goog.asserts.assert(P,"Must choose an initial variant!"),r.addVariantToSwitchHistory_(P,!0),r.streamingEngine_.switchVariant(P,!1,0),(M=r.chooseTextStream_())&&r.addTextStreamToSwitchHistory_(M,!0),r.setInitialTextState_(P,M),M&&r.shouldStreamText_()&&r.streamingEngine_.switchTextStream(M),!r.config_.streaming.startAtSegmentBoundary){G.jumpTo(2);break}return R=r.playhead_.getTime(),G.yield(r.adjustStartTime_(P,R),3);case 3:r.playhead_.setStartTime(G.yieldResult);case 2:return G.yield(r.streamingEngine_.start(),4);case 4:r.config_.abr.enabled&&(r.abrManager_.enable(),r.onAbrStatusChanged_()),r.filterManifestByCurrentVariant_(),r.onTracksChanged_(),r.onAdaptation_(),r.updateAbrManagerVariants_(),$=r.manifest_.variants.some(function(z){return z.primary}),r.config_.preferredAudioLanguage||$||shaka.log.warning("No preferred audio language set.  We have chosen an arbitrary language initially"),r.eventManager_.listenOnce(o,"loadedmetadata",function(){var z=Date.now()/1e3-i.startTimeOfLoad;r.stats_.setLoadLatency(z)}),G.jumpToEnd()}})},shaka.Player.prototype.onInitializeSrcEqualsDrm_=function(t,i){var o,l,g,v,E,P,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?(o=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(r.networkingEngine_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),goog.asserts.assert(r.config_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),l=Date.now()/1e3,g=!0,r.drmEngine_=r.createDrmEngine({netEngine:r.networkingEngine_,onError:function(R){r.onError_(R)},onKeyStatus:function(R){r.onKeyStatus_(R)},onExpirationUpdated:function(R,U){r.onExpirationUpdated_(R,U)},onEvent:function(R){r.dispatchEvent(R),R.type==shaka.Player.EventName.DrmSessionUpdate&&g&&(g=!1,R=Date.now()/1e3-l,r.stats_.setDrmTime(R))}}),r.drmEngine_.configure(r.config_.drm),v=shaka.media.ManifestParser.getExtension(t.uri||""),"application/x-mpegurl"==(E=shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_[v])&&shaka.util.Platform.isApple()&&(E="application/vnd.apple.mpegurl"),E||(E="video/mp4"),P={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:i.mimeType?shaka.util.MimeUtils.getBasicType(i.mimeType):E,codecs:i.mimeType?shaka.util.MimeUtils.getCodecs(i.mimeType):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",label:null,type:o.VIDEO,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},M.yield(r.drmEngine_.initForPlayback([P],[]),2)):M.yield(r.drmEngine_.attach(t.mediaElement),0)})},shaka.Player.prototype.onSrcEquals_=function(t,i){var r=this;goog.asserts.assert(t.mediaElement,"We should have a media element when loading."),goog.asserts.assert(i.uri,"|has| should have a valid uri when loading."),goog.asserts.assert(!isNaN(i.startTimeOfLoad),"|wants| should tell us when the load was originally requested"),goog.asserts.assert(this.video_==t.mediaElement,"The video element should match our media element"),t.uri=i.uri,t.startTime=i.startTime,this.assetUri_=t.uri,this.playhead_=new shaka.media.SrcEqualsPlayhead(t.mediaElement),null!=t.startTime&&this.playhead_.setStartTime(t.startTime),this.playRateController_=new shaka.media.PlayRateController({getRate:function(){return t.mediaElement.playbackRate},getDefaultRate:function(){return t.mediaElement.defaultPlaybackRate},setRate:function(_){t.mediaElement.playbackRate=_},movePlayhead:function(_){t.mediaElement.currentTime+=_}}),this.startBufferManagement_(this.config_.streaming.rebufferingGoal);var o=function(){return r.updateStateHistory_()};this.eventManager_.listen(t.mediaElement,"playing",o),this.eventManager_.listen(t.mediaElement,"pause",o),this.eventManager_.listen(t.mediaElement,"ended",o),this.eventManager_.listen(t.mediaElement,"ratechange",function(){return r.onRateChange_()}),"none"!=this.video_.preload&&this.eventManager_.listenOnce(this.video_,"loadedmetadata",function(){var _=Date.now()/1e3-i.startTimeOfLoad;r.stats_.setLoadLatency(_)}),this.video_.audioTracks&&(this.eventManager_.listen(this.video_.audioTracks,"addtrack",function(){return r.onTracksChanged_()}),this.eventManager_.listen(this.video_.audioTracks,"removetrack",function(){return r.onTracksChanged_()}),this.eventManager_.listen(this.video_.audioTracks,"change",function(){return r.onTracksChanged_()})),this.video_.textTracks&&(this.eventManager_.listen(this.video_.textTracks,"addtrack",function(_){r.onTracksChanged_(),r.processTimedMetadataSrcEqls_(_)}),this.eventManager_.listen(this.video_.textTracks,"removetrack",function(){return r.onTracksChanged_()}),this.eventManager_.listen(this.video_.textTracks,"change",function(){return r.onTracksChanged_()})),t.mediaElement.src=t.uri,(shaka.util.Platform.isTizen()||shaka.util.Platform.isWebOS())&&t.mediaElement.load(),this.loadMode_=shaka.Player.LoadMode.SRC_EQUALS,this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Streaming));var l=new shaka.util.PublicPromise;shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){l.resolve()});var g=!1;return this.cleanupOnUnload_.push(function(){g=!0}),shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?g?v.return():(r.setupPreferredAudioOnSrc_(),r.getFilteredTextTracks_().find(function(E){return"disabled"!=E.mode})?v.jumpTo(2):v.yield(new Promise(function(E){r.eventManager_.listenOnce(r.video_.textTracks,"change",E),new shaka.util.Timer(E).tickAfter(1)}),2)):g?v.return():(r.setupPreferredTextOnSrc_(),void v.jumpToEnd())})}),this.video_.error?l.reject(this.videoErrorToShakaError_()):"none"==this.video_.preload&&(shaka.log.alwaysWarn('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),l.resolve()),this.eventManager_.listenOnce(this.video_,"error",function(){l.reject(r.videoErrorToShakaError_())}),new shaka.util.AbortableOperation(l,function(){var _=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return l.reject(_),Promise.resolve()})},shaka.Player.prototype.setupPreferredAudioOnSrc_=function(){var t=this.config_.preferredAudioLanguage;if(""!=t){this.selectAudioLanguage(t);var i=this.config_.preferredVariantRole;""!=i&&this.selectAudioLanguage(t,i)}},shaka.Player.prototype.setupPreferredTextOnSrc_=function(){var t=this.config_.preferredTextLanguage,i=this.config_.preferForcedSubs;if(""!=t){this.selectTextLanguage(t,"",i);var r=this.config_.preferredTextRole;""!=r&&this.selectTextLanguage(t,r,i)}},shaka.Player.prototype.processTimedMetadataSrcEqls_=function(t){var i=this,r=t.track;goog.asserts.assert(r instanceof TextTrack,"Wrong track type!"),"metadata"==r.kind&&(r.mode="hidden",this.eventManager_.listen(r,"cuechange",function(){if(r.activeCues)for(var o=$jscomp.makeIterator(r.activeCues),l=o.next();!l.done;l=o.next())i.dispatchMetadataEvent_((l=l.value).startTime,l.endTime,l.type,l.value),i.adManager_&&i.adManager_.onCueMetadataChange(l.value)}),new shaka.util.Timer(function(){for(var o=i.getMetadataTracks_(),l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next())l.value.mode="hidden"}).tickNow().tickAfter(.5))},shaka.Player.prototype.processTimedMetadataMediaSrc_=function(t,i,r){for(var o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next())if((o=o.value).data&&o.cueTime&&o.frames){for(var l=o.cueTime+i,g=r,_=$jscomp.makeIterator(o.frames),v=_.next();!v.done;v=_.next())this.dispatchMetadataEvent_(l,g,"ID3",v.value);this.adManager_&&this.adManager_.onHlsTimedMetadata(o,l)}},shaka.Player.prototype.dispatchMetadataEvent_=function(t,i,r,o){goog.asserts.assert(!i||t<=i,"Metadata start time should be less or equal to the end time!"),this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Metadata,{startTime:t,endTime:i,metadataType:r,payload:o}))},shaka.Player.filterForAVVariants_=function(t){var i=function(r){return r.video&&r.audio||r.video&&r.video.codecs.includes(",")};t.variants.some(i)&&(shaka.log.debug("Found variant with audio and video content, so filtering out audio-only content."),t.variants=t.variants.filter(i))},shaka.Player.prototype.createDrmEngine=function(t){return new shaka.media.DrmEngine(t,this.config_.drm.updateExpirationTime)},shaka.Player.prototype.createNetworkingEngine=function(){var t=this;return new shaka.net.NetworkingEngine(function(i,r){t.abrManager_&&t.abrManager_.segmentDownloaded(i,r)})},shaka.Player.prototype.createPlayhead=function(t){var i=this;return goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.video_,"Must have video"),new shaka.media.MediaSourcePlayhead(this.video_,this.manifest_,this.config_.streaming,t,function(){return i.onSeek_()},function(r){return i.dispatchEvent(r)})},shaka.Player.prototype.createPlayheadObserversForMSE_=function(){var t=this;goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.regionTimeline_,"Must have region timeline"),goog.asserts.assert(this.video_,"Must have video element");var i=new shaka.media.RegionObserver(this.regionTimeline_);i.setListeners(function(o,l){t.onRegionEvent_(shaka.Player.EventName.TimelineRegionEnter,o)},function(o,l){t.onRegionEvent_(shaka.Player.EventName.TimelineRegionExit,o)},function(o,l){l||(t.onRegionEvent_(shaka.Player.EventName.TimelineRegionEnter,o),t.onRegionEvent_(shaka.Player.EventName.TimelineRegionExit,o))});var r=new shaka.media.PlayheadObserverManager(this.video_);return r.manage(i),r},shaka.Player.prototype.startBufferManagement_=function(t){var i=this;goog.asserts.assert(!this.bufferObserver_,"No buffering observer should exist before initialization."),goog.asserts.assert(!this.bufferPoller_,"No buffer timer should exist before initialization."),this.bufferObserver_=new shaka.media.BufferingObserver(1,2),this.bufferObserver_.setState(shaka.media.BufferingObserver.State.STARVING),this.updateBufferingSettings_(t),this.updateBufferState_(),this.bufferPoller_=new shaka.util.Timer(function(){i.pollBufferState_()}).tickEvery(.25)},shaka.Player.prototype.updateBufferingSettings_=function(t){this.bufferObserver_.setThresholds(t,Math.min(shaka.Player.TYPICAL_BUFFERING_THRESHOLD_,t/2))},shaka.Player.prototype.pollBufferState_=function(){switch(goog.asserts.assert(this.video_,"Need a media element to update the buffering observer"),goog.asserts.assert(this.bufferObserver_,"Need a buffering observer to update"),this.loadMode_){case shaka.Player.LoadMode.SRC_EQUALS:var t=this.isBufferedToEndSrc_();break;case shaka.Player.LoadMode.MEDIA_SOURCE:t=this.isBufferedToEndMS_();break;default:t=!1}var i=shaka.media.TimeRangesUtils.bufferedAheadOf(this.video_.buffered,this.video_.currentTime);this.bufferObserver_.update(i,t)&&this.updateBufferState_()},shaka.Player.prototype.createMediaSourceEngine=function(t,i,r,o){return new shaka.media.MediaSourceEngine(t,i,r,o)},shaka.Player.prototype.createStreamingEngine=function(){var t=this;return goog.asserts.assert(this.playhead_&&this.abrManager_&&this.mediaSourceEngine_&&this.manifest_,"Must not be destroyed"),new shaka.media.StreamingEngine(this.manifest_,{getPresentationTime:function(){return t.playhead_.getTime()},getBandwidthEstimate:function(){return t.abrManager_.getBandwidthEstimate()},mediaSourceEngine:this.mediaSourceEngine_,netEngine:this.networkingEngine_,onError:function(i){return t.onError_(i)},onEvent:function(i){return t.dispatchEvent(i)},onManifestUpdate:function(){return t.onManifestUpdate_()},onSegmentAppended:function(){return t.onSegmentAppended_()}})},shaka.Player.prototype.configure=function(t,i){goog.asserts.assert(this.config_,"Config must not be null!"),goog.asserts.assert("object"==typeof t||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof t&&(t=shaka.util.ConfigUtils.convertToConfigObject(t,i)),goog.asserts.assert("object"==typeof t,"Should be an object!"),t.manifest&&t.manifest.dash&&"defaultPresentationDelay"in t.manifest.dash&&(shaka.Deprecate.deprecateFeature(4,"manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),t.manifest.defaultPresentationDelay=t.manifest.dash.defaultPresentationDelay,delete t.manifest.dash.defaultPresentationDelay),t.streaming&&t.streaming.lowLatencyMode&&(null==t.streaming.inaccurateManifestTolerance&&(t.streaming.inaccurateManifestTolerance=0),null==t.streaming.rebufferingGoal&&(t.streaming.rebufferingGoal=.01));var r=shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,t,this.defaultConfig_());return this.applyConfig_(),r},shaka.Player.prototype.applyConfig_=function(){if(this.parser_){var t=shaka.util.ObjectUtils.cloneObject(this.config_.manifest);this.video_&&"AUDIO"===this.video_.nodeName&&(t.disableVideo=!0),this.parser_.configure(t)}if(this.drmEngine_&&this.drmEngine_.configure(this.config_.drm),this.streamingEngine_){this.streamingEngine_.configure(this.config_.streaming);try{this.filterManifestWithRestrictions_(this.manifest_)}catch(r){this.onError_(r)}this.abrManager_&&this.updateAbrManagerVariants_(),!(t=this.streamingEngine_.getCurrentVariant())||t.allowedByApplication&&t.allowedByKeySystem||(shaka.log.debug("Choosing new variant after changing configuration"),this.chooseVariantAndSwitch_())}if(this.networkingEngine_&&this.networkingEngine_.setForceHTTPS(this.config_.streaming.forceHTTPS),this.mediaSourceEngine_&&this.lastTextFactory_!=(t=this.config_.textDisplayFactory)){var i=shaka.util.Functional.callFactory(t);this.mediaSourceEngine_.setTextDisplayer(i),this.lastTextFactory_=t,this.streamingEngine_&&this.streamingEngine_.reloadTextStream()}this.abrManager_&&(this.abrManager_.configure(this.config_.abr),this.config_.abr.enabled?this.abrManager_.enable():this.abrManager_.disable(),this.onAbrStatusChanged_()),this.bufferObserver_&&(t=this.config_.streaming.rebufferingGoal,this.manifest_&&(t=Math.max(t,this.manifest_.minBufferTime)),this.updateBufferingSettings_(t)),this.manifest_&&shaka.Player.applyPlayRange_(this.manifest_.presentationTimeline,this.config_.playRangeStart,this.config_.playRangeEnd)},shaka.Player.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var t=this.defaultConfig_();return shaka.util.PlayerConfiguration.mergeConfigObjects(t,this.config_,this.defaultConfig_()),t},shaka.Player.prototype.getSharedConfiguration=function(){return goog.asserts.assert(this.config_,"Cannot call getSharedConfiguration after call destroy!"),this.config_},shaka.Player.prototype.getBufferFullness=function(){if(this.video_){var t=this.video_.buffered.length;t=t?this.video_.buffered.end(t-1):0;var i=this.getConfiguration().streaming.bufferingGoal;if(t>=(i=Math.min(this.video_.currentTime+i,this.seekRange().end)))return 1;if(!(t<=this.video_.currentTime)&&t<i)return(t-this.video_.currentTime)/(i-this.video_.currentTime)}return 0},shaka.Player.prototype.resetConfiguration=function(){for(var t in goog.asserts.assert(this.config_,"Cannot be destroyed"),this.config_)delete this.config_[t];shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,this.defaultConfig_(),this.defaultConfig_()),this.applyConfig_()},shaka.Player.prototype.getLoadMode=function(){return this.loadMode_},shaka.Player.prototype.getMediaElement=function(){return this.video_},shaka.Player.prototype.getNetworkingEngine=function(){return this.networkingEngine_},shaka.Player.prototype.getAssetUri=function(){return this.assetUri_},shaka.Player.prototype.getAdManager=function(){return this.adManager_?this.adManager_:null},shaka.Player.prototype.isLive=function(){return this.manifest_?this.manifest_.presentationTimeline.isLive():!(!this.video_||!this.video_.src)&&this.video_.duration==1/0},shaka.Player.prototype.isInProgress=function(){return!!this.manifest_&&this.manifest_.presentationTimeline.isInProgress()},shaka.Player.prototype.isAudioOnly=function(){if(this.manifest_){var t=this.manifest_.variants;return!!t.length&&!t[0].video}return!(!this.video_||!this.video_.src)&&(this.video_.videoTracks?0==this.video_.videoTracks.length:0==this.video_.videoHeight)},shaka.Player.prototype.isLowLatencyMode_=function(){return this.config_.streaming.lowLatencyMode},shaka.Player.prototype.isAutoLowLatencyMode_=function(){return this.config_.streaming.autoLowLatencyMode},shaka.Player.prototype.seekRange=function(){if(this.manifest_){var t=this.manifest_.presentationTimeline;return{start:t.getSeekRangeStart(),end:t.getSeekRangeEnd()}}return this.video_&&this.video_.src&&(t=this.video_.seekable).length?{start:t.start(0),end:t.end(t.length-1)}:{start:0,end:0}},shaka.Player.prototype.keySystem=function(){return shaka.media.DrmEngine.keySystem(this.drmInfo())},shaka.Player.prototype.drmInfo=function(){return this.drmEngine_?this.drmEngine_.getDrmInfo():null},shaka.Player.prototype.getExpiration=function(){return this.drmEngine_?this.drmEngine_.getExpiration():1/0},shaka.Player.prototype.getKeyStatuses=function(){return this.drmEngine_?this.drmEngine_.getKeyStatuses():{}},shaka.Player.prototype.isBuffering=function(){var t=shaka.media.BufferingObserver.State;return!!this.bufferObserver_&&this.bufferObserver_.getState()==t.STARVING},shaka.Player.prototype.getPlaybackRate=function(){return this.video_?this.playRateController_?this.playRateController_.getRealRate():1:0},shaka.Player.prototype.trickPlay=function(t){goog.asserts.assert(0!=t,"Should never set a trick play rate of 0!"),0==t?shaka.log.alwaysWarn("A trick play rate of 0 is unsupported!"):(this.video_.paused&&this.video_.play(),this.playRateController_.set(t),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.abrManager_.playbackRateChanged(t),this.streamingEngine_.setTrickPlay(1<Math.abs(t))))},shaka.Player.prototype.cancelTrickPlay=function(){var t=this.playRateController_.getDefaultRate();this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&this.playRateController_.set(t),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.playRateController_.set(t),this.abrManager_.playbackRateChanged(t),this.streamingEngine_.setTrickPlay(!1))},shaka.Player.prototype.getVariantTracks=function(){if(this.manifest_){for(var t=this.streamingEngine_?this.streamingEngine_.getCurrentVariant():null,i=[],r=$jscomp.makeIterator(this.manifest_.variants),o=r.next();!o.done;o=r.next())if(shaka.util.StreamUtils.isPlayable(o=o.value)){var l=shaka.util.StreamUtils.variantToTrack(o);l.active=o==t,i.push(l)}return i}return this.video_&&this.video_.audioTracks?Array.from(this.video_.audioTracks).map(function(g){return shaka.util.StreamUtils.html5AudioTrackToTrack(g)}):[]},shaka.Player.prototype.getTextTracks=function(){if(this.manifest_){for(var t=this.streamingEngine_?this.streamingEngine_.getCurrentTextStream():null,i=[],r=$jscomp.makeIterator(this.manifest_.textStreams),o=r.next();!o.done;o=r.next()){var l=shaka.util.StreamUtils.textStreamToTrack(o=o.value);l.active=o==t,i.push(l)}return i}if(this.video_&&this.video_.src&&this.video_.textTracks){t=this.getFilteredTextTracks_();var g=shaka.util.StreamUtils;return t.map(function(_){return g.html5TextTrackToTrack(_)})}return[]},shaka.Player.prototype.getImageTracks=function(){if(this.manifest_){var t=shaka.util.StreamUtils;return this.manifest_.imageStreams.map(function(i){return t.imageStreamToTrack(i)})}return[]},shaka.Player.prototype.getThumbnails=function(t,i){var o,l,g,_,v,E,P,M,R,U,$,G,z,se,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){return 1==Q.nextAddress?r.manifest_?(o=r.manifest_.imageStreams.find(function(te){return te.id==t}))?o.segmentIndex?Q.jumpTo(3):Q.yield(o.createSegmentIndex(),3):Q.return(null):Q.jumpTo(2):2!=Q.nextAddress?null==(l=o.segmentIndex.find(i))?Q.return(null):(g=o.segmentIndex.get(l),(_=/(\d+)x(\d+)/.exec(o.tilesLayout))?(v=o.width||0,E=o.height||0,P=parseInt(_[1],10),M=parseInt(_[2],10),R=v/P,U=E/M,G=$=0,1<(z=P*M)&&(se=Math.floor((i-g.startTime)*z/(g.endTime-g.startTime)),$=se%P/P*v,G=se%M/M*E),Q.return({height:U,positionX:$,positionY:G,uris:g.getUris(),width:R})):(shaka.log.warning("Tiles layout does not contain a valid format  (columns x rows)"),Q.return(null))):Q.return(null)})},shaka.Player.prototype.selectTextTrack=function(t){if(this.manifest_&&this.streamingEngine_){var i=this.manifest_.textStreams.find(function(o){return o.id==t.id});i?i==this.streamingEngine_.getCurrentTextStream()?shaka.log.debug("Text track already selected."):(this.addTextStreamToSwitchHistory_(i,!1),this.streamingEngine_.switchTextStream(i),this.onTextChanged_(),this.currentTextLanguage_=i.language):shaka.log.error("No stream with id",t.id)}else if(this.video_&&this.video_.src&&this.video_.textTracks){i=this.getFilteredTextTracks_();for(var r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())(r=r.value).mode=shaka.util.StreamUtils.html5TrackId(r)==t.id?this.isTextVisible_?"showing":"hidden":"disabled";this.onTextChanged_()}},shaka.Player.prototype.selectVariantTrack=function(t,i,r){if(i=void 0!==i&&i,r=void 0===r?0:r,this.manifest_&&this.streamingEngine_){this.config_.abr.enabled&&shaka.log.alwaysWarn("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var o=this.manifest_.variants.find(function(l){return l.id==t.id});o?shaka.util.StreamUtils.isPlayable(o)?(this.switchVariant_(o,!1,i,r),this.currentAdaptationSetCriteria_=new shaka.media.ExampleBasedCriteria(o),this.updateAbrManagerVariants_()):shaka.log.error("Unable to switch to restricted track",t.id):shaka.log.error("No variant with id",t.id)}else if(this.video_&&this.video_.audioTracks)for(i=Array.from(this.video_.audioTracks),r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())if(shaka.util.StreamUtils.html5TrackId(r=r.value)==t.id){this.switchHtml5Track_(r);break}},shaka.Player.prototype.getAudioLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getVariantTracks())},shaka.Player.prototype.getTextLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getTextTracks())},shaka.Player.prototype.getAudioLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getVariantTracks()))},shaka.Player.prototype.getTextLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getTextTracks()))},shaka.Player.prototype.selectAudioLanguage=function(t,i){var r=shaka.util.LanguageUtils;if(this.manifest_&&this.playhead_){if(this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(t,i||"",0,""),!this.config_.abr.enabled){r=function(P,M){return P.video||M.video?P.video&&M.video?Math.abs((P.video.height||0)-(M.video.height||0))+Math.abs((P.video.width||0)-(M.video.width||0)):1/0:0};for(var o=this.streamingEngine_.getCurrentVariant(),l=this.currentAdaptationSetCriteria_.create(this.manifest_.variants),g=null,_=(l=$jscomp.makeIterator(l.values())).next();!_.done;_=l.next())_=_.value,(!g||r(g,o)>r(_,o))&&(g=_);if(g)return r=shaka.util.StreamUtils.variantToTrack(g),void this.selectVariantTrack(r,!0)}this.chooseVariantAndSwitch_()}else if(this.video_&&this.video_.audioTracks){_=Array.from(this.video_.audioTracks),o=r.normalize(t),l=g=null;for(var v=(_=$jscomp.makeIterator(_)).next();!v.done;v=_.next()){var E=shaka.util.StreamUtils.html5AudioTrackToTrack(v=v.value);r.normalize(E.language)==o&&(g=v,i?E.roles.includes(i)&&(l=v):0==E.roles.length&&(l=v))}l?this.switchHtml5Track_(l):g&&this.switchHtml5Track_(g)}},shaka.Player.prototype.selectTextLanguage=function(t,i,r){r=void 0!==r&&r;var o=shaka.util.LanguageUtils;if(this.manifest_&&this.playhead_)this.currentTextLanguage_=t,this.currentTextRole_=i||"",this.currentTextForced_=r,(t=this.chooseTextStream_())&&(t==this.streamingEngine_.getCurrentTextStream()?shaka.log.debug("Text track already selected."):(this.addTextStreamToSwitchHistory_(t,!1),this.shouldStreamText_()&&(this.streamingEngine_.switchTextStream(t),this.onTextChanged_())));else{var l=o.normalize(t);(t=this.getTextTracks().find(function(g){return o.normalize(g.language)==l&&(!i||g.roles.includes(i))&&g.forced==r}))&&this.selectTextTrack(t)}},shaka.Player.prototype.selectVariantsByLabel=function(t){if(this.manifest_&&this.playhead_){for(var i=null,r=$jscomp.makeIterator(this.manifest_.variants),o=r.next();!o.done;o=r.next())if((o=o.value).audio.label==t){i=o;break}null==i?shaka.log.warning("No variants were found with label: "+t+". Ignoring the request to switch."):(this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(i.language,"",0,t),this.chooseVariantAndSwitch_())}},shaka.Player.prototype.isTextTrackVisible=function(){var t=this.isTextVisible_;if(this.mediaSourceEngine_){var i=this.mediaSourceEngine_.getTextDisplayer().isTextVisible();return goog.asserts.assert(i==t,"text visibility has fallen out of sync"),i}return this.video_&&this.video_.src&&this.video_.textTracks?this.getFilteredTextTracks_().some(function(r){return"showing"==r.mode}):t},shaka.Player.prototype.getFilteredTextTracks_=function(){return goog.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter(function(t){return"metadata"!=t.kind&&"chapters"!=t.kind&&t.label!=shaka.Player.TextTrackLabel})},shaka.Player.prototype.getMetadataTracks_=function(){return goog.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter(function(t){return"metadata"==t.kind})},shaka.Player.prototype.setTextTrackVisibility=function(t){if(this.isTextVisible_!=(t=!!t)){if(this.isTextVisible_=t,this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE)this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(t),this.config_.streaming.alwaysStreamText||(t?this.streamingEngine_.getCurrentTextStream()||0<(t=shaka.util.StreamUtils.filterStreamsByLanguageAndRole(this.manifest_.textStreams,this.currentTextLanguage_,this.currentTextRole_,this.currentTextForced_)).length&&(this.streamingEngine_.switchTextStream(t[0]),this.onTextChanged_()):this.streamingEngine_.unloadTextStream());else if(this.video_&&this.video_.src&&this.video_.textTracks)for(var i=this.getFilteredTextTracks_(),r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())"disabled"!=(r=r.value).mode&&(r.mode=t?"showing":"hidden");this.onTextTrackVisibility_()}},shaka.Player.prototype.getPlayheadTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPlayheadTimeAsDate is for live streams!"),null;var t=this.walker_.getCurrentPayload(),i=0;if(this.playhead_)i=this.playhead_.getTime();else if(t){if(null==t.startTime)return new Date;i=t.startTime}return this.manifest_?(t=this.manifest_.presentationTimeline.getPresentationStartTime(),new Date(1e3*(t+i))):this.video_&&this.video_.getStartDate?(t=this.video_.getStartDate(),isNaN(t.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(t.getTime()+1e3*i)):(shaka.log.warning("No way to get playhead time as Date!"),null)},shaka.Player.prototype.getPresentationStartTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPresentationStartTimeAsDate is for live streams!"),null;if(this.manifest_){var t=this.manifest_.presentationTimeline.getPresentationStartTime();return goog.asserts.assert(null!=t,"Presentation start time should not be null!"),new Date(1e3*t)}return this.video_&&this.video_.getStartDate?(t=this.video_.getStartDate(),isNaN(t.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):t):(shaka.log.warning("No way to get presentation start time as Date!"),null)},shaka.Player.prototype.getBufferedInfo=function(){if(this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE)return this.mediaSourceEngine_.getBufferedInfo();var t={total:[],audio:[],video:[],text:[]};return this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&(t.total=shaka.media.TimeRangesUtils.getBufferedInfo(this.video_.buffered)),t},shaka.Player.prototype.getStats=function(){if(this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)return shaka.util.Stats.getEmptyBlob();this.updateStateHistory_(),goog.asserts.assert(this.video_,"If we have stats, we should have video_");var t=this.video_,i=t.currentTime/t.duration;return isNaN(i)||this.stats_.setCompletionPercent(Math.round(100*i)),t.getVideoPlaybackQuality&&(t=t.getVideoPlaybackQuality(),this.stats_.setDroppedFrames(Number(t.droppedVideoFrames),Number(t.totalVideoFrames)),this.stats_.setCorruptedFrames(Number(t.corruptedVideoFrames))),t=this.drmEngine_?this.drmEngine_.getLicenseTime():NaN,this.stats_.setLicenseTime(t),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&((t=this.streamingEngine_.getCurrentVariant())&&(i=(this.playRateController_?this.playRateController_.getRealRate():1)*t.bandwidth,this.stats_.setCurrentStreamBandwidth(i)),t&&t.video&&this.stats_.setResolution(t.video.width||NaN,t.video.height||NaN),this.isLive()&&(t=this.getPresentationStartTimeAsDate().valueOf()+1e3*this.seekRange().end,t=(Date.now()-t)/1e3,this.stats_.setLiveLatency(t)),this.manifest_&&this.manifest_.presentationTimeline&&(t=this.manifest_.presentationTimeline.getMaxSegmentDuration(),this.stats_.setMaxSegmentDuration(t)),t=this.abrManager_.getBandwidthEstimate(),this.stats_.setBandwidthEstimate(t)),this.stats_.getBlob()},shaka.Player.prototype.addTextTrack=function(t,i,r,o,l,g,_){if(_=void 0!==_&&_,shaka.Deprecate.deprecateFeature(4,"addTextTrack","Please use an addTextTrackAsync."),this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Must call load() and wait for it to resolve before adding text tracks."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.CONTENT_NOT_LOADED);if(!o){var v=shaka.media.ManifestParser.getExtension(t);if(!(o={sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"}[v]))throw shaka.log.error("The mimeType has not been provided and it could not be deduced from its extension."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.TEXT_COULD_NOT_GUESS_MIME_TYPE,v)}if(this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS){if("text/vtt"!=o)throw shaka.log.error("Only WebVTT is supported when using src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.TEXT_ONLY_WEBVTT_SRC_EQUALS,o);if(_&&(r="forced"),(o=document.createElement("track")).src=t,o.label=g||"",o.kind=r,o.srclang=i,this.video_.getAttribute("crossorigin")||this.video_.setAttribute("crossorigin","anonymous"),this.video_.appendChild(o),o=this.getTextTracks().find(function(P){return P.language==i&&P.label==(g||"")&&P.kind==r}))return this.onTracksChanged_(),o;throw shaka.log.error("Cannot add this text when loaded with src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS)}v=shaka.util.ManifestParserUtils.ContentType;var E=this.manifest_.presentationTimeline.getDuration();if(E==1/0)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);if(t={id:this.nextExternalStreamId_++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:shaka.media.SegmentIndex.forSingleSegment(0,E,[t]),mimeType:o||"",codecs:l||"",kind:r,encrypted:!1,drmInfos:[],keyIds:new Set,language:i,label:g||null,type:v.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!_,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},l=shaka.util.MimeUtils.getFullType(t.mimeType,t.codecs),!shaka.text.TextEngine.isTypeSupported(l))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.MISSING_TEXT_PLUGIN,o);return this.manifest_.textStreams.push(t),this.onTracksChanged_(),shaka.util.StreamUtils.textStreamToTrack(t)},shaka.Player.prototype.addTextTrackAsync=function(t,i,r,o,l,g,_){_=void 0!==_&&_;var E,M,R,U,$,G,z,Z,Y,se,v=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){switch(te.nextAddress){case 1:if(v.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&v.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Must call load() and wait for it to resolve before adding text tracks."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.CONTENT_NOT_LOADED);if(o){te.jumpTo(2);break}if(E=shaka.media.ManifestParser.getExtension(t),o={sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"}[E]){te.jumpTo(3);break}return te.setCatchFinallyBlocks(4),goog.asserts.assert(v.networkingEngine_,"Need networking engine."),te.yield(shaka.media.ManifestParser.getMimeType(t,v.networkingEngine_,v.config_.streaming.retryParameters),6);case 6:o=te.yieldResult,te.leaveTryBlock(3);break;case 4:te.enterCatchBlock();case 3:if(!o)throw shaka.log.error("The mimeType has not been provided and it could not be deduced from its extension."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.TEXT_COULD_NOT_GUESS_MIME_TYPE,E);case 2:if(v.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS){te.jumpTo(7);break}if("text/vtt"==o){te.jumpTo(8);break}return goog.asserts.assert(v.networkingEngine_,"Need networking engine."),te.yield(v.getTextData_(t,v.networkingEngine_,v.config_.streaming.retryParameters),9);case 9:M=v.convertToWebVTT_(te.yieldResult,o),R=new Blob([M],{type:"text/vtt"}),t=shaka.media.MediaSourceEngine.createObjectURL(R),o="text/vtt";case 8:if(_&&(r="forced"),(U=document.createElement("track")).src=t,U.label=g||"",U.kind=r,U.srclang=i,v.video_.getAttribute("crossorigin")||v.video_.setAttribute("crossorigin","anonymous"),v.video_.appendChild(U),$=v.getTextTracks(),G=$.find(function(ce){return ce.language==i&&ce.label==(g||"")&&ce.kind==r}))return v.onTracksChanged_(),te.return(G);throw shaka.log.error("Cannot add this text when loaded with src="),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS);case 7:if(z=shaka.util.ManifestParserUtils.ContentType,(Z=v.manifest_.presentationTimeline.getDuration())==1/0)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);if(Y={id:v.nextExternalStreamId_++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:shaka.media.SegmentIndex.forSingleSegment(0,Z,[t]),mimeType:o||"",codecs:l||"",kind:r,encrypted:!1,drmInfos:[],keyIds:new Set,language:i,label:g||null,type:z.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!_,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},se=shaka.util.MimeUtils.getFullType(Y.mimeType,Y.codecs),!shaka.text.TextEngine.isTypeSupported(se))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.MISSING_TEXT_PLUGIN,o);return v.manifest_.textStreams.push(Y),v.onTracksChanged_(),te.return(shaka.util.StreamUtils.textStreamToTrack(Y))}})},shaka.Player.prototype.getTextData_=function(t,i,r){var o,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_){return 1==_.nextAddress?(o=shaka.net.NetworkingEngine.RequestType.SEGMENT,(l=shaka.net.NetworkingEngine.makeRequest([t],r)).method="GET",_.yield(i.request(o,l).promise,2)):_.return(_.yieldResult.data)})},shaka.Player.prototype.convertToWebVTT_=function(t,i){var r=shaka.text.TextEngine.findParser(i);if(r){r=r();var o={periodStart:0,segmentStart:0,segmentEnd:this.video_.duration},l=shaka.util.BufferUtils.toUint8(t);return r=r.parseMedia(l,o),shaka.text.WebVttGenerator.convert(r)}throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.MISSING_TEXT_PLUGIN,i)},shaka.Player.prototype.setMaxHardwareResolution=function(t,i){this.maxHwRes_.width=t,this.maxHwRes_.height=i},shaka.Player.prototype.retryStreaming=function(){return this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&this.streamingEngine_.retry()},shaka.Player.prototype.getManifest=function(){return shaka.log.alwaysWarn("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.manifest_},shaka.Player.prototype.getManifestParserFactory=function(){return this.parserFactory_},shaka.Player.prototype.addVariantToSwitchHistory_=function(t,i){this.stats_.getSwitchHistory().updateCurrentVariant(t,i)},shaka.Player.prototype.addTextStreamToSwitchHistory_=function(t,i){this.stats_.getSwitchHistory().updateCurrentText(t,i)},shaka.Player.prototype.defaultConfig_=function(){var t=this,i=shaka.util.PlayerConfiguration.createDefault();return i.streaming.failureCallback=function(r){t.defaultStreamingFailureCallback_(r)},i.textDisplayFactory=function(){return t.videoContainer_?new shaka.text.UITextDisplayer(t.video_,t.videoContainer_):new shaka.text.SimpleTextDisplayer(t.video_)},i},shaka.Player.prototype.setVideoContainer=function(t){this.videoContainer_=t},shaka.Player.prototype.defaultStreamingFailureCallback_=function(t){var i=[shaka.util.Error.Code.BAD_HTTP_STATUS,shaka.util.Error.Code.HTTP_ERROR,shaka.util.Error.Code.TIMEOUT];this.isLive()&&i.includes(t.code)&&(t.severity=shaka.util.Error.Severity.RECOVERABLE,shaka.log.warning("Live streaming error.  Retrying automatically..."),this.retryStreaming())},shaka.Player.prototype.makeTextStreamsForClosedCaptions_=function(t){for(var i=shaka.util.ManifestParserUtils.ContentType,r=shaka.util.ManifestParserUtils.TextStreamKind,o=shaka.util.MimeUtils.CEA608_CLOSED_CAPTION_MIMETYPE,l=shaka.util.MimeUtils.CEA708_CLOSED_CAPTION_MIMETYPE,g=new Set,_=$jscomp.makeIterator(t.textStreams),v=_.next();!v.done;v=_.next())(v=v.value).mimeType!=o&&v.mimeType!=l||g.add(v.originalId);for(v=(_=$jscomp.makeIterator(t.variants)).next();!v.done;v=_.next())if((v=v.value.video)&&v.closedCaptions)for(var E=$jscomp.makeIterator(v.closedCaptions.keys()),P=E.next();!P.done;P=E.next())if(!g.has(P=P.value)){var M=P.startsWith("CC")?o:l,R=new shaka.media.MetaSegmentIndex;M={id:this.nextExternalStreamId_++,originalId:P,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:R,mimeType:M,codecs:"",kind:r.CLOSED_CAPTION,encrypted:!1,drmInfos:[],keyIds:new Set,language:v.closedCaptions.get(P),label:null,type:i.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:v.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},t.textStreams.push(M),g.add(P)}},shaka.Player.prototype.filterManifest_=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return r.yield(i.filterManifestWithStreamUtils_(t),2);i.filterManifestWithRestrictions_(t),r.jumpToEnd()})},shaka.Player.prototype.filterManifestWithStreamUtils_=function(t){var r,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){if(1==o.nextAddress)return goog.asserts.assert(t,"Manifest should exist!"),goog.asserts.assert(i.video_,"Must not be destroyed"),r=i.streamingEngine_?i.streamingEngine_.getCurrentVariant():null,o.yield(shaka.util.StreamUtils.filterManifest(i.drmEngine_,r,t,i.config_.useMediaCapabilities),2);i.checkPlayableVariants_(t),o.jumpToEnd()})},shaka.Player.prototype.filterManifestWithRestrictions_=function(t){if(this.loadMode_!=shaka.Player.LoadMode.DESTROYED){shaka.util.StreamUtils.applyRestrictions(t.variants,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.onTracksChanged_();var i=this.drmEngine_?this.drmEngine_.getDrmInfo():null;if(i&&this.drmEngine_.getMediaKeys())for(var r=$jscomp.makeIterator(t.variants),o=r.next();!o.done;o=r.next()){o=((o=o.value).video?o.video.drmInfos:[]).concat(o.audio?o.audio.drmInfos:[]);for(var l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next())if((l=l.value).keySystem==i.keySystem)for(var g=(l=$jscomp.makeIterator(l.initData||[])).next();!g.done;g=l.next())this.drmEngine_.newInitData((g=g.value).initDataType,g.initData)}this.checkRestrictedVariants_(t)}},shaka.Player.prototype.filterManifestByCurrentVariant_=function(){goog.asserts.assert(this.manifest_,"Manifest should be valid"),goog.asserts.assert(this.streamingEngine_,"StreamingEngine should be valid");var t=this.streamingEngine_?this.streamingEngine_.getCurrentVariant():null;shaka.util.StreamUtils.filterManifestByCurrentVariant(t,this.manifest_),this.checkPlayableVariants_(this.manifest_)},shaka.Player.prototype.adjustStartTime_=function(t,i){var o,l,g,_;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(o=t.video,v.yield((l=function(E,P){var M,R;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return 1==U.nextAddress?E?U.yield(E.createSegmentIndex(),2):U.return(null):(M=E.segmentIndex[Symbol.iterator]().seek(P))?(goog.asserts.assert((R=M.startTime)<=P,"Segment should start before target time!"),U.return(R)):U.return(null)})})(t.audio,i),2)):3!=v.nextAddress?(g=v.yieldResult,v.yield(l(o,i),3)):v.return(null!=(_=v.yieldResult)&&null!=g?Math.max(_,g):null!=_?_:null!=g?g:i)})},shaka.Player.prototype.updateBufferState_=function(){var t=this.isBuffering();shaka.log.v2("Player changing buffering state to",t),this.stats_&&this.bufferObserver_&&this.playhead_&&(this.playRateController_.setBuffering(t),this.updateStateHistory_()),this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Buffering,{buffering:t}))},shaka.Player.prototype.onRateChange_=function(){var t=this.video_.playbackRate;0!=t&&(this.playRateController_&&this.playRateController_.set(t),t=this.makeEvent_(shaka.Player.EventName.RateChange),this.dispatchEvent(t))},shaka.Player.prototype.updateStateHistory_=function(){if(this.stats_&&this.bufferObserver_){var t=shaka.media.BufferingObserver.State,i=this.stats_.getStateHistory();this.bufferObserver_.getState()==t.STARVING?i.update("buffering"):i.update(this.video_.paused?"paused":this.video_.ended?"ended":"playing")}},shaka.Player.prototype.onSeek_=function(){this.playheadObservers_&&this.playheadObservers_.notifyOfSeek(),this.streamingEngine_&&this.streamingEngine_.seeked(),this.bufferObserver_&&this.pollBufferState_()},shaka.Player.prototype.updateAbrManagerVariants_=function(){try{goog.asserts.assert(this.manifest_,"Manifest should exist by now!"),this.checkRestrictedVariants_(this.manifest_)}catch(i){return this.onError_(i),!1}var t=this.manifest_.variants.filter(function(i){return shaka.util.StreamUtils.isPlayable(i)});return t=this.currentAdaptationSetCriteria_.create(t),this.abrManager_.setVariants(Array.from(t.values())),!0},shaka.Player.prototype.chooseVariant_=function(){return this.updateAbrManagerVariants_()?this.abrManager_.chooseVariant():null},shaka.Player.prototype.chooseTextStream_=function(){return shaka.util.StreamUtils.filterStreamsByLanguageAndRole(this.manifest_.textStreams,this.currentTextLanguage_,this.currentTextRole_,this.currentTextForced_)[0]||null},shaka.Player.prototype.chooseVariantAndSwitch_=function(){goog.asserts.assert(this.config_,"Must not be destroyed");var t=this.chooseVariant_();t&&(this.switchVariant_(t,!0,!0,0),this.onAdaptation_())},shaka.Player.prototype.switchVariant_=function(t,i,r,o){var l=this.streamingEngine_.getCurrentVariant();t==l?shaka.log.debug("Variant already selected."):(this.addVariantToSwitchHistory_(t,i),this.streamingEngine_.switchVariant(t,r,o),i=null,l&&(i=shaka.util.StreamUtils.variantToTrack(l)),t=shaka.util.StreamUtils.variantToTrack(t),this.onVariantChanged_(i,t))},shaka.Player.prototype.switchHtml5Track_=function(t){goog.asserts.assert(this.video_&&this.video_.audioTracks,"Video and video.audioTracks should not be null!");var i=Array.from(this.video_.audioTracks).find(function(r){return r.enabled});t.enabled=!0,i=shaka.util.StreamUtils.html5AudioTrackToTrack(i),t=shaka.util.StreamUtils.html5AudioTrackToTrack(t),this.onVariantChanged_(i,t)},shaka.Player.prototype.setInitialTextState_=function(t,i){i?(t.audio&&this.shouldInitiallyShowText_(t.audio,i)&&(this.isTextVisible_=!0),this.isTextVisible_&&(this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(!0),goog.asserts.assert(this.shouldStreamText_(),"Should be streaming text")),this.onTextTrackVisibility_()):this.isTextVisible_=!1},shaka.Player.prototype.shouldInitiallyShowText_=function(t,i){var r=shaka.util.LanguageUtils,o=r.normalize(this.config_.preferredTextLanguage),l=r.normalize(t.language),g=r.normalize(i.language);return r.areLanguageCompatible(g,o)&&!r.areLanguageCompatible(l,g)},shaka.Player.prototype.onManifestUpdate_=function(){this.parser_&&this.parser_.update&&this.parser_.update()},shaka.Player.prototype.onSegmentAppended_=function(){this.playhead_&&this.playhead_.notifyOfBufferingChange(),this.pollBufferState_()},shaka.Player.prototype.switch_=function(t,i,r){i=void 0!==i&&i,r=void 0===r?0:r,shaka.log.debug("switch_"),goog.asserts.assert(this.config_.abr.enabled,"AbrManager should not call switch while disabled!"),goog.asserts.assert(this.manifest_,"We need a manifest to switch variants."),this.streamingEngine_&&t!=this.streamingEngine_.getCurrentVariant()&&(this.addVariantToSwitchHistory_(t,!0),this.streamingEngine_.switchVariant(t,i,r),this.onAdaptation_())},shaka.Player.prototype.onAdaptation_=function(){var t=this.makeEvent_(shaka.Player.EventName.Adaptation);this.delayDispatchEvent_(t)},shaka.Player.prototype.onTracksChanged_=function(){var t=this.makeEvent_(shaka.Player.EventName.TracksChanged);this.delayDispatchEvent_(t)},shaka.Player.prototype.onVariantChanged_=function(t,i){var r=this.makeEvent_(shaka.Player.EventName.VariantChanged,{oldTrack:t,newTrack:i});this.delayDispatchEvent_(r)},shaka.Player.prototype.onTextChanged_=function(){var t=this.makeEvent_(shaka.Player.EventName.TextChanged);this.delayDispatchEvent_(t)},shaka.Player.prototype.onTextTrackVisibility_=function(){var t=this.makeEvent_(shaka.Player.EventName.TextTrackVisibility);this.delayDispatchEvent_(t)},shaka.Player.prototype.onAbrStatusChanged_=function(){var t=this.makeEvent_(shaka.Player.EventName.AbrStatusChanged,{newStatus:this.config_.abr.enabled});this.delayDispatchEvent_(t)},shaka.Player.prototype.onError_=function(t){if(goog.asserts.assert(t instanceof shaka.util.Error,"Wrong error type!"),this.loadMode_!=shaka.Player.LoadMode.DESTROYED){var i=this.makeEvent_(shaka.Player.EventName.Error,{detail:t});this.dispatchEvent(i),i.defaultPrevented&&(t.handled=!0)}},shaka.Player.prototype.onRegionEvent_=function(t,i){this.dispatchEvent(this.makeEvent_(t,{detail:{schemeIdUri:i.schemeIdUri,value:i.value,startTime:i.startTime,endTime:i.endTime,id:i.id,eventElement:i.eventElement}}))},shaka.Player.prototype.videoErrorToShakaError_=function(){if(goog.asserts.assert(this.video_.error,"Video error expected, but missing!"),!this.video_.error)return null;var t=this.video_.error.code;if(1==t)return null;var i=this.video_.error.msExtendedCode;return i&&(0>i&&(i+=Math.pow(2,32)),i=i.toString(16)),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.VIDEO_ERROR,t,i,this.video_.error.message)},shaka.Player.prototype.onVideoError_=function(t){(t=this.videoErrorToShakaError_())&&this.onError_(t)},shaka.Player.prototype.onKeyStatus_=function(t){if(this.streamingEngine_){var i=Object.keys(t);0==i.length&&shaka.log.warning("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var r=1==i.length&&"00"==i[0];r&&shaka.log.warning("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var o=shaka.Player.restrictedStatuses_,l=!1;if(i.length)for(var g=(i=$jscomp.makeIterator(this.manifest_.variants)).next();!g.done;g=i.next())for(var _=shaka.util.StreamUtils.getVariantStreams(g=g.value),v=(_=$jscomp.makeIterator(_)).next();!v.done;v=_.next()){var E=v.value;if(v=g.allowedByKeySystem,E.keyIds.size){g.allowedByKeySystem=!0;for(var P=(E=$jscomp.makeIterator(E.keyIds)).next();!P.done;P=E.next())P=P.value,P=t[r?"00":P],g.allowedByKeySystem=g.allowedByKeySystem&&!!P&&!o.includes(P)}v!=g.allowedByKeySystem&&(l=!0)}l&&this.updateAbrManagerVariants_(),(t=this.streamingEngine_.getCurrentVariant())&&!t.allowedByKeySystem&&(shaka.log.debug("Choosing new streams after key status changed"),this.chooseVariantAndSwitch_()),l&&this.onTracksChanged_()}},shaka.Player.prototype.onExpirationUpdated_=function(t,i){this.parser_&&this.parser_.onExpirationUpdated&&this.parser_.onExpirationUpdated(t,i);var r=this.makeEvent_(shaka.Player.EventName.ExpirationUpdated);this.dispatchEvent(r)},shaka.Player.prototype.shouldStreamText_=function(){return this.config_.streaming.alwaysStreamText||this.isTextTrackVisible()},shaka.Player.applyPlayRange_=function(t,i,r){0<i&&(t.isLive()?shaka.log.warning("|playRangeStart| has been configured for live content. Ignoring the setting."):t.setUserSeekStart(i)),r<(i=t.getDuration())&&(t.isLive()?shaka.log.warning("|playRangeEnd| has been configured for live content. Ignoring the setting."):t.setDuration(r))},shaka.Player.prototype.checkRestrictedVariants_=function(t){var i=shaka.Player.restrictedStatuses_,r=this.drmEngine_?this.drmEngine_.getKeyStatuses():{},o=Object.keys(r);o=o.length&&"00"==o[0];for(var l=!1,g=!1,_=new Set,v=new Set,E=(t=$jscomp.makeIterator(t.variants)).next();!E.done;E=t.next()){var P=[];(E=E.value).audio&&P.push(E.audio),E.video&&P.push(E.video);for(var M=(P=$jscomp.makeIterator(P)).next();!M.done;M=P.next())if((M=M.value).keyIds.size)for(var R=(M=$jscomp.makeIterator(M.keyIds)).next();!R.done;R=M.next()){R=R.value;var U=r[o?"00":R];U?i.includes(U)&&v.add(U):_.add(R)}E.allowedByApplication?E.allowedByKeySystem&&(l=!0):g=!0}if(!l)throw i={hasAppRestrictions:g,missingKeys:Array.from(_),restrictedKeyStatuses:Array.from(v)},new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.RESTRICTIONS_CANNOT_BE_MET,i)},shaka.Player.prototype.checkPlayableVariants_=function(t){if(!t.variants.some(shaka.util.StreamUtils.isPlayable))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CONTENT_UNSUPPORTED_BY_BROWSER)},shaka.Player.prototype.delayDispatchEvent_=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return r.yield(Promise.resolve(),2);i.loadMode_!=shaka.Player.LoadMode.DESTROYED&&i.dispatchEvent(t),r.jumpToEnd()})},shaka.Player.getLanguagesFrom_=function(t){for(var i=new Set,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())i.add((r=r.value).language?shaka.util.LanguageUtils.normalize(r.language):"und");return i},shaka.Player.getLanguageAndRolesFrom_=function(t){for(var i=new Map,r=new Map,o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next()){var l="und",g=[];(o=o.value).language&&(l=shaka.util.LanguageUtils.normalize(o.language)),(g="variant"==o.type?o.audioRoles:o.roles)&&g.length||(g=[""]),i.has(l)||i.set(l,new Set);for(var _=(g=$jscomp.makeIterator(g)).next();!_.done;_=g.next())_=_.value,i.get(l).add(_),o.label&&(r.has(l)||r.set(l,new Map),r.get(l).set(_,o.label))}var v=[];return i.forEach(function(E,P){for(var M=$jscomp.makeIterator(E),R=M.next();!R.done;R=M.next()){R=R.value;var U=null;r.has(P)&&r.get(P).has(R)&&(U=r.get(P).get(R)),v.push({language:P,role:R,label:U})}}),v},shaka.Player.prototype.isBufferedToEndMS_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),goog.asserts.assert(this.mediaSourceEngine_,"We need a media source engine to get buffering information"),goog.asserts.assert(this.manifest_,"We need a manifest to get buffering information"),this.video_.ended||this.mediaSourceEngine_.ended())return!0;if(this.manifest_.presentationTimeline.isLive()){var t=this.manifest_.presentationTimeline.getSegmentAvailabilityEnd(),i=shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered);if(null!=i&&i>=t)return!0}return!1},shaka.Player.prototype.isBufferedToEndSrc_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),this.video_.ended)return!0;var t=shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered);return null!=t&&t>=this.video_.duration-1},shaka.Player.prototype.createAbortLoadError_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED)},shaka.Player.prototype.getNextStep_=function(t,i,r,o){var l=null;return t==this.detachNode_&&(l=r==this.detachNode_?this.detachNode_:this.attachNode_),t==this.attachNode_&&(l=this.getNextAfterAttach_(r,i,o)),t==this.mediaSourceNode_&&(l=this.getNextAfterMediaSource_(r,i,o)),t==this.parserNode_&&(l=this.getNextMatchingAllDependencies_(this.loadNode_,this.manifestNode_,this.unloadNode_,r,i,o)),t==this.manifestNode_&&(l=this.getNextMatchingAllDependencies_(this.loadNode_,this.drmNode_,this.unloadNode_,r,i,o)),t==this.drmNode_&&(l=this.getNextMatchingAllDependencies_(this.loadNode_,this.loadNode_,this.unloadNode_,r,i,o)),t==this.srcEqualsDrmNode_&&(l=r==this.srcEqualsNode_&&i.mediaElement==o.mediaElement?this.srcEqualsNode_:this.unloadNode_),(t==this.loadNode_||t==this.srcEqualsNode_)&&(l=this.unloadNode_),t==this.unloadNode_&&(l=this.getNextAfterUnload_(r,i,o)),goog.asserts.assert(l,"Missing next step!"),l},shaka.Player.prototype.getNextAfterAttach_=function(t,i,r){return t==this.detachNode_||i.mediaElement!=r.mediaElement?this.detachNode_:t==this.attachNode_?this.attachNode_:t==this.mediaSourceNode_||t==this.loadNode_?this.mediaSourceNode_:t==this.srcEqualsNode_?this.srcEqualsDrmNode_:null},shaka.Player.prototype.getNextAfterMediaSource_=function(t,i,r){return t==this.loadNode_&&i.mediaElement==r.mediaElement?this.parserNode_:this.unloadNode_},shaka.Player.prototype.getNextAfterUnload_=function(t,i,r){return r.mediaElement&&i.mediaElement==r.mediaElement?this.attachNode_:this.detachNode_},shaka.Player.prototype.getNextMatchingAllDependencies_=function(t,i,r,o,l,g){return o==t&&l.mediaElement==g.mediaElement&&l.uri==g.uri&&l.mimeType==g.mimeType?i:r},shaka.Player.createEmptyPayload_=function(){return{mediaElement:null,mimeType:null,startTime:null,startTimeOfLoad:NaN,uri:null}},shaka.Player.prototype.wrapWalkerListenersWithPromise_=function(t){var i=this;return new Promise(function(r,o){t.onCancel=function(){return o(i.createAbortLoadError_())},t.onEnd=function(){return r()},t.onError=function(l){return o(l)},t.onSkip=function(){return o(i.createAbortLoadError_())}})},goog.exportSymbol("shaka.Player",shaka.Player),goog.exportProperty(shaka.Player.prototype,"setVideoContainer",shaka.Player.prototype.setVideoContainer),goog.exportProperty(shaka.Player.prototype,"getManifestParserFactory",shaka.Player.prototype.getManifestParserFactory),goog.exportProperty(shaka.Player.prototype,"getManifest",shaka.Player.prototype.getManifest),goog.exportProperty(shaka.Player.prototype,"retryStreaming",shaka.Player.prototype.retryStreaming),goog.exportProperty(shaka.Player.prototype,"setMaxHardwareResolution",shaka.Player.prototype.setMaxHardwareResolution),goog.exportProperty(shaka.Player.prototype,"addTextTrackAsync",shaka.Player.prototype.addTextTrackAsync),goog.exportProperty(shaka.Player.prototype,"addTextTrack",shaka.Player.prototype.addTextTrack),goog.exportProperty(shaka.Player.prototype,"getStats",shaka.Player.prototype.getStats),goog.exportProperty(shaka.Player.prototype,"getBufferedInfo",shaka.Player.prototype.getBufferedInfo),goog.exportProperty(shaka.Player.prototype,"getPresentationStartTimeAsDate",shaka.Player.prototype.getPresentationStartTimeAsDate),goog.exportProperty(shaka.Player.prototype,"getPlayheadTimeAsDate",shaka.Player.prototype.getPlayheadTimeAsDate),goog.exportProperty(shaka.Player.prototype,"setTextTrackVisibility",shaka.Player.prototype.setTextTrackVisibility),goog.exportProperty(shaka.Player.prototype,"isTextTrackVisible",shaka.Player.prototype.isTextTrackVisible),goog.exportProperty(shaka.Player.prototype,"selectVariantsByLabel",shaka.Player.prototype.selectVariantsByLabel),goog.exportProperty(shaka.Player.prototype,"selectTextLanguage",shaka.Player.prototype.selectTextLanguage),goog.exportProperty(shaka.Player.prototype,"selectAudioLanguage",shaka.Player.prototype.selectAudioLanguage),goog.exportProperty(shaka.Player.prototype,"getTextLanguages",shaka.Player.prototype.getTextLanguages),goog.exportProperty(shaka.Player.prototype,"getAudioLanguages",shaka.Player.prototype.getAudioLanguages),goog.exportProperty(shaka.Player.prototype,"getTextLanguagesAndRoles",shaka.Player.prototype.getTextLanguagesAndRoles),goog.exportProperty(shaka.Player.prototype,"getAudioLanguagesAndRoles",shaka.Player.prototype.getAudioLanguagesAndRoles),goog.exportProperty(shaka.Player.prototype,"selectVariantTrack",shaka.Player.prototype.selectVariantTrack),goog.exportProperty(shaka.Player.prototype,"selectTextTrack",shaka.Player.prototype.selectTextTrack),goog.exportProperty(shaka.Player.prototype,"getThumbnails",shaka.Player.prototype.getThumbnails),goog.exportProperty(shaka.Player.prototype,"getImageTracks",shaka.Player.prototype.getImageTracks),goog.exportProperty(shaka.Player.prototype,"getTextTracks",shaka.Player.prototype.getTextTracks),goog.exportProperty(shaka.Player.prototype,"getVariantTracks",shaka.Player.prototype.getVariantTracks),goog.exportProperty(shaka.Player.prototype,"cancelTrickPlay",shaka.Player.prototype.cancelTrickPlay),goog.exportProperty(shaka.Player.prototype,"trickPlay",shaka.Player.prototype.trickPlay),goog.exportProperty(shaka.Player.prototype,"getPlaybackRate",shaka.Player.prototype.getPlaybackRate),goog.exportProperty(shaka.Player.prototype,"isBuffering",shaka.Player.prototype.isBuffering),goog.exportProperty(shaka.Player.prototype,"getKeyStatuses",shaka.Player.prototype.getKeyStatuses),goog.exportProperty(shaka.Player.prototype,"getExpiration",shaka.Player.prototype.getExpiration),goog.exportProperty(shaka.Player.prototype,"drmInfo",shaka.Player.prototype.drmInfo),goog.exportProperty(shaka.Player.prototype,"keySystem",shaka.Player.prototype.keySystem),goog.exportProperty(shaka.Player.prototype,"seekRange",shaka.Player.prototype.seekRange),goog.exportProperty(shaka.Player.prototype,"isAudioOnly",shaka.Player.prototype.isAudioOnly),goog.exportProperty(shaka.Player.prototype,"isInProgress",shaka.Player.prototype.isInProgress),goog.exportProperty(shaka.Player.prototype,"isLive",shaka.Player.prototype.isLive),goog.exportProperty(shaka.Player.prototype,"getAdManager",shaka.Player.prototype.getAdManager),goog.exportProperty(shaka.Player.prototype,"getAssetUri",shaka.Player.prototype.getAssetUri),goog.exportProperty(shaka.Player.prototype,"getNetworkingEngine",shaka.Player.prototype.getNetworkingEngine),goog.exportProperty(shaka.Player.prototype,"getMediaElement",shaka.Player.prototype.getMediaElement),goog.exportProperty(shaka.Player.prototype,"getLoadMode",shaka.Player.prototype.getLoadMode),goog.exportProperty(shaka.Player.prototype,"resetConfiguration",shaka.Player.prototype.resetConfiguration),goog.exportProperty(shaka.Player.prototype,"getBufferFullness",shaka.Player.prototype.getBufferFullness),goog.exportProperty(shaka.Player.prototype,"getConfiguration",shaka.Player.prototype.getConfiguration),goog.exportProperty(shaka.Player.prototype,"configure",shaka.Player.prototype.configure),goog.exportProperty(shaka.Player.prototype,"load",shaka.Player.prototype.load),goog.exportProperty(shaka.Player.prototype,"unload",shaka.Player.prototype.unload),goog.exportProperty(shaka.Player.prototype,"detach",shaka.Player.prototype.detach),goog.exportProperty(shaka.Player.prototype,"attach",shaka.Player.prototype.attach),goog.exportProperty(shaka.Player,"probeSupport",shaka.Player.probeSupport),goog.exportProperty(shaka.Player,"isBrowserSupported",shaka.Player.isBrowserSupported),goog.exportProperty(shaka.Player,"setAdManagerFactory",shaka.Player.setAdManagerFactory),goog.exportProperty(shaka.Player,"registerSupportPlugin",shaka.Player.registerSupportPlugin),goog.exportProperty(shaka.Player.prototype,"destroy",shaka.Player.prototype.destroy),shaka.Player.EventName={AbrStatusChanged:"abrstatuschanged",Adaptation:"adaptation",Buffering:"buffering",DrmSessionUpdate:"drmsessionupdate",Emsg:"emsg",Error:"error",ExpirationUpdated:"expirationupdated",LargeGap:"largegap",Loaded:"loaded",Loading:"loading",ManifestParsed:"manifestparsed",Metadata:"metadata",OnStateChange:"onstatechange",OnStateIdle:"onstateidle",RateChange:"ratechange",SessionDataEvent:"sessiondata",Streaming:"streaming",TextChanged:"textchanged",TextTrackVisibility:"texttrackvisibility",TimelineRegionAdded:"timelineregionadded",TimelineRegionEnter:"timelineregionenter",TimelineRegionExit:"timelineregionexit",TracksChanged:"trackschanged",Unloading:"unloading",VariantChanged:"variantchanged"},shaka.Player.LoadMode={DESTROYED:0,NOT_LOADED:1,MEDIA_SOURCE:2,SRC_EQUALS:3},goog.exportProperty(shaka.Player,"LoadMode",shaka.Player.LoadMode),shaka.Player.TYPICAL_BUFFERING_THRESHOLD_=.5,shaka.Player.version="v3.1.0-master-16-g87797157-debug",goog.exportProperty(shaka.Player,"version",shaka.Player.version),shaka.Deprecate.init(shaka.Player.version),shaka.Player.restrictedStatuses_=["output-restricted","internal-error"],shaka.Player.supportPlugins_={},shaka.Player.adManagerFactory_=null,shaka.Player.SRC_EQUAL_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"},shaka.Player.TextTrackLabel="Shaka Player TextTrack",shaka.ads={},shaka.ads.AdsStats=function(){this.loadTimes_=[],this.skipped_=this.playedCompletely_=this.started_=0},shaka.ads.AdsStats.prototype.addLoadTime=function(t){this.loadTimes_.push(t)},shaka.ads.AdsStats.prototype.incrementStarted=function(){this.started_++},shaka.ads.AdsStats.prototype.incrementPlayedCompletely=function(){this.playedCompletely_++},shaka.ads.AdsStats.prototype.incrementSkipped=function(){this.skipped_++},shaka.ads.AdsStats.prototype.getBlob=function(){return{loadTimes:this.loadTimes_,started:this.started_,playedCompletely:this.playedCompletely_,skipped:this.skipped_}},shaka.ads.ClientSideAd=function(t,i){var r=this;this.ad_=t,this.manager_=i,this.isPaused_=!1,this.volume_=this.manager_.getVolume(),this.eventManager_=new shaka.util.EventManager,this.eventManager_.listen(this.manager_,google.ima.AdEvent.Type.PAUSED,function(){r.isPaused_=!0}),this.eventManager_.listen(this.manager_,google.ima.AdEvent.Type.RESUMED,function(){r.isPaused_=!1})},shaka.ads.ClientSideAd.prototype.getDuration=function(){return this.ad_.getDuration()},shaka.ads.ClientSideAd.prototype.getMinSuggestedDuration=function(){return this.ad_.getMinSuggestedDuration()},shaka.ads.ClientSideAd.prototype.getRemainingTime=function(){return this.manager_.getRemainingTime()},shaka.ads.ClientSideAd.prototype.isPaused=function(){return this.isPaused_},shaka.ads.ClientSideAd.prototype.isSkippable=function(){return 0<=this.ad_.getSkipTimeOffset()},shaka.ads.ClientSideAd.prototype.getTimeUntilSkippable=function(){var t=this.ad_.getSkipTimeOffset();return t=this.getRemainingTime()-t,Math.max(t,0)},shaka.ads.ClientSideAd.prototype.canSkipNow=function(){return this.manager_.getAdSkippableState()},shaka.ads.ClientSideAd.prototype.skip=function(){return this.manager_.skip()},shaka.ads.ClientSideAd.prototype.setPaused=function(t){this.isPaused_=t},shaka.ads.ClientSideAd.prototype.pause=function(){return this.manager_.pause()},shaka.ads.ClientSideAd.prototype.play=function(){return this.manager_.resume()},shaka.ads.ClientSideAd.prototype.getVolume=function(){return this.manager_.getVolume()},shaka.ads.ClientSideAd.prototype.setVolume=function(t){return this.manager_.setVolume(t)},shaka.ads.ClientSideAd.prototype.isMuted=function(){return 0==this.manager_.getVolume()},shaka.ads.ClientSideAd.prototype.resize=function(t,i){this.manager_.resize(t,i,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},shaka.ads.ClientSideAd.prototype.setMuted=function(t){t?(this.volume_=this.getVolume(),this.setVolume(0)):this.setVolume(this.volume_)},shaka.ads.ClientSideAd.prototype.getSequenceLength=function(){var t=this.ad_.getAdPodInfo();return null==t?1:t.getTotalAds()},shaka.ads.ClientSideAd.prototype.getPositionInSequence=function(){var t=this.ad_.getAdPodInfo();return null==t?1:t.getAdPosition()},shaka.ads.ClientSideAd.prototype.release=function(){this.manager_=this.ad_=null},goog.exportSymbol("shaka.ads.ClientSideAd",shaka.ads.ClientSideAd),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"release",shaka.ads.ClientSideAd.prototype.release),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getPositionInSequence",shaka.ads.ClientSideAd.prototype.getPositionInSequence),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getSequenceLength",shaka.ads.ClientSideAd.prototype.getSequenceLength),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"setMuted",shaka.ads.ClientSideAd.prototype.setMuted),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"resize",shaka.ads.ClientSideAd.prototype.resize),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isMuted",shaka.ads.ClientSideAd.prototype.isMuted),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"setVolume",shaka.ads.ClientSideAd.prototype.setVolume),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getVolume",shaka.ads.ClientSideAd.prototype.getVolume),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"play",shaka.ads.ClientSideAd.prototype.play),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"pause",shaka.ads.ClientSideAd.prototype.pause),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"skip",shaka.ads.ClientSideAd.prototype.skip),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"canSkipNow",shaka.ads.ClientSideAd.prototype.canSkipNow),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getTimeUntilSkippable",shaka.ads.ClientSideAd.prototype.getTimeUntilSkippable),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isSkippable",shaka.ads.ClientSideAd.prototype.isSkippable),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isPaused",shaka.ads.ClientSideAd.prototype.isPaused),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getRemainingTime",shaka.ads.ClientSideAd.prototype.getRemainingTime),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getMinSuggestedDuration",shaka.ads.ClientSideAd.prototype.getMinSuggestedDuration),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getDuration",shaka.ads.ClientSideAd.prototype.getDuration),shaka.ads.ClientSideAdManager=function(t,i,r,o){var l=this;this.adContainer_=t,this.video_=i,this.requestAdsStartTime_=NaN,this.onEvent_=o,this.ad_=null,this.eventManager_=new shaka.util.EventManager,google.ima.settings.setLocale(r),(t=new google.ima.AdDisplayContainer(this.adContainer_,this.video_)).initialize(),this.adsLoader_=new google.ima.AdsLoader(t),this.adsLoader_.getSettings().setPlayerType("shaka-player"),this.adsLoader_.getSettings().setPlayerVersion(shaka.Player.version),this.imaAdsManager_=null,this.eventManager_.listenOnce(this.adsLoader_,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(g){l.onAdsManagerLoaded_(g)}),this.eventManager_.listen(this.adsLoader_,google.ima.AdErrorEvent.Type.AD_ERROR,function(g){l.onAdError_(g)}),this.video_.onended=function(){l.adsLoader_.contentComplete()}},shaka.ads.ClientSideAdManager.prototype.requestAds=function(t){goog.asserts.assert(t.adTagUrl||t.adsResponse,"The ad tag needs to be set up before requesting ads, or adsResponse must be filled."),this.requestAdsStartTime_=Date.now()/1e3,this.adsLoader_.requestAds(t)},shaka.ads.ClientSideAdManager.prototype.stop=function(){this.imaAdsManager_&&this.imaAdsManager_.stop(),this.adContainer_&&shaka.util.Dom.removeAllChildren(this.adContainer_)},shaka.ads.ClientSideAdManager.prototype.onAdError_=function(t){shaka.log.warning("There was an ad error from the IMA SDK: "+t.getError()),shaka.log.warning("Resuming playback."),this.onAdComplete_(null),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,{cuepoints:[]}))},shaka.ads.ClientSideAdManager.prototype.onAdsManagerLoaded_=function(t){var i=this;goog.asserts.assert(null!=this.video_,"Video should not be null!");var r=Date.now()/1e3-this.requestAdsStartTime_;if(this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ADS_LOADED,{loadTime:r})),this.imaAdsManager_=t.getAdsManager(this.video_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.IMA_AD_MANAGER_LOADED,{imaAdManager:this.imaAdsManager_})),(r=this.imaAdsManager_.getCuePoints()).length){t=[];for(var o=(r=$jscomp.makeIterator(r)).next();!o.done;o=r.next())o=new shaka.ads.CuePoint(o.value),t.push(o);this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,{cuepoints:t}))}this.addImaEventListeners_();try{this.imaAdsManager_.init(this.video_.offsetWidth,this.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),this.eventManager_.listen(this.video_,"loadeddata",function(){i.imaAdsManager_.resize(i.video_.offsetWidth,i.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),this.imaAdsManager_.start()}catch(l){this.onAdComplete_(null)}},shaka.ads.ClientSideAdManager.prototype.addImaEventListeners_=function(){var t=this;this.eventManager_.listen(this.imaAdsManager_,google.ima.AdErrorEvent.Type.AD_ERROR,function(i){t.onAdError_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(i){t.onAdStart_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.STARTED,function(i){t.onAdStart_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.FIRST_QUARTILE,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_FIRST_QUARTILE,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.MIDPOINT,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MIDPOINT,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.THIRD_QUARTILE,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_THIRD_QUARTILE,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.COMPLETE,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_COMPLETE,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(i){t.onAdComplete_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(i){t.onAdComplete_(i)}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.SKIPPED,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIPPED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.VOLUME_CHANGED,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_VOLUME_CHANGED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.VOLUME_MUTED,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MUTED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.PAUSED,function(i){goog.asserts.assert(null!=t.ad_,"Ad should not be null!"),t.ad_.setPaused(!0),t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_PAUSED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.RESUMED,function(i){goog.asserts.assert(null!=t.ad_,"Ad should not be null!"),t.ad_.setPaused(!1),t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_RESUMED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(i){goog.asserts.assert(null!=t.ad_,"Ad should not be null!"),t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIP_STATE_CHANGED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CLICK,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_CLICKED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_PROGRESS,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_PROGRESS,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_BUFFERING,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_BUFFERING,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.IMPRESSION,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_IMPRESSION,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.DURATION_CHANGE,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_DURATION_CHANGED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.USER_CLOSE,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_CLOSED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LOADED,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_LOADED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ALL_ADS_COMPLETED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LINEAR_CHANGED,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_LINEAR_CHANGED,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_METADATA,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_METADATA,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LOG,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_RECOVERABLE_ERROR,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_BREAK_READY,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_BREAK_READY,{originalEvent:i}))}),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.INTERACTION,function(i){t.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_INTERACTION,{originalEvent:i}))})},shaka.ads.ClientSideAdManager.prototype.onAdStart_=function(t){goog.asserts.assert(this.imaAdsManager_,"Should have an ads manager at this point!");var i=t.getAd();this.ad_=new shaka.ads.ClientSideAd(i,this.imaAdsManager_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STARTED,{ad:this.ad_,sdkAdObject:i,originalEvent:t})),this.adContainer_.setAttribute("ad-active","true"),this.video_.pause()},shaka.ads.ClientSideAdManager.prototype.onAdComplete_=function(t){this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED,{originalEvent:t})),this.adContainer_.removeAttribute("ad-active"),this.video_.play()},shaka.ads.ServerSideAd=function(t,i){this.ad_=t,this.adProgressData_=null,this.video_=i},shaka.ads.ServerSideAd.prototype.setProgressData=function(t){this.adProgressData_=t},shaka.ads.ServerSideAd.prototype.getDuration=function(){return this.adProgressData_?this.adProgressData_.duration:-1},shaka.ads.ServerSideAd.prototype.getMinSuggestedDuration=function(){return this.getDuration()},shaka.ads.ServerSideAd.prototype.getRemainingTime=function(){return this.adProgressData_?this.adProgressData_.duration-this.adProgressData_.currentTime:-1},shaka.ads.ServerSideAd.prototype.isPaused=function(){return this.video_.paused},shaka.ads.ServerSideAd.prototype.isSkippable=function(){return this.ad_.isSkippable()},shaka.ads.ServerSideAd.prototype.getTimeUntilSkippable=function(){var t=this.ad_.getSkipTimeOffset();return t=this.getRemainingTime()-t,Math.max(t,0)},shaka.ads.ServerSideAd.prototype.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},shaka.ads.ServerSideAd.prototype.skip=function(){this.video_.currentTime+=this.getRemainingTime()},shaka.ads.ServerSideAd.prototype.pause=function(){return this.video_.pause()},shaka.ads.ServerSideAd.prototype.play=function(){return this.video_.play()},shaka.ads.ServerSideAd.prototype.getVolume=function(){return this.video_.volume},shaka.ads.ServerSideAd.prototype.setVolume=function(t){this.video_.volume=t},shaka.ads.ServerSideAd.prototype.isMuted=function(){return this.video_.muted},shaka.ads.ServerSideAd.prototype.resize=function(t,i){},shaka.ads.ServerSideAd.prototype.setMuted=function(t){this.video_.muted=t},shaka.ads.ServerSideAd.prototype.getSequenceLength=function(){var t=this.ad_.getAdPodInfo();return null==t?1:t.getTotalAds()},shaka.ads.ServerSideAd.prototype.getPositionInSequence=function(){var t=this.ad_.getAdPodInfo();return null==t?1:t.getAdPosition()},shaka.ads.ServerSideAd.prototype.release=function(){this.video_=this.adProgressData_=this.ad_=null},goog.exportSymbol("shaka.ads.ServerSideAd",shaka.ads.ServerSideAd),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"release",shaka.ads.ServerSideAd.prototype.release),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getPositionInSequence",shaka.ads.ServerSideAd.prototype.getPositionInSequence),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getSequenceLength",shaka.ads.ServerSideAd.prototype.getSequenceLength),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"setMuted",shaka.ads.ServerSideAd.prototype.setMuted),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"resize",shaka.ads.ServerSideAd.prototype.resize),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isMuted",shaka.ads.ServerSideAd.prototype.isMuted),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"setVolume",shaka.ads.ServerSideAd.prototype.setVolume),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getVolume",shaka.ads.ServerSideAd.prototype.getVolume),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"play",shaka.ads.ServerSideAd.prototype.play),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"pause",shaka.ads.ServerSideAd.prototype.pause),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"skip",shaka.ads.ServerSideAd.prototype.skip),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"canSkipNow",shaka.ads.ServerSideAd.prototype.canSkipNow),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getTimeUntilSkippable",shaka.ads.ServerSideAd.prototype.getTimeUntilSkippable),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isSkippable",shaka.ads.ServerSideAd.prototype.isSkippable),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isPaused",shaka.ads.ServerSideAd.prototype.isPaused),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getRemainingTime",shaka.ads.ServerSideAd.prototype.getRemainingTime),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getMinSuggestedDuration",shaka.ads.ServerSideAd.prototype.getMinSuggestedDuration),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getDuration",shaka.ads.ServerSideAd.prototype.getDuration),shaka.ads.ServerSideAdManager=function(t,i,r,o){var l=this;this.adContainer_=t,this.video_=i,this.streamPromise_=null,this.streamRequestStartTime_=NaN,this.onEvent_=o,this.isLiveContent_=!1,this.adProgressData_=this.ad_=this.snapForwardTime_=null,this.backupUrl_="",this.eventManager_=new shaka.util.EventManager,(t=new google.ima.dai.api.UiSettings).setLocale(r),this.streamManager_=new google.ima.dai.api.StreamManager(this.video_,this.adContainer_,t),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.IMA_STREAM_MANAGER_LOADED,{imaStreamManager:this.streamManager_})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.LOADED,function(g){shaka.log.info("Ad SS Loaded"),l.onLoaded_(g)}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.ERROR,function(){shaka.log.info("Ad SS Error"),l.onError_()}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,function(){shaka.log.info("Ad Break Started")}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.STARTED,function(g){shaka.log.info("Ad Started"),l.onAdStart_(g)}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,function(){shaka.log.info("Ad Break Ended"),l.onAdBreakEnded_()}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,function(g){l.onAdProgress_(g)}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,function(){shaka.log.info("Ad event: First Quartile"),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_FIRST_QUARTILE))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.MIDPOINT,function(){shaka.log.info("Ad event: Midpoint"),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MIDPOINT))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,function(){shaka.log.info("Ad event: Third Quartile"),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_THIRD_QUARTILE))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.COMPLETE,function(){shaka.log.info("Ad event: Complete"),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_COMPLETE)),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED)),l.adContainer_.removeAttribute("ad-active"),l.ad_=null}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.SKIPPED,function(){shaka.log.info("Ad event: Skipped"),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIPPED)),l.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED))}),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,function(g){shaka.log.info("Ad event: Cue points changed"),l.onCuePointsChanged_(g)})},shaka.ads.ServerSideAdManager.prototype.streamRequest=function(t,i){return this.streamPromise_?Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CURRENT_DAI_REQUEST_NOT_FINISHED)):(t instanceof google.ima.dai.api.LiveStreamRequest&&(this.isLiveContent_=!0),this.streamPromise_=new shaka.util.PublicPromise,this.streamManager_.requestStream(t),this.backupUrl_=i||"",this.streamRequestStartTime_=Date.now()/1e3,this.streamPromise_)},shaka.ads.ServerSideAdManager.prototype.replaceAdTagParameters=function(t){this.streamManager_.replaceAdTagParameters(t)},shaka.ads.ServerSideAdManager.prototype.stop=function(){this.streamManager_.reset(),this.backupUrl_="",this.snapForwardTime_=null},shaka.ads.ServerSideAdManager.prototype.onTimedMetadata=function(t,i,r){this.streamManager_.processMetadata(t,i,r)},shaka.ads.ServerSideAdManager.prototype.onCueMetadataChange=function(t){if(t.key&&t.data){var i={};i[t.key]=t.data,this.streamManager_.onTimedMetadata(i)}},shaka.ads.ServerSideAdManager.prototype.checkForSnapback_=function(){var t=this.video_.currentTime;if(0!=t){this.streamManager_.streamTimeForContentTime(t);var i=this.streamManager_.previousCuePointForStreamTime(t);i&&!i.played&&(shaka.log.info("Seeking back to the start of the ad break at "+i.start+" and will return to "+t),this.snapForwardTime_=t,this.video_.currentTime=i.start)}},shaka.ads.ServerSideAdManager.prototype.onAdStart_=function(t){goog.asserts.assert(this.streamManager_,"Should have a stream manager at this point!"),t=t.getAd(),this.ad_=new shaka.ads.ServerSideAd(t,this.video_),this.adProgressData_&&this.ad_.setProgressData(this.adProgressData_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STARTED,{ad:this.ad_})),this.adContainer_.setAttribute("ad-active","true")},shaka.ads.ServerSideAdManager.prototype.onAdBreakEnded_=function(){this.adContainer_.removeAttribute("ad-active"),this.snapForwardTime_&&this.snapForwardTime_>this.video_.currentTime&&(this.video_.currentTime=this.snapForwardTime_,this.snapForwardTime_=null)},shaka.ads.ServerSideAdManager.prototype.onLoaded_=function(t){var i=this,r=Date.now()/1e3-this.streamRequestStartTime_;this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ADS_LOADED,{loadTime:r})),t=t.getStreamData().url,this.streamPromise_.resolve(t),this.streamPromise_=null,this.isLiveContent_||this.eventManager_.listen(this.video_,"seeked",function(){i.checkForSnapback_()})},shaka.ads.ServerSideAdManager.prototype.onError_=function(){this.backupUrl_.length?(shaka.log.warning("IMA stream request returned an error. Falling back to the backup asset uri."),this.streamPromise_.resolve(this.backupUrl_)):this.streamPromise_.reject("IMA Stream request returned an error and there was no backup asset uri provided."),this.streamPromise_=null},shaka.ads.ServerSideAdManager.prototype.onAdProgress_=function(t){this.adProgressData_=t.getStreamData().adProgressData,this.ad_&&this.ad_.setProgressData(this.adProgressData_)},shaka.ads.ServerSideAdManager.prototype.onCuePointsChanged_=function(t){var i=t.getStreamData();t=[];for(var r=(i=$jscomp.makeIterator(i.cuepoints)).next();!r.done;r=i.next())r=new shaka.ads.CuePoint((r=r.value).start,r.end),t.push(r);this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,{cuepoints:t}))},shaka.ads.AdManager=function(){shaka.util.FakeEventTarget.call(this),this.ssAdManager_=this.csAdManager_=null,this.stats_=new shaka.ads.AdsStats,this.locale_=navigator.language},$jscomp.inherits(shaka.ads.AdManager,shaka.util.FakeEventTarget),shaka.ads.AdManager.prototype.setLocale=function(t){this.locale_=t},shaka.ads.AdManager.prototype.initClientSide=function(t,i){var r=this;if(!window.google||!google.ima||!google.ima.AdsLoader)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CS_IMA_SDK_MISSING);this.csAdManager_=new shaka.ads.ClientSideAdManager(t,i,this.locale_,function(o){if(o&&o.type)switch(o.type){case shaka.ads.AdManager.ADS_LOADED:r.stats_.addLoadTime(o.loadTime);break;case shaka.ads.AdManager.AD_STARTED:r.stats_.incrementStarted();break;case shaka.ads.AdManager.AD_COMPLETE:r.stats_.incrementPlayedCompletely();break;case shaka.ads.AdManager.AD_SKIPPED:r.stats_.incrementSkipped()}r.dispatchEvent(o)})},shaka.ads.AdManager.prototype.onAssetUnload=function(){this.csAdManager_&&this.csAdManager_.stop(),this.dispatchEvent(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED)),this.stats_=new shaka.ads.AdsStats},shaka.ads.AdManager.prototype.requestClientSideAds=function(t){if(!this.csAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CS_AD_MANAGER_NOT_INITIALIZED);this.csAdManager_.requestAds(t)},shaka.ads.AdManager.prototype.initServerSide=function(t,i){var r=this;if(!window.google||!google.ima||!google.ima.dai)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_IMA_SDK_MISSING);this.ssAdManager_=new shaka.ads.ServerSideAdManager(t,i,this.locale_,function(o){if(o&&o.type)switch(o.type){case shaka.ads.AdManager.ADS_LOADED:r.stats_.addLoadTime(o.loadTime);break;case shaka.ads.AdManager.AD_STARTED:r.stats_.incrementStarted();break;case shaka.ads.AdManager.AD_COMPLETE:r.stats_.incrementPlayedCompletely();break;case shaka.ads.AdManager.AD_SKIPPED:r.stats_.incrementSkipped()}r.dispatchEvent(o)})},shaka.ads.AdManager.prototype.requestServerSideStream=function(t,i){if(i=void 0===i?"":i,!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);t.adTagParameters||(t.adTagParameters={});var r=t.adTagParameters;return(r.mpt||r.mpv)&&shaka.log.alwaysWarn('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),t.adTagParameters.mpt="shaka-player",t.adTagParameters.mpv=shaka.Player.version,this.ssAdManager_.streamRequest(t,i)},shaka.ads.AdManager.prototype.replaceServerSideAdTagParameters=function(t){if(!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);(t.mpt||t.mpv)&&shaka.log.alwaysWarn('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),t.mpt="Shaka Player",t.mpv=shaka.Player.version,this.ssAdManager_.replaceAdTagParameters(t)},shaka.ads.AdManager.prototype.getStats=function(){return this.stats_.getBlob()},shaka.ads.AdManager.prototype.onDashTimedMetadata=function(t){if(this.ssAdManager_&&"urn:google:dai:2018"==t.schemeIdUri){var i=t.schemeIdUri,r=t.eventElement?t.eventElement.getAttribute("messageData"):null;this.ssAdManager_.onTimedMetadata(i,r,t.startTime)}},shaka.ads.AdManager.prototype.onHlsTimedMetadata=function(t,i){this.ssAdManager_?this.ssAdManager_.onTimedMetadata("ID3",t.data,i):shaka.log.warning("ID3 metadata processing was called without initializing server side ad logic. Ad-related metadata will not take effect")},shaka.ads.AdManager.prototype.onCueMetadataChange=function(t){this.ssAdManager_?this.ssAdManager_.onCueMetadataChange(t):shaka.log.warning("ID3 metadata processing was called without initializing server side ad logic. Ad-related metadata will not take effect")},goog.exportSymbol("shaka.ads.AdManager",shaka.ads.AdManager),goog.exportProperty(shaka.ads.AdManager.prototype,"onCueMetadataChange",shaka.ads.AdManager.prototype.onCueMetadataChange),goog.exportProperty(shaka.ads.AdManager.prototype,"onHlsTimedMetadata",shaka.ads.AdManager.prototype.onHlsTimedMetadata),goog.exportProperty(shaka.ads.AdManager.prototype,"onDashTimedMetadata",shaka.ads.AdManager.prototype.onDashTimedMetadata),goog.exportProperty(shaka.ads.AdManager.prototype,"getStats",shaka.ads.AdManager.prototype.getStats),goog.exportProperty(shaka.ads.AdManager.prototype,"replaceServerSideAdTagParameters",shaka.ads.AdManager.prototype.replaceServerSideAdTagParameters),goog.exportProperty(shaka.ads.AdManager.prototype,"requestServerSideStream",shaka.ads.AdManager.prototype.requestServerSideStream),goog.exportProperty(shaka.ads.AdManager.prototype,"initServerSide",shaka.ads.AdManager.prototype.initServerSide),goog.exportProperty(shaka.ads.AdManager.prototype,"requestClientSideAds",shaka.ads.AdManager.prototype.requestClientSideAds),goog.exportProperty(shaka.ads.AdManager.prototype,"onAssetUnload",shaka.ads.AdManager.prototype.onAssetUnload),goog.exportProperty(shaka.ads.AdManager.prototype,"initClientSide",shaka.ads.AdManager.prototype.initClientSide),goog.exportProperty(shaka.ads.AdManager.prototype,"setLocale",shaka.ads.AdManager.prototype.setLocale),shaka.ads.CuePoint=function(t,i){this.start=t,this.end=void 0===i?null:i},shaka.ads.AdManager.ADS_LOADED="ads-loaded",goog.exportProperty(shaka.ads.AdManager,"ADS_LOADED",shaka.ads.AdManager.ADS_LOADED),shaka.ads.AdManager.AD_STARTED="ad-started",goog.exportProperty(shaka.ads.AdManager,"AD_STARTED",shaka.ads.AdManager.AD_STARTED),shaka.ads.AdManager.AD_FIRST_QUARTILE="ad-first-quartile",goog.exportProperty(shaka.ads.AdManager,"AD_FIRST_QUARTILE",shaka.ads.AdManager.AD_FIRST_QUARTILE),shaka.ads.AdManager.AD_MIDPOINT="ad-midpoint",goog.exportProperty(shaka.ads.AdManager,"AD_MIDPOINT",shaka.ads.AdManager.AD_MIDPOINT),shaka.ads.AdManager.AD_THIRD_QUARTILE="ad-third-quartile",goog.exportProperty(shaka.ads.AdManager,"AD_THIRD_QUARTILE",shaka.ads.AdManager.AD_THIRD_QUARTILE),shaka.ads.AdManager.AD_COMPLETE="ad-complete",goog.exportProperty(shaka.ads.AdManager,"AD_COMPLETE",shaka.ads.AdManager.AD_COMPLETE),shaka.ads.AdManager.AD_STOPPED="ad-stopped",goog.exportProperty(shaka.ads.AdManager,"AD_STOPPED",shaka.ads.AdManager.AD_STOPPED),shaka.ads.AdManager.AD_SKIPPED="ad-skipped",goog.exportProperty(shaka.ads.AdManager,"AD_SKIPPED",shaka.ads.AdManager.AD_SKIPPED),shaka.ads.AdManager.AD_VOLUME_CHANGED="ad-volume-changed",goog.exportProperty(shaka.ads.AdManager,"AD_VOLUME_CHANGED",shaka.ads.AdManager.AD_VOLUME_CHANGED),shaka.ads.AdManager.AD_MUTED="ad-muted",goog.exportProperty(shaka.ads.AdManager,"AD_MUTED",shaka.ads.AdManager.AD_MUTED),shaka.ads.AdManager.AD_PAUSED="ad-paused",goog.exportProperty(shaka.ads.AdManager,"AD_PAUSED",shaka.ads.AdManager.AD_PAUSED),shaka.ads.AdManager.AD_RESUMED="ad-resumed",goog.exportProperty(shaka.ads.AdManager,"AD_RESUMED",shaka.ads.AdManager.AD_RESUMED),shaka.ads.AdManager.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",goog.exportProperty(shaka.ads.AdManager,"AD_SKIP_STATE_CHANGED",shaka.ads.AdManager.AD_SKIP_STATE_CHANGED),shaka.ads.AdManager.CUEPOINTS_CHANGED="ad-cue-points-changed",goog.exportProperty(shaka.ads.AdManager,"CUEPOINTS_CHANGED",shaka.ads.AdManager.CUEPOINTS_CHANGED),shaka.ads.AdManager.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",goog.exportProperty(shaka.ads.AdManager,"IMA_AD_MANAGER_LOADED",shaka.ads.AdManager.IMA_AD_MANAGER_LOADED),shaka.ads.AdManager.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",goog.exportProperty(shaka.ads.AdManager,"IMA_STREAM_MANAGER_LOADED",shaka.ads.AdManager.IMA_STREAM_MANAGER_LOADED),shaka.ads.AdManager.AD_CLICKED="ad-clicked",goog.exportProperty(shaka.ads.AdManager,"AD_CLICKED",shaka.ads.AdManager.AD_CLICKED),shaka.ads.AdManager.AD_PROGRESS="ad-progress",goog.exportProperty(shaka.ads.AdManager,"AD_PROGRESS",shaka.ads.AdManager.AD_PROGRESS),shaka.ads.AdManager.AD_BUFFERING="ad-buffering",goog.exportProperty(shaka.ads.AdManager,"AD_BUFFERING",shaka.ads.AdManager.AD_BUFFERING),shaka.ads.AdManager.AD_IMPRESSION="ad-impression",goog.exportProperty(shaka.ads.AdManager,"AD_IMPRESSION",shaka.ads.AdManager.AD_IMPRESSION),shaka.ads.AdManager.AD_DURATION_CHANGED="ad-duration-changed",goog.exportProperty(shaka.ads.AdManager,"AD_DURATION_CHANGED",shaka.ads.AdManager.AD_DURATION_CHANGED),shaka.ads.AdManager.AD_CLOSED="ad-closed",goog.exportProperty(shaka.ads.AdManager,"AD_CLOSED",shaka.ads.AdManager.AD_CLOSED),shaka.ads.AdManager.AD_LOADED="ad-loaded",goog.exportProperty(shaka.ads.AdManager,"AD_LOADED",shaka.ads.AdManager.AD_LOADED),shaka.ads.AdManager.ALL_ADS_COMPLETED="all-ads-completed",goog.exportProperty(shaka.ads.AdManager,"ALL_ADS_COMPLETED",shaka.ads.AdManager.ALL_ADS_COMPLETED),shaka.ads.AdManager.AD_LINEAR_CHANGED="ad-linear-changed",goog.exportProperty(shaka.ads.AdManager,"AD_LINEAR_CHANGED",shaka.ads.AdManager.AD_LINEAR_CHANGED),shaka.ads.AdManager.AD_METADATA="ad-metadata",goog.exportProperty(shaka.ads.AdManager,"AD_METADATA",shaka.ads.AdManager.AD_METADATA),shaka.ads.AdManager.AD_RECOVERABLE_ERROR="ad-recoverable-error",goog.exportProperty(shaka.ads.AdManager,"AD_RECOVERABLE_ERROR",shaka.ads.AdManager.AD_RECOVERABLE_ERROR),shaka.ads.AdManager.AD_BREAK_READY="ad-break-ready",goog.exportProperty(shaka.ads.AdManager,"AD_BREAK_READY",shaka.ads.AdManager.AD_BREAK_READY),shaka.ads.AdManager.AD_INTERACTION="ad-interaction",goog.exportProperty(shaka.ads.AdManager,"AD_INTERACTION",shaka.ads.AdManager.AD_INTERACTION),shaka.Player.setAdManagerFactory(function(){return new shaka.ads.AdManager}),shaka.cast={},shaka.cast.CastUtils=function(){},shaka.cast.CastUtils.serialize=function(t){return JSON.stringify(t,function(i,r){if("function"!=typeof r){if(r instanceof Event||r instanceof shaka.util.FakeEvent){var l,o={};for(l in r){var g=r[l];g&&"object"==typeof g?"detail"==l&&(o[l]=g):l in Event||(o[l]=g)}return o}return r instanceof Error?shaka.cast.CastUtils.unpackError_(r):r instanceof TimeRanges?shaka.cast.CastUtils.unpackTimeRanges_(r):r instanceof Uint8Array?shaka.cast.CastUtils.unpackUint8Array_(r):"number"==typeof r?isNaN(r)?"NaN":isFinite(r)?r:0>r?"-Infinity":"Infinity":r}})},shaka.cast.CastUtils.deserialize=function(t){return JSON.parse(t,function(i,r){return"NaN"==r?NaN:"-Infinity"==r?-1/0:"Infinity"==r?1/0:r&&"object"==typeof r&&"TimeRanges"==r.__type__?shaka.cast.CastUtils.simulateTimeRanges_(r):r&&"object"==typeof r&&"Uint8Array"==r.__type__?shaka.cast.CastUtils.makeUint8Array_(r):r&&"object"==typeof r&&"Error"==r.__type__?shaka.cast.CastUtils.makeError_(r):r})},shaka.cast.CastUtils.unpackTimeRanges_=function(t){for(var i={__type__:"TimeRanges",length:t.length,start:[],end:[]},r=(t=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(t))).next();!r.done;r=t.next()){var o=(r=r.value).end;i.start.push(r.start),i.end.push(o)}return i},shaka.cast.CastUtils.simulateTimeRanges_=function(t){return{length:t.length,start:function(i){return t.start[i]},end:function(i){return t.end[i]}}},shaka.cast.CastUtils.unpackUint8Array_=function(t){return{__type__:"Uint8Array",entries:Array.from(t)}},shaka.cast.CastUtils.makeUint8Array_=function(t){return new Uint8Array(t.entries)},shaka.cast.CastUtils.unpackError_=function(t){var r,i=new Set(["name","message","stack"]);for(r in t)i.add(r);var o=$jscomp.makeIterator(Object.getOwnPropertyNames(t));for(r=o.next();!r.done;r=o.next())i.add(r.value);for(o={},r=(i=$jscomp.makeIterator(i)).next();!r.done;r=i.next())o[r=r.value]=t[r];return{__type__:"Error",contents:o}},shaka.cast.CastUtils.makeError_=function(t){t=t.contents;var r,i=Error(t.message);for(r in t)i[r]=t[r];return i},shaka.cast.CastUtils.VideoEvents="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),shaka.cast.CastUtils.VideoAttributes="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),shaka.cast.CastUtils.VideoInitStateAttributes=["loop","playbackRate"],shaka.cast.CastUtils.VideoVoidMethods=["pause","play"],shaka.cast.CastUtils.PlayerGetterMethods={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getTextTracks:2,getStats:5,getVariantTracks:2,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10},shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},shaka.cast.CastUtils.PlayerInitState=[["getConfiguration","configure"]],shaka.cast.CastUtils.PlayerInitAfterLoadState=[["isTextTrackVisible","setTextTrackVisibility"]],shaka.cast.CastUtils.PlayerVoidMethods="addTextTrack addTextTrackAsync cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),shaka.cast.CastUtils.PlayerPromiseMethods=["attach","detach","load","unload"],shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE="urn:x-cast:com.google.shaka.v2",shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE="urn:x-cast:com.google.cast.media",shaka.cast.CastSender=function(t,i,r,o,l,g){var _=this;this.receiverAppId_=t,this.statusChangeTimer_=new shaka.util.Timer(i),this.onFirstCastStateUpdate_=r,this.hasJoinedExistingSession_=!1,this.onRemoteEvent_=o,this.onResumeLocal_=l,this.onInitStateRequired_=g,this.isCasting_=this.apiReady_=!1,this.receiverName_="",this.appData_=null,this.onConnectionStatusChangedBound_=function(){return _.onConnectionStatusChanged_()},this.onMessageReceivedBound_=function(v,E){return _.onMessageReceived_(v,E)},this.cachedProperties_={video:{},player:{}},this.nextAsyncCallId_=0,this.asyncCallPromises_={},this.castPromise_=null,shaka.cast.CastSender.instances_.add(this)},shaka.cast.CastSender.prototype.destroy=function(){return shaka.cast.CastSender.instances_.delete(this),this.rejectAllPromises_(),shaka.cast.CastSender.session_&&this.removeListeners_(),this.statusChangeTimer_&&(this.statusChangeTimer_.stop(),this.statusChangeTimer_=null),this.onResumeLocal_=this.onRemoteEvent_=null,this.isCasting_=this.apiReady_=!1,this.onMessageReceivedBound_=this.onConnectionStatusChangedBound_=this.castPromise_=this.asyncCallPromises_=this.cachedProperties_=this.appData_=null,Promise.resolve()},shaka.cast.CastSender.prototype.apiReady=function(){return this.apiReady_},shaka.cast.CastSender.prototype.hasReceivers=function(){return shaka.cast.CastSender.hasReceivers_},shaka.cast.CastSender.prototype.isCasting=function(){return this.isCasting_},shaka.cast.CastSender.prototype.receiverName=function(){return this.receiverName_},shaka.cast.CastSender.prototype.hasRemoteProperties=function(){return 0!=Object.keys(this.cachedProperties_.video).length},shaka.cast.CastSender.prototype.init=function(){var t=shaka.cast.CastSender;if(this.receiverAppId_.length)if(window.chrome&&chrome.cast&&chrome.cast.isAvailable){this.apiReady_=!0,this.statusChangeTimer_.tickNow();var i=new chrome.cast.SessionRequest(this.receiverAppId_);i=new chrome.cast.ApiConfig(i,function(r){return t.onExistingSessionJoined_(r)},function(r){return t.onReceiverStatusChanged_(r)},"origin_scoped"),chrome.cast.initialize(i,function(){shaka.log.debug("CastSender: init")},function(r){shaka.log.error("CastSender: init error",r)}),shaka.cast.CastSender.hasReceivers_&&this.statusChangeTimer_.tickAfter(shaka.cast.CastSender.STATUS_DELAY),(i=shaka.cast.CastSender.session_)&&i.status!=chrome.cast.SessionStatus.STOPPED?(shaka.log.debug("CastSender: re-using existing connection"),this.onExistingSessionJoined_(i)):shaka.cast.CastSender.session_=null}else window.__onGCastApiAvailable||(window.__onGCastApiAvailable=shaka.cast.CastSender.onSdkLoaded_),window.__onGCastApiAvailable!=shaka.cast.CastSender.onSdkLoaded_&&shaka.log.alwaysWarn("A global Cast SDK hook is already installed! Shaka Player will be unable to receive a notification when the Cast SDK is ready.")},shaka.cast.CastSender.prototype.setAppData=function(t){this.appData_=t,this.isCasting_&&this.sendMessage_({type:"appData",appData:this.appData_})},shaka.cast.CastSender.prototype.cast=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(!i.apiReady_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_API_UNAVAILABLE);if(!shaka.cast.CastSender.hasReceivers_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.NO_CAST_RECEIVERS);if(i.isCasting_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.ALREADY_CASTING);return i.castPromise_=new shaka.util.PublicPromise,chrome.cast.requestSession(function(o){return i.onSessionInitiated_(t,o)},function(o){return i.onConnectionError_(o)}),r.yield(i.castPromise_,0)})},shaka.cast.CastSender.prototype.showDisconnectDialog=function(){var t=this;if(this.isCasting_){var i=this.onInitStateRequired_();chrome.cast.requestSession(function(r){return t.onSessionInitiated_(i,r)},function(r){return t.onConnectionError_(r)})}},shaka.cast.CastSender.prototype.forceDisconnect=function(){if(this.isCasting_){if(this.rejectAllPromises_(),shaka.cast.CastSender.session_){this.removeListeners_();try{shaka.cast.CastSender.session_.stop(function(){},function(){})}catch(t){}shaka.cast.CastSender.session_=null}this.onConnectionStatusChanged_()}},shaka.cast.CastSender.prototype.get=function(t,i){var r=this;goog.asserts.assert("video"==t||"player"==t,"Unexpected target name");var o=shaka.cast.CastUtils;if("video"==t){if(o.VideoVoidMethods.includes(i))return function(g){for(var _=[],v=0;v<arguments.length;++v)_[v-0]=arguments[v];return r.remoteCall_.apply(r,[t,i].concat($jscomp.arrayFromIterable(_)))}}else if("player"==t){if(o.PlayerGetterMethodsThatRequireLive[i]){var l=this.get("player","isLive")();if(goog.asserts.assert(l,i+" should be called on a live stream!"),!l)return function(){}}if(o.PlayerVoidMethods.includes(i))return function(g){for(var _=[],v=0;v<arguments.length;++v)_[v-0]=arguments[v];return r.remoteCall_.apply(r,[t,i].concat($jscomp.arrayFromIterable(_)))};if(o.PlayerPromiseMethods.includes(i))return function(g){for(var _=[],v=0;v<arguments.length;++v)_[v-0]=arguments[v];return r.remoteAsyncCall_.apply(r,[t,i].concat($jscomp.arrayFromIterable(_)))};if(o.PlayerGetterMethods[i])return function(){return r.propertyGetter_(t,i)}}return this.propertyGetter_(t,i)},shaka.cast.CastSender.prototype.set=function(t,i,r){goog.asserts.assert("video"==t||"player"==t,"Unexpected target name"),this.cachedProperties_[t][i]=r,this.sendMessage_({type:"set",targetName:t,property:i,value:r})},shaka.cast.CastSender.prototype.onSessionInitiated_=function(t,i){shaka.log.debug("CastSender: onSessionInitiated"),this.onSessionCreated_(i),this.sendMessage_({type:"init",initState:t,appData:this.appData_}),this.castPromise_.resolve()},shaka.cast.CastSender.prototype.onConnectionError_=function(t){var i=shaka.util.Error.Code.UNEXPECTED_CAST_ERROR;switch(t.code){case"cancel":i=shaka.util.Error.Code.CAST_CANCELED_BY_USER;break;case"timeout":i=shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT;break;case"receiver_unavailable":i=shaka.util.Error.Code.CAST_RECEIVER_APP_UNAVAILABLE}this.castPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,i,t))},shaka.cast.CastSender.prototype.propertyGetter_=function(t,i){return goog.asserts.assert("video"==t||"player"==t,"Unexpected target name"),this.cachedProperties_[t][i]},shaka.cast.CastSender.prototype.remoteCall_=function(t,i,r){for(var o=[],l=2;l<arguments.length;++l)o[l-2]=arguments[l];goog.asserts.assert("video"==t||"player"==t,"Unexpected target name"),this.sendMessage_({type:"call",targetName:t,methodName:i,args:o})},shaka.cast.CastSender.prototype.remoteAsyncCall_=function(t,i,r){for(var o=[],l=2;l<arguments.length;++l)o[l-2]=arguments[l];goog.asserts.assert("video"==t||"player"==t,"Unexpected target name"),l=new shaka.util.PublicPromise;var g=this.nextAsyncCallId_.toString();this.nextAsyncCallId_++,this.asyncCallPromises_[g]=l;try{this.sendMessage_({type:"asyncCall",targetName:t,methodName:i,args:o,id:g})}catch(_){l.reject(_)}return l},shaka.cast.CastSender.onExistingSessionJoined_=function(t){for(var i=$jscomp.makeIterator(shaka.cast.CastSender.instances_),r=i.next();!r.done;r=i.next())r.value.onExistingSessionJoined_(t)},shaka.cast.CastSender.prototype.onExistingSessionJoined_=function(t){shaka.log.debug("CastSender: onExistingSessionJoined");var i=this.onInitStateRequired_();this.castPromise_=new shaka.util.PublicPromise,this.hasJoinedExistingSession_=!0,this.onSessionInitiated_(i,t)},shaka.cast.CastSender.onReceiverStatusChanged_=function(t){for(var i=$jscomp.makeIterator(shaka.cast.CastSender.instances_),r=i.next();!r.done;r=i.next())r.value.onReceiverStatusChanged_(t)},shaka.cast.CastSender.prototype.onReceiverStatusChanged_=function(t){shaka.log.debug("CastSender: receiver status",t),shaka.cast.CastSender.hasReceivers_="available"==t,this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.onSessionCreated_=function(t){shaka.cast.CastSender.session_=t,t.addUpdateListener(this.onConnectionStatusChangedBound_),t.addMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_),this.onConnectionStatusChanged_()},shaka.cast.CastSender.prototype.removeListeners_=function(){var t=shaka.cast.CastSender.session_;t.removeUpdateListener(this.onConnectionStatusChangedBound_),t.removeMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_)},shaka.cast.CastSender.prototype.onConnectionStatusChanged_=function(){var t=!!shaka.cast.CastSender.session_&&"connected"==shaka.cast.CastSender.session_.status;if(shaka.log.debug("CastSender: connection status",t),this.isCasting_&&!t){for(var i in this.onResumeLocal_(),this.cachedProperties_)this.cachedProperties_[i]={};this.rejectAllPromises_()}this.receiverName_=(this.isCasting_=t)?shaka.cast.CastSender.session_.receiver.friendlyName:"",this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.rejectAllPromises_=function(){for(var t in this.asyncCallPromises_){var i=this.asyncCallPromises_[t];delete this.asyncCallPromises_[t],i.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED))}},shaka.cast.CastSender.prototype.onMessageReceived_=function(t,i){var r=shaka.cast.CastUtils.deserialize(i);switch(shaka.log.v2("CastSender: message",r),r.type){case"event":var o=r.targetName;r=new shaka.util.FakeEvent((r=r.event).type,r),this.onRemoteEvent_(o,r);break;case"update":for(var l in o=r.update)for(var g in r=this.cachedProperties_[l]||{},o[l])r[g]=o[l][g];this.hasJoinedExistingSession_&&(this.onFirstCastStateUpdate_(),this.hasJoinedExistingSession_=!1);break;case"asyncComplete":if(l=r.id,r=r.error,g=this.asyncCallPromises_[l],delete this.asyncCallPromises_[l],goog.asserts.assert(g,"Unexpected async id"),g)if(r){for(o in l=new shaka.util.Error(r.severity,r.category,r.code),r)l[o]=r[o];g.reject(l)}else g.resolve()}},shaka.cast.CastSender.prototype.sendMessage_=function(t){t=shaka.cast.CastUtils.serialize(t);var i=shaka.cast.CastSender.session_;try{i.sendMessage(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,t,function(){},shaka.log.error)}catch(r){throw shaka.log.error("Cast session sendMessage threw",r),t=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT,r),i=new shaka.util.FakeEvent("error",{detail:t}),this.onRemoteEvent_("player",i),this.forceDisconnect(),t}},shaka.cast.CastSender.STATUS_DELAY=.02,shaka.cast.CastSender.hasReceivers_=!1,shaka.cast.CastSender.session_=null,shaka.cast.CastSender.instances_=new Set,shaka.cast.CastSender.onSdkLoaded_=function(t){if(t)for(var i=(t=$jscomp.makeIterator(shaka.cast.CastSender.instances_)).next();!i.done;i=t.next())i.value.init()},shaka.cast.CastProxy=function(t,i,r){shaka.util.FakeEventTarget.call(this);var o=this;this.localVideo_=t,this.localPlayer_=i,this.eventManager_=this.playerEventTarget_=this.videoEventTarget_=this.playerProxy_=this.videoProxy_=null,this.receiverAppId_=r,this.compiledToExternNames_=new Map,this.sender_=new shaka.cast.CastSender(r,function(){return o.onCastStatusChanged_()},function(){return o.onFirstCastStateUpdate_()},function(l,g){return o.onRemoteEvent_(l,g)},function(){return o.onResumeLocal_()},function(){return o.getInitState_()}),this.init_()},$jscomp.inherits(shaka.cast.CastProxy,shaka.util.FakeEventTarget),shaka.cast.CastProxy.prototype.destroy=function(t){return t&&this.sender_.forceDisconnect(),this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),t=[],this.localPlayer_&&(t.push(this.localPlayer_.destroy()),this.localPlayer_=null),this.sender_&&(t.push(this.sender_.destroy()),this.sender_=null),this.playerProxy_=this.videoProxy_=this.localVideo_=null,Promise.all(t)},shaka.cast.CastProxy.prototype.getVideo=function(){return this.videoProxy_},shaka.cast.CastProxy.prototype.getPlayer=function(){return this.playerProxy_},shaka.cast.CastProxy.prototype.canCast=function(){return this.sender_.apiReady()&&this.sender_.hasReceivers()},shaka.cast.CastProxy.prototype.isCasting=function(){return this.sender_.isCasting()},shaka.cast.CastProxy.prototype.receiverName=function(){return this.sender_.receiverName()},shaka.cast.CastProxy.prototype.cast=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return 1==r.nextAddress?(i=t.getInitState_(),r.yield(t.sender_.cast(i),2)):t.localPlayer_?r.yield(t.localPlayer_.unload(),0):r.return()})},shaka.cast.CastProxy.prototype.setAppData=function(t){this.sender_.setAppData(t)},shaka.cast.CastProxy.prototype.suggestDisconnect=function(){this.sender_.showDisconnectDialog()},shaka.cast.CastProxy.prototype.forceDisconnect=function(){this.sender_.forceDisconnect()},shaka.cast.CastProxy.prototype.changeReceiverId=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return t==i.receiverAppId_?r.return():(i.receiverAppId_=t,i.sender_.forceDisconnect(),r.yield(i.sender_.destroy(),2));i.sender_=null,i.sender_=new shaka.cast.CastSender(t,function(){return i.onCastStatusChanged_()},function(){return i.onFirstCastStateUpdate_()},function(o,l){return i.onRemoteEvent_(o,l)},function(){return i.onResumeLocal_()},function(){return i.getInitState_()}),i.sender_.init(),r.jumpToEnd()})},shaka.cast.CastProxy.prototype.init_=function(){var t=this;this.sender_.init(),this.eventManager_=new shaka.util.EventManager;for(var i=$jscomp.makeIterator(shaka.cast.CastUtils.VideoEvents),r=i.next();!r.done;r=i.next())this.eventManager_.listen(this.localVideo_,r.value,function(g){return t.videoProxyLocalEvent_(g)});for(var o in shaka.Player.EventName)this.eventManager_.listen(this.localPlayer_,shaka.Player.EventName[o],function(g){return t.playerProxyLocalEvent_(g)});for(var l in this.videoProxy_={},i={},this.localVideo_)i.$jscomp$loop$prop$k$641=l,Object.defineProperty(this.videoProxy_,i.$jscomp$loop$prop$k$641,{configurable:!1,enumerable:!0,get:function(g){return function(){return t.videoProxyGet_(g.$jscomp$loop$prop$k$641)}}(i),set:function(g){return function(_){t.videoProxySet_(g.$jscomp$loop$prop$k$641,_)}}(i)}),i={$jscomp$loop$prop$k$641:i.$jscomp$loop$prop$k$641};this.playerProxy_={},this.iterateOverPlayerMethods_(function(g,_){goog.asserts.assert(t.playerProxy_,"Must have player proxy!"),Object.defineProperty(t.playerProxy_,g,{configurable:!1,enumerable:!0,get:function(){return t.playerProxyGet_(g)}})}),COMPILED&&this.mapCompiledToUncompiledPlayerMethodNames_(),this.videoEventTarget_=new shaka.util.FakeEventTarget,this.videoEventTarget_.dispatchTarget=this.videoProxy_,this.playerEventTarget_=new shaka.util.FakeEventTarget,this.playerEventTarget_.dispatchTarget=this.playerProxy_},shaka.cast.CastProxy.prototype.mapCompiledToUncompiledPlayerMethodNames_=function(){var t=this,i=new Map;this.iterateOverPlayerMethods_(function(r,o){if(i.has(o)){var l=i.get(o);r.length<l.length?t.compiledToExternNames_.set(r,l):t.compiledToExternNames_.set(l,r)}else i.set(o,r)})},shaka.cast.CastProxy.prototype.iterateOverPlayerMethods_=function(t){function i(E){return"constructor"!=E&&"function"==typeof r[E]&&!o.has(E)}goog.asserts.assert(this.localPlayer_,"Must have player!");var r=this.localPlayer_,o=new Set;for(l in r)i(l)&&(o.add(l),t(l,r[l]));for(var l=Object.getPrototypeOf(r),g=Object.getPrototypeOf({});l&&l!=g;){for(var _=$jscomp.makeIterator(Object.getOwnPropertyNames(l)),v=_.next();!v.done;v=_.next())i(v=v.value)&&(o.add(v),t(v,r[v]));l=Object.getPrototypeOf(l)}},shaka.cast.CastProxy.prototype.getInitState_=function(){var t={video:{},player:{},playerAfterLoad:{},manifest:this.localPlayer_.getAssetUri(),startTime:null};this.localVideo_.pause();for(var i=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),r=i.next();!r.done;r=i.next())t.video[r=r.value]=this.localVideo_[r];for(this.localVideo_.ended||(t.startTime=this.localVideo_.currentTime),r=(i=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitState)).next();!r.done;r=i.next()){var o=r.value;r=o[1],o=this.localPlayer_[o[0]](),t.player[r]=o}for(r=(i=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitAfterLoadState)).next();!r.done;r=i.next())r=(o=r.value)[1],o=this.localPlayer_[o[0]](),t.playerAfterLoad[r]=o;return t},shaka.cast.CastProxy.prototype.onCastStatusChanged_=function(){var t=new shaka.util.FakeEvent("caststatuschanged");this.dispatchEvent(t)},shaka.cast.CastProxy.prototype.onFirstCastStateUpdate_=function(){var t=new shaka.util.FakeEvent(this.videoProxy_.paused?"pause":"play");this.videoEventTarget_.dispatchEvent(t)},shaka.cast.CastProxy.prototype.onResumeLocal_=function(){for(var t=this,i=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitState),r=i.next();!r.done;r=i.next()){var o=r.value;r=o[1],o=this.sender_.get("player",o[0])(),this.localPlayer_[r](o)}var l=this.sender_.get("player","getAssetUri")();r=this.sender_.get("video","ended"),i=Promise.resolve();var g=this.localVideo_.autoplay;o=null,r||(o=this.sender_.get("video","currentTime")),l&&(this.localVideo_.autoplay=!1,i=this.localPlayer_.load(l,o));var _={};for(o=(r=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes)).next();!o.done;o=r.next())_[o=o.value]=this.sender_.get("video",o);i.then(function(){if(t.localVideo_){for(var v=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),E=v.next();!E.done;E=v.next())t.localVideo_[E=E.value]=_[E];for(E=(v=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitAfterLoadState)).next();!E.done;E=v.next()){var P=E.value;E=P[1],P=t.sender_.get("player",P[0])(),t.localPlayer_[E](P)}t.localVideo_.autoplay=g,l&&t.localVideo_.play()}},function(v){goog.asserts.assert(v instanceof shaka.util.Error,"Wrong error type!"),v=new shaka.util.FakeEvent(shaka.Player.EventName.Error,{detail:v}),t.localPlayer_.dispatchEvent(v)})},shaka.cast.CastProxy.prototype.videoProxyGet_=function(t){var i=this;if("addEventListener"==t)return function(o,l,g){return i.videoEventTarget_.addEventListener(o,l,g)};if("removeEventListener"==t)return function(o,l,g){return i.videoEventTarget_.removeEventListener(o,l,g)};if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()){var r=this.localVideo_[t];if("function"!=typeof r)return r}return this.sender_.isCasting()?this.sender_.get("video",t):("function"==typeof(t=this.localVideo_[t])&&(t=t.bind(this.localVideo_)),t)},shaka.cast.CastProxy.prototype.videoProxySet_=function(t,i){this.sender_.isCasting()?this.sender_.set("video",t,i):this.localVideo_[t]=i},shaka.cast.CastProxy.prototype.videoProxyLocalEvent_=function(t){this.sender_.isCasting()||(t=new shaka.util.FakeEvent(t.type,t),this.videoEventTarget_.dispatchEvent(t))},shaka.cast.CastProxy.prototype.playerProxyGet_=function(t){var i=this;if(this.compiledToExternNames_.has(t)&&(t=this.compiledToExternNames_.get(t)),"addEventListener"==t)return function(o,l,g){return i.playerEventTarget_.addEventListener(o,l,g)};if("removeEventListener"==t)return function(o,l,g){return i.playerEventTarget_.removeEventListener(o,l,g)};if("getMediaElement"==t)return function(){return i.videoProxy_};if("getSharedConfiguration"==t)return shaka.log.warning("Can't share configuration across a network. Returning copy."),this.sender_.get("player","getConfiguration");if("getNetworkingEngine"==t)return this.sender_.isCasting()&&shaka.log.warning("NOTE: getNetworkingEngine() is always local!"),function(){return i.localPlayer_.getNetworkingEngine()};if("getAdManager"==t)return this.sender_.isCasting()&&shaka.log.warning("NOTE: getAdManager() is always local!"),function(){return i.localPlayer_.getAdManager()};if("setVideoContainer"==t)return this.sender_.isCasting()&&shaka.log.warning("NOTE: setVideoContainer() is always local!"),function(o){return i.localPlayer_.setVideoContainer(o)};if(this.sender_.isCasting()){if("getManifest"==t||"drmInfo"==t)return function(){return shaka.log.alwaysWarn(t+"() does not work while casting!"),null};if("attach"==t||"detach"==t)return function(){return shaka.log.alwaysWarn(t+"() does not work while casting!"),Promise.resolve()}}if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()&&shaka.cast.CastUtils.PlayerGetterMethods[t]){var r=this.localPlayer_[t];return goog.asserts.assert("function"==typeof r,"only methods on Player"),r.bind(this.localPlayer_)}return this.sender_.isCasting()?this.sender_.get("player",t):(goog.asserts.assert("function"==typeof(r=this.localPlayer_[t]),"only methods on Player"),r.bind(this.localPlayer_))},shaka.cast.CastProxy.prototype.playerProxyLocalEvent_=function(t){this.sender_.isCasting()||this.playerEventTarget_.dispatchEvent(t)},shaka.cast.CastProxy.prototype.onRemoteEvent_=function(t,i){goog.asserts.assert(this.sender_.isCasting(),"Should only receive remote events while casting"),this.sender_.isCasting()&&("video"==t?this.videoEventTarget_.dispatchEvent(i):"player"==t&&this.playerEventTarget_.dispatchEvent(i))},goog.exportSymbol("shaka.cast.CastProxy",shaka.cast.CastProxy),goog.exportProperty(shaka.cast.CastProxy.prototype,"changeReceiverId",shaka.cast.CastProxy.prototype.changeReceiverId),goog.exportProperty(shaka.cast.CastProxy.prototype,"forceDisconnect",shaka.cast.CastProxy.prototype.forceDisconnect),goog.exportProperty(shaka.cast.CastProxy.prototype,"suggestDisconnect",shaka.cast.CastProxy.prototype.suggestDisconnect),goog.exportProperty(shaka.cast.CastProxy.prototype,"setAppData",shaka.cast.CastProxy.prototype.setAppData),goog.exportProperty(shaka.cast.CastProxy.prototype,"cast",shaka.cast.CastProxy.prototype.cast),goog.exportProperty(shaka.cast.CastProxy.prototype,"receiverName",shaka.cast.CastProxy.prototype.receiverName),goog.exportProperty(shaka.cast.CastProxy.prototype,"isCasting",shaka.cast.CastProxy.prototype.isCasting),goog.exportProperty(shaka.cast.CastProxy.prototype,"canCast",shaka.cast.CastProxy.prototype.canCast),goog.exportProperty(shaka.cast.CastProxy.prototype,"getPlayer",shaka.cast.CastProxy.prototype.getPlayer),goog.exportProperty(shaka.cast.CastProxy.prototype,"getVideo",shaka.cast.CastProxy.prototype.getVideo),goog.exportProperty(shaka.cast.CastProxy.prototype,"destroy",shaka.cast.CastProxy.prototype.destroy),shaka.cast.CastReceiver=function(t,i,r,o){shaka.util.FakeEventTarget.call(this);var l=this;this.video_=t,this.player_=i,this.eventManager_=new shaka.util.EventManager,this.targets_={video:t,player:i},this.appDataCallback_=r||function(){},this.contentIdCallback_=o||function(g){return g},this.metadata_=null,this.isConnected_=!1,this.isIdle_=!0,this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.genericBus_=this.shakaBus_=null,this.pollTimer_=new shaka.util.Timer(function(){l.pollAttributes_()}),this.init_()},$jscomp.inherits(shaka.cast.CastReceiver,shaka.util.FakeEventTarget),shaka.cast.CastReceiver.prototype.isConnected=function(){return this.isConnected_},shaka.cast.CastReceiver.prototype.isIdle=function(){return this.isIdle_},shaka.cast.CastReceiver.prototype.setContentMetadata=function(t){this.metadata_=t},shaka.cast.CastReceiver.prototype.clearContentMetadata=function(){this.metadata_=null},shaka.cast.CastReceiver.prototype.setContentTitle=function(t){this.metadata_||(this.metadata_={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.metadata_.title=t},shaka.cast.CastReceiver.prototype.setContentImage=function(t){this.metadata_||(this.metadata_={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.metadata_.images=[{url:t}]},shaka.cast.CastReceiver.prototype.setContentArtist=function(t){this.metadata_||(this.metadata_={}),this.metadata_.artist=t,this.metadata_.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},shaka.cast.CastReceiver.prototype.destroy=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){if(1==o.nextAddress)return t.eventManager_&&(t.eventManager_.release(),t.eventManager_=null),i=[],t.player_&&(i.push(t.player_.destroy()),t.player_=null),t.pollTimer_&&(t.pollTimer_.stop(),t.pollTimer_=null),t.video_=null,t.targets_=null,t.appDataCallback_=null,t.isConnected_=!1,t.isIdle_=!0,t.shakaBus_=null,t.genericBus_=null,o.yield(Promise.all(i),2);cast.receiver.CastReceiverManager.getInstance().stop(),o.jumpToEnd()})},shaka.cast.CastReceiver.prototype.init_=function(){var t=this,i=cast.receiver.CastReceiverManager.getInstance();i.onSenderConnected=function(){return t.onSendersChanged_()},i.onSenderDisconnected=function(){return t.onSendersChanged_()},i.onSystemVolumeChanged=function(){return t.fakeVolumeChangeEvent_()},this.genericBus_=i.getCastMessageBus(shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE),this.genericBus_.onMessage=function(l){return t.onGenericMessage_(l)},this.shakaBus_=i.getCastMessageBus(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE),this.shakaBus_.onMessage=function(l){return t.onShakaMessage_(l)},goog.DEBUG?shaka.util.Platform.isChromecast()&&i.start():i.start();for(var r=(i=$jscomp.makeIterator(shaka.cast.CastUtils.VideoEvents)).next();!r.done;r=i.next())this.eventManager_.listen(this.video_,r.value,function(l){return t.proxyEvent_("video",l)});for(var o in shaka.Player.EventName)this.eventManager_.listen(this.player_,shaka.Player.EventName[o],function(l){return t.proxyEvent_("player",l)});cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?this.player_.setMaxHardwareResolution(3840,2160):this.player_.setMaxHardwareResolution(1920,1080),this.eventManager_.listen(this.video_,"loadeddata",function(){t.startUpdatingUpdateNumber_=!0}),this.eventManager_.listen(this.player_,"loading",function(){t.isIdle_=!1,t.onCastStatusChanged_()}),this.eventManager_.listen(this.video_,"playing",function(){t.isIdle_=!1,t.onCastStatusChanged_()}),this.eventManager_.listen(this.video_,"pause",function(){t.onCastStatusChanged_()}),this.eventManager_.listen(this.player_,"unloading",function(){t.isIdle_=!0,t.onCastStatusChanged_()}),this.eventManager_.listen(this.video_,"ended",function(){new shaka.util.Timer(function(){t.video_&&t.video_.ended&&(t.isIdle_=!0,t.onCastStatusChanged_())}).tickAfter(shaka.cast.CastReceiver.IDLE_INTERVAL)})},shaka.cast.CastReceiver.prototype.onSendersChanged_=function(){this.updateNumber_=0,this.initialStatusUpdatePending_=!0,this.isConnected_=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,this.onCastStatusChanged_()},shaka.cast.CastReceiver.prototype.onCastStatusChanged_=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return 1==r.nextAddress?r.yield(Promise.resolve(),2):t.player_?(i=new shaka.util.FakeEvent("caststatuschanged"),t.dispatchEvent(i),t.maybeSendMediaInfoMessage_()||t.sendMediaStatus_(),void r.jumpToEnd()):r.return()})},shaka.cast.CastReceiver.prototype.initState_=function(t,i){var o,g,_,E,P,R,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){switch($.nextAddress){case 1:for(o in t.player)r.player_[o](t.player[o]);return r.appDataCallback_(i),g=r.video_.autoplay,t.manifest?(r.video_.autoplay=!1,$.setCatchFinallyBlocks(5),$.yield(r.player_.load(t.manifest,t.startTime),7)):$.yield(Promise.resolve(),3);case 7:$.leaveTryBlock(3);break;case 5:return _=$.enterCatchBlock(),goog.asserts.assert(_ instanceof shaka.util.Error,"Wrong error type!"),E=new shaka.util.FakeEvent(shaka.Player.EventName.Error,{detail:_}),r.player_&&r.player_.dispatchEvent(E),$.return();case 3:if(!r.player_)return $.return();for(P in t.video)r.video_[P]=t.video[P];for(R in t.playerAfterLoad)r.player_[R](t.playerAfterLoad[R]);r.video_.autoplay=g,t.manifest&&(r.video_.play(),r.sendMediaStatus_()),$.jumpToEnd()}})},shaka.cast.CastReceiver.prototype.proxyEvent_=function(t,i){this.player_&&(this.pollAttributes_(),this.sendMessage_({type:"event",targetName:t,event:i},this.shakaBus_))},shaka.cast.CastReceiver.prototype.pollAttributes_=function(){this.pollTimer_.tickAfter(shaka.cast.CastReceiver.POLL_INTERVAL);for(var t={video:{},player:{}},i=$jscomp.makeIterator(shaka.cast.CastUtils.VideoAttributes),r=i.next();!r.done;r=i.next())t.video[r=r.value]=this.video_[r];if(this.player_.isLive())for(var o in i=shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive)this.updateNumber_%i[o]==0&&(t.player[o]=this.player_[o]());for(var l in shaka.cast.CastUtils.PlayerGetterMethods)this.updateNumber_%shaka.cast.CastUtils.PlayerGetterMethods[l]==0&&(t.player[l]=this.player_[l]());(o=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=o.level,t.video.muted=o.muted),this.startUpdatingUpdateNumber_&&(this.updateNumber_+=1),this.sendMessage_({type:"update",update:t},this.shakaBus_),this.maybeSendMediaInfoMessage_()},shaka.cast.CastReceiver.prototype.maybeSendMediaInfoMessage_=function(){return!(!this.initialStatusUpdatePending_||!this.video_.duration&&!this.player_.isLive()||(this.sendMediaInfoMessage_(),this.initialStatusUpdatePending_=!1,0))},shaka.cast.CastReceiver.prototype.sendMediaInfoMessage_=function(t){t=void 0===t?0:t;var i={contentId:this.player_.getAssetUri(),streamType:this.player_.isLive()?"LIVE":"BUFFERED",contentType:""};this.player_.isLive()||(i.duration=this.video_.duration),this.metadata_&&(i.metadata=this.metadata_),this.sendMediaStatus_(t,i)},shaka.cast.CastReceiver.prototype.fakeVolumeChangeEvent_=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();goog.asserts.assert(t,"System volume should not be null!"),t&&this.sendMessage_({type:"update",update:{video:{volume:t.level,muted:t.muted}}},this.shakaBus_),this.sendMessage_({type:"event",targetName:"video",event:{type:"volumechange"}},this.shakaBus_)},shaka.cast.CastReceiver.prototype.onShakaMessage_=function(t){var i=this,r=shaka.cast.CastUtils.deserialize(t.data);switch(shaka.log.debug("CastReceiver: message",r),r.type){case"init":this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.initState_(r.initState,r.appData),this.pollAttributes_();break;case"appData":this.appDataCallback_(r.appData);break;case"set":var o=r.targetName,l=r.property;if(r=r.value,"video"==o){if(t=cast.receiver.CastReceiverManager.getInstance(),"volume"==l){t.setSystemVolumeLevel(r);break}if("muted"==l){t.setSystemVolumeMuted(r);break}}this.targets_[o][l]=r;break;case"call":(o=this.targets_[r.targetName])[r.methodName].apply(o,r.args);break;case"asyncCall":l=r.methodName,"player"==(o=r.targetName)&&"load"==l&&(this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1);var g=r.id,_=t.senderId;r=(t=this.targets_[o])[l].apply(t,r.args),"player"==o&&"load"==l&&(r=r.then(function(){i.initialStatusUpdatePending_=!0})),r.then(function(){return i.sendAsyncComplete_(_,g,null)},function(v){return i.sendAsyncComplete_(_,g,v)})}},shaka.cast.CastReceiver.prototype.onGenericMessage_=function(t){var i=this,r=shaka.cast.CastUtils.deserialize(t.data);switch(shaka.log.debug("CastReceiver: message",r),r.type){case"PLAY":this.video_.play(),this.sendMediaStatus_();break;case"PAUSE":this.video_.pause(),this.sendMediaStatus_();break;case"SEEK":var o=r.resumeState;null!=(t=r.currentTime)&&(this.video_.currentTime=Number(t)),o&&"PLAYBACK_START"==o?(this.video_.play(),this.sendMediaStatus_()):o&&"PLAYBACK_PAUSE"==o&&(this.video_.pause(),this.sendMediaStatus_());break;case"STOP":this.player_.unload().then(function(){i.player_&&i.sendMediaStatus_()});break;case"GET_STATUS":this.sendMediaInfoMessage_(Number(r.requestId));break;case"VOLUME":t=(o=r.volume).level,o=o.muted;var l=this.video_.volume,g=this.video_.muted;null!=t&&(this.video_.volume=Number(t)),null!=o&&(this.video_.muted=o),l==this.video_.volume&&g==this.video_.muted||this.sendMediaStatus_();break;case"LOAD":this.updateNumber_=0,this.initialStatusUpdatePending_=this.startUpdatingUpdateNumber_=!1,o=r.currentTime,l=this.contentIdCallback_((t=r.media).contentId),g=r.autoplay||!0,this.appDataCallback_(t.customData),g&&(this.video_.autoplay=!0),this.player_.load(l,o).then(function(){i.player_&&i.sendMediaInfoMessage_()}).catch(function(_){goog.asserts.assert(_ instanceof shaka.util.Error,"Wrong error type!");var v="LOAD_FAILED";_.category==shaka.util.Error.Category.PLAYER&&_.code==shaka.util.Error.Code.LOAD_INTERRUPTED&&(v="LOAD_CANCELLED"),i.sendMessage_({requestId:Number(r.requestId),type:v},i.genericBus_)});break;default:shaka.log.warning("Unrecognized message type from the generic Chromecast controller!",r.type),this.sendMessage_({requestId:Number(r.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.genericBus_)}},shaka.cast.CastReceiver.prototype.sendAsyncComplete_=function(t,i,r){this.player_&&this.sendMessage_({type:"asyncComplete",id:i,error:r},this.shakaBus_,t)},shaka.cast.CastReceiver.prototype.sendMessage_=function(t,i,r){this.isConnected_&&(t=shaka.cast.CastUtils.serialize(t),r?i.getCastChannel(r).send(t):i.broadcast(t))},shaka.cast.CastReceiver.prototype.getPlayState_=function(){var t=shaka.cast.CastReceiver.PLAY_STATE;return this.isIdle_?t.IDLE:this.player_.isBuffering()?t.BUFFERING:this.video_.paused?t.PAUSED:t.PLAYING},shaka.cast.CastReceiver.prototype.sendMediaStatus_=function(t,i){t=void 0===t?0:t,i=void 0===i?null:i;var r={mediaSessionId:0,playbackRate:this.video_.playbackRate,playerState:this.getPlayState_(),currentTime:this.video_.currentTime,supportedMediaCommands:63,volume:{level:this.video_.volume,muted:this.video_.muted}};i&&(r.media=i),this.sendMessage_({requestId:t,type:"MEDIA_STATUS",status:[r]},this.genericBus_)},goog.exportSymbol("shaka.cast.CastReceiver",shaka.cast.CastReceiver),goog.exportProperty(shaka.cast.CastReceiver.prototype,"destroy",shaka.cast.CastReceiver.prototype.destroy),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentArtist",shaka.cast.CastReceiver.prototype.setContentArtist),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentImage",shaka.cast.CastReceiver.prototype.setContentImage),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentTitle",shaka.cast.CastReceiver.prototype.setContentTitle),goog.exportProperty(shaka.cast.CastReceiver.prototype,"clearContentMetadata",shaka.cast.CastReceiver.prototype.clearContentMetadata),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentMetadata",shaka.cast.CastReceiver.prototype.setContentMetadata),goog.exportProperty(shaka.cast.CastReceiver.prototype,"isIdle",shaka.cast.CastReceiver.prototype.isIdle),goog.exportProperty(shaka.cast.CastReceiver.prototype,"isConnected",shaka.cast.CastReceiver.prototype.isConnected),shaka.cast.CastReceiver.POLL_INTERVAL=.5,shaka.cast.CastReceiver.IDLE_INTERVAL=5,shaka.cast.CastReceiver.PLAY_STATE={IDLE:"IDLE",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED"},shaka.util.Pssh=function(t){var i=this;this.systemIds=[],this.cencKeyIds=[],this.data=[],(new shaka.util.Mp4Parser).box("moov",shaka.util.Mp4Parser.children).fullBox("pssh",function(r){return i.parsePsshBox_(r)}).parse(t),0==this.data.length&&shaka.log.warning("No pssh box found!")},shaka.util.Pssh.prototype.parsePsshBox_=function(t){if(goog.asserts.assert(null!=t.version,"PSSH boxes are full boxes and must have a valid version"),goog.asserts.assert(null!=t.flags,"PSSH boxes are full boxes and must have a valid flag"),1<t.version)shaka.log.warning("Unrecognized PSSH version found!");else{var i=t.reader.getDataView();if(goog.asserts.assert(12<=i.byteOffset,"DataView at incorrect position"),i=shaka.util.BufferUtils.toUint8(i,-12,t.size),this.data.push(i),this.systemIds.push(shaka.util.Uint8ArrayUtils.toHex(t.reader.readBytes(16))),0<t.version){i=t.reader.readUint32();for(var r=(i=$jscomp.makeIterator(shaka.util.Iterables.range(i))).next();!r.done;r=i.next())shaka.util.Functional.ignored(r.value),r=shaka.util.Uint8ArrayUtils.toHex(t.reader.readBytes(16)),this.cencKeyIds.push(r)}}},shaka.util.Pssh.createPssh=function(t,i){goog.asserts.assert(16==i.byteLength,"Invalid system ID length");var r=t.length,o=12+i.length+4+r,l=new Uint8Array(o),g=shaka.util.BufferUtils.toDataView(l),_=0;return g.setUint32(_,o),g.setUint32(_+=4,1886614376),g.setUint32(_+=4,0),l.set(i,_+=4),g.setUint32(_+=i.length,r),l.set(t,_+=4),goog.asserts.assert(_+r===o,"PSSH invalid length."),l},shaka.util.Pssh.normaliseInitData=function(t){if(!t)return t;var i=new shaka.util.Pssh(t);if(1>=i.data.length)return t;t=[];for(var r={},o=(i=$jscomp.makeIterator(i.data)).next();!o.done;r={$jscomp$loop$prop$initData$536$643:r.$jscomp$loop$prop$initData$536$643},o=i.next())r.$jscomp$loop$prop$initData$536$643=o.value,t.some(function(l){return function(g){return shaka.util.BufferUtils.equal(g,l.$jscomp$loop$prop$initData$536$643)}}(r))||t.push(r.$jscomp$loop$prop$initData$536$643);return shaka.util.Uint8ArrayUtils.concat.apply(shaka.util.Uint8ArrayUtils,$jscomp.arrayFromIterable(t))},shaka.util.XmlUtils=function(){},shaka.util.XmlUtils.findChild=function(t,i){var r=shaka.util.XmlUtils.findChildren(t,i);return 1!=r.length?null:r[0]},shaka.util.XmlUtils.findChildNS=function(t,i,r){return 1!=(t=shaka.util.XmlUtils.findChildrenNS(t,i,r)).length?null:t[0]},shaka.util.XmlUtils.findChildren=function(t,i){return Array.from(t.childNodes).filter(function(r){return r instanceof Element&&r.tagName==i})},shaka.util.XmlUtils.getChildren=function(t){return Array.from(t.childNodes).filter(function(i){return i instanceof Element})},shaka.util.XmlUtils.findChildrenNS=function(t,i,r){return Array.from(t.childNodes).filter(function(o){return o instanceof Element&&o.localName==r&&o.namespaceURI==i})},shaka.util.XmlUtils.getAttributeNS=function(t,i,r){return t.hasAttributeNS(i,r)?t.getAttributeNS(i,r):null},shaka.util.XmlUtils.getContents=function(t){var i=shaka.util.XmlUtils;return Array.from(t.childNodes).every(i.isText)?t.textContent.trim():null},shaka.util.XmlUtils.isText=function(t){return t.nodeType==Node.TEXT_NODE||t.nodeType==Node.CDATA_SECTION_NODE},shaka.util.XmlUtils.parseAttr=function(t,i,r,o){o=void 0===o?null:o;var l=null;return null!=(t=t.getAttribute(i))&&(l=r(t)),null==l?o:l},shaka.util.XmlUtils.parseDate=function(t){return t?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t)&&(t+="Z"),t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null},shaka.util.XmlUtils.parseDuration=function(t){if(!t)return null;var i=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(t);return i?(t=31536e3*Number(i[1]||null)+2592e3*Number(i[2]||null)+86400*Number(i[3]||null)+3600*Number(i[4]||null)+60*Number(i[5]||null)+Number(i[6]||null),isFinite(t)?t:null):(shaka.log.warning("Invalid duration string:",t),null)},shaka.util.XmlUtils.parseRange=function(t){var i=/([0-9]+)-([0-9]+)/.exec(t);return i&&(t=Number(i[1]),isFinite(t))?(i=Number(i[2]),isFinite(i)?{start:t,end:i}:null):null},shaka.util.XmlUtils.parseInt=function(t){return(t=Number(t))%1==0?t:null},shaka.util.XmlUtils.parsePositiveInt=function(t){return(t=Number(t))%1==0&&0<t?t:null},shaka.util.XmlUtils.parseNonNegativeInt=function(t){return(t=Number(t))%1==0&&0<=t?t:null},shaka.util.XmlUtils.parseFloat=function(t){return t=Number(t),isNaN(t)?null:t},shaka.util.XmlUtils.evalDivision=function(t){var i;return t=(i=t.match(/^(\d+)\/(\d+)$/))?Number(i[1])/Number(i[2]):Number(t),isNaN(t)?null:t},shaka.util.XmlUtils.parseXmlString=function(t,i){var r=new DOMParser,o=null,l=null;try{l=r.parseFromString(t,"text/xml")}catch(g){}return l&&l.documentElement.tagName==i&&(o=l.documentElement),o&&0<o.getElementsByTagName("parsererror").length?null:o},shaka.util.XmlUtils.parseXml=function(t,i){try{var r=shaka.util.StringUtils.fromUTF8(t);return shaka.util.XmlUtils.parseXmlString(r,i)}catch(o){return null}},shaka.dash={},shaka.dash.ContentProtection=function(){},shaka.dash.ContentProtection.parseFromAdaptationSet=function(t,i,r){var o=shaka.dash.ContentProtection,l=shaka.util.ManifestParserUtils,g=o.parseElements_(t),_=null;t=[];var v=[],E=new Set(g.map(function(P){return P.keyId}));if(E.delete(null),1<E.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_CONFLICTING_KEY_IDS);if(i||(v=g.filter(function(P){return P.schemeUri!=o.MP4Protection_||(goog.asserts.assert(!P.init||P.init.length,"Init data must be null or non-empty."),_=P.init||_,!1)})).length&&0==(t=o.convertElements_(_,v,r)).length&&(t=[l.createDrmInfo("",_)]),g.length&&(i||!v.length))for(t=[],r=(i=$jscomp.makeIterator(Object.values(r))).next();!r.done;r=i.next())"org.w3.clearkey"!=(r=r.value)&&(r=l.createDrmInfo(r,_),t.push(r));if(l=Array.from(E)[0]||null)for(i=(E=$jscomp.makeIterator(t)).next();!i.done;i=E.next())for(r=(i=$jscomp.makeIterator(i.value.initData)).next();!r.done;r=i.next())r.value.keyId=l;return{defaultKeyId:l,defaultInit:_,drmInfos:t,firstRepresentation:!0}},shaka.dash.ContentProtection.parseFromRepresentation=function(t,i,r,o){var l=shaka.dash.ContentProtection.parseFromAdaptationSet(t,r,o);if(i.firstRepresentation)t=1==i.drmInfos.length&&!i.drmInfos[0].keySystem,r=0==l.drmInfos.length,(0==i.drmInfos.length||t&&!r)&&(i.drmInfos=l.drmInfos),i.firstRepresentation=!1;else if(0<l.drmInfos.length&&(i.drmInfos=i.drmInfos.filter(function(g){return l.drmInfos.some(function(_){return _.keySystem==g.keySystem})}),0==i.drmInfos.length))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_COMMON_KEY_SYSTEM);return l.defaultKeyId||i.defaultKeyId},shaka.dash.ContentProtection.getWidevineLicenseUrl=function(t){return(t=shaka.util.XmlUtils.findChildNS(t.node,"urn:microsoft","laurl"))&&t.getAttribute("licenseUrl")||""},shaka.dash.ContentProtection.parseMsProRecords_=function(t,i){for(var r=[];i<t.byteLength-1;){var o=t.getUint16(i,!0),l=t.getUint16(i+=2,!0);if(i+=2,0!=(1&l)||l+i>t.byteLength)return shaka.log.warning("Malformed MS PRO object"),[];var g=shaka.util.BufferUtils.toUint8(t,i,l);r.push({type:o,value:g}),i+=l}return r},shaka.dash.ContentProtection.parseMsPro_=function(t){var i=0,r=shaka.util.BufferUtils.toDataView(t),o=r.getUint32(i,!0);return i+=4,o!=t.byteLength?(shaka.log.warning("PlayReady Object with invalid length encountered."),[]):shaka.dash.ContentProtection.parseMsProRecords_(r,i+2)},shaka.dash.ContentProtection.getLaurl_=function(t){for(var i=(t=$jscomp.makeIterator(t.getElementsByTagName("DATA"))).next();!i.done;i=t.next())for(var r=(i=$jscomp.makeIterator(i.value.childNodes)).next();!r.done;r=i.next())if((r=r.value)instanceof Element&&"LA_URL"==r.tagName)return r.textContent;return""},shaka.dash.ContentProtection.getPlayReadyLicenseUrl=function(t){var i=shaka.util.XmlUtils.findChildNS(t.node,"urn:microsoft:playready","pro");if(!i)return"";var r=(t=shaka.dash.ContentProtection).PLAYREADY_RECORD_TYPES;return i=shaka.util.Uint8ArrayUtils.fromBase64(i.textContent),(i=t.parseMsPro_(i).filter(function(o){return o.type===r.RIGHTS_MANAGEMENT})[0])?(i=shaka.util.StringUtils.fromUTF16(i.value,!0),(i=shaka.util.XmlUtils.parseXmlString(i,"WRMHEADER"))?t.getLaurl_(i):""):""},shaka.dash.ContentProtection.getInitDataFromPro_=function(t){var i=shaka.util.XmlUtils.findChildNS(t.node,"urn:microsoft:playready","pro");if(!i)return null;i=shaka.util.Uint8ArrayUtils.fromBase64(i.textContent);var r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);return[{initData:shaka.util.Pssh.createPssh(i,r),initDataType:"cenc",keyId:t.keyId}]},shaka.dash.ContentProtection.convertElements_=function(t,i,r){for(var o=shaka.dash.ContentProtection,l=shaka.util.ManifestParserUtils,g=o.licenseUrlParsers_,_=[],v=(i=$jscomp.makeIterator(i)).next();!v.done;v=i.next()){var E=r[(v=v.value).schemeUri];if(E){goog.asserts.assert(!v.init||v.init.length,"Init data must be null or non-empty.");var P=o.getInitDataFromPro_(v);P=l.createDrmInfo(E,v.init||t||P),(E=g.get(E))&&(P.licenseServerUri=E(v)),_.push(P)}}return _},shaka.dash.ContentProtection.parseElements_=function(t){for(var i=[],r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())(r=shaka.dash.ContentProtection.parseElement_(r.value))&&i.push(r);return i},shaka.dash.ContentProtection.parseElement_=function(t){var i=shaka.dash.ContentProtection.CencNamespaceUri_,r=t.getAttribute("schemeIdUri"),o=shaka.util.XmlUtils.getAttributeNS(t,i,"default_KID");if(i=shaka.util.XmlUtils.findChildrenNS(t,i,"pssh").map(shaka.util.XmlUtils.getContents),!r)return shaka.log.error("Missing required schemeIdUri attribute on","ContentProtection element",t),null;if(r=r.toLowerCase(),o&&(o=o.replace(/-/g,"").toLowerCase()).includes(" "))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED);var l=[];try{l=i.map(function(g){return{initDataType:"cenc",initData:shaka.util.Uint8ArrayUtils.fromBase64(g),keyId:null}})}catch(g){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_PSSH_BAD_ENCODING)}return{node:t,schemeUri:r,keyId:o,init:0<l.length?l:null}},shaka.dash.ContentProtection.PLAYREADY_RECORD_TYPES={RIGHTS_MANAGEMENT:1,RESERVED:2,EMBEDDED_LICENSE:3},shaka.dash.ContentProtection.licenseUrlParsers_=(new Map).set("com.widevine.alpha",shaka.dash.ContentProtection.getWidevineLicenseUrl).set("com.microsoft.playready",shaka.dash.ContentProtection.getPlayReadyLicenseUrl).set("com.microsoft.playready.recommendation",shaka.dash.ContentProtection.getPlayReadyLicenseUrl).set("com.microsoft.playready.software",shaka.dash.ContentProtection.getPlayReadyLicenseUrl).set("com.microsoft.playready.hardware",shaka.dash.ContentProtection.getPlayReadyLicenseUrl),shaka.dash.ContentProtection.MP4Protection_="urn:mpeg:dash:mp4protection:2011",shaka.dash.ContentProtection.CencNamespaceUri_="urn:mpeg:cenc:2013",shaka.dash.MpdUtils=function(){},shaka.dash.MpdUtils.fillUriTemplate=function(t,i,r,o,l){var g={RepresentationID:i,Number:r,Bandwidth:o,Time:l};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(_,v,E,P){if("$$"==_)return"$";var M=g[v];if(goog.asserts.assert(void 0!==M,"Unrecognized identifier"),null==M)return shaka.log.warning("URL template does not have an available substitution for ",'identifier "'+v+'":',t),_;switch("RepresentationID"==v&&E&&(shaka.log.warning("URL template should not contain a width specifier for identifier",'"RepresentationID":',t),E=void 0),"Time"==v&&(goog.asserts.assert("number"==typeof M,"Time value should be a number!"),goog.asserts.assert(.2>Math.abs(M-Math.round(M)),"Calculated $Time$ values must be close to integers"),M=Math.round(M)),P){case void 0:case"d":case"i":case"u":_=M.toString();break;case"o":_=M.toString(8);break;case"x":_=M.toString(16);break;case"X":_=M.toString(16).toUpperCase();break;default:goog.asserts.assert(!1,"Unhandled format specifier"),_=M.toString()}return E=window.parseInt(E,10)||1,Array(Math.max(0,E-_.length)+1).join("0")+_})},shaka.dash.MpdUtils.createTimeline=function(t,i,r,o){goog.asserts.assert(0<i&&1/0>i,"timescale must be a positive, finite integer"),goog.asserts.assert(0<o,"period duration must be a positive integer");var l=shaka.util.XmlUtils,g=l.findChildren(t,"S");t=[];for(var _=-r,v=(g=$jscomp.makeIterator(shaka.util.Iterables.enumerate(g))).next();!v.done;v=g.next()){var E=(v=v.value).item,P=v.next,M=l.parseAttr(E,"t",l.parseNonNegativeInt);v=l.parseAttr(E,"d",l.parseNonNegativeInt);var R=l.parseAttr(E,"r",l.parseInt);if(null!=M&&(M-=r),!v){shaka.log.warning('"S" element must have a duration:','ignoring the remaining "S" elements.',E);break}if(M=null!=M?M:_,0>(R=R||0))if(P){if(null==(P=l.parseAttr(P,"t",l.parseNonNegativeInt))){shaka.log.warning('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',E);break}if(M>=P){shaka.log.warning('An "S" element cannot have a negative repeatif its start ','time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',E);break}R=Math.ceil((P-M)/v)-1}else{if(o==1/0){shaka.log.warning('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',E);break}if(M/i>=o){shaka.log.warning('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',E);break}R=Math.ceil((o*i-M)/v)-1}for(0<t.length&&M!=_&&(Math.abs((M-_)/i)>=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS&&shaka.log.warning("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",E),t[t.length-1].end=M/i),P=(E=$jscomp.makeIterator(shaka.util.Iterables.range(R+1))).next();!P.done;P=E.next())shaka.util.Functional.ignored(P.value),t.push({start:M/i,end:(_=M+v)/i,unscaledStart:M}),M=_}return t},shaka.dash.MpdUtils.parseSegmentInfo=function(t,i){goog.asserts.assert(i(t.representation),"There must be at least one element of the given type.");var r=shaka.dash.MpdUtils,o=shaka.util.XmlUtils,l=r.inheritAttribute(t,i,"timescale"),g=1;l&&(g=o.parsePositiveInt(l)||1);var _=r.inheritAttribute(t,i,"duration");l=o.parsePositiveInt(_||""),t.representation.contentType==shaka.util.ManifestParserUtils.ContentType.IMAGE&&(l=o.parseFloat(_||"")),l&&(l/=g);var v=r.inheritAttribute(t,i,"startNumber");_=Number(r.inheritAttribute(t,i,"presentationTimeOffset"))||0,o=o.parseNonNegativeInt(v||""),(null==v||null==o)&&(o=1);var E=null;return(v=r.inheritChild(t,i,"SegmentTimeline"))&&(E=r.createTimeline(v,g,_,t.periodInfo.duration||1/0)),{timescale:g,segmentDuration:l,startNumber:o,scaledPresentationTimeOffset:_/g||0,unscaledPresentationTimeOffset:_,timeline:E}},shaka.dash.MpdUtils.inheritAttribute=function(t,i,r){var o=shaka.util.Functional;return goog.asserts.assert(i(t.representation),"There must be at least one element of the given type"),[i(t.representation),i(t.adaptationSet),i(t.period)].filter(o.isNotNull).map(function(l){return l.getAttribute(r)}).reduce(function(l,g){return l||g})},shaka.dash.MpdUtils.inheritChild=function(t,i,r){var o=shaka.util.Functional;goog.asserts.assert(i(t.representation),"There must be at least one element of the given type"),t=[i(t.representation),i(t.adaptationSet),i(t.period)].filter(o.isNotNull);var l=shaka.util.XmlUtils;return t.map(function(g){return l.findChild(g,r)}).reduce(function(g,_){return g||_})},shaka.dash.MpdUtils.handleXlinkInElement_=function(t,i,r,o,l,g){var _=shaka.util.XmlUtils,v=shaka.util.Error,E=shaka.util.ManifestParserUtils,P=shaka.dash.MpdUtils.XlinkNamespaceUri_,M=_.getAttributeNS(t,P,"href");_=_.getAttributeNS(t,P,"actuate")||"onRequest";for(var R=$jscomp.makeIterator(Array.from(t.attributes)),U=R.next();!U.done;U=R.next())(U=U.value).namespaceURI==P&&t.removeAttributeNS(U.namespaceURI,U.localName);if(5<=g)return shaka.util.AbortableOperation.failed(new v(v.Severity.CRITICAL,v.Category.MANIFEST,v.Code.DASH_XLINK_DEPTH_LIMIT));if("onLoad"!=_)return shaka.util.AbortableOperation.failed(new v(v.Severity.CRITICAL,v.Category.MANIFEST,v.Code.DASH_UNSUPPORTED_XLINK_ACTUATE));var $=E.resolveUris([o],[M]);return o=shaka.net.NetworkingEngine.RequestType.MANIFEST,E=shaka.net.NetworkingEngine.makeRequest($,i),o=l.request(o,E),goog.asserts.assert(o instanceof shaka.util.AbortableOperation,"Unexpected implementation of IAbortableOperation!"),o.chain(function(G){if(!(G=shaka.util.XmlUtils.parseXml(G.data,t.tagName)))return shaka.util.AbortableOperation.failed(new v(v.Severity.CRITICAL,v.Category.MANIFEST,v.Code.DASH_INVALID_XML,M));for(;t.childNodes.length;)t.removeChild(t.childNodes[0]);for(;G.childNodes.length;){var z=G.childNodes[0];G.removeChild(z),t.appendChild(z)}for(z=(G=$jscomp.makeIterator(Array.from(G.attributes))).next();!z.done;z=G.next())t.setAttributeNode(z.value.cloneNode(!1));return shaka.dash.MpdUtils.processXlinks(t,i,r,$[0],l,g+1)})},shaka.dash.MpdUtils.processXlinks=function(t,i,r,o,l,g){g=void 0===g?0:g;var _=shaka.dash.MpdUtils,v=shaka.util.XmlUtils,E=_.XlinkNamespaceUri_;if(v.getAttributeNS(t,E,"href"))return v=_.handleXlinkInElement_(t,i,r,o,l,g),r&&(v=v.chain(void 0,function(U){return _.processXlinks(t,i,r,o,l,g)})),v;for(var P=[],M=$jscomp.makeIterator(Array.from(t.childNodes)),R=M.next();!R.done;R=M.next())(R=R.value)instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==v.getAttributeNS(R,E,"href")?t.removeChild(R):"SegmentTimeline"!=R.tagName&&P.push(shaka.dash.MpdUtils.processXlinks(R,i,r,o,l,g)));return shaka.util.AbortableOperation.all(P).chain(function(){return t})},shaka.dash.MpdUtils.XlinkNamespaceUri_="http://www.w3.org/1999/xlink",shaka.media.Mp4SegmentIndexParser=function(){},shaka.media.Mp4SegmentIndexParser.parse=function(t,i,r,o,l,g,_){var E,v=shaka.media.Mp4SegmentIndexParser,P=(new shaka.util.Mp4Parser).fullBox("sidx",function(M){E=v.parseSIDX_(i,o,l,g,_,r,M)});if(t&&P.parse(t),E)return E;throw shaka.log.error('Invalid box type, expected "sidx".'),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_WRONG_BOX_TYPE)},shaka.media.Mp4SegmentIndexParser.parseSIDX_=function(t,i,r,o,l,g,_){goog.asserts.assert(null!=_.version,"SIDX is a full box and should have a valid version.");var v=[];_.reader.skip(4);var E=_.reader.readUint32();if(0==E)throw shaka.log.error("Invalid timescale."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_INVALID_TIMESCALE);if(0==_.version)var P=_.reader.readUint32(),M=_.reader.readUint32();else P=_.reader.readUint64(),M=_.reader.readUint64();_.reader.skip(2);var R=_.reader.readUint16();for(t=t+_.size+M,M=(R=$jscomp.makeIterator(shaka.util.Iterables.range(R))).next();!M.done;M=R.next()){shaka.util.Functional.ignored(M.value);var U=_.reader.readUint32();M=(2147483648&U)>>>31,U&=2147483647;var $=_.reader.readUint32();if(_.reader.skip(4),1==M)throw shaka.log.error("Heirarchical SIDXs are not supported."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_TYPE_NOT_SUPPORTED);v.push(new shaka.media.SegmentReference(P/E+r,(P+$)/E+r,function(){return g},t,t+U-1,i,r,o,l)),P+=$,t+=U}return _.parser.stop(),v},shaka.util.EbmlParser=function(t){this.dataView_=shaka.util.BufferUtils.toDataView(t),this.reader_=new shaka.util.DataViewReader(this.dataView_,shaka.util.DataViewReader.Endianness.BIG_ENDIAN)},shaka.util.EbmlParser.prototype.hasMoreData=function(){return this.reader_.hasMoreData()},shaka.util.EbmlParser.prototype.parseElement=function(){var t=this.parseId_(),i=this.parseVint_();i=shaka.util.EbmlParser.isDynamicSizeValue_(i)?this.dataView_.byteLength-this.reader_.getPosition():shaka.util.EbmlParser.getVintValue_(i),i=this.reader_.getPosition()+i<=this.dataView_.byteLength?i:this.dataView_.byteLength-this.reader_.getPosition();var r=shaka.util.BufferUtils.toDataView(this.dataView_,this.reader_.getPosition(),i);return this.reader_.skip(i),new shaka.util.EbmlElement(t,r)},shaka.util.EbmlParser.prototype.parseId_=function(){var t=this.parseVint_();if(7<t.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);for(var i=0,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())i=256*i+r.value;return i},shaka.util.EbmlParser.prototype.parseVint_=function(){var t=this.reader_.getPosition(),i=this.reader_.readUint8();if(0==i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);return i=8-Math.floor(Math.log2(i)),goog.asserts.assert(8>=i&&1<=i,"Incorrect log2 value"),this.reader_.skip(i-1),shaka.util.BufferUtils.toUint8(this.dataView_,t,i)},shaka.util.EbmlParser.getVintValue_=function(t){if(8==t.length&&224&t[1])throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var i=0,r=$jscomp.makeIterator(shaka.util.Iterables.enumerate(t)),o=r.next();!o.done;o=r.next()){var l=(o=o.value).item;i=0==o.i?l&(1<<8-t.length)-1:256*i+l}return i},shaka.util.EbmlParser.isDynamicSizeValue_=function(t){for(var i=shaka.util.BufferUtils,r=$jscomp.makeIterator(shaka.util.EbmlParser.DYNAMIC_SIZES),o=r.next();!o.done;o=r.next())if(i.equal(t,new Uint8Array(o.value)))return!0;return!1},shaka.util.EbmlParser.DYNAMIC_SIZES=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]],shaka.util.EbmlElement=function(t,i){this.id=t,this.dataView_=i},shaka.util.EbmlElement.prototype.getOffset=function(){return this.dataView_.byteOffset},shaka.util.EbmlElement.prototype.createParser=function(){return new shaka.util.EbmlParser(this.dataView_)},shaka.util.EbmlElement.prototype.getUint=function(){if(8<this.dataView_.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);if(8==this.dataView_.byteLength&&224&this.dataView_.getUint8(0))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var t=0,i=$jscomp.makeIterator(shaka.util.Iterables.range(this.dataView_.byteLength)),r=i.next();!r.done;r=i.next())t=256*t+(r=this.dataView_.getUint8(r.value));return t},shaka.util.EbmlElement.prototype.getFloat=function(){if(4==this.dataView_.byteLength)return this.dataView_.getFloat32(0);if(8==this.dataView_.byteLength)return this.dataView_.getFloat64(0);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_BAD_FLOATING_POINT_SIZE)},shaka.media.WebmSegmentIndexParser=function(){},shaka.media.WebmSegmentIndexParser.parse=function(t,i,r,o,l,g,_){if(i=shaka.media.WebmSegmentIndexParser.parseWebmContainer_(i),(t=new shaka.util.EbmlParser(t).parseElement()).id!=shaka.media.WebmSegmentIndexParser.CUES_ID)throw shaka.log.error("Not a Cues element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUES_ELEMENT_MISSING);return shaka.media.WebmSegmentIndexParser.parseCues_(t,i.segmentOffset,i.timecodeScale,i.duration,r,o,l,g,_)},shaka.media.WebmSegmentIndexParser.parseWebmContainer_=function(t){if((t=new shaka.util.EbmlParser(t)).parseElement().id!=shaka.media.WebmSegmentIndexParser.EBML_ID)throw shaka.log.error("Not an EBML element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_EBML_HEADER_ELEMENT_MISSING);var i=t.parseElement();if(i.id!=shaka.media.WebmSegmentIndexParser.SEGMENT_ID)throw shaka.log.error("Not a Segment element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_SEGMENT_ELEMENT_MISSING);return{segmentOffset:t=i.getOffset(),timecodeScale:(i=shaka.media.WebmSegmentIndexParser.parseSegment_(i)).timecodeScale,duration:i.duration}},shaka.media.WebmSegmentIndexParser.parseSegment_=function(t){t=t.createParser();for(var i=null;t.hasMoreData();){var r=t.parseElement();if(r.id==shaka.media.WebmSegmentIndexParser.INFO_ID){i=r;break}}if(!i)throw shaka.log.error("Not an Info element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_INFO_ELEMENT_MISSING);return shaka.media.WebmSegmentIndexParser.parseInfo_(i)},shaka.media.WebmSegmentIndexParser.parseInfo_=function(t){var i=t.createParser(),r=1e6;for(t=null;i.hasMoreData();){var o=i.parseElement();o.id==shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID?r=o.getUint():o.id==shaka.media.WebmSegmentIndexParser.DURATION_ID&&(t=o.getFloat())}if(null==t)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_DURATION_ELEMENT_MISSING);return{timecodeScale:i=r/1e9,duration:t*i}},shaka.media.WebmSegmentIndexParser.parseCues_=function(t,i,r,o,l,g,_,v,E){var P=[],M=function(){return l};t=t.createParser();for(var R=null,U=null;t.hasMoreData();){var $=t.parseElement();if($.id==shaka.media.WebmSegmentIndexParser.CUE_POINT_ID){var G=shaka.media.WebmSegmentIndexParser.parseCuePoint_($);G&&($=r*G.unscaledTime,G=i+G.relativeOffset,null!=R&&(goog.asserts.assert(null!=U,"last offset cannot be null"),P.push(new shaka.media.SegmentReference(R+_,$+_,M,U,G-1,g,_,v,E))),R=$,U=G)}}return null!=R&&(goog.asserts.assert(null!=U,"last offset cannot be null"),P.push(new shaka.media.SegmentReference(R+_,o+_,M,U,null,g,_,v,E))),P},shaka.media.WebmSegmentIndexParser.parseCuePoint_=function(t){var i=t.createParser();if((t=i.parseElement()).id!=shaka.media.WebmSegmentIndexParser.CUE_TIME_ID)throw shaka.log.warning("Not a CueTime element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TIME_ELEMENT_MISSING);if(t=t.getUint(),(i=i.parseElement()).id!=shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID)throw shaka.log.warning("Not a CueTrackPositions element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING);i=i.createParser();for(var r=0;i.hasMoreData();){var o=i.parseElement();if(o.id==shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION){r=o.getUint();break}}return{unscaledTime:t,relativeOffset:r}},shaka.media.WebmSegmentIndexParser.EBML_ID=440786851,shaka.media.WebmSegmentIndexParser.SEGMENT_ID=408125543,shaka.media.WebmSegmentIndexParser.INFO_ID=357149030,shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID=2807729,shaka.media.WebmSegmentIndexParser.DURATION_ID=17545,shaka.media.WebmSegmentIndexParser.CUES_ID=475249515,shaka.media.WebmSegmentIndexParser.CUE_POINT_ID=187,shaka.media.WebmSegmentIndexParser.CUE_TIME_ID=179,shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID=183,shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION=241,shaka.dash.SegmentBase=function(){},shaka.dash.SegmentBase.createInitSegment=function(t,i){var r=shaka.util.XmlUtils,o=shaka.util.ManifestParserUtils,l=shaka.dash.MpdUtils.inheritChild(t,i,"Initialization");if(!l)return null;var g=t.representation.baseUris,_=l.getAttribute("sourceURL");return _&&(g=o.resolveUris(t.representation.baseUris,[_])),o=0,_=null,(r=r.parseAttr(l,"range",r.parseRange))&&(o=r.start,_=r.end),new shaka.media.InitSegmentReference(function(){return g},o,_)},shaka.dash.SegmentBase.createStreamInfo=function(t,i){goog.asserts.assert(t.representation.segmentBase,"Should only be called with SegmentBase");var r=shaka.dash.MpdUtils,o=shaka.dash.SegmentBase,l=shaka.util.XmlUtils,g=Number(r.inheritAttribute(t,o.fromInheritance_,"presentationTimeOffset"))||0,_=1;(r=r.inheritAttribute(t,o.fromInheritance_,"timescale"))&&(_=l.parsePositiveInt(r)||1);var v=g/_||0,E=o.createInitSegment(t,o.fromInheritance_);o.checkSegmentIndexRangeSupport_(t,E);var P=shaka.util.ObjectUtils.shallowCloneObject(t);return{generateSegmentIndex:function(){return o.generateSegmentIndex_(P,i,E,v)}}},shaka.dash.SegmentBase.generateSegmentIndexFromUris=function(t,i,r,o,l,g,_){var v,E,P,M,R,U,$,G,z,Z,Y,se,Q,te,ce;return $jscomp.asyncExecutePromiseGeneratorProgram(function(me){return 1==me.nextAddress?(v=t.presentationTimeline,E=!t.dynamic||!t.periodInfo.isLastPeriod,P=t.periodInfo.start,M=t.periodInfo.duration,R=t.representation.mimeType.split("/")[1],$=null,G=[(U=i)(o,l,g),"webm"==R?U(r.getUris(),r.startByte,r.endByte):null],U=null,me.yield(Promise.all(G),2)):(Z=(z=me.yieldResult)[0],Y=z[1]||null,se=null,Q=P-_,te=P,ce=M?P+M:1/0,"mp4"==R?se=shaka.media.Mp4SegmentIndexParser.parse(Z,l,o,r,Q,te,ce):(goog.asserts.assert(Y,"WebM requires init data"),se=shaka.media.WebmSegmentIndexParser.parse(Z,Y,o,r,Q,te,ce)),v.notifySegments(se),goog.asserts.assert(!$,"Should not call generateSegmentIndex twice"),$=new shaka.media.SegmentIndex(se),E&&$.fit(te,ce,!0),me.return($))})},shaka.dash.SegmentBase.fromInheritance_=function(t){return t.segmentBase},shaka.dash.SegmentBase.computeIndexRange_=function(t){var i=shaka.dash.MpdUtils,r=shaka.dash.SegmentBase,o=shaka.util.XmlUtils,l=i.inheritChild(t,r.fromInheritance_,"RepresentationIndex");return t=i.inheritAttribute(t,r.fromInheritance_,"indexRange"),t=o.parseRange(t||""),l&&(t=o.parseAttr(l,"range",o.parseRange,t)),t},shaka.dash.SegmentBase.computeIndexUris_=function(t){var i=shaka.util.ManifestParserUtils,r=shaka.dash.MpdUtils.inheritChild(t,shaka.dash.SegmentBase.fromInheritance_,"RepresentationIndex"),o=t.representation.baseUris;return r&&(r=r.getAttribute("sourceURL"))&&(o=i.resolveUris(t.representation.baseUris,[r])),o},shaka.dash.SegmentBase.checkSegmentIndexRangeSupport_=function(t,i){var r=shaka.dash.SegmentBase;if(r.checkSegmentIndexSupport(t,i),!r.computeIndexRange_(t))throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentBase.checkSegmentIndexSupport=function(t,i){var r=shaka.util.ManifestParserUtils.ContentType,o=t.representation.contentType,l=t.representation.mimeType.split("/")[1];if(o!=r.TEXT&&"mp4"!=l&&"webm"!=l)throw shaka.log.error("SegmentBase specifies an unsupported container type.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if("webm"==l&&!i)throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_WEBM_MISSING_INIT)},shaka.dash.SegmentBase.generateSegmentIndex_=function(t,i,r,o){var l=shaka.dash.SegmentBase,g=l.computeIndexUris_(t);return l=l.computeIndexRange_(t),goog.asserts.assert(l,"Index range should not be null!"),shaka.dash.SegmentBase.generateSegmentIndexFromUris(t,i,r,g,l.start,l.end,o)},shaka.dash.SegmentList=function(){},shaka.dash.SegmentList.createStreamInfo=function(t,i){goog.asserts.assert(t.representation.segmentList,"Should only be called with SegmentList");var r=shaka.dash.SegmentList,o=shaka.dash.SegmentBase.createInitSegment(t,r.fromInheritance_),l=r.parseSegmentListInfo_(t);r.checkSegmentListInfo_(t,l);var g=null,_=null;return t.period.id&&t.representation.id&&(g=i[_=t.period.id+","+t.representation.id]),r=r.createSegmentReferences_(t.periodInfo.start,t.periodInfo.duration,l.startNumber,t.representation.baseUris,l,o),o=!g,g?(_=t.presentationTimeline.getSegmentAvailabilityStart(),g.mergeAndEvict(r,_)):(t.presentationTimeline.notifySegments(r),g=new shaka.media.SegmentIndex(r),_&&t.dynamic&&(i[_]=g)),t.dynamic&&t.periodInfo.isLastPeriod||g.fit(t.periodInfo.start,t.periodInfo.duration?t.periodInfo.start+t.periodInfo.duration:1/0,o),{generateSegmentIndex:function(){return Promise.resolve(g)}}},shaka.dash.SegmentList.fromInheritance_=function(t){return t.segmentList},shaka.dash.SegmentList.parseSegmentListInfo_=function(t){var i=shaka.dash.SegmentList,r=shaka.dash.MpdUtils,o=i.parseMediaSegments_(t);return 0==(i=(t=r.parseSegmentInfo(t,i.fromInheritance_)).startNumber)&&(shaka.log.warning("SegmentList@startNumber must be > 0"),i=1),r=0,t.segmentDuration?r=t.segmentDuration*(i-1):t.timeline&&0<t.timeline.length&&(r=t.timeline[0].start),{segmentDuration:t.segmentDuration,startTime:r,startNumber:i,scaledPresentationTimeOffset:t.scaledPresentationTimeOffset,timeline:t.timeline,mediaSegments:o}},shaka.dash.SegmentList.checkSegmentListInfo_=function(t,i){if(!i.segmentDuration&&!i.timeline&&1<i.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(!i.segmentDuration&&!t.periodInfo.duration&&!i.timeline&&1==i.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(i.timeline&&0==i.timeline.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentList.createSegmentReferences_=function(t,i,r,o,l,g){r=shaka.util.ManifestParserUtils;var _=l.mediaSegments.length;l.timeline&&l.timeline.length!=l.mediaSegments.length&&(_=Math.min(l.timeline.length,l.mediaSegments.length),shaka.log.warning("The number of items in the segment timeline and the number of ","segment URLs do not match, truncating",l.mediaSegments.length,"to",_));for(var v=t-l.scaledPresentationTimeOffset,E=i?t+i:1/0,P=[],M=l.startTime,R={},U=(_=$jscomp.makeIterator(shaka.util.Iterables.range(_))).next();!U.done;R={$jscomp$loop$prop$mediaUri$645:R.$jscomp$loop$prop$mediaUri$645},U=_.next()){var $=U.value;R.$jscomp$loop$prop$mediaUri$645=r.resolveUris(o,[(U=l.mediaSegments[$]).mediaUri]);var G=void 0;null!=l.segmentDuration?G=M+l.segmentDuration:l.timeline?G=l.timeline[$].end:(goog.asserts.assert(1==l.mediaSegments.length&&i,"There should be exactly one segment with a Period duration."),G=M+i),$=function(z){return function(){return z.$jscomp$loop$prop$mediaUri$645}}(R),P.push(new shaka.media.SegmentReference(t+M,t+G,$,U.start,U.end,g,v,t,E)),M=G}return P},shaka.dash.SegmentList.parseMediaSegments_=function(t){var i=[t.representation.segmentList,t.adaptationSet.segmentList,t.period.segmentList].filter(shaka.util.Functional.isNotNull),r=shaka.util.XmlUtils;return i.map(function(o){return r.findChildren(o,"SegmentURL")}).reduce(function(o,l){return 0<o.length?o:l}).map(function(o){return o.getAttribute("indexRange")&&!t.indexRangeWarningGiven&&(t.indexRangeWarningGiven=!0,shaka.log.warning("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate.")),{mediaUri:o.getAttribute("media"),start:(o=r.parseAttr(o,"mediaRange",r.parseRange,{start:0,end:null})).start,end:o.end}})},shaka.dash.SegmentTemplate=function(){},shaka.dash.SegmentTemplate.createStreamInfo=function(t,i,r,o,l){goog.asserts.assert(t.representation.segmentTemplate,"Should only be called with SegmentTemplate");var g=shaka.dash.SegmentTemplate,_=g.createInitSegment_(t),v=g.parseSegmentTemplateInfo_(t);g.checkSegmentTemplateInfo_(t,v);var E=shaka.util.ObjectUtils.shallowCloneObject(t);if(v.indexTemplate)return shaka.dash.SegmentBase.checkSegmentIndexSupport(t,_),{generateSegmentIndex:function(){return g.generateSegmentIndexFromIndexTemplate_(E,i,_,v)}};if(v.segmentDuration)return o||(t.presentationTimeline.notifyMaxSegmentDuration(v.segmentDuration),t.presentationTimeline.notifyMinSegmentStartTime(t.periodInfo.start)),{generateSegmentIndex:function(){return g.generateSegmentIndexFromDuration_(E,v,l,_)}};var P=null;o=null,t.period.id&&t.representation.id&&(P=r[o=t.period.id+","+t.representation.id]);var M=g.createFromTimeline_(E,v,_),R=t.periodInfo.start,U=t.periodInfo.duration?t.periodInfo.start+t.periodInfo.duration:1/0,$=U!=1/0;return P?($&&new shaka.media.SegmentIndex(M).fit(R,U,!0),P.mergeAndEvict(M,t.presentationTimeline.getSegmentAvailabilityStart())):(t.presentationTimeline.notifySegments(M),P=new shaka.media.SegmentIndex(M),o&&t.dynamic&&(r[o]=P)),$&&P.fit(R,U),{generateSegmentIndex:function(){return Promise.resolve(P)}}},shaka.dash.SegmentTemplate.fromInheritance_=function(t){return t.segmentTemplate},shaka.dash.SegmentTemplate.parseSegmentTemplateInfo_=function(t){var i=shaka.dash.SegmentTemplate,r=shaka.dash.MpdUtils,o=r.parseSegmentInfo(t,i.fromInheritance_),l=r.inheritAttribute(t,i.fromInheritance_,"media");return t=r.inheritAttribute(t,i.fromInheritance_,"index"),{segmentDuration:o.segmentDuration,timescale:o.timescale,startNumber:o.startNumber,scaledPresentationTimeOffset:o.scaledPresentationTimeOffset,unscaledPresentationTimeOffset:o.unscaledPresentationTimeOffset,timeline:o.timeline,mediaTemplate:l,indexTemplate:t}},shaka.dash.SegmentTemplate.checkSegmentTemplateInfo_=function(t,i){var r=i.indexTemplate?1:0;if(r+=i.timeline?1:0,0==(r+=i.segmentDuration?1:0))throw shaka.log.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(1!=r&&(shaka.log.warning("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",t.representation),i.indexTemplate?(shaka.log.info("Using the index URL template by default."),i.timeline=null):(goog.asserts.assert(i.timeline,"There should be a timeline"),shaka.log.info("Using the SegmentTimeline by default.")),i.segmentDuration=null),!i.indexTemplate&&!i.mediaTemplate)throw shaka.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",t.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentTemplate.generateSegmentIndexFromIndexTemplate_=function(t,i,r,o){var l=shaka.dash.MpdUtils,g=shaka.util.ManifestParserUtils;return goog.asserts.assert(o.indexTemplate,"must be using index template"),l=l.fillUriTemplate(o.indexTemplate,t.representation.id,null,t.bandwidth||null,null),g=g.resolveUris(t.representation.baseUris,[l]),shaka.dash.SegmentBase.generateSegmentIndexFromUris(t,i,r,g,0,null,o.scaledPresentationTimeOffset)},shaka.dash.SegmentTemplate.generateSegmentIndexFromDuration_=function(t,i,r,o){goog.asserts.assert(i.mediaTemplate,"There should be a media template with duration");var l=shaka.dash.MpdUtils,g=shaka.util.ManifestParserUtils,_=t.presentationTimeline,v=t.periodInfo.start,E=t.periodInfo.duration,P=E?v+E:1/0,M=i.segmentDuration;goog.asserts.assert(null!=M,"Segment duration must not be null!");var R=i.startNumber,U=i.timescale,$=i.mediaTemplate,G=t.bandwidth||null,z=t.representation.id,Z=t.representation.baseUris,Y=v-i.scaledPresentationTimeOffset,se=function(){var fe=[Math.max(_.getSegmentAvailabilityStart(),v),Math.min(_.getSegmentAvailabilityEnd(),P)];return goog.asserts.assert(fe.every(isFinite),"Available presentation times must be finite!"),goog.asserts.assert(fe.every(function(le){return 0<=le}),"Available presentation times must be positive!"),goog.asserts.assert(null!=M,"Segment duration must not be null!"),fe=fe.map(function(le){return le-v}),[Math.ceil(fe[0]/M),Math.ceil(fe[1]/M)-1].map(function(le){return le+R})};E=se(),t=t.dynamic?Math.max(E[0],E[1]-r+1):E[0],r=E[1],E=[];for(var Q=function(fe){goog.asserts.assert(null!=M,"Segment duration must not be null!");var le=(fe-R)*M,be=le+i.scaledPresentationTimeOffset;le+=v;var Ie=Math.min(le+M,P);return goog.asserts.assert(le<Ie,"Generated a segment outside of the period!"),new shaka.media.SegmentReference(le,Ie,function(){var Se=l.fillUriTemplate($,z,fe,G,be*U);return g.resolveUris(Z,[Se])},0,null,o,Y,v,P)},te=t;te<=r;++te){var ce=Q(te);E.push(ce)}var me=new shaka.media.SegmentIndex(E);if(_.getSegmentAvailabilityEnd()<P){var ye=Math.max(t,r+1);me.updateEvery(M,function(){me.evict(_.getSegmentAvailabilityStart());var fe=$jscomp.makeIterator(se());fe.next(),fe=fe.next().value;for(var le=[];ye<=fe;){var be=Q(ye);le.push(be),ye++}return _.getSegmentAvailabilityEnd()>=P&&!le.length?null:le})}return Promise.resolve(me)},shaka.dash.SegmentTemplate.createFromTimeline_=function(t,i,r){var o=shaka.dash.MpdUtils,l=shaka.util.ManifestParserUtils,g=t.periodInfo.start,_=t.periodInfo.duration,v=g-i.scaledPresentationTimeOffset;_=_?g+_:1/0;for(var E=[],P={},M=$jscomp.makeIterator(shaka.util.Iterables.enumerate(i.timeline)),R=M.next();!R.done;P={$jscomp$loop$prop$mediaTemplate$647:P.$jscomp$loop$prop$mediaTemplate$647,$jscomp$loop$prop$repId$648:P.$jscomp$loop$prop$repId$648,$jscomp$loop$prop$segmentReplacement$649:P.$jscomp$loop$prop$segmentReplacement$649,$jscomp$loop$prop$bandwidth$650:P.$jscomp$loop$prop$bandwidth$650,$jscomp$loop$prop$timeReplacement$651:P.$jscomp$loop$prop$timeReplacement$651,$jscomp$loop$prop$baseUris$652:P.$jscomp$loop$prop$baseUris$652},R=M.next()){var U=R.value,$=U.item;R=$.start;var G=$.unscaledStart;$=$.end,P.$jscomp$loop$prop$segmentReplacement$649=U.i+i.startNumber,P.$jscomp$loop$prop$timeReplacement$651=G+i.unscaledPresentationTimeOffset,P.$jscomp$loop$prop$repId$648=t.representation.id,P.$jscomp$loop$prop$bandwidth$650=t.bandwidth||null,P.$jscomp$loop$prop$mediaTemplate$647=i.mediaTemplate,P.$jscomp$loop$prop$baseUris$652=t.representation.baseUris,U=function(z){return function(){goog.asserts.assert(z.$jscomp$loop$prop$mediaTemplate$647,"There should be a media template with a timeline");var Z=o.fillUriTemplate(z.$jscomp$loop$prop$mediaTemplate$647,z.$jscomp$loop$prop$repId$648,z.$jscomp$loop$prop$segmentReplacement$649,z.$jscomp$loop$prop$bandwidth$650||null,z.$jscomp$loop$prop$timeReplacement$651);return l.resolveUris(z.$jscomp$loop$prop$baseUris$652,[Z]).map(function(Y){return Y.toString()})}}(P),E.push(new shaka.media.SegmentReference(g+R,g+$,U,0,null,r,v,g,_))}return E},shaka.dash.SegmentTemplate.createInitSegment_=function(t){var i=shaka.dash.MpdUtils,r=shaka.util.ManifestParserUtils,o=i.inheritAttribute(t,shaka.dash.SegmentTemplate.fromInheritance_,"initialization");if(!o)return null;var l=t.representation.id,g=t.bandwidth||null,_=t.representation.baseUris;return new shaka.media.InitSegmentReference(function(){goog.asserts.assert(o,"Should have returned earler");var v=i.fillUriTemplate(o,l,null,g,null);return r.resolveUris(_,[v])},0,null)},shaka.util.PeriodCombiner=function(){this.variants_=[],this.audioStreams_=[],this.videoStreams_=[],this.textStreams_=[],this.imageStreams_=[],this.usedPeriodIds_=new Set},shaka.util.PeriodCombiner.prototype.release=function(){for(var t=this.audioStreams_.concat(this.videoStreams_,this.textStreams_,this.imageStreams_),i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next())(i=i.value).segmentIndex&&i.segmentIndex.release();this.audioStreams_=[],this.videoStreams_=[],this.textStreams_=[],this.imageStreams_=[],this.variants_=[]},shaka.util.PeriodCombiner.prototype.getVariants=function(){return this.variants_},shaka.util.PeriodCombiner.prototype.getTextStreams=function(){return this.textStreams_},shaka.util.PeriodCombiner.prototype.getImageStreams=function(){return this.imageStreams_},shaka.util.PeriodCombiner.prototype.combinePeriods=function(t,i){var o,l,g,_,v,E,M,R,U,$,G,z,Z,Y,se,te,ce,me,ye,fe,le,be,Ie,Se,Fe,$e,He,Xe,Ye,ct,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yt){switch(yt.nextAddress){case 1:if(o=shaka.util.ManifestParserUtils.ContentType,l=shaka.util.Iterables,shaka.util.PeriodCombiner.filterOutAudioStreamDuplicates_(t),shaka.util.PeriodCombiner.filterOutVideoStreamDuplicates_(t),shaka.util.PeriodCombiner.filterOutTextStreamDuplicates_(t),!i&&1==t.length){r.audioStreams_=(g=t[0]).audioStreams,r.videoStreams_=g.videoStreams,r.textStreams_=g.textStreams,r.imageStreams_=g.imageStreams,yt.jumpTo(2);break}for(_=-1,v=$jscomp.makeIterator(l.enumerate(t)),E=v.next();!E.done;E=v.next())R=(M=E.value).i,r.usedPeriodIds_.has((U=M.item).id)||(r.usedPeriodIds_.add(U.id),-1==_&&(_=R));if(-1==_)return yt.return();for($=t.map(function(_t){return _t.audioStreams}),G=t.map(function(_t){return _t.videoStreams}),z=t.map(function(_t){return _t.textStreams}),Z=t.map(function(_t){return _t.imageStreams}),Y=$jscomp.makeIterator(z),se=Y.next();!se.done;se=Y.next())se.value.push(shaka.util.PeriodCombiner.dummyTextStream_());return yt.yield(shaka.util.PeriodCombiner.combine_(r.audioStreams_,$,_,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),3);case 3:return yt.yield(shaka.util.PeriodCombiner.combine_(r.videoStreams_,G,_,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),4);case 4:return yt.yield(shaka.util.PeriodCombiner.combine_(r.textStreams_,z,_,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),5);case 5:return yt.yield(shaka.util.PeriodCombiner.combine_(r.imageStreams_,Z,_,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),2);case 2:if(te=0,ce=[],r.videoStreams_.length&&r.audioStreams_.length)for(Ie=$jscomp.makeIterator(r.audioStreams_),Se=Ie.next();!Se.done;Se=Ie.next())for(Fe=Se.value,$e=$jscomp.makeIterator(r.videoStreams_),He=$e.next();!He.done;He=$e.next())Ye=shaka.media.DrmEngine.getCommonDrmInfos(Fe.drmInfos,(Xe=He.value).drmInfos),Fe.drmInfos.length&&Xe.drmInfos.length&&!Ye.length?shaka.log.warning("Incompatible DRM in audio & video, skipping variant creation.",Fe,Xe):(ct=te++,ce.push({id:ct,language:Fe.language,primary:Fe.primary,audio:Fe,video:Xe,bandwidth:(Fe.bandwidth||0)+(Xe.bandwidth||0),drmInfos:Ye,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(me=r.videoStreams_.concat(r.audioStreams_),ye=$jscomp.makeIterator(me),fe=ye.next();!fe.done;fe=ye.next())be=te++,ce.push({id:be,language:(le=fe.value).language,primary:le.primary,audio:le.type==o.AUDIO?le:null,video:le.type==o.VIDEO?le:null,bandwidth:le.bandwidth||0,drmInfos:le.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});r.variants_=ce,yt.jumpToEnd()}})},shaka.util.PeriodCombiner.filterOutAudioStreamDuplicates_=function(t){for(var i=shaka.util.ArrayUtils,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){for(var o=[],l=$jscomp.makeIterator((r=r.value).audioStreams),g=l.next();!g.done;g=l.next()){g=g.value;for(var _=!1,v=$jscomp.makeIterator(o),E=v.next();!E.done;E=v.next())g.id!=(E=E.value).id&&g.channelsCount==E.channelsCount&&g.language==E.language&&g.bandwidth==E.bandwidth&&g.label==E.label&&g.codecs==E.codecs&&g.mimeType==E.mimeType&&i.hasSameElements(g.roles,E.roles)&&g.audioSamplingRate==E.audioSamplingRate&&g.primary==E.primary&&(_=!0);_||o.push(g)}r.audioStreams=o}},shaka.util.PeriodCombiner.filterOutTextStreamDuplicates_=function(t){for(var i=shaka.util.ArrayUtils,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){for(var o=[],l=$jscomp.makeIterator((r=r.value).textStreams),g=l.next();!g.done;g=l.next()){g=g.value;for(var _=!1,v=$jscomp.makeIterator(o),E=v.next();!E.done;E=v.next())g.id!=(E=E.value).id&&g.language==E.language&&g.label==E.label&&g.codecs==E.codecs&&g.mimeType==E.mimeType&&i.hasSameElements(g.roles,E.roles)&&(_=!0);_||o.push(g)}r.textStreams=o}},shaka.util.PeriodCombiner.filterOutVideoStreamDuplicates_=function(t){for(var i=shaka.util.ArrayUtils,r=shaka.util.MapUtils,o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next()){for(var l=[],g=$jscomp.makeIterator((o=o.value).videoStreams),_=g.next();!_.done;_=g.next()){_=_.value;for(var v=!1,E=$jscomp.makeIterator(l),P=E.next();!P.done;P=E.next())_.id!=(P=P.value).id&&_.width==P.width&&_.frameRate==P.frameRate&&_.codecs==P.codecs&&_.mimeType==P.mimeType&&_.label==P.label&&i.hasSameElements(_.roles,P.roles)&&r.hasSameElements(_.closedCaptions,P.closedCaptions)&&_.bandwidth==P.bandwidth&&(v=!0);v||l.push(_)}o.videoStreams=l}},shaka.util.PeriodCombiner.combineDbStreams=function(t){var i,r,o,l,g,_,E,P,M,R,U,$,G,Z,Y,se,Q,te,me;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){switch(ye.nextAddress){case 1:if(i=shaka.util.ManifestParserUtils.ContentType,1==t.length)return ye.return(t[0]);for(r=t.map(function(fe){return fe.filter(function(le){return le.type==i.AUDIO})}),o=t.map(function(fe){return fe.filter(function(le){return le.type==i.VIDEO})}),l=t.map(function(fe){return fe.filter(function(le){return le.type==i.TEXT})}),g=$jscomp.makeIterator(l),_=g.next();!_.done;_=g.next())_.value.push(shaka.util.PeriodCombiner.dummyTextStreamDB_());return ye.yield(shaka.util.PeriodCombiner.combine_([],r,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),2);case 2:return E=ye.yieldResult,ye.yield(shaka.util.PeriodCombiner.combine_([],o,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),3);case 3:return P=ye.yieldResult,ye.yield(shaka.util.PeriodCombiner.combine_([],l,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),4);case 4:if(M=ye.yieldResult,R=0,P.length&&E.length)for(Z=$jscomp.makeIterator(E),Y=Z.next();!Y.done;Y=Z.next())for(se=Y.value,Q=$jscomp.makeIterator(P),te=Q.next();!te.done;te=Q.next())me=R++,te.value.variantIds.push(me),se.variantIds.push(me);else for(U=P.concat(E),$=$jscomp.makeIterator(U),G=$.next();!G.done;G=$.next())G.value.variantIds=[R++];return ye.return(P.concat(E).concat(M))}})},shaka.util.PeriodCombiner.combine_=function(t,i,r,o,l){var g,v,E,P,R,$,G,z,se,Q,ce,me,fe,le,Ie,Se;return $jscomp.asyncExecutePromiseGeneratorProgram(function($e){switch($e.nextAddress){case 1:for(g=shaka.util.ManifestParserUtils.ContentType,v=[],E=$jscomp.makeIterator(shaka.util.Iterables.enumerate(i)),P=E.next();!P.done;P=E.next())$=(R=P.value).item,v.push(R.i>=r?new Set($):new Set);G=$jscomp.makeIterator(t),z=G.next();case 2:if(z.done){$e.jumpTo(4);break}return $e.yield(shaka.util.PeriodCombiner.extendExistingOutputStream_(z.value,i,r,l,v),5);case 5:if(!$e.yieldResult)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.PERIOD_FLATTENING_FAILED);z=G.next(),$e.jumpTo(2);break;case 4:se=$jscomp.makeIterator(v),Q=se.next();case 6:if(Q.done){$e.jumpTo(8);break}ce=$jscomp.makeIterator(Q.value),me=ce.next();case 9:if(me.done){Q=se.next(),$e.jumpTo(6);break}return $e.yield(shaka.util.PeriodCombiner.createNewOutputStream_(me.value,i,o,l,v),12);case 12:(fe=$e.yieldResult)&&t.push(fe),me=ce.next(),$e.jumpTo(9);break;case 8:for(le=$jscomp.makeIterator(v),Q=le.next();!Q.done;Q=le.next())for(Ie={},Se=$jscomp.makeIterator(Q.value),me=Se.next();!me.done;Ie={$jscomp$loop$prop$stream$543$654:Ie.$jscomp$loop$prop$stream$543$654},me=Se.next())if(Ie.$jscomp$loop$prop$stream$543$654=me.value,(Ie.$jscomp$loop$prop$stream$543$654.type!=g.TEXT||Ie.$jscomp$loop$prop$stream$543$654.language)&&t.some(function(He){return function(Xe){return Xe.mimeType==He.$jscomp$loop$prop$stream$543$654.mimeType&&shaka.util.MimeUtils.getCodecBase(Xe.codecs)==shaka.util.MimeUtils.getCodecBase(He.$jscomp$loop$prop$stream$543$654.codecs)}}(Ie)))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.PERIOD_FLATTENING_FAILED);return $e.return(t)}})},shaka.util.PeriodCombiner.extendExistingOutputStream_=function(t,i,r,o,l){var g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_){return 1==_.nextAddress?(g=shaka.util.PeriodCombiner.findMatchesInAllPeriods_(i,t))?(goog.asserts.assert(t.createSegmentIndex,"outputStream should be a Stream type!"),_.yield(Promise.all(g.map(function(v){return v.createSegmentIndex()})),2)):_.return(!1):(goog.asserts.assert(g,"Matches should be non-null"),shaka.util.PeriodCombiner.extendOutputStream_(t,g,r,o,l),_.return(!0))})},shaka.util.PeriodCombiner.createNewOutputStream_=function(t,i,r,o,l){var g,_;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){return 1==v.nextAddress?(g=r(t),(_=shaka.util.PeriodCombiner.findMatchesInAllPeriods_(i,g))?g.createSegmentIndex?v.yield(Promise.all(_.map(function(E){return E.createSegmentIndex()})),2):v.jumpTo(2):v.return(null)):(goog.asserts.assert(_,"Matches should be non-null"),shaka.util.PeriodCombiner.extendOutputStream_(g,_,0,o,l),v.return(g))})},shaka.util.PeriodCombiner.extendOutputStream_=function(t,i,r,o,l){for(var g=shaka.util.ManifestParserUtils.ContentType,_=shaka.util.LanguageUtils,v=(i=$jscomp.makeIterator(shaka.util.Iterables.enumerate(i))).next();!v.done;v=i.next()){var E=v.value;if(v=E.i,E=E.item,v>=r){o(t,E);var P=!0;t.type==g.AUDIO&&0==_.relatedness(t.language,E.language)&&(P=!1),P&&l[v].delete(E)}}},shaka.util.PeriodCombiner.cloneStream_=function(t){return(t=Object.assign({},t)).originalId=null,t.createSegmentIndex=function(){return Promise.resolve()},t.segmentIndex=new shaka.media.MetaSegmentIndex,t.emsgSchemeIdUris=[],t.keyIds=new Set,t.closedCaptions=null,t.trickModeVideo=null,t},shaka.util.PeriodCombiner.cloneStreamDB_=function(t){return(t=Object.assign({},t)).keyIds=new Set,t.segments=[],t.variantIds=[],t.closedCaptions=null,t},shaka.util.PeriodCombiner.concatenateStreams_=function(t,i){t.roles=Array.from(new Set(t.roles.concat(i.roles))),i.emsgSchemeIdUris&&(t.emsgSchemeIdUris=Array.from(new Set(t.emsgSchemeIdUris.concat(i.emsgSchemeIdUris))));var r=i.keyIds;if(r=new Set([].concat($jscomp.arrayFromIterable(t.keyIds),$jscomp.arrayFromIterable(r))),t.keyIds=r,t.originalId=null==t.originalId?i.originalId:t.originalId+","+(i.originalId||""),r=shaka.media.DrmEngine.getCommonDrmInfos(t.drmInfos,i.drmInfos),i.drmInfos.length&&t.drmInfos.length&&!r.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INCONSISTENT_DRM_ACROSS_PERIODS);if(t.drmInfos=r,t.encrypted=t.encrypted||i.encrypted,i.closedCaptions){t.closedCaptions||(t.closedCaptions=new Map);for(var o=(r=$jscomp.makeIterator(i.closedCaptions)).next();!o.done;o=r.next()){var l=$jscomp.makeIterator(o.value);o=l.next().value,l=l.next().value,t.closedCaptions.set(o,l)}}goog.asserts.assert(t.segmentIndex instanceof shaka.media.MetaSegmentIndex,"Output streams should have a MetaSegmentIndex!"),goog.asserts.assert(i.segmentIndex,"Input segment index should have been created by now!"),t.segmentIndex.appendSegmentIndex(i.segmentIndex),i.trickModeVideo?(t.trickModeVideo||(t.trickModeVideo=shaka.util.PeriodCombiner.cloneStream_(i.trickModeVideo),t.trickModeVideo.segmentIndex=t.segmentIndex.clone()),shaka.util.PeriodCombiner.concatenateStreams_(t.trickModeVideo,i.trickModeVideo)):t.trickModeVideo&&shaka.util.PeriodCombiner.concatenateStreams_(t.trickModeVideo,i)},shaka.util.PeriodCombiner.concatenateStreamDBs_=function(t,i){t.roles=Array.from(new Set(t.roles.concat(i.roles)));var r=i.keyIds;if(r=new Set([].concat($jscomp.arrayFromIterable(t.keyIds),$jscomp.arrayFromIterable(r))),t.keyIds=r,t.encrypted=t.encrypted&&i.encrypted,t.segments.push.apply(t.segments,$jscomp.arrayFromIterable(i.segments)),i.closedCaptions){t.closedCaptions||(t.closedCaptions=new Map);for(var o=(r=$jscomp.makeIterator(i.closedCaptions)).next();!o.done;o=r.next()){var l=$jscomp.makeIterator(o.value);o=l.next().value,l=l.next().value,t.closedCaptions.set(o,l)}}},shaka.util.PeriodCombiner.findMatchesInAllPeriods_=function(t,i){for(var r=[],o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next()){if(!(l=shaka.util.PeriodCombiner.findBestMatchInPeriod_(l.value,i)))return null;r.push(l)}return r},shaka.util.PeriodCombiner.findBestMatchInPeriod_=function(t,i){for(var r={audio:shaka.util.PeriodCombiner.areAVStreamsCompatible_,video:shaka.util.PeriodCombiner.areAVStreamsCompatible_,text:shaka.util.PeriodCombiner.areTextStreamsCompatible_,image:shaka.util.PeriodCombiner.areImageStreamsCompatible_}[i.type],o={audio:shaka.util.PeriodCombiner.isAudioStreamBetterMatch_,video:shaka.util.PeriodCombiner.isVideoStreamBetterMatch_,text:shaka.util.PeriodCombiner.isTextStreamBetterMatch_,image:shaka.util.PeriodCombiner.isImageStreamBetterMatch_}[i.type],l=null,g=$jscomp.makeIterator(t),_=g.next();!_.done;_=g.next())!r(i,_=_.value)||l&&!o(i,l,_)||(l=_);return l},shaka.util.PeriodCombiner.areAVStreamsCompatible_=function(t,i){return!(i.mimeType!=t.mimeType||shaka.util.MimeUtils.getCodecBase(i.codecs)!=shaka.util.MimeUtils.getCodecBase(t.codecs)||t.drmInfos&&!shaka.media.DrmEngine.areDrmCompatible(t.drmInfos,i.drmInfos))},shaka.util.PeriodCombiner.areTextStreamsCompatible_=function(t,i){return!(!t.language||i.language&&(0==shaka.util.LanguageUtils.relatedness(t.language,i.language)||i.kind!=t.kind))},shaka.util.PeriodCombiner.areImageStreamsCompatible_=function(t,i){return!!t.tilesLayout},shaka.util.PeriodCombiner.isAudioStreamBetterMatch_=function(t,i,r){var o=shaka.util.LanguageUtils,l=shaka.util.PeriodCombiner.BetterOrWorse,g=l.BETTER;if(l=l.WORSE,t.id==r.id)return!0;var _=o.relatedness(t.language,i.language);return(o=o.relatedness(t.language,r.language))>_||!(o<_)&&(!(i.primary||!r.primary)||!(i.primary&&!r.primary)&&(t.roles.length?(g=i.roles.filter(function(v){return t.roles.includes(v)}),(l=r.roles.filter(function(v){return t.roles.includes(v)})).length>g.length||!(l.length<g.length)&&r.roles.length<i.roles.length):!(r.roles.length||!i.roles.length)||!(r.roles.length&&!i.roles.length)&&((o=shaka.util.PeriodCombiner.compareClosestPreferLower(t.channelsCount,i.channelsCount,r.channelsCount))==g||o!=l&&((o=shaka.util.PeriodCombiner.compareClosestPreferLower(t.audioSamplingRate,i.audioSamplingRate,r.audioSamplingRate))==g||o!=l&&!(!t.bandwidth||shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_(t.bandwidth,i.bandwidth,r.bandwidth)!=g)))))},shaka.util.PeriodCombiner.isVideoStreamBetterMatch_=function(t,i,r){var o=shaka.util.PeriodCombiner.BetterOrWorse,l=o.BETTER;if(o=o.WORSE,t.id==r.id)return!0;var g=shaka.util.PeriodCombiner.compareClosestPreferLower(t.width*t.height,i.width*i.height,r.width*r.height);if(g==l)return!0;if(g==o)return!1;if(t.frameRate){if((g=shaka.util.PeriodCombiner.compareClosestPreferLower(t.frameRate,i.frameRate,r.frameRate))==l)return!0;if(g==o)return!1}return!(!t.bandwidth||shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_(t.bandwidth,i.bandwidth,r.bandwidth)!=l)},shaka.util.PeriodCombiner.isTextStreamBetterMatch_=function(t,i,r){var o=shaka.util.LanguageUtils;if(t.id==r.id)return!0;var l=o.relatedness(t.language,i.language);if((o=o.relatedness(t.language,r.language))>l)return!0;if(o<l)return!1;if(!i.primary&&r.primary)return!0;if(i.primary&&!r.primary)return!1;if(t.roles.length){if(l=i.roles.filter(function(g){return t.roles.includes(g)}),(o=r.roles.filter(function(g){return t.roles.includes(g)})).length>l.length)return!0;if(o.length<l.length)return!1}else{if(!r.roles.length&&i.roles.length)return!0;if(r.roles.length&&!i.roles.length)return!1}return!(r.mimeType!=t.mimeType||r.codecs!=t.codecs||i.mimeType==t.mimeType&&i.codecs==t.codecs)},shaka.util.PeriodCombiner.isImageStreamBetterMatch_=function(t,i,r){return t.id==r.id||r.mimeType==t.mimeType},shaka.util.PeriodCombiner.dummyTextStreamDB_=function(){return{id:0,originalId:"",primary:!1,type:shaka.util.ManifestParserUtils.ContentType.TEXT,mimeType:"",codecs:"",language:"",label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}},shaka.util.PeriodCombiner.dummyTextStream_=function(){var t=shaka.util.ManifestParserUtils.ContentType;return{id:0,originalId:"",createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new shaka.media.SegmentIndex([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",label:null,type:t.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}},shaka.util.PeriodCombiner.compareClosestPreferLower=function(t,i,r){var o=shaka.util.PeriodCombiner.BetterOrWorse,l=o.BETTER,g=o.WORSE;if(i==t&&t!=r)return g;if(r==t&&t!=i)return l;if(i>t){if(r<=t||r-t<i-t)return l;if(r-t>i-t)return g}else{if(r>t)return g;if(t-r<t-i)return l;if(t-r>t-i)return g}return o.EQUAL},shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_=function(t,i,r){var o=shaka.util.PeriodCombiner.BetterOrWorse,l=o.BETTER,g=o.WORSE;return i=Math.abs(t-i),(t=Math.abs(t-r))<i?l:i<t?g:o.EQUAL},shaka.util.PeriodCombiner.BetterOrWorse={BETTER:1,EQUAL:0,WORSE:-1},shaka.dash.DashParser=function(){var t=this;this.playerInterface_=this.config_=null,this.manifestUris_=[],this.manifest_=null,this.globalId_=1,this.segmentIndexMap_={},this.periodCombiner_=new shaka.util.PeriodCombiner,this.updatePeriod_=0,this.averageUpdateDuration_=new shaka.abr.Ewma(5),this.updateTimer_=new shaka.util.Timer(function(){t.onUpdate_()}),this.operationManager_=new shaka.util.OperationManager,this.minTotalAvailabilityTimeOffset_=1/0,this.lowLatencyMode_=!1},shaka.dash.DashParser.prototype.configure=function(t){goog.asserts.assert(null!=t.dash,"DashManifestConfiguration should not be null!"),this.config_=t},shaka.dash.DashParser.prototype.start=function(t,i){var o,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return goog.asserts.assert(r.config_,"Must call configure() before start()!"),r.lowLatencyMode_=i.isLowLatencyMode(),r.manifestUris_=[t],r.playerInterface_=i,l.yield(r.requestManifest_(),2);if(o=l.yieldResult,r.playerInterface_&&r.setUpdateTimer_(o),!r.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return goog.asserts.assert(r.manifest_,"Manifest should be non-null!"),l.return(r.manifest_)})},shaka.dash.DashParser.prototype.stop=function(){for(var t=$jscomp.makeIterator(Object.values(this.segmentIndexMap_)),i=t.next();!i.done;i=t.next())i.value.release();return this.periodCombiner_&&this.periodCombiner_.release(),this.config_=this.playerInterface_=null,this.manifestUris_=[],this.manifest_=null,this.segmentIndexMap_={},this.periodCombiner_=null,null!=this.updateTimer_&&(this.updateTimer_.stop(),this.updateTimer_=null),this.operationManager_.destroy()},shaka.dash.DashParser.prototype.update=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return 1==r.nextAddress?(r.setCatchFinallyBlocks(2),r.yield(t.requestManifest_(),4)):2!=r.nextAddress?r.leaveTryBlock(0):(i=r.enterCatchBlock(),t.playerInterface_&&i?(goog.asserts.assert(i instanceof shaka.util.Error,"Bad error type"),t.playerInterface_.onError(i),void r.jumpToEnd()):r.return())})},shaka.dash.DashParser.prototype.onExpirationUpdated=function(t,i){},shaka.dash.DashParser.prototype.requestManifest_=function(){var i,r,o,l,g,_,v,E,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return 1==P.nextAddress?(i=shaka.net.NetworkingEngine.RequestType.MANIFEST,r=shaka.net.NetworkingEngine.makeRequest(t.manifestUris_,t.config_.retryParameters),o=t.playerInterface_.networkingEngine,l=Date.now(),g=o.request(i,r),t.operationManager_.manage(g),P.yield(g.promise,2)):3!=P.nextAddress?(_=P.yieldResult,t.playerInterface_?(_.uri&&!t.manifestUris_.includes(_.uri)&&t.manifestUris_.unshift(_.uri),P.yield(t.parseManifest_(_.data,_.uri),3)):P.return(0)):(v=Date.now(),t.averageUpdateDuration_.sample(1,E=(v-l)/1e3),P.return(E))})},shaka.dash.DashParser.prototype.parseManifest_=function(t,i){var o,l,g,E,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress){if(o=shaka.util.Error,l=shaka.dash.MpdUtils,!(g=shaka.util.XmlUtils.parseXml(t,"MPD")))throw new o(o.Severity.CRITICAL,o.Category.MANIFEST,o.Code.DASH_INVALID_XML,i);return r.config_.dash.disableXlinkProcessing?M.return(r.processManifest_(g,i)):(E=l.processXlinks(g,r.config_.retryParameters,r.config_.dash.xlinkFailGracefully,i,r.playerInterface_.networkingEngine),r.operationManager_.manage(E),M.yield(E.promise,2))}return M.return(r.processManifest_(M.yieldResult,i))})},shaka.dash.DashParser.prototype.processManifest_=function(t,i){var o,l,g,_,v,E,P,M,R,$,G,z,Y,Q,te,ce,me,ye,le,Ie,Se,Fe,$e,He,yt,_t,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qe){switch(Qe.nextAddress){case 1:if(o=shaka.util.Functional,g=[i],0<(_=(l=shaka.util.XmlUtils).findChildren(t,"Location").map(l.getContents).filter(o.isNotNull)).length&&(v=shaka.util.ManifestParserUtils.resolveUris(g,_),g=r.manifestUris_=v),E=l.findChildren(t,"BaseURL"),P=E.map(l.getContents),M=shaka.util.ManifestParserUtils.resolveUris(g,P),R=0,E&&E.length&&(R=l.parseAttr(E[0],"availabilityTimeOffset",l.parseFloat)||0),$=0,r.config_.dash.ignoreMinBufferTime||($=l.parseAttr(t,"minBufferTime",l.parseDuration)||0),r.updatePeriod_=l.parseAttr(t,"minimumUpdatePeriod",l.parseDuration,-1),G=l.parseAttr(t,"availabilityStartTime",l.parseDate),z=l.parseAttr(t,"timeShiftBufferDepth",l.parseDuration),Y=null,r.config_.dash.ignoreSuggestedPresentationDelay||(Y=l.parseAttr(t,"suggestedPresentationDelay",l.parseDuration)),Q=null,r.config_.dash.ignoreMaxSegmentDuration||(Q=l.parseAttr(t,"maxSegmentDuration",l.parseDuration)),te=t.getAttribute("type")||"static",r.manifest_)for(ce=r.manifest_.presentationTimeline,me=$jscomp.makeIterator(Object.values(r.segmentIndexMap_)),ye=me.next();!ye.done;ye=me.next())ye.value.evict(ce.getSegmentAvailabilityStart());else le=r.config_.defaultPresentationDelay||1.5*$,ce=new shaka.media.PresentationTimeline(G,null!=Y?Y:le,r.config_.dash.autoCorrectDrift);return Ie=t.getAttribute("profiles")||"",Se={dynamic:"static"!=te,presentationTimeline:ce,period:null,periodInfo:null,adaptationSet:null,representation:null,bandwidth:0,indexRangeWarningGiven:!1,availabilityTimeOffset:R,profiles:Ie.split(",")},Fe=r.parsePeriods_(Se,M,t),$e=Fe.duration,He=Fe.periods,ce.setStatic("static"==te),"static"!=te&&Fe.durationDerivedFromPeriods||ce.setDuration($e||1/0),r.minTotalAvailabilityTimeOffset_&&!r.lowLatencyMode_&&r.playerInterface_.isAutoLowLatencyMode()&&(r.playerInterface_.enableLowLatencyMode(),r.lowLatencyMode_=r.playerInterface_.isLowLatencyMode()),r.lowLatencyMode_?ce.setAvailabilityTimeOffset(r.minTotalAvailabilityTimeOffset_):r.minTotalAvailabilityTimeOffset_&&shaka.log.alwaysWarn("Low-latency DASH live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),ce.isLive()&&!isNaN(r.config_.availabilityWindowOverride)&&(z=r.config_.availabilityWindowOverride),null==z&&(z=1/0),ce.setSegmentAvailabilityDuration(z),ce.notifyMaxSegmentDuration(Q||1),goog.DEBUG&&ce.assertIsValid(),Qe.yield(r.periodCombiner_.combinePeriods(He,Se.dynamic),2);case 2:if(r.manifest_){r.manifest_.variants=r.periodCombiner_.getVariants(),r.manifest_.textStreams=r.periodCombiner_.getTextStreams(),r.manifest_.imageStreams=r.periodCombiner_.getImageStreams(),r.playerInterface_.filter(r.manifest_),Qe.jumpTo(3);break}if(r.manifest_={presentationTimeline:ce,variants:r.periodCombiner_.getVariants(),textStreams:r.periodCombiner_.getTextStreams(),imageStreams:r.periodCombiner_.getImageStreams(),offlineSessionIds:[],minBufferTime:$||0},!ce.usingPresentationStartTime()){Qe.jumpTo(3);break}return yt=shaka.util.XmlUtils.findChildren(t,"UTCTiming"),Qe.yield(r.parseUtcTiming_(M,yt),5);case 5:if(_t=Qe.yieldResult,!r.playerInterface_)return Qe.return();ce.setClockOffset(_t);case 3:r.playerInterface_.makeTextStreamsForClosedCaptions(r.manifest_),Qe.jumpToEnd()}})},shaka.dash.DashParser.prototype.parsePeriods_=function(t,i,r){var o=shaka.util.XmlUtils,l=o.parseAttr(r,"mediaPresentationDuration",o.parseDuration),g=[],_=0;r=o.findChildren(r,"Period");for(var v=(r=$jscomp.makeIterator(shaka.util.Iterables.enumerate(r))).next();!v.done;v=r.next()){var E=v.value;v=E.i;var P=E.item;E=E.next,_=o.parseAttr(P,"start",o.parseDuration,_);var M=o.parseAttr(P,"duration",o.parseDuration),R=null;if(E){var U=o.parseAttr(E,"start",o.parseDuration);null!=U&&(R=U-_)}else null!=l&&(R=l-_);if(U=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS,R&&M&&Math.abs(R-M)>U&&shaka.log.warning("There is a gap/overlap between Periods",P),null==R&&(R=M),P=this.parsePeriod_(t,i,{start:_,duration:R,node:P,isLastPeriod:null==R||!E}),g.push(P),null==R){E&&shaka.log.warning("Skipping Period",v+1,"and any subsequent Periods:","Period",v+1,"does not have a valid start time.",E),_=null;break}_+=R}return null!=l?(_!=l&&shaka.log.warning("@mediaPresentationDuration does not match the total duration of ","all Periods."),{periods:g,duration:l,durationDerivedFromPeriods:!1}):{periods:g,duration:_,durationDerivedFromPeriods:!0}},shaka.dash.DashParser.prototype.parsePeriod_=function(t,i,r){var o=this,l=shaka.util.Functional,g=shaka.util.XmlUtils,_=shaka.util.ManifestParserUtils.ContentType;t.period=this.createFrame_(r.node,null,i),t.periodInfo=r,t.period.availabilityTimeOffset=t.availabilityTimeOffset,t.period.id||(shaka.log.info("No Period ID given for Period with start time "+r.start+",  Assigning a default"),t.period.id="__shaka_period_"+r.start),i=g.findChildren(r.node,"EventStream");for(var v=(i=$jscomp.makeIterator(i)).next();!v.done;v=i.next())this.parseEventStream_(r.start,r.duration,v.value);if(l=g.findChildren(r.node,"AdaptationSet").map(function(R){return o.parseAdaptationSet_(t,R)}).filter(l.isNotNull),t.dynamic){for(r=[],i=(g=$jscomp.makeIterator(l)).next();!i.done;i=g.next())for(v=(i=$jscomp.makeIterator(i.value.representationIds)).next();!v.done;v=i.next())r.push(v.value);if(g=new Set(r),r.length!=g.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_DUPLICATE_REPRESENTATION_ID)}for(r=l.filter(function(R){return!R.trickModeFor}),l=l.filter(function(R){return R.trickModeFor}),g=(l=$jscomp.makeIterator(l)).next();!g.done;g=l.next()){i=(g=g.value).trickModeFor.split(" ");for(var E=(v=$jscomp.makeIterator(r)).next();!E.done;E=v.next()){var P=E.value;if(i.includes(P.id)){E={};for(var M=(P=$jscomp.makeIterator(P.streams)).next();!M.done;E={$jscomp$loop$prop$stream$656:E.$jscomp$loop$prop$stream$656},M=P.next())E.$jscomp$loop$prop$stream$656=M.value,E.$jscomp$loop$prop$stream$656.trickModeVideo=g.streams.find(function(R){return function(U){return shaka.util.MimeUtils.getCodecBase(R.$jscomp$loop$prop$stream$656.codecs)==shaka.util.MimeUtils.getCodecBase(U.codecs)}}(E))}}}if(g=this.config_.disableAudio?[]:this.getSetsOfType_(r,_.AUDIO),i=this.config_.disableVideo?[]:this.getSetsOfType_(r,_.VIDEO),l=this.config_.disableText?[]:this.getSetsOfType_(r,_.TEXT),r=this.config_.disableThumbnails?[]:this.getSetsOfType_(r,_.IMAGE),!i.length&&!g.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_PERIOD);for(_=[],v=(g=$jscomp.makeIterator(g)).next();!v.done;v=g.next())_.push.apply(_,$jscomp.arrayFromIterable(v.value.streams));for(g=[],v=(i=$jscomp.makeIterator(i)).next();!v.done;v=i.next())g.push.apply(g,$jscomp.arrayFromIterable(v.value.streams));for(i=[],v=(l=$jscomp.makeIterator(l)).next();!v.done;v=l.next())i.push.apply(i,$jscomp.arrayFromIterable(v.value.streams));for(l=[],v=(r=$jscomp.makeIterator(r)).next();!v.done;v=r.next())l.push.apply(l,$jscomp.arrayFromIterable(v.value.streams));return{id:t.period.id,audioStreams:_,videoStreams:g,textStreams:i,imageStreams:l}},shaka.dash.DashParser.prototype.getSetsOfType_=function(t,i){return t.filter(function(r){return r.contentType==i})},shaka.dash.DashParser.prototype.parseAdaptationSet_=function(t,i){var r=this,o=shaka.util.XmlUtils,l=shaka.util.Functional,g=shaka.util.ManifestParserUtils,_=g.ContentType,v=shaka.dash.ContentProtection;t.adaptationSet=this.createFrame_(i,t.period,null);var E=!1,P=o.findChildren(i,"Role"),M=P.map(function(le){return le.getAttribute("value")}).filter(l.isNotNull),R=void 0;(l=t.adaptationSet.contentType==_.TEXT)&&(R=g.TextStreamKind.SUBTITLE);for(var U=(P=$jscomp.makeIterator(P)).next();!U.done;U=P.next()){var $=(U=U.value).getAttribute("schemeIdUri");if(null==$||"urn:mpeg:dash:role:2011"==$)switch(U=U.getAttribute("value"),U){case"main":E=!0;break;case"caption":case"subtitle":R=U}}$=o.findChildren(i,"EssentialProperty"),P=null,U=!1;for(var G=($=$jscomp.makeIterator($)).next();!G.done;G=$.next()){var z=G.value;"http://dashif.org/guidelines/trickmode"==z.getAttribute("schemeIdUri")?P=z.getAttribute("value"):U=!0}z=o.findChildren(i,"Accessibility"),$=shaka.util.LanguageUtils;var Z=new Map;for(G=(z=$jscomp.makeIterator(z)).next();!G.done;G=z.next()){var Y=G.value;if(G=Y.getAttribute("schemeIdUri"),Y=Y.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==G)if(G=1,null!=Y){Y=Y.split(";");for(var se=$jscomp.makeIterator(Y),Q=se.next();!Q.done;Q=se.next()){var te=Q.value,ce=Q=void 0;te.includes("=")?(Q=(te=te.split("="))[0].startsWith("CC")?te[0]:"CC"+te[0],ce=te[1]):(Q="CC"+G,2==Y.length?G+=2:G++,ce=te),Z.set(Q,$.normalize(ce))}}else Z.set("CC1","und");else if("urn:scte:dash:cc:cea-708:2015"==G)if(G=1,null!=Y)for(Q=(Y=$jscomp.makeIterator(Y.split(";"))).next();!Q.done;Q=Y.next())te=se=void 0,(Q=Q.value).includes("=")?(se="svc"+(Q=Q.split("="))[0],te=Q[1].split(",")[0].split(":").pop()):(se="svc"+G,G++,te=Q),Z.set(se,$.normalize(te));else Z.set("svc1","und");else"urn:mpeg:dash:role:2011"==G&&null!=Y&&(M.push(Y),"captions"==Y&&(R=g.TextStreamKind.CLOSED_CAPTION))}if(U)return null;g=o.findChildren(i,"ContentProtection");var me=v.parseFromAdaptationSet(g,this.config_.dash.ignoreDrmInfo,this.config_.dash.keySystemsByURI),ye=shaka.util.LanguageUtils.normalize(i.getAttribute("lang")||"und"),fe=i.getAttribute("label");if((v=o.findChildren(i,"Label"))&&v.length&&(v=v[0]).textContent&&(fe=v.textContent),v=o.findChildren(i,"Representation"),0==(o=v.map(function(le){return r.parseRepresentation_(t,me,R,ye,fe,E,M,Z,le)}).filter(function(le){return!!le})).length){if(P=t.adaptationSet.contentType==_.IMAGE,this.config_.dash.ignoreEmptyAdaptationSet||l||P)return null;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_ADAPTATION_SET)}if(!t.adaptationSet.contentType||t.adaptationSet.contentType==_.APPLICATION)for(t.adaptationSet.contentType=shaka.dash.DashParser.guessContentType_(o[0].mimeType,o[0].codecs),l=(_=$jscomp.makeIterator(o)).next();!l.done;l=_.next())l.value.type=t.adaptationSet.contentType;for(l=(_=$jscomp.makeIterator(o)).next();!l.done;l=_.next())for(l=l.value,U=(g=$jscomp.makeIterator(me.drmInfos)).next();!U.done;U=g.next())(U=U.value).keyIds=U.keyIds&&l.keyIds?new Set([].concat($jscomp.arrayFromIterable(U.keyIds),$jscomp.arrayFromIterable(l.keyIds))):U.keyIds||l.keyIds;return _=v.map(function(le){return le.getAttribute("id")}).filter(shaka.util.Functional.isNotNull),{id:t.adaptationSet.id||"__fake__"+this.globalId_++,contentType:t.adaptationSet.contentType,language:ye,main:E,streams:o,drmInfos:me.drmInfos,trickModeFor:P,representationIds:_}},shaka.dash.DashParser.prototype.parseRepresentation_=function(t,i,r,o,l,g,_,v,E){var P=this,M=shaka.util.XmlUtils,R=shaka.util.ManifestParserUtils.ContentType;if(t.representation=this.createFrame_(E,t.adaptationSet,null),this.minTotalAvailabilityTimeOffset_=Math.min(this.minTotalAvailabilityTimeOffset_,t.representation.availabilityTimeOffset),!this.verifyRepresentation_(t.representation))return shaka.log.warning("Skipping Representation",t.representation),null;var U=t.periodInfo.start;t.bandwidth=M.parseAttr(E,"bandwidth",M.parsePositiveInt)||0;var $=t.representation.contentType,G=$==R.TEXT||$==R.APPLICATION;R=$==R.IMAGE;try{if($=function(ye,fe,le){return P.requestInitSegment_(ye,fe,le)},t.representation.segmentBase)var z=shaka.dash.SegmentBase.createStreamInfo(t,$);else if(t.representation.segmentList)z=shaka.dash.SegmentList.createStreamInfo(t,this.segmentIndexMap_);else if(t.representation.segmentTemplate)z=shaka.dash.SegmentTemplate.createStreamInfo(t,$,this.segmentIndexMap_,!!this.manifest_,this.config_.dash.initialSegmentLimit);else{goog.asserts.assert(G,"Must have Segment* with non-text streams.");var Z=t.representation.baseUris,Y=t.periodInfo.duration||0;z={generateSegmentIndex:function(){return Promise.resolve(shaka.media.SegmentIndex.forSingleSegment(U,Y,Z))}}}}catch(ye){if((G||R)&&ye.code==shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)return null;throw ye}$=M.findChildren(E,"ContentProtection"),$=shaka.dash.ContentProtection.parseFromRepresentation($,i,this.config_.dash.ignoreDrmInfo,this.config_.dash.keySystemsByURI),$=new Set($?[$]:[]);var se=!1;M.findChildren(E,"SupplementalProperty").some(function(ye){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"==ye.getAttribute("schemeIdUri")&&"JOC"==ye.getAttribute("value")})&&(t.representation.mimeType="audio/eac3-joc",se=!0);var te,ce,Q=!1;if(G&&(Q=_.includes("forced_subtitle")),R&&((E=M.findChildren(E,"EssentialProperty").find(function(ye){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(ye.getAttribute("schemeIdUri"))}))&&(te=E.getAttribute("value")),!te))return null;E=t.representation.codecs,t.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(E.includes("hvc1.2.4.L153.B0")||E.includes("hev1.2.4.L153.B0"))&&(ce="PQ");var me={id:this.globalId_++,originalId:t.representation.id,createSegmentIndex:function(){var ye;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fe){if(1==fe.nextAddress)return me.segmentIndex?fe.jumpTo(0):(ye=me,fe.yield(z.generateSegmentIndex(),3));ye.segmentIndex=fe.yieldResult,fe.jumpToEnd()})},segmentIndex:null,mimeType:t.representation.mimeType,codecs:t.representation.codecs,frameRate:t.representation.frameRate,pixelAspectRatio:t.representation.pixelAspectRatio,bandwidth:t.bandwidth,width:t.representation.width,height:t.representation.height,kind:r,encrypted:0<i.drmInfos.length,drmInfos:i.drmInfos,keyIds:$,language:o,label:l,type:t.adaptationSet.contentType,primary:g,trickModeVideo:null,emsgSchemeIdUris:t.representation.emsgSchemeIdUris,roles:_,forced:Q,channelsCount:t.representation.numChannels,audioSamplingRate:t.representation.audioSamplingRate,spatialAudio:se,closedCaptions:v,hdr:ce,tilesLayout:te};return me},shaka.dash.DashParser.prototype.onUpdate_=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){switch(o.nextAddress){case 1:return goog.asserts.assert(0<=t.updatePeriod_,"There should be an update period"),shaka.log.info("Updating manifest..."),i=0,o.setCatchFinallyBlocks(2),o.yield(t.requestManifest_(),4);case 4:i=o.yieldResult,o.leaveTryBlock(3);break;case 2:r=o.enterCatchBlock(),goog.asserts.assert(r instanceof shaka.util.Error,"Should only receive a Shaka error"),t.playerInterface_&&(r.severity=shaka.util.Error.Severity.RECOVERABLE,t.playerInterface_.onError(r));case 3:if(!t.playerInterface_)return o.return();t.setUpdateTimer_(i),o.jumpToEnd()}})},shaka.dash.DashParser.prototype.setUpdateTimer_=function(t){0>this.updatePeriod_||(t=Math.max(shaka.dash.DashParser.MIN_UPDATE_PERIOD_,this.updatePeriod_-t,this.averageUpdateDuration_.getEstimate()),this.updateTimer_.tickAfter(t))},shaka.dash.DashParser.prototype.createFrame_=function(t,i,r){goog.asserts.assert(i||r,"Must provide either parent or baseUris");var o=shaka.util.ManifestParserUtils,l=shaka.util.XmlUtils;i=i||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,numChannels:null,audioSamplingRate:null,availabilityTimeOffset:0},r=r||i.baseUris;var g=l.parseNonNegativeInt,_=l.evalDivision,v=l.findChildren(t,"BaseURL"),E=v.map(l.getContents),P=t.getAttribute("contentType")||i.contentType,M=t.getAttribute("mimeType")||i.mimeType,R=t.getAttribute("codecs")||i.codecs;_=l.parseAttr(t,"frameRate",_)||i.frameRate;var U=t.getAttribute("sar")||i.pixelAspectRatio,$=this.emsgSchemeIdUris_(l.findChildren(t,"InbandEventStream"),i.emsgSchemeIdUris),G=l.findChildren(t,"AudioChannelConfiguration");G=this.parseAudioChannels_(G)||i.numChannels;var z=l.parseAttr(t,"audioSamplingRate",g)||i.audioSamplingRate;P||(P=shaka.dash.DashParser.guessContentType_(M,R));var Z=l.findChild(t,"SegmentBase"),Y=l.findChild(t,"SegmentTemplate"),se=Z&&l.parseAttr(Z,"availabilityTimeOffset",l.parseFloat)||0,Q=Y&&l.parseAttr(Y,"availabilityTimeOffset",l.parseFloat)||0;return v=v&&v.length&&l.parseAttr(v[0],"availabilityTimeOffset",l.parseFloat)||0,v=i.availabilityTimeOffset+v+se+Q,{baseUris:o.resolveUris(r,E),segmentBase:Z||i.segmentBase,segmentList:l.findChild(t,"SegmentList")||i.segmentList,segmentTemplate:Y||i.segmentTemplate,width:l.parseAttr(t,"width",g)||i.width,height:l.parseAttr(t,"height",g)||i.height,contentType:P,mimeType:M,codecs:R,frameRate:_,pixelAspectRatio:U,emsgSchemeIdUris:$,id:t.getAttribute("id"),numChannels:G,audioSamplingRate:z,availabilityTimeOffset:v}},shaka.dash.DashParser.prototype.emsgSchemeIdUris_=function(t,i){for(var r=i.slice(),o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())l=l.value.getAttribute("schemeIdUri"),r.includes(l)||r.push(l);return r},shaka.dash.DashParser.prototype.parseAudioChannels_=function(t){for(var i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){var r=i.value;if((i=r.getAttribute("schemeIdUri"))&&(r=r.getAttribute("value")))switch(i){case"urn:mpeg:dash:outputChannelPositionList:2012":return r.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var o=parseInt(r,10);if(!o){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",i,r);continue}return o;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(o=parseInt(r,16))){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",i,r);continue}for(t=0;o;)1&o&&++t,o>>=1;return t;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":o=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14];var l=parseInt(r,10);if(!l){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",i,r);continue}if(0<l&&l<o.length)return o[l];continue;default:shaka.log.warning("Unrecognized audio channel scheme:",i,r)}}return null},shaka.dash.DashParser.prototype.verifyRepresentation_=function(t){var i=shaka.util.ManifestParserUtils.ContentType,r=t.segmentBase?1:0;return r+=t.segmentList?1:0,0==(r+=t.segmentTemplate?1:0)?t.contentType==i.TEXT||t.contentType==i.APPLICATION||(shaka.log.warning("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',t),!1):(1!=r&&(shaka.log.warning("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",t),t.segmentBase?(shaka.log.info("Using SegmentBase by default."),t.segmentList=null):(goog.asserts.assert(t.segmentList,"There should be a SegmentList"),shaka.log.info("Using SegmentList by default.")),t.segmentTemplate=null),!0)},shaka.dash.DashParser.prototype.requestForTiming_=function(t,i,r){var l,g,v,E,P,M,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){if(1==R.nextAddress)return l=shaka.util.ManifestParserUtils.resolveUris(t,[i]),(g=shaka.net.NetworkingEngine.makeRequest(l,o.config_.retryParameters)).method=r,v=o.playerInterface_.networkingEngine.request(shaka.net.NetworkingEngine.RequestType.TIMING,g),o.operationManager_.manage(v),R.yield(v.promise,2);if(E=R.yieldResult,"HEAD"==r){if(!E.headers||!E.headers.date)return shaka.log.warning("UTC timing response is missing","expected date header"),R.return(0);P=E.headers.date}else P=shaka.util.StringUtils.fromUTF8(E.data);return M=Date.parse(P),isNaN(M)?(shaka.log.warning("Unable to parse date from UTC timing response"),R.return(0)):R.return(M-Date.now())})},shaka.dash.DashParser.prototype.parseUtcTiming_=function(t,i){var o,l,g,_,v,E,P,M,R,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){switch(U.nextAddress){case 1:o=i.map(function($){return{scheme:$.getAttribute("schemeIdUri"),value:$.getAttribute("value")}}),l=r.config_.dash.clockSyncUri,!o.length&&l&&o.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:l}),g=$jscomp.makeIterator(o),_=g.next();case 2:if(_.done){U.jumpTo(4);break}switch(v=_.value,U.setCatchFinallyBlocks(5),P=v.value,E=v.scheme){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return U.jumpTo(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return U.jumpTo(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return M=Date.parse(P),U.return(isNaN(M)?0:M-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":shaka.log.alwaysWarn("NTP UTCTiming scheme is not supported");break;default:shaka.log.alwaysWarn("Unrecognized scheme in UTCTiming element",E)}U.jumpTo(9);break;case 7:return U.yield(r.requestForTiming_(t,P,"HEAD"),10);case 10:return U.return(U.yieldResult);case 8:return U.yield(r.requestForTiming_(t,P,"GET"),11);case 11:return U.return(U.yieldResult);case 9:U.leaveTryBlock(3);break;case 5:R=U.enterCatchBlock(),shaka.log.warning("Error fetching time from UTCTiming elem",R.message);case 3:_=g.next(),U.jumpTo(2);break;case 4:return shaka.log.alwaysWarn("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),U.return(0)}})},shaka.dash.DashParser.prototype.parseEventStream_=function(t,i,r){for(var o=shaka.util.XmlUtils,l=o.parseNonNegativeInt,g=r.getAttribute("schemeIdUri")||"",_=r.getAttribute("value")||"",v=o.parseAttr(r,"timescale",l)||1,E=(r=$jscomp.makeIterator(o.findChildren(r,"Event"))).next();!E.done;E=r.next()){var P=o.parseAttr(E=E.value,"presentationTime",l)||0,M=o.parseAttr(E,"duration",l)||0;M=(P=P/v+t)+M/v,null!=i&&(P=Math.min(P,t+i),M=Math.min(M,t+i)),E={schemeIdUri:g,value:_,startTime:P,endTime:M,id:E.getAttribute("id")||"",eventElement:E},this.playerInterface_.onTimelineRegionAdded(E)}},shaka.dash.DashParser.prototype.requestInitSegment_=function(t,i,r){var l,g,v,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return 1==P.nextAddress?(l=shaka.net.NetworkingEngine.RequestType.SEGMENT,g=shaka.util.Networking.createSegmentRequest(t,i,r,o.config_.retryParameters),v=o.playerInterface_.networkingEngine.request(l,g),o.operationManager_.manage(v),P.yield(v.promise,2)):P.return(P.yieldResult.data)})},shaka.dash.DashParser.guessContentType_=function(t,i){var r=shaka.util.MimeUtils.getFullType(t,i);return shaka.text.TextEngine.isTypeSupported(r)?shaka.util.ManifestParserUtils.ContentType.TEXT:t.split("/")[0]},goog.exportSymbol("shaka.dash.DashParser",shaka.dash.DashParser),shaka.dash.DashParser.MIN_UPDATE_PERIOD_=3,shaka.media.ManifestParser.registerParserByExtension("mpd",function(){return new shaka.dash.DashParser}),shaka.media.ManifestParser.registerParserByMime("application/dash+xml",function(){return new shaka.dash.DashParser}),shaka.media.ManifestParser.registerParserByMime("video/vnd.mpeg.dash.mpd",function(){return new shaka.dash.DashParser}),shaka.hls={},shaka.hls.Playlist=function(t,i,r,o){this.absoluteUri=t,this.type=i,this.tags=r,this.segments=o||null},shaka.hls.PlaylistType={MASTER:0,MEDIA:1},shaka.hls.Tag=function(t,i,r,o){this.id=t,this.name=i,this.attributes=r,this.value=void 0===o?null:o},shaka.hls.Tag.prototype.toString=function(){var t=function(r){var o=isNaN(Number(r.value))?'"'+r.value+'"':r.value;return r.name+"="+o},i="#"+this.name;return t=this.attributes?this.attributes.map(t):[],this.value&&t.unshift(this.value),0<t.length&&(i+=":"+t.join(",")),i},shaka.hls.Tag.prototype.addAttribute=function(t){this.attributes.push(t)},shaka.hls.Tag.prototype.getAttribute=function(t){var i=this.attributes.filter(function(r){return r.name==t});return goog.asserts.assert(2>i.length,"A tag should not have multiple attributes with the same name!"),i.length?i[0]:null},shaka.hls.Tag.prototype.getAttributeValue=function(t,i){var r=this.getAttribute(t);return r?r.value:i||null},shaka.hls.Tag.prototype.getRequiredAttrValue=function(t){var i=this.getAttribute(t);if(!i)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_ATTRIBUTE_MISSING,t);return i.value},shaka.hls.Tag.prototype.setName=function(t){this.name=t},shaka.hls.Segment=function(t,i,r){r=void 0===r?[]:r,this.tags=i,this.absoluteUri=t,this.partialSegments=r},shaka.hls.Attribute=function(t,i){this.name=t,this.value=i},shaka.hls.Utils=function(){},shaka.hls.Utils.filterTagsByName=function(t,i){return t.filter(function(r){return r.name==i})},shaka.hls.Utils.filterTagsByType=function(t,i){return t.filter(function(r){return r.getRequiredAttrValue("TYPE")==i})},shaka.hls.Utils.getFirstTagWithName=function(t,i){var r=shaka.hls.Utils.filterTagsByName(t,i);return r.length?r[0]:null},shaka.hls.Utils.getFirstTagWithNameAsNumber=function(t,i,r){return r=void 0===r?0:r,(t=shaka.hls.Utils.getFirstTagWithName(t,i))?Number(t.value):r},shaka.hls.Utils.constructAbsoluteUri=function(t,i){return shaka.util.ManifestParserUtils.resolveUris([t],[i])[0]},shaka.hls.Utils.isComment=function(t){return/^#(?!EXT)/m.test(t)},shaka.util.TextParser=function(t){this.data_=t,this.position_=0},shaka.util.TextParser.prototype.atEnd=function(){return this.position_==this.data_.length},shaka.util.TextParser.prototype.readLine=function(){return this.readRegexReturnCapture_(/(.*?)(\n|$)/gm,1)},shaka.util.TextParser.prototype.readWord=function(){return this.readRegexReturnCapture_(/[^ \t\n]*/gm,0)},shaka.util.TextParser.prototype.skipWhitespace=function(){this.readRegex(/[ \t]+/gm)},shaka.util.TextParser.prototype.readRegex=function(t){return t=this.indexOf_(t),this.atEnd()||null==t||t.position!=this.position_?null:(this.position_+=t.length,t.results)},shaka.util.TextParser.prototype.readRegexReturnCapture_=function(t,i){if(this.atEnd())return null;var r=this.readRegex(t);return r?r[i]:null},shaka.util.TextParser.prototype.indexOf_=function(t){return goog.asserts.assert(t.global,"global flag should be set"),t.lastIndex=this.position_,null==(t=t.exec(this.data_))?null:{position:t.index,length:t[0].length,results:t}},shaka.hls.ManifestTextParser=function(){this.globalId_=0},shaka.hls.ManifestTextParser.prototype.parsePlaylist=function(t,i){var r=shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS,o=shaka.hls.ManifestTextParser.SEGMENT_TAGS,l=shaka.util.StringUtils.fromUTF8(t),g=(l=l.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(g[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_PLAYLIST_HEADER_MISSING);l=shaka.hls.PlaylistType.MASTER;for(var _=!0,v=$jscomp.makeIterator(g),E=v.next();!E.done;E=v.next())if(shaka.hls.Utils.isComment(E=E.value)||_)_=!1;else{if(E=this.parseTag_(E),--this.globalId_,r.includes(E.name)){l=shaka.hls.PlaylistType.MEDIA;break}"EXT-X-STREAM-INF"==E.name&&(_=!0)}for(r=[],_=!0,E=(v=$jscomp.makeIterator(shaka.util.Iterables.enumerate(g))).next();!E.done;E=v.next()){var P=E.value;E=P.i;var M=P.item;if(P=P.next,shaka.hls.Utils.isComment(M)||_)_=!1;else{if(M=this.parseTag_(M),o.includes(M.name)){if(l!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return o=g.splice(E,g.length-E),o=this.parseSegments_(i,o,r),new shaka.hls.Playlist(i,l,r,o)}r.push(M),"EXT-X-STREAM-INF"==M.name&&(_=new shaka.hls.Attribute("URI",P),M.addAttribute(_),_=!0)}}return new shaka.hls.Playlist(i,l,r)},shaka.hls.ManifestTextParser.prototype.parseSegments_=function(t,i,r){for(var o=[],l=[],g=[],_=null,v=(i=$jscomp.makeIterator(i)).next();!v.done;v=i.next())/^(#EXT)/.test(v=v.value)?(v=this.parseTag_(v),shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS.includes(v.name)?r.push(v):"EXT-X-MAP"==v.name?_=v:"EXT-X-PART"==v.name?g.push(v):"EXT-X-PRELOAD-HINT"==v.name?"PART"==v.getAttributeValue("TYPE")?g.push(v):"MAP"==v.getAttributeValue("TYPE")&&(v.setName("EXT-X-MAP"),_=v):l.push(v)):shaka.hls.Utils.isComment(v)||(v=v.trim(),v=shaka.hls.Utils.constructAbsoluteUri(t,v),_&&l.push(_),l=new shaka.hls.Segment(v,l,g),o.push(l),l=[],g=[]);return g.length&&(_&&l.push(_),t=new shaka.hls.Segment("",l,g),o.push(t)),o},shaka.hls.ManifestTextParser.prototype.parseTag_=function(t){return shaka.hls.ManifestTextParser.parseTag(this.globalId_++,t)},shaka.hls.ManifestTextParser.parseTag=function(t,i){var r=i.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INVALID_HLS_TAG,i);var g,o=r[1],l=r[2];if(r=[],l){var _,v=(l=new shaka.util.TextParser(l)).readRegex(/^([^,=]+)(?:,|$)/g);for(v&&(g=v[1]),v=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;_=l.readRegex(v);)_=new shaka.hls.Attribute(_[1],_[2]||_[3]),r.push(_)}return new shaka.hls.Tag(t,o,r,g)},shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP".split(" "),shaka.hls.ManifestTextParser.SEGMENT_TAGS="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP".split(" "),shaka.net.DataUriPlugin=function(){},shaka.net.DataUriPlugin.parse=function(t,i,r,o){try{var l=shaka.net.DataUriPlugin.parseRaw(t);return shaka.util.AbortableOperation.completed({uri:t,originalUri:t,data:l.data,headers:{"content-type":l.contentType}})}catch(g){return shaka.util.AbortableOperation.failed(g)}},shaka.net.DataUriPlugin.parseRaw=function(t){var i=t.split(":");if(2>i.length||"data"!=i[0])throw shaka.log.error("Bad data URI, failed to parse scheme"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,t);if(2>(i=i.slice(1).join(":").split(",")).length)throw shaka.log.error("Bad data URI, failed to extract encoding and MIME type"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,t);var r=i[0];t=window.decodeURIComponent(i.slice(1).join(",")),i=r.split(";"),r=i[0];var o=!1;return 1<i.length&&"base64"==i[i.length-1]&&(o=!0,i.pop()),{data:o?shaka.util.Uint8ArrayUtils.fromBase64(t):shaka.util.StringUtils.toUTF8(t),contentType:r}},goog.exportSymbol("shaka.net.DataUriPlugin",shaka.net.DataUriPlugin),goog.exportProperty(shaka.net.DataUriPlugin,"parse",shaka.net.DataUriPlugin.parse),shaka.net.NetworkingEngine.registerScheme("data",shaka.net.DataUriPlugin.parse),shaka.hls.HlsParser=function(){var t=this;this.config_=this.playerInterface_=null,this.globalId_=1,this.globalVariables_=new Map,this.groupIdToStreamInfosMap_=new Map,this.variantUriSet_=new Set,this.uriToStreamInfosMap_=new Map,this.presentationTimeline_=null,this.masterPlaylistUri_="",this.manifestTextParser_=new shaka.hls.ManifestTextParser,this.updatePlaylistDelay_=0,this.updatePlaylistTimer_=new shaka.util.Timer(function(){t.onUpdate_()}),this.presentationType_=shaka.hls.HlsParser.PresentationType_.VOD,this.manifest_=null,this.maxTargetDuration_=0,this.minTargetDuration_=1/0,this.lowLatencyPresentationDelay_=this.partialTargetDuration_=0,this.operationManager_=new shaka.util.OperationManager,this.segmentsToNotifyByStream_=[],this.groupIdToClosedCaptionsMap_=new Map,this.aesEncrypted_=!1,this.groupIdToCodecsMap_=new Map,this.playlistStartTime_=null,this.mapTagToInitSegmentRefMap_=new Map,this.discontinuityToTso_=new Map,this.lowLatencyMode_=!1},shaka.hls.HlsParser.prototype.configure=function(t){this.config_=t},shaka.hls.HlsParser.prototype.start=function(t,i){var o,l,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){return 1==g.nextAddress?(goog.asserts.assert(r.config_,"Must call configure() before start()!"),r.playerInterface_=i,r.lowLatencyMode_=i.isLowLatencyMode(),g.yield(r.requestManifest_(t),2)):3!=g.nextAddress?(r.masterPlaylistUri_=(o=g.yieldResult).uri,goog.asserts.assert(o.data,"Response data should be non-null!"),g.yield(r.parseManifest_(o.data),3)):(0<(l=r.updatePlaylistDelay_)&&r.updatePlaylistTimer_.tickAfter(l),goog.asserts.assert(r.manifest_,"Manifest should be non-null"),g.return(r.manifest_))})},shaka.hls.HlsParser.prototype.stop=function(){this.updatePlaylistTimer_&&(this.updatePlaylistTimer_.stop(),this.updatePlaylistTimer_=null);var t=[];return this.operationManager_&&(t.push(this.operationManager_.destroy()),this.operationManager_=null),this.config_=this.playerInterface_=null,this.variantUriSet_.clear(),this.manifest_=null,this.uriToStreamInfosMap_.clear(),this.groupIdToStreamInfosMap_.clear(),this.groupIdToCodecsMap_.clear(),this.globalVariables_.clear(),Promise.all(t)},shaka.hls.HlsParser.prototype.update=function(){var i,r,o,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return t.isLive_()?(i=[],t.playlistStartTime_=null,(r=Array.from(t.uriToStreamInfosMap_.values())).length?l.yield(t.updateStream_(r[0]),2):l.jumpTo(2)):l.return();for(o=1;o<r.length;o++)i.push(t.updateStream_(r[o]));return l.yield(Promise.all(i),0)})},shaka.hls.HlsParser.prototype.updateStream_=function(t){var r,l,g,_,v,E,P,M,R,U,$,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(z){if(1==z.nextAddress)return r=shaka.hls.HlsParser.PresentationType_,l=new goog.Uri(t.absoluteMediaPlaylistUri),i.lowLatencyMode_&&t.canSkipSegments&&l.setQueryData(new goog.Uri.QueryData("_HLS_skip=YES")),z.yield(i.requestManifest_(l.toString()),2);if(3!=z.nextAddress){if((_=i.manifestTextParser_.parsePlaylist((g=z.yieldResult).data,g.uri)).type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return v=shaka.hls.Utils.filterTagsByName(_.tags,"EXT-X-DEFINE"),E=i.parseMediaVariables_(v),z.yield(i.createSegments_(t.verbatimMediaPlaylistUri,_,(P=t.stream).type,P.mimeType,t.mediaSequenceToStartTime,E,t.discontinuityToMediaSequence),3)}P.segmentIndex.mergeAndEvict(M=z.yieldResult,i.presentationTimeline_.getSegmentAvailabilityStart()),M.length&&(R=shaka.hls.Utils.getFirstTagWithNameAsNumber(_.tags,"EXT-X-MEDIA-SEQUENCE",0),U=t.mediaSequenceToStartTime.get(R),P.segmentIndex.evict(U)),goog.asserts.assert($=M[M.length-1],"Should have segments!"),shaka.hls.Utils.getFirstTagWithName(_.tags,"EXT-X-ENDLIST")&&(i.setPresentationType_(r.VOD),i.presentationTimeline_.setDuration($.endTime)),z.jumpToEnd()})},shaka.hls.HlsParser.prototype.onExpirationUpdated=function(t,i){},shaka.hls.HlsParser.prototype.parseManifest_=function(t){var r,o,l,g,_,v,E,P,M,R,U,$,G,z,Z,Y,se,Q,te,ce,me,ye,le,be,Ie,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Se){switch(Se.nextAddress){case 1:if(r=shaka.hls.Utils,goog.asserts.assert(i.masterPlaylistUri_,"Master playlist URI must be set before calling parseManifest_!"),(o=i.manifestTextParser_.parsePlaylist(t,i.masterPlaylistUri_)).type!=shaka.hls.PlaylistType.MASTER)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_MASTER_PLAYLIST_NOT_PROVIDED);for(l=r.filterTagsByName(o.tags,"EXT-X-DEFINE"),i.parseMasterVariables_(l),g=r.filterTagsByName(o.tags,"EXT-X-MEDIA"),_=r.filterTagsByName(o.tags,"EXT-X-STREAM-INF"),i.parseCodecs_(_),v=r.filterTagsByName(o.tags,"EXT-X-SESSION-DATA"),E=$jscomp.makeIterator(v),P=E.next();!P.done;P=E.next())R=(M=P.value).getAttributeValue("DATA-ID"),U=M.getAttributeValue("URI"),$=M.getAttributeValue("LANGUAGE"),G=M.getAttributeValue("VALUE"),z={id:R},U&&(z.uri=shaka.hls.Utils.constructAbsoluteUri(i.masterPlaylistUri_,U)),$&&(z.language=$),G&&(z.value=G),Z=new shaka.util.FakeEvent("sessiondata",z),i.playerInterface_&&i.playerInterface_.onEvent(Z);return Se.yield(i.createStreamInfosFromMediaTags_(g),2);case 2:return i.parseClosedCaptions_(g),Se.yield(i.createVariantsForTags_(_),3);case 3:return Y=Se.yieldResult,Se.yield(i.parseTexts_(g),4);case 4:if(se=Se.yieldResult,!i.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);if(i.aesEncrypted_&&0==Y.length)throw shaka.log.info("No stream is created, because we don't support AES-128","encryption yet"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_AES_128_ENCRYPTION_NOT_SUPPORTED);for(te=Q=1/0,ce=$jscomp.makeIterator(i.uriToStreamInfosMap_.values()),me=ce.next();!me.done;me=ce.next())ye=me.value,Q=Math.min(Q,ye.minTimestamp),"text"!=ye.stream.type&&(te=Math.min(te,ye.maxTimestamp-ye.minTimestamp));if(goog.asserts.assert(null==i.presentationTimeline_,"Presentation timeline created early!"),i.createPresentationTimeline_(),goog.asserts.assert(i.presentationTimeline_,"Presentation timeline not created!"),i.isLive_())i.updatePlaylistDelay_=i.minTargetDuration_,i.presentationType_==shaka.hls.HlsParser.PresentationType_.LIVE&&(le=i.presentationTimeline_.getDelay(),isNaN(i.config_.availabilityWindowOverride)||(le=i.config_.availabilityWindowOverride),i.presentationTimeline_.setSegmentAvailabilityDuration(le));else for(i.presentationTimeline_.setDuration(te),i.presentationTimeline_.offset(-Q),be=$jscomp.makeIterator(i.uriToStreamInfosMap_.values()),me=be.next();!me.done;me=be.next())(Ie=me.value).stream.segmentIndex.offset(-Q),Ie.stream.segmentIndex.fit(0,te);i.manifest_={presentationTimeline:i.presentationTimeline_,variants:Y,textStreams:se,imageStreams:[],offlineSessionIds:[],minBufferTime:0},i.playerInterface_.makeTextStreamsForClosedCaptions(i.manifest_),Se.jumpToEnd()}})},shaka.hls.HlsParser.prototype.parseMasterVariables_=function(t){for(var i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){var r=i.value;i=r.getAttributeValue("NAME"),r=r.getAttributeValue("VALUE"),i&&r&&(this.globalVariables_.has(i)||this.globalVariables_.set(i,r))}},shaka.hls.HlsParser.prototype.parseMediaVariables_=function(t){for(var i=new Map,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){var o=r.value;r=o.getAttributeValue("NAME");var l=o.getAttributeValue("VALUE");o=o.getAttributeValue("IMPORT"),r&&l&&i.set(r,l),o&&(r=this.globalVariables_.get(o))&&i.set(o,r)}return i},shaka.hls.HlsParser.prototype.parseCodecs_=function(t){for(var i=shaka.util.ManifestParserUtils.ContentType,r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){var o=r.value,l=o.getAttributeValue("AUDIO");r=o.getAttributeValue("VIDEO");var g=o.getAttributeValue("SUBTITLES");if(o=this.getCodecsForVariantTag_(o),g){var _=shaka.util.ManifestParserUtils.guessCodecsSafe(i.TEXT,o);goog.asserts.assert(null!=_,"Text codecs should be valid."),this.groupIdToCodecsMap_.set(g,_),shaka.util.ArrayUtils.remove(o,_)}l&&(g=shaka.util.ManifestParserUtils.guessCodecs(i.AUDIO,o),this.groupIdToCodecsMap_.set(l,g)),r&&(l=shaka.util.ManifestParserUtils.guessCodecs(i.VIDEO,o),this.groupIdToCodecsMap_.set(r,l))}},shaka.hls.HlsParser.prototype.parseTexts_=function(t){var r,o,l,g,_,E,P,M,R,U,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){if(1==G.nextAddress)return r=shaka.hls.Utils.filterTagsByType(t,"SUBTITLES"),o=r.map(function(z){var Y,se;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){if(1==Q.nextAddress)return i.config_.disableText?Q.return(null):(Q.setCatchFinallyBlocks(2),Q.yield(i.createStreamInfoFromMediaTag_(z),4));if(2!=Q.nextAddress)return goog.asserts.assert(Y=Q.yieldResult,"Should always have a streamInfo for text"),Q.return(Y.stream);if(se=Q.enterCatchBlock(),i.config_.hls.ignoreTextStreamFailures)return Q.return(null);throw se})}),G.yield(Promise.all(o),2);for(l=G.yieldResult,g=$jscomp.makeIterator(r),_=g.next();!_.done;_=g.next())if(E=_.value.getRequiredAttrValue("GROUP-ID"),(P=i.groupIdToCodecsMap_.get(E))&&(M=i.groupIdToStreamInfosMap_.get(E)))for(R=$jscomp.makeIterator(M),U=R.next();!U.done;U=R.next())U.value.stream.codecs=P;return G.return(l.filter(function(z){return z}))})},shaka.hls.HlsParser.prototype.createStreamInfosFromMediaTags_=function(t){var r,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?(t=t.filter(function(l){var g=l.getAttributeValue("URI")||"";return"SUBTITLES"!=l.getAttributeValue("TYPE")&&""!=g})).length?o.yield(i.createStreamInfoFromMediaTag_(t[0]),2):o.jumpTo(2):(r=t.slice(1).map(function(l){return i.createStreamInfoFromMediaTag_(l)}),o.yield(Promise.all(r),0))})},shaka.hls.HlsParser.prototype.createVariantsForTags_=function(t){var r,l,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){return 1==g.nextAddress?(r=t.map(function(_){var v,E,P,M,R,U,$,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(z){return 1==z.nextAddress?(v=_.getAttributeValue("FRAME-RATE"),E=Number(_.getRequiredAttrValue("BANDWIDTH")),P=_.getAttributeValue("RESOLUTION"),M=$jscomp.makeIterator(P?P.split("x"):[null,null]),R=M.next().value,U=M.next().value,$=_.getAttributeValue("VIDEO-RANGE"),z.yield(i.createStreamInfosForVariantTag_(_,P,v),2)):(G=z.yieldResult)?(goog.asserts.assert(G.audio.length||G.video.length,"We should have created a stream!"),z.return(i.createVariants_(G.audio,G.video,E,R,U,v,$))):z.return([])})}),g.yield(Promise.all(r),2)):(l=(l=g.yieldResult.reduce(shaka.util.Functional.collapseArrays,[])).filter(function(_){return null!=_}),g.return(l))})},shaka.hls.HlsParser.prototype.createStreamInfosForVariantTag_=function(t,i,r){var l,g,_,v,E,P,M,R,U,$,G,z,Z,Y,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){if(1==se.nextAddress)return l=shaka.util.ManifestParserUtils.ContentType,g=o.getCodecsForVariantTag_(t),_=t.getAttributeValue("AUDIO"),v=t.getAttributeValue("VIDEO"),goog.asserts.assert(null==_||null==v,"Unexpected: both video and audio described by media tags!"),P=(E=_||v)&&o.groupIdToStreamInfosMap_.has(E)?o.groupIdToStreamInfosMap_.get(E):[],M={audio:_?P:[],video:v?P:[]},shaka.log.debug("Guessing stream type for",t.toString()),U=!1,$=t.getRequiredAttrValue("URI"),G=M.audio.find(function(Q){return Q&&Q.verbatimMediaPlaylistUri==$}),z=shaka.util.ManifestParserUtils.guessCodecsSafe(l.VIDEO,g),(Z=shaka.util.ManifestParserUtils.guessCodecsSafe(l.AUDIO,g))&&!z?(R=l.AUDIO,shaka.log.debug("Guessing audio-only.")):!P.length&&Z&&z?(shaka.log.debug("Guessing multiplexed audio+video."),R=l.VIDEO,g=[[z,Z].join()]):M.audio.length&&G?(shaka.log.debug("Guessing audio-only."),R=l.AUDIO,U=!0):M.video.length?(shaka.log.debug("Guessing audio-only."),R=l.AUDIO):(shaka.log.debug("Guessing video-only."),R=l.VIDEO),U?se.jumpTo(2):se.yield(o.createStreamInfoFromVariantTag_(t,g,R),3);if(2!=se.nextAddress&&(Y=se.yieldResult),Y)M[Y.stream.type]=[Y];else if(null===Y)return shaka.log.debug("streamInfo is null"),se.return(null);return o.filterLegacyCodecs_(M),se.return(M)})},shaka.hls.HlsParser.prototype.getCodecsForVariantTag_=function(t){var i=[];this.config_.disableVideo||i.push("avc1.42E01E"),this.config_.disableAudio||i.push("mp4a.40.2"),i=i.join(",");var r=t.getAttributeValue("CODECS",i).split(/\s*,\s*/);t=new Set,i=[];for(var o=(r=$jscomp.makeIterator(r)).next();!o.done;o=r.next()){var l=shaka.util.MimeUtils.getCodecBase(o=o.value);t.has(l)?shaka.log.debug("Ignoring duplicate codec"):(i.push(o),t.add(l))}return i},shaka.hls.HlsParser.prototype.getChannelsCount_=function(t){return(t=t.getAttributeValue("CHANNELS"))?(t=t.split("/")[0],parseInt(t,10)):null},shaka.hls.HlsParser.prototype.isSpatialAudio_=function(t){return!!(t=t.getAttributeValue("CHANNELS"))&&t.includes("/JOC")},shaka.hls.HlsParser.prototype.getClosedCaptions_=function(t,i){var r=shaka.util.ManifestParserUtils.ContentType,o=t.getAttributeValue("CLOSED-CAPTIONS");return i==r.VIDEO&&o&&"NONE"!=o?this.groupIdToClosedCaptionsMap_.get(o):null},shaka.hls.HlsParser.prototype.getLanguage_=function(t){var i=shaka.util.LanguageUtils;return t=t.getAttributeValue("LANGUAGE")||"und",i.normalize(t)},shaka.hls.HlsParser.prototype.getType_=function(t){return"subtitles"==(t=t.getRequiredAttrValue("TYPE").toLowerCase())&&(t=shaka.util.ManifestParserUtils.ContentType.TEXT),t},shaka.hls.HlsParser.prototype.filterLegacyCodecs_=function(t){for(var i=(t=$jscomp.makeIterator(t.audio.concat(t.video))).next();!i.done;i=t.next())if(i=i.value){var r=i.stream.codecs.split(",");r=r.filter(function(o){return"mp4a.40.34"!=o}),i.stream.codecs=r.join(",")}},shaka.hls.HlsParser.prototype.createVariants_=function(t,i,r,o,l,g,_){for(var v=shaka.util.ManifestParserUtils.ContentType,E=shaka.media.DrmEngine,P=$jscomp.makeIterator(i),M=P.next();!M.done;M=P.next())this.addVideoAttributes_(M.value.stream,o,l,g,_);for(o=this.config_.disableAudio,(!t.length||o)&&(t=[null]),o=this.config_.disableVideo,(!i.length||o)&&(i=[null]),o=[],l=(t=$jscomp.makeIterator(t)).next();!l.done;l=t.next())for(l=l.value,_=(g=$jscomp.makeIterator(i)).next();!_.done;_=g.next()){var R=_.value;P=R?R.stream:null,M=l?l.stream.drmInfos:null;var U=R?R.stream.drmInfos:null;R=(R?R.verbatimMediaPlaylistUri:"")+" - "+(l?l.verbatimMediaPlaylistUri:""),(_=l?l.stream:null)&&P&&!E.areDrmCompatible(M,U)?shaka.log.warning("Incompatible DRM info in HLS variant.  Skipping."):this.variantUriSet_.has(R)?shaka.log.debug("Skipping variant which only differs in text streams."):(goog.asserts.assert(!_||_.type==v.AUDIO,"Audio parameter mismatch!"),goog.asserts.assert(!P||P.type==v.VIDEO,"Video parameter mismatch!"),_={id:this.globalId_++,language:_?_.language:"und",primary:!!_&&_.primary||!!P&&P.primary,audio:_,video:P,bandwidth:r,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},o.push(_),this.variantUriSet_.add(R))}return o},shaka.hls.HlsParser.prototype.parseClosedCaptions_=function(t){t=shaka.hls.Utils.filterTagsByType(t,"CLOSED-CAPTIONS");for(var i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){var r=i.value;goog.asserts.assert("EXT-X-MEDIA"==r.name,"Should only be called on media tags!"),i=this.getLanguage_(r);var o=r.getRequiredAttrValue("GROUP-ID");r=r.getRequiredAttrValue("INSTREAM-ID"),this.groupIdToClosedCaptionsMap_.get(o)||this.groupIdToClosedCaptionsMap_.set(o,new Map),this.groupIdToClosedCaptionsMap_.get(o).set(r,i)}},shaka.hls.HlsParser.prototype.createStreamInfoFromMediaTag_=function(t){var r,o,l,g,_,v,E,P,M,R,U,$,z,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Z){return 1==Z.nextAddress?(goog.asserts.assert("EXT-X-MEDIA"==t.name,"Should only be called on media tags!"),r=t.getRequiredAttrValue("GROUP-ID"),o="",(l=i.getType_(t))!=shaka.util.ManifestParserUtils.ContentType.TEXT&&r&&i.groupIdToCodecsMap_.has(r)&&(o=i.groupIdToCodecsMap_.get(r)),g=i.variableSubstitution_(t.getRequiredAttrValue("URI"),i.globalVariables_),i.uriToStreamInfosMap_.has(g)?Z.return(i.uriToStreamInfosMap_.get(g)):(_=i.getLanguage_(t),v=t.getAttributeValue("NAME"),E=t.getAttribute("DEFAULT"),P="YES"==E,M="audio"==l?i.getChannelsCount_(t):null,R="audio"==l&&i.isSpatialAudio_(t),U=t.getAttributeValue("CHARACTERISTICS"),$=t.getAttributeValue("FORCED"),Z.yield(i.createStreamInfo_(g,o,l,_,P,v,M,null,U,"YES"==$,R),2))):(z=Z.yieldResult,i.groupIdToStreamInfosMap_.has(r)?i.groupIdToStreamInfosMap_.get(r).push(z):i.groupIdToStreamInfosMap_.set(r,[z]),null==z?Z.return(null):i.uriToStreamInfosMap_.has(g)?Z.return(i.uriToStreamInfosMap_.get(g)):(i.uriToStreamInfosMap_.set(g,z),Z.return(z)))})},shaka.hls.HlsParser.prototype.createStreamInfoFromVariantTag_=function(t,i,r){var l,g,_,v,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?(goog.asserts.assert("EXT-X-STREAM-INF"==t.name,"Should only be called on variant tags!"),l=o.variableSubstitution_(t.getRequiredAttrValue("URI"),o.globalVariables_),o.uriToStreamInfosMap_.has(l)?E.return(o.uriToStreamInfosMap_.get(l)):(g=o.getClosedCaptions_(t,r),_=shaka.util.ManifestParserUtils.guessCodecs(r,i),E.yield(o.createStreamInfo_(l,_,r,"und",!1,null,null,g,null,!1,!1),2))):null==(v=E.yieldResult)?E.return(null):o.uriToStreamInfosMap_.has(l)?E.return(o.uriToStreamInfosMap_.get(l)):(o.uriToStreamInfosMap_.set(l,v),E.return(v))})},shaka.hls.HlsParser.prototype.createStreamInfo_=function(t,i,r,o,l,g,_,v,E,P,M){var U,$,G,z,Z,Y,Q,te,ce,me,ye,fe,le,be,Ie,Se,Fe,$e,He,Ye,ct,yt,_t,Qe,Aa,ua,We,Xa,At,La,tt,Ya,Na,fa,xi,Mi,R=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Re){switch(Re.nextAddress){case 1:return U=shaka.hls.Utils.constructAbsoluteUri(R.masterPlaylistUri_,t),Re.yield(R.requestManifest_(U),2);case 2:if((G=R.manifestTextParser_.parsePlaylist(($=Re.yieldResult).data,U=$.uri)).type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);if(z=[],G.segments)for(Z=$jscomp.makeIterator(G.segments),Y=Z.next();!Y.done;Y=Z.next())Q=shaka.hls.Utils.filterTagsByName(Y.value.tags,"EXT-X-KEY"),z.push.apply(z,$jscomp.arrayFromIterable(Q));for(te=!1,ce=[],me=new Set,ye=$jscomp.makeIterator(z),fe=ye.next();!fe.done;fe=ye.next())if("NONE"!=(be=(le=fe.value).getRequiredAttrValue("METHOD"))){if(te=!0,"AES-128"==be)return shaka.log.warning("Unsupported HLS Encryption",be),R.aesEncrypted_=!0,Re.return(null);if(Ie=le.getRequiredAttrValue("KEYFORMAT"),Fe=(Se=shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_[Ie])?Se(le):null){if(Fe.keyIds)for($e=$jscomp.makeIterator(Fe.keyIds),He=$e.next();!He.done;He=$e.next())me.add(He.value);ce.push(Fe)}else shaka.log.warning("Unsupported HLS KEYFORMAT",Ie)}if(te&&!ce.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_KEYFORMATS_NOT_SUPPORTED);return Ye=shaka.hls.Utils.filterTagsByName(G.tags,"EXT-X-DEFINE"),ct=R.parseMediaVariables_(Ye),goog.asserts.assert(null!=G.segments,"Media playlist should have segments!"),R.determinePresentationType_(G),Re.yield(R.guessMimeType_(r,i,G,ct),3);case 3:return shaka.hls.HlsParser.RAW_FORMATS_.includes(yt=Re.yieldResult)&&(i=""),_t=new Map,Qe=new Map,Re.setCatchFinallyBlocks(4),Re.yield(R.createSegments_(t,G,r,yt,_t,ct,Qe),6);case 6:Aa=Re.yieldResult,Re.leaveTryBlock(5);break;case 4:if((ua=Re.enterCatchBlock()).code==shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM)return shaka.log.alwaysWarn("Skipping unsupported HLS stream",yt,t),Re.return(null);throw ua;case 5:if(We=Aa[0].startTime,Xa=Aa[Aa.length-1].endTime,At=new shaka.media.SegmentIndex(Aa),La=r==shaka.util.ManifestParserUtils.ContentType.TEXT?shaka.util.ManifestParserUtils.TextStreamKind.SUBTITLE:void 0,tt=[],E)for(Ya=$jscomp.makeIterator(E.split(",")),Na=Ya.next();!Na.done;Na=Ya.next())tt.push(Na.value);return xi=!!(fa=shaka.hls.Utils.getFirstTagWithName(G.tags,"EXT-X-SERVER-CONTROL"))&&null!=fa.getAttribute("CAN-SKIP-UNTIL"),Mi={id:R.globalId_++,originalId:g,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:At,mimeType:yt,codecs:i,kind:La,encrypted:te,drmInfos:ce,keyIds:me,language:o,label:g,type:r,primary:l,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:tt,forced:P,channelsCount:_,audioSamplingRate:null,spatialAudio:M,closedCaptions:v,hdr:void 0,tilesLayout:void 0},Re.return({stream:Mi,verbatimMediaPlaylistUri:t,absoluteMediaPlaylistUri:U,minTimestamp:We,maxTimestamp:Xa,mediaSequenceToStartTime:_t,discontinuityToMediaSequence:Qe,canSkipSegments:xi})}})},shaka.hls.HlsParser.prototype.determinePresentationType_=function(t){var i=shaka.hls.HlsParser.PresentationType_,r=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-PLAYLIST-TYPE"),o=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-ENDLIST");o=r&&"VOD"==r.value||o,r=r&&"EVENT"==r.value&&!o,r=!o&&!r,o?this.setPresentationType_(i.VOD):(this.setPresentationType_(r?i.LIVE:i.EVENT),i=this.getRequiredTag_(t.tags,"EXT-X-TARGETDURATION"),i=Number(i.value),o=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-PART-INF"),this.lowLatencyMode_&&o?(this.partialTargetDuration_=Number(o.getRequiredAttrValue("PART-TARGET")),this.minTargetDuration_=Math.min(this.partialTargetDuration_,this.minTargetDuration_),this.lowLatencyPresentationDelay_=(t=shaka.hls.Utils.getFirstTagWithName(t.tags,"EXT-X-SERVER-CONTROL"))?Number(t.getRequiredAttrValue("PART-HOLD-BACK")):0):this.minTargetDuration_=Math.min(i,this.minTargetDuration_),this.maxTargetDuration_=Math.max(i,this.maxTargetDuration_))},shaka.hls.HlsParser.prototype.createPresentationTimeline_=function(){this.isLive_()?(this.presentationTimeline_=new shaka.media.PresentationTimeline(0,this.config_.defaultPresentationDelay?this.config_.defaultPresentationDelay:this.lowLatencyPresentationDelay_?this.lowLatencyPresentationDelay_:3*this.maxTargetDuration_),this.presentationTimeline_.setStatic(!1)):(this.presentationTimeline_=new shaka.media.PresentationTimeline(null,0),this.presentationTimeline_.setStatic(!0)),this.notifySegments_(),goog.asserts.assert(!this.presentationTimeline_.usingPresentationStartTime(),"We should not be using the presentation start time in HLS!")},shaka.hls.HlsParser.prototype.getInitSegmentReference_=function(t,i,r){if(!(i=shaka.hls.Utils.getFirstTagWithName(i,"EXT-X-MAP")))return null;var o=i.getRequiredAttrValue("URI");return t=[r=this.variableSubstitution_(shaka.hls.Utils.constructAbsoluteUri(t,o),r),i.getAttributeValue("BYTERANGE","")].join("-"),this.mapTagToInitSegmentRefMap_.has(t)||(i=this.createInitSegmentReference_(r,i),this.mapTagToInitSegmentRefMap_.set(t,i)),this.mapTagToInitSegmentRefMap_.get(t)},shaka.hls.HlsParser.prototype.createInitSegmentReference_=function(t,i){var r=0,o=null,l=i.getAttributeValue("BYTERANGE");return l&&(r=l.split("@"),o=Number(r[0]),o=(r=Number(r[1]))+o-1),new shaka.media.InitSegmentReference(function(){return[t]},r,o)},shaka.hls.HlsParser.prototype.createSegmentReference_=function(t,i,r,o,l,g,_){var v=r.tags,E=this.variableSubstitution_(r.absoluteUri,g),P=shaka.hls.Utils.getFirstTagWithName(v,"EXTINF"),M=0;g=0;var R=null,U=[];if(this.lowLatencyMode_&&r.partialSegments.length){M={};for(var $=(r=$jscomp.makeIterator(shaka.util.Iterables.enumerate(r.partialSegments))).next();!$.done;M={$jscomp$loop$prop$pAbsoluteUri$658:M.$jscomp$loop$prop$pAbsoluteUri$658},$=r.next()){var G=($=$.value).i;$=$.item;var z=0==G?i:U[U.length-1];G=0==G?o:z.endTime;var Z=Number($.getAttributeValue("DURATION"));Z=G+Z;var Y=0,se=null;"EXT-X-PRELOAD-HINT"==$.name?Y=(z=$.getAttributeValue("BYTERANGE-START"))?Number(z):0:(Y=$.getAttributeValue("BYTERANGE"),Y=(z=$jscomp.makeIterator(this.parseByteRange_(z,Y))).next().value,se=z.next().value),$=$.getAttributeValue("URI"),M.$jscomp$loop$prop$pAbsoluteUri$658=shaka.hls.Utils.constructAbsoluteUri(_,$),$=new shaka.media.SegmentReference(G,Z,function(Q){return function(){return[Q.$jscomp$loop$prop$pAbsoluteUri$658]}}(M),Y,se,t,l,0,1/0),U.push($)}}else if(!P)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,"EXTINF");return P?(_=P.value.split(","),M=o+Number(_[0])):M=U[U.length-1].endTime,(v=shaka.hls.Utils.getFirstTagWithName(v,"EXT-X-BYTERANGE"))?(g=(i=$jscomp.makeIterator(this.parseByteRange_(i,v.value))).next().value,R=i.next().value):U.length&&(g=U[0].startByte,R=U[U.length-1].endByte),new shaka.media.SegmentReference(o,M,function(){return E.length?[E]:[]},g,R,t,l,0,1/0,U)},shaka.hls.HlsParser.prototype.parseByteRange_=function(t,i){var r=0,o=null;return i&&(r=i.split("@"),o=Number(r[0]),r[1]?r=Number(r[1]):(goog.asserts.assert(t,"Cannot refer back to previous HLS segment!"),r=t.endByte+1),o=r+o-1),[r,o]},shaka.hls.HlsParser.prototype.notifySegments_=function(){if(this.presentationTimeline_){for(var t=$jscomp.makeIterator(this.segmentsToNotifyByStream_),i=t.next();!i.done;i=t.next())this.presentationTimeline_.notifySegments(i.value);this.segmentsToNotifyByStream_=[]}},shaka.hls.HlsParser.prototype.createSegments_=function(t,i,r,o,l,g,_){var E,P,M,R,U,$,G,z,Y,se,Q,ce,me,fe,le,be,Ie,Se,He,Xe,v=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ye){switch(Ye.nextAddress){case 1:if(goog.asserts.assert((E=i.segments).length,"Playlist should have segments!"),M=shaka.hls.Utils.getFirstTagWithNameAsNumber(i.tags,"EXT-X-MEDIA-SEQUENCE",0),U=(R=shaka.hls.Utils.getFirstTagWithName(i.tags,"EXT-X-SKIP"))?Number(R.getAttributeValue("SKIPPED-SEGMENTS")):0,$=M+U,v.isLive_()&&l.has($)){G=l.get($),Ye.jumpTo(2);break}if(null!=v.playlistStartTime_){Ye.jumpTo(3);break}return P=v.getInitSegmentReference_(i.absoluteUri,E[0].tags,g),goog.asserts.assert(r!=shaka.util.ManifestParserUtils.ContentType.TEXT,"Should only get start time from audio or video streams"),z=v,Ye.yield(v.getStartTime_(t,P,o,$,!1,E[0],g),4);case 4:z.playlistStartTime_=Ye.yieldResult;case 3:G=v.playlistStartTime_;case 2:if(shaka.log.debug("First segment",E[0].absoluteUri.split("/").pop(),"starts at",G),Y=shaka.hls.Utils.getFirstTagWithNameAsNumber(i.tags,"EXT-X-DISCONTINUITY-SEQUENCE"),v.lowLatencyMode_&&(_.has(Y)||_.set(Y,$),U))for(;_.has(Y+1)&&_.get(Y+1)<$;)Y++;se=v.discontinuityToTso_.get(Y)||0,Q=[],ce=$jscomp.makeIterator(shaka.util.Iterables.enumerate(E)),me=ce.next();case 5:if(me.done){Ye.jumpTo(7);break}if(be=(fe=me.value).item,Ie=Q[Q.length-1],l.set($=M+U+(le=fe.i),Se=0==le?G:Ie.endTime),P=v.getInitSegmentReference_(i.absoluteUri,be.tags,g),!shaka.hls.Utils.getFirstTagWithName(be.tags,"EXT-X-DISCONTINUITY")){Ye.jumpTo(8);break}return Y++,_.set(Y,$),Ye.yield(v.getTimestampOffset_(Y,t,P,o,$,be,g,Se),9);case 9:se=Ye.yieldResult;case 8:!v.lowLatencyMode_&&v.playerInterface_.isAutoLowLatencyMode()&&(v.playerInterface_.enableLowLatencyMode(),v.lowLatencyMode_=v.playerInterface_.isLowLatencyMode()),He=shaka.hls.Utils.getFirstTagWithName(be.tags,"EXTINF"),v.lowLatencyMode_||He?(Xe=v.createSegmentReference_(P,Ie,be,Se,se,g,i.absoluteUri),Q.push(Xe)):v.lowLatencyMode_||shaka.log.alwaysWarn("Low-latency HLS live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),me=ce.next(),Ye.jumpTo(5);break;case 7:return v.segmentsToNotifyByStream_.push(Q),v.notifySegments_(),Ye.return(Q)}})},shaka.hls.HlsParser.prototype.getTimestampOffset_=function(t,i,r,o,l,g,_,v){var P,E=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){return 1==R.nextAddress?(P=0,E.discontinuityToTso_.has(t)?(P=E.discontinuityToTso_.get(t),R.jumpTo(2)):R.yield(E.getStartTime_(i,r,o,l,!0,g,_),3)):(2!=R.nextAddress&&(shaka.log.v1("Segment timestampOffset =",P=v-R.yieldResult),E.discontinuityToTso_.set(t,P)),R.return(P))})},shaka.hls.HlsParser.prototype.fetchStartOfSegment_=function(t){var r,o,l,_,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){switch(E.nextAddress){case 1:return r=shaka.net.NetworkingEngine.RequestType.SEGMENT,o=shaka.util.Networking.createSegmentRequest(t.getUris(),t.startByte,t.endByte,i.config_.retryParameters),i.config_.hls.useFullSegmentsForStartTime?E.return(i.makeNetworkRequest_(o,r)):(l=shaka.util.Networking.createSegmentRequest(t.getUris(),t.startByte,t.startByte+shaka.hls.HlsParser.START_OF_SEGMENT_SIZE_-1,i.config_.retryParameters),E.setCatchFinallyBlocks(2),E.yield(i.makeNetworkRequest_(l,r),4));case 4:case 5:return E.return(E.yieldResult);case 2:if((_=E.enterCatchBlock()).code==shaka.util.Error.Code.OPERATION_ABORTED)throw _;return shaka.log.alwaysWarn("Unable to fetch the starting part of HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",l.uris[0]),E.yield(i.makeNetworkRequest_(o,r),5)}})},shaka.hls.HlsParser.prototype.getStartTime_=function(t,i,r,o,l,g,_){var E,P,M,R,U,$,z,v=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Z){switch(Z.nextAddress){case 1:if(E=v.createSegmentReference_(i,null,g,0,0,_,""),v.manifest_&&!l){if(P=v.uriToStreamInfosMap_.get(t),null!=(M=P.mediaSequenceToStartTime.get(o)))return shaka.log.v1("Found segment start time in previous manifest",M),Z.return(M);shaka.log.debug("Unable to find segment start time in previous manifest!")}if(shaka.log.v1("Fetching segment to find start time"),r=r.toLowerCase(),shaka.hls.HlsParser.RAW_FORMATS_.includes(r))throw shaka.log.alwaysWarn("Raw formats are not yet supported.  Skipping "+r),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if("video/webm"==r)throw shaka.log.alwaysWarn("WebM in HLS is not yet supported.  Skipping."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if("video/mp4"!=r&&"audio/mp4"!=r){Z.jumpTo(2);break}return R=[v.fetchStartOfSegment_(E)],i&&R.push(v.fetchStartOfSegment_(i)),Z.yield(Promise.all(R),3);case 3:return Z.return(v.getStartTimeFromMp4Segment_(t,($=(U=Z.yieldResult)[0]).uri,$.data,(U[1]||U[0]).data));case 2:if("video/mp2t"!=r){Z.jumpTo(4);break}return Z.yield(v.fetchStartOfSegment_(E),5);case 5:return goog.asserts.assert((z=Z.yieldResult).data,"Should have a response body!"),Z.return(v.getStartTimeFromTsSegment_(t,z.uri,z.data));case 4:throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t)}})},shaka.hls.HlsParser.prototype.getStartTimeFromMp4Segment_=function(t,i,r,o){var l=shaka.util.Mp4Parser,g=0;if((new l).box("moov",l.children).box("trak",l.children).box("mdia",l.children).fullBox("mdhd",function(E){goog.asserts.assert(0==E.version||1==E.version,"MDHD version can only be 0 or 1"),g=shaka.util.Mp4BoxParsers.parseMDHD(E.reader,E.version).timescale,E.parser.stop()}).parse(o,!0),!g)throw shaka.log.error("Unable to find timescale in init segment!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t,i);var _=0,v=!1;if((new l).box("moof",l.children).box("traf",l.children).fullBox("tfdt",function(E){goog.asserts.assert(0==E.version||1==E.version,"TFDT version can only be 0 or 1"),_=shaka.util.Mp4BoxParsers.parseTFDT(E.reader,E.version).baseMediaDecodeTime/g,v=!0,E.parser.stop()}).parse(r,!0),!v)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t,i);return _},shaka.hls.HlsParser.prototype.getStartTimeFromTsSegment_=function(t,i,r){var o=new shaka.util.DataViewReader(r,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),l=function(){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,t,i)},g=0,_=0;for(r=function(){o.seek(g+188),71!=(_=o.readUint8())&&(o.seek(g+192),_=o.readUint8()),71!=_&&(o.seek(g+204),_=o.readUint8()),71!=_&&l(),o.rewind(1)};;){g=o.getPosition(),71!=(_=o.readUint8())&&l();var v=o.readUint16();if(8191==(8191&v))r();else if(16384&v){if(0!=(v=(48&o.readUint8())>>4)&&2!=v||l(),3==v&&(v=o.readUint8(),o.skip(v)),o.readUint32()>>8==1)return o.skip(3),0!=(r=o.readUint8()>>6)&&1!=r||l(),0==(v=o.readUint8())&&l(),2==r?goog.asserts.assert(5==v,"Bad PES header?"):3==r&&goog.asserts.assert(10==v,"Bad PES header?"),(1073741824*((14&(r=o.readUint8()))>>1)+((65534&(v=o.readUint16()))<<14|(65534&o.readUint16())>>1))/shaka.hls.HlsParser.TS_TIMESCALE_;r()}else r()}},shaka.hls.HlsParser.prototype.variableSubstitution_=function(t,i){var r=String(t).replace(/%7B/g,"{").replace(/%7D/g,"}"),o=r.match(/{\$\w*}/g);if(o)for(var l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next()){var g=(l=l.value).slice(2,l.length-1),_=i.get(g);if(!_)throw shaka.log.error("A variable has been found that is not declared",g),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_VARIABLE_NOT_FOUND,g);r=r.replace(l,_)}return r},shaka.hls.HlsParser.prototype.guessMimeType_=function(t,i,r,o){var g,_,v,E,P,M,R,U,$,z,l=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Y){return 1==Y.nextAddress?(g=shaka.hls.HlsParser,_=shaka.util.ManifestParserUtils.ContentType,v=shaka.net.NetworkingEngine.RequestType.SEGMENT,goog.asserts.assert(r.segments.length,"Playlist should have segments!"),E=l.variableSubstitution_(r.segments[0].absoluteUri,o),P=new goog.Uri(E),M=P.getPath().split(".").pop(),(U=(R=g.EXTENSION_MAP_BY_CONTENT_TYPE_[t])[M])?Y.return(U):t==_.TEXT?Y.return(i&&"vtt"!=i&&"wvtt"!=i?"application/mp4":"text/vtt"):(($=shaka.net.NetworkingEngine.makeRequest([E],l.config_.retryParameters)).method="HEAD",Y.yield(l.makeNetworkRequest_($,v),2))):(z=Y.yieldResult.headers["content-type"])?Y.return(z.split(";")[0]):Y.return(R.mp4)})},shaka.hls.HlsParser.prototype.getRequiredTag_=function(t,i){var r=shaka.hls.Utils.getFirstTagWithName(t,i);if(!r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,i);return r},shaka.hls.HlsParser.prototype.addVideoAttributes_=function(t,i,r,o,l){t&&(t.width=Number(i)||void 0,t.height=Number(r)||void 0,t.frameRate=Number(o)||void 0,t.hdr=l||void 0)},shaka.hls.HlsParser.prototype.requestManifest_=function(t){var i=shaka.net.NetworkingEngine.RequestType.MANIFEST;return t=shaka.net.NetworkingEngine.makeRequest([t],this.config_.retryParameters),this.makeNetworkRequest_(t,i)},shaka.hls.HlsParser.prototype.onUpdate_=function(){var r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?(shaka.log.info("Updating manifest..."),goog.asserts.assert(0<t.updatePlaylistDelay_,"We should only call |onUpdate_| when we are suppose to be updating."),t.playerInterface_?(o.setCatchFinallyBlocks(2),o.yield(t.update(),4)):o.return()):2!=o.nextAddress?(t.updatePlaylistTimer_.tickAfter(t.updatePlaylistDelay_),o.leaveTryBlock(0)):(r=o.enterCatchBlock(),t.playerInterface_?(goog.asserts.assert(r instanceof shaka.util.Error,"Should only receive a Shaka error"),r.severity=shaka.util.Error.Severity.RECOVERABLE,t.playerInterface_.onError(r),t.updatePlaylistTimer_.tickAfter(.1),void o.jumpToEnd()):o.return())})},shaka.hls.HlsParser.prototype.isLive_=function(){return this.presentationType_!=shaka.hls.HlsParser.PresentationType_.VOD},shaka.hls.HlsParser.prototype.setPresentationType_=function(t){this.presentationType_=t,this.presentationTimeline_&&this.presentationTimeline_.setStatic(!this.isLive_()),this.isLive_()||this.updatePlaylistTimer_.stop()},shaka.hls.HlsParser.prototype.makeNetworkRequest_=function(t,i){if(!this.operationManager_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);var r=this.playerInterface_.networkingEngine.request(i,t);return this.operationManager_.manage(r),r.promise},shaka.hls.HlsParser.widevineDrmParser_=function(t){var i=t.getRequiredAttrValue("METHOD"),r=["SAMPLE-AES","SAMPLE-AES-CTR"];return r.includes(i)?(i=t.getRequiredAttrValue("URI"),i=shaka.net.DataUriPlugin.parseRaw(i),i=shaka.util.BufferUtils.toUint8(i.data),i=shaka.util.ManifestParserUtils.createDrmInfo("com.widevine.alpha",[{initDataType:"cenc",initData:i}]),(t=t.getAttributeValue("KEYID"))&&(t=t.toLowerCase(),goog.asserts.assert(t.startsWith("0x"),"Incorrect KEYID format!"),i.keyIds=new Set([t.substr(2)])),i):(shaka.log.error("Widevine in HLS is only supported with [",r.join(", "),"], not",i),null)},shaka.hls.HlsParser.playreadyDrmParser_=function(t){var i=t.getRequiredAttrValue("METHOD"),r=["SAMPLE-AES","SAMPLE-AES-CTR"];return r.includes(i)?(t=t.getRequiredAttrValue("URI"),t=shaka.net.DataUriPlugin.parseRaw(t),t=shaka.util.BufferUtils.toUint8(t.data),i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),t=shaka.util.Pssh.createPssh(t,i),shaka.util.ManifestParserUtils.createDrmInfo("com.microsoft.playready",[{initDataType:"cenc",initData:t}])):(shaka.log.error("PlayReady in HLS is only supported with [",r.join(", "),"], not",i),null)},goog.exportSymbol("shaka.hls.HlsParser",shaka.hls.HlsParser),shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_={mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},shaka.hls.HlsParser.RAW_FORMATS_=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_={mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"},shaka.hls.HlsParser.EXTENSION_MAP_BY_CONTENT_TYPE_={audio:shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_,video:shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_,text:shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_},shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":shaka.hls.HlsParser.widevineDrmParser_,"com.microsoft.playready":shaka.hls.HlsParser.playreadyDrmParser_},shaka.hls.HlsParser.PresentationType_={VOD:"VOD",EVENT:"EVENT",LIVE:"LIVE"},shaka.hls.HlsParser.TS_TIMESCALE_=9e4,shaka.hls.HlsParser.START_OF_SEGMENT_SIZE_=2048,shaka.media.ManifestParser.registerParserByExtension("m3u8",function(){return new shaka.hls.HlsParser}),shaka.media.ManifestParser.registerParserByMime("application/x-mpegurl",function(){return new shaka.hls.HlsParser}),shaka.media.ManifestParser.registerParserByMime("application/vnd.apple.mpegurl",function(){return new shaka.hls.HlsParser}),shaka.net.HttpPluginUtils=function(){},shaka.net.HttpPluginUtils.makeResponse=function(t,i,r,o,l,g){if(200<=r&&299>=r&&202!=r)return{uri:l||o,originalUri:o,data:i,headers:t,fromCache:!!t["x-shaka-from-cache"]};l=null;try{l=shaka.util.StringUtils.fromBytesAutoDetect(i)}catch(_){}throw shaka.log.debug("HTTP error text:",l),new shaka.util.Error(401==r||403==r?shaka.util.Error.Severity.CRITICAL:shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.BAD_HTTP_STATUS,o,r,l,t,g)},shaka.net.HttpFetchPlugin=function(){},shaka.net.HttpFetchPlugin.parse=function(t,i,r,o){var l=new shaka.net.HttpFetchPlugin.Headers_;shaka.util.MapUtils.asMap(i.headers).forEach(function(E,P){l.append(P,E)});var g=new shaka.net.HttpFetchPlugin.AbortController_,_={canceled:!1,timedOut:!1};if(t=shaka.net.HttpFetchPlugin.request_(t,r,{body:i.body||void 0,headers:l,method:i.method,signal:g.signal,credentials:i.allowCrossSiteCredentials?"include":void 0},_,o,i.streamDataCallback),t=new shaka.util.AbortableOperation(t,function(){return _.canceled=!0,g.abort(),Promise.resolve()}),i=i.retryParameters.timeout){var v=new shaka.util.Timer(function(){_.timedOut=!0,g.abort()});v.tickAfter(i/1e3),t.finally(function(){v.stop()})}return t},shaka.net.HttpFetchPlugin.request_=function(t,i,r,o,l,g){var _,v,E,P,M,R,U,$,G,z,Y,se;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){switch(te.nextAddress){case 1:return _=shaka.net.HttpFetchPlugin.fetch_,v=shaka.net.HttpFetchPlugin.ReadableStream_,R=M=0,U=Date.now(),te.setCatchFinallyBlocks(2),te.yield(_(t,r),4);case 4:return $=(E=te.yieldResult).clone().body.getReader(),z=(G=E.headers.get("Content-Length"))?parseInt(G,10):0,new v({start:function(ce){var me=function(){var ye,fe,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(be){switch(be.nextAddress){case 1:return be.setCatchFinallyBlocks(2),be.yield($.read(),4);case 4:ye=be.yieldResult,be.leaveTryBlock(3);break;case 2:return fe=be.enterCatchBlock(),shaka.log.v1("error reading from stream",fe.message),be.return();case 3:ye.done||(M+=ye.value.byteLength,g&&g(ye.value)),(100<(le=Date.now())-U||ye.done)&&(l(le-U,M-R,z-M),R=M,U=le),ye.done?(goog.asserts.assert(!ye.value,'readObj should be unset when "done" is true.'),ce.close()):(ce.enqueue(ye.value),me()),be.jumpToEnd()}})};me()}}),te.yield(E.arrayBuffer(),5);case 5:P=te.yieldResult,te.leaveTryBlock(3);break;case 2:throw Y=te.enterCatchBlock(),o.canceled?new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,t,i):o.timedOut?new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,t,i):new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,t,Y,i);case 3:return se={},E.headers.forEach(function(ce,me){se[me.trim()]=ce}),te.return(shaka.net.HttpPluginUtils.makeResponse(se,P,E.status,t,E.url,i))}})},shaka.net.HttpFetchPlugin.isSupported=function(){if(!window.ReadableStream)return!1;try{new ReadableStream({})}catch(t){return!1}return!(!window.fetch||!window.AbortController)},goog.exportSymbol("shaka.net.HttpFetchPlugin",shaka.net.HttpFetchPlugin),goog.exportProperty(shaka.net.HttpFetchPlugin,"isSupported",shaka.net.HttpFetchPlugin.isSupported),goog.exportProperty(shaka.net.HttpFetchPlugin,"parse",shaka.net.HttpFetchPlugin.parse),shaka.net.HttpFetchPlugin.fetch_=window.fetch,shaka.net.HttpFetchPlugin.AbortController_=window.AbortController,shaka.net.HttpFetchPlugin.ReadableStream_=window.ReadableStream,shaka.net.HttpFetchPlugin.Headers_=window.Headers,shaka.net.HttpFetchPlugin.isSupported()&&(shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED,!0),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED,!0)),shaka.net.HttpXHRPlugin=function(){},shaka.net.HttpXHRPlugin.parse=function(t,i,r,o){var l=new shaka.net.HttpXHRPlugin.Xhr_,g=Date.now(),_=0,v=new Promise(function(E,P){for(var M in l.open(i.method,t,!0),l.responseType="arraybuffer",l.timeout=i.retryParameters.timeout,l.withCredentials=i.allowCrossSiteCredentials,l.onabort=function(){P(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,t,r))},l.onload=function(U){goog.asserts.assert(U=U.target,"XHR onload has no target!");for(var $=U.getAllResponseHeaders().trim().split("\r\n"),G={},z=($=$jscomp.makeIterator($)).next();!z.done;z=$.next())G[(z=z.value.split(": "))[0].toLowerCase()]=z.slice(1).join(": ");try{var Z=shaka.net.HttpPluginUtils.makeResponse(G,U.response,U.status,t,U.responseURL,r);E(Z)}catch(Y){goog.asserts.assert(Y instanceof shaka.util.Error,"Wrong error type!"),P(Y)}},l.onerror=function(U){P(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,t,U,r))},l.ontimeout=function(U){P(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,t,r))},l.onprogress=function(U){var $=Date.now();(100<$-g||U.lengthComputable&&U.loaded==U.total)&&(o($-g,U.loaded-_,U.total-U.loaded),_=U.loaded,g=$)},i.headers){var R=M.toLowerCase();l.setRequestHeader(R,i.headers[M])}l.send(i.body)});return new shaka.util.AbortableOperation(v,function(){return l.abort(),Promise.resolve()})},goog.exportSymbol("shaka.net.HttpXHRPlugin",shaka.net.HttpXHRPlugin),goog.exportProperty(shaka.net.HttpXHRPlugin,"parse",shaka.net.HttpXHRPlugin.parse),shaka.net.HttpXHRPlugin.Xhr_=window.XMLHttpRequest,shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK,!0),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK,!0),shaka.offline={},shaka.offline.DownloadProgressEstimator=function(){this.actualDownloaded_=this.estimatedDownloaded_=this.estimatedTotal_=0,this.pending_=new Map,this.nextId_=0},shaka.offline.DownloadProgressEstimator.prototype.open=function(t){this.estimatedTotal_+=t;var i=this.nextId_;return this.nextId_++,this.pending_.set(i,t),i},shaka.offline.DownloadProgressEstimator.prototype.close=function(t,i){if(this.pending_.has(t)){var r=this.pending_.get(t);this.pending_.delete(t),this.estimatedDownloaded_+=r,this.actualDownloaded_+=i}},shaka.offline.DownloadProgressEstimator.prototype.getEstimatedProgress=function(){return 0==this.estimatedTotal_?0:this.estimatedDownloaded_/this.estimatedTotal_},shaka.offline.DownloadProgressEstimator.prototype.getTotalDownloaded=function(){return this.actualDownloaded_},shaka.offline.DownloadManager=function(t){var i=this;this.networkingEngine_=t,this.groups_=new Map,this.destroyer_=new shaka.util.Destroyer(function(){var r=Array.from(i.groups_.values());return Promise.all(r.map(function(o){return o.catch(function(){})}))}),this.abortCallbacks_=[],this.onProgress_=function(r,o){},this.onInitData_=function(r,o){},this.estimator_=new shaka.offline.DownloadProgressEstimator},shaka.offline.DownloadManager.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.offline.DownloadManager.prototype.setCallbacks=function(t,i){this.onProgress_=t,this.onInitData_=i},shaka.offline.DownloadManager.prototype.abortAll=function(){var t=this.abortCallbacks_.map(function(i){return i()});return this.abortCallbacks_=[],Promise.all(t)},shaka.offline.DownloadManager.prototype.queue=function(t,i,r,o,l){var g=this;this.destroyer_.ensureNotDestroyed();var _=this.estimator_.open(r);return r=(this.groups_.get(t)||Promise.resolve()).then(function(){var v,E,P,M,R;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){if(1==G.nextAddress)return G.yield(g.fetchSegment_(i),2);if(v=G.yieldResult,g.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED);if(o)for(M in E=shaka.util.BufferUtils.toUint8(v),(P=new shaka.util.Pssh(E)).data)R=Number(M),g.onInitData_(P.data[R],P.systemIds[R]);return g.estimator_.close(_,v.byteLength),g.onProgress_(g.estimator_.getEstimatedProgress(),g.estimator_.getTotalDownloaded()),G.return(l(v))})}),this.groups_.set(t,r),r},shaka.offline.DownloadManager.prototype.queueWork=function(t,i){this.destroyer_.ensureNotDestroyed();var r=(this.groups_.get(t)||Promise.resolve()).then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return o.yield(i(),0)})});return this.groups_.set(t,r),r},shaka.offline.DownloadManager.prototype.waitToFinish=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return 1==i.nextAddress?i.yield(Promise.all(t.groups_.values()),2):i.return(t.estimator_.getTotalDownloaded())})},shaka.offline.DownloadManager.prototype.fetchSegment_=function(t){var o,l,g,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_){return 1==_.nextAddress?(o=i.networkingEngine_.request(shaka.net.NetworkingEngine.RequestType.SEGMENT,t),i.abortCallbacks_.push(l=function(){return o.abort()}),_.yield(o.promise,2)):(g=_.yieldResult,shaka.util.ArrayUtils.remove(i.abortCallbacks_,l),_.return(g.data))})},shaka.offline.indexeddb={},shaka.offline.indexeddb.DBOperation=function(t,i){var r=this;this.transaction_=t,this.store_=t.objectStore(i),this.promise_=new shaka.util.PublicPromise,t.onabort=function(o){o.preventDefault(),r.promise_.reject()},t.onerror=function(o){o.preventDefault(),r.promise_.reject()},t.oncomplete=function(o){r.promise_.resolve()}},shaka.offline.indexeddb.DBOperation.prototype.abort=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){if(1==i.nextAddress){try{t.transaction_.abort()}catch(r){}return i.setCatchFinallyBlocks(2),i.yield(t.promise_,4)}if(2!=i.nextAddress)return i.leaveTryBlock(0);i.enterCatchBlock(),i.jumpToEnd()})},shaka.offline.indexeddb.DBOperation.prototype.forEachEntry=function(t){var i=this;return new Promise(function(r,o){var l=i.store_.openCursor();l.onerror=o,l.onsuccess=function(g){var _;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){if(1==v.nextAddress)return null==l.result?(r(),v.return()):v.yield(t((_=l.result).key,_.value,_),2);_.continue(),v.jumpToEnd()})}})},shaka.offline.indexeddb.DBOperation.prototype.store=function(){return this.store_},shaka.offline.indexeddb.DBOperation.prototype.promise=function(){return this.promise_},shaka.offline.indexeddb.DBConnection=function(t){this.connection_=t,this.pending_=[]},shaka.offline.indexeddb.DBConnection.prototype.destroy=function(){return Promise.all(this.pending_.map(function(t){return t.abort()}))},shaka.offline.indexeddb.DBConnection.prototype.startReadOnlyOperation=function(t){return this.startOperation_(t,"readonly")},shaka.offline.indexeddb.DBConnection.prototype.startReadWriteOperation=function(t){return this.startOperation_(t,"readwrite")},shaka.offline.indexeddb.DBConnection.prototype.startOperation_=function(t,i){var r=this,o=this.connection_.transaction([t],i),l=new shaka.offline.indexeddb.DBOperation(o,t);return this.pending_.push(l),l.promise().then(function(){return r.stopTracking_(l)},function(){return r.stopTracking_(l)}),l},shaka.offline.indexeddb.DBConnection.prototype.stopTracking_=function(t){shaka.util.ArrayUtils.remove(this.pending_,t)},shaka.offline.indexeddb.BaseStorageCell=function(t,i,r){this.connection_=new shaka.offline.indexeddb.DBConnection(t),this.segmentStore_=i,this.manifestStore_=r},shaka.offline.indexeddb.BaseStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.BaseStorageCell.prototype.hasFixedKeySpace=function(){return!0},shaka.offline.indexeddb.BaseStorageCell.prototype.addSegments=function(t){return this.rejectAdd(this.segmentStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.removeSegments=function(t,i){return this.remove_(this.segmentStore_,t,i)},shaka.offline.indexeddb.BaseStorageCell.prototype.getSegments=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?o.yield(i.get_(i.segmentStore_,t),2):o.return(o.yieldResult.map(function(l){return i.convertSegmentData(l)}))})},shaka.offline.indexeddb.BaseStorageCell.prototype.addManifests=function(t){return this.rejectAdd(this.manifestStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.updateManifestExpiration=function(t,i){var r=this.connection_.startReadWriteOperation(this.manifestStore_),o=r.store();return o.get(t).onsuccess=function(l){(l=l.target.result)&&(l.expiration=i,o.put(l,t))},r.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.removeManifests=function(t,i){return this.remove_(this.manifestStore_,t,i)},shaka.offline.indexeddb.BaseStorageCell.prototype.getManifests=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?o.yield(i.get_(i.manifestStore_,t),2):o.return(Promise.all(o.yieldResult.map(function(l){return i.convertManifest(l)})))})},shaka.offline.indexeddb.BaseStorageCell.prototype.getAllManifests=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?(i=t.connection_.startReadOnlyOperation(t.manifestStore_),r=new Map,o.yield(i.forEachEntry(function(l,g){return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){if(1==v.nextAddress)return v.yield(t.convertManifest(g),2);r.set(l,v.yieldResult),v.jumpToEnd()})}),2)):3!=o.nextAddress?o.yield(i.promise(),3):o.return(r)})},shaka.offline.indexeddb.BaseStorageCell.prototype.convertSegmentData=function(t){return t},shaka.offline.indexeddb.BaseStorageCell.prototype.convertManifest=function(t){return Promise.resolve(t)},shaka.offline.indexeddb.BaseStorageCell.prototype.rejectAdd=function(t){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NEW_KEY_OPERATION_NOT_SUPPORTED,"Cannot add new value to "+t))},shaka.offline.indexeddb.BaseStorageCell.prototype.add=function(t,i){var o,l,g,_,v,E,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress){for(o=r.connection_.startReadWriteOperation(t),l=o.store(),g=[],_={},v=$jscomp.makeIterator(i),E=v.next();!E.done;_={$jscomp$loop$prop$request$660:_.$jscomp$loop$prop$request$660},E=v.next())_.$jscomp$loop$prop$request$660=l.add(E.value),_.$jscomp$loop$prop$request$660.onsuccess=function(R){return function(U){g.push(R.$jscomp$loop$prop$request$660.result)}}(_);return M.yield(o.promise(),2)}return M.return(g)})},shaka.offline.indexeddb.BaseStorageCell.prototype.remove_=function(t,i,r){for(var o=(t=this.connection_.startReadWriteOperation(t)).store(),l={},g=(i=$jscomp.makeIterator(i)).next();!g.done;l={$jscomp$loop$prop$key$662:l.$jscomp$loop$prop$key$662},g=i.next())l.$jscomp$loop$prop$key$662=g.value,o.delete(l.$jscomp$loop$prop$key$662).onsuccess=function(_){return function(){return r(_.$jscomp$loop$prop$key$662)}}(l);return t.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.get_=function(t,i){var o,l,g,_,v,E,P,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress){for(o=r.connection_.startReadOnlyOperation(t),l=o.store(),g={},_=[],v={},E=$jscomp.makeIterator(i),P=E.next();!P.done;v={$jscomp$loop$prop$request$664:v.$jscomp$loop$prop$request$664,$jscomp$loop$prop$key$665:v.$jscomp$loop$prop$key$665},P=E.next())v.$jscomp$loop$prop$key$665=P.value,v.$jscomp$loop$prop$request$664=l.get(v.$jscomp$loop$prop$key$665),v.$jscomp$loop$prop$request$664.onsuccess=function(R){return function(){null==R.$jscomp$loop$prop$request$664.result&&_.push(R.$jscomp$loop$prop$key$665),g[R.$jscomp$loop$prop$key$665]=R.$jscomp$loop$prop$request$664.result}}(v);return M.yield(o.promise(),2)}if(_.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+_);return M.return(i.map(function(R){return g[R]}))})},shaka.offline.indexeddb.EmeSessionStorageCell=function(t,i){this.connection_=new shaka.offline.indexeddb.DBConnection(t),this.store_=i},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.getAll=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?(i=t.connection_.startReadOnlyOperation(t.store_),r=[],o.yield(i.forEachEntry(function(l,g){r.push(g)}),2)):3!=o.nextAddress?o.yield(i.promise(),3):o.return(r)})},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.add=function(t){for(var i=this.connection_.startReadWriteOperation(this.store_),r=i.store(),o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next())r.add(o.value);return i.promise()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.remove=function(t){var r,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return 1==o.nextAddress?(r=i.connection_.startReadWriteOperation(i.store_),o.yield(r.forEachEntry(function(l,g,_){t.includes(g.sessionId)&&_.delete()}),2)):o.yield(r.promise(),0)})},shaka.offline.StorageMuxer=function(){this.mechanisms_=new Map},shaka.offline.StorageMuxer.prototype.destroy=function(){for(var t=[],i=$jscomp.makeIterator(this.mechanisms_.values()),r=i.next();!r.done;r=i.next())t.push(r.value.destroy());return this.mechanisms_.clear(),Promise.all(t)},shaka.offline.StorageMuxer.prototype.init=function(){var t=this;shaka.offline.StorageMuxer.getRegistry_().forEach(function(l,g){var _=l();_?t.mechanisms_.set(g,_):shaka.log.info("Skipping "+g+" as it is not supported on this platform")});for(var i=[],r=$jscomp.makeIterator(this.mechanisms_.values()),o=r.next();!o.done;o=r.next())i.push(o.value.init());return Promise.all(i)},shaka.offline.StorageMuxer.prototype.getActive=function(){var t=null;if(this.mechanisms_.forEach(function(i,r){i.getCells().forEach(function(o,l){o.hasFixedKeySpace()||t||(t={path:{mechanism:r,cell:l},cell:o})})}),t)return t;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find a cell that supports add-operations")},shaka.offline.StorageMuxer.prototype.forEachCell=function(t){this.mechanisms_.forEach(function(i,r){i.getCells().forEach(function(o,l){t({mechanism:r,cell:l},o)})})},shaka.offline.StorageMuxer.prototype.getCell=function(t,i){var r=this.mechanisms_.get(t);if(!r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find mechanism with name "+t);if(!(r=r.getCells().get(i)))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find cell with name "+i);return r},shaka.offline.StorageMuxer.prototype.forEachEmeSessionCell=function(t){this.mechanisms_.forEach(function(i,r){t(i.getEmeSessionCell())})},shaka.offline.StorageMuxer.prototype.getEmeSessionCell=function(){var t=Array.from(this.mechanisms_.keys());if(!t.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED,"No supported storage mechanisms found");return this.mechanisms_.get(t[0]).getEmeSessionCell()},shaka.offline.StorageMuxer.prototype.resolvePath=function(t){var i=this.mechanisms_.get(t.mechanism);return i?i.getCells().get(t.cell):null},shaka.offline.StorageMuxer.prototype.erase=function(){var i,r,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return 1==l.nextAddress?(i=Array.from(t.mechanisms_.values()),(r=0<i.length)||shaka.offline.StorageMuxer.getRegistry_().forEach(function(g,_){var v=g();v&&i.push(v)}),l.yield(Promise.all(i.map(function(g){return g.erase()})),2)):r?l.jumpTo(0):l.yield(Promise.all(i.map(function(g){return g.destroy()})),0)})},shaka.offline.StorageMuxer.register=function(t,i){shaka.offline.StorageMuxer.registry_.set(t,i)},shaka.offline.StorageMuxer.unregister=function(t){shaka.offline.StorageMuxer.registry_.delete(t)},shaka.offline.StorageMuxer.support=function(){for(var t=shaka.offline.StorageMuxer.getRegistry_(),i=(t=$jscomp.makeIterator(t.values())).next();!i.done;i=t.next())if(i=(i=i.value)())return i.destroy(),!0;return!1},shaka.offline.StorageMuxer.overrideSupport=function(t){shaka.offline.StorageMuxer.override_=t},shaka.offline.StorageMuxer.clearOverride=function(){shaka.offline.StorageMuxer.override_=null},shaka.offline.StorageMuxer.getRegistry_=function(){var i=shaka.offline.StorageMuxer.registry_;return COMPILED?i:shaka.offline.StorageMuxer.override_||i},goog.exportSymbol("shaka.offline.StorageMuxer",shaka.offline.StorageMuxer),goog.exportProperty(shaka.offline.StorageMuxer,"unregister",shaka.offline.StorageMuxer.unregister),goog.exportProperty(shaka.offline.StorageMuxer,"register",shaka.offline.StorageMuxer.register),goog.exportProperty(shaka.offline.StorageMuxer.prototype,"destroy",shaka.offline.StorageMuxer.prototype.destroy),shaka.offline.StorageMuxer.override_=null,shaka.offline.StorageMuxer.registry_=new Map,shaka.offline.indexeddb.V1StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V1StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V1StorageCell.prototype.updateManifestExpiration=function(t,i){var o,l,g,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(_){return o=r.connection_.startReadWriteOperation(r.manifestStore_),l=o.store(),g=new shaka.util.PublicPromise,l.get(t).onsuccess=function(v){(v=v.target.result)?(goog.asserts.assert(v.key==t,"With in-line keys, the keys should match"),v.expiration=i,l.put(v),g.resolve()):g.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+t))},_.yield(Promise.all([o.promise(),g]),0)})},shaka.offline.indexeddb.V1StorageCell.prototype.convertManifest=function(t){var i,r,o,_;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(1==E.nextAddress){for(i=shaka.offline.indexeddb.V1StorageCell,r=[],o=0;o<t.periods.length;++o)_=i.convertPeriod_(t.periods[o],(o==t.periods.length-1?t.duration:t.periods[o+1].startTime)-t.periods[o].startTime),r.push(_);return E.yield(shaka.util.PeriodCombiner.combineDbStreams(r),2)}return E.return({creationTime:0,originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:null==t.expiration?1/0:t.expiration,streams:E.yieldResult,sessionIds:t.sessionIds,drmInfo:t.drmInfo,appMetadata:t.appMetadata})})},shaka.offline.indexeddb.V1StorageCell.convertPeriod_=function(t,i){var r=shaka.offline.indexeddb.V1StorageCell;r.fillMissingVariants_(t);for(var o=$jscomp.makeIterator(t.streams),l=o.next();!l.done;l=o.next())goog.asserts.assert(l.value.variantIds,"After filling in missing variants, each stream should have variant ids");return t.streams.map(function(g){return r.convertStream_(g,t.startTime,i)})},shaka.offline.indexeddb.V1StorageCell.convertStream_=function(t,i,r){var o=shaka.offline.indexeddb.V1StorageCell,l=t.initSegmentUri?o.getKeyFromSegmentUri_(t.initSegmentUri):null,g=i+t.presentationTimeOffset,_=i+r;return{id:t.id,originalId:null,primary:t.primary,type:t.contentType,mimeType:t.mimeType,codecs:t.codecs,frameRate:t.frameRate,pixelAspectRatio:void 0,hdr:void 0,kind:t.kind,language:t.language,label:t.label,width:t.width,height:t.height,initSegmentKey:l,encrypted:t.encrypted,keyIds:new Set([t.keyId]),segments:t.segments.map(function(v){return o.convertSegment_(v,l,i,_,g)}),variantIds:t.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}},shaka.offline.indexeddb.V1StorageCell.convertSegment_=function(t,i,r,o,l){var g=shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_(t.uri);return{startTime:r+t.startTime,endTime:r+t.endTime,dataKey:g,initSegmentKey:i,appendWindowStart:r,appendWindowEnd:o,timestampOffset:l}},shaka.offline.indexeddb.V1StorageCell.prototype.convertSegmentData=function(t){return{data:t.data}},shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_=function(t){var i;if((i=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(t))||(i=/^offline:segment\/([0-9]+)$/.exec(t)))return Number(i[1]);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,"Could not parse uri "+t)},shaka.offline.indexeddb.V1StorageCell.fillMissingVariants_=function(t){var i=shaka.util.ManifestParserUtils.ContentType.AUDIO,r=shaka.util.ManifestParserUtils.ContentType.VIDEO,o=t.streams.filter(function(P){return P.contentType==i});if(t=t.streams.filter(function(P){return P.contentType==r}),!o.every(function(P){return P.variantIds})||!t.every(function(P){return P.variantIds})){goog.asserts.assert(o.every(function(P){return!P.variantIds}),"Some audio streams have variant ids and some do not."),goog.asserts.assert(t.every(function(P){return!P.variantIds}),"Some video streams have variant ids and some do not.");for(var l=$jscomp.makeIterator(o),g=l.next();!g.done;g=l.next())g.value.variantIds=[];for(g=(l=$jscomp.makeIterator(t)).next();!g.done;g=l.next())g.value.variantIds=[];if(l=0,t.length&&!o.length){shaka.log.debug("Found video-only content. Creating variants for video.");var _=l++,v=$jscomp.makeIterator(t);for(g=v.next();!g.done;g=v.next())g.value.variantIds.push(_)}if(!t.length&&o.length)for(shaka.log.debug("Found audio-only content. Creating variants for audio."),_=l++,g=(v=$jscomp.makeIterator(o)).next();!g.done;g=v.next())g.value.variantIds.push(_);if(t.length&&o.length)for(shaka.log.debug("Found audio-video content. Creating variants."),g=(o=$jscomp.makeIterator(o)).next();!g.done;g=o.next())for(g=g.value,v=(_=$jscomp.makeIterator(t)).next();!v.done;v=_.next()){v=v.value;var E=l++;g.variantIds.push(E),v.variantIds.push(E)}}},shaka.offline.indexeddb.V2StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V2StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V2StorageCell.prototype.convertManifest=function(t){var r,o,_,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(1==E.nextAddress){for(r=[],o=0;o<t.periods.length;++o)_=i.convertPeriod_(t.periods[o],(o==t.periods.length-1?t.duration:t.periods[o+1].startTime)-t.periods[o].startTime),r.push(_);return E.yield(shaka.util.PeriodCombiner.combineDbStreams(r),2)}return E.return({appMetadata:t.appMetadata,creationTime:0,drmInfo:t.drmInfo,duration:t.duration,expiration:null==t.expiration?1/0:t.expiration,originalManifestUri:t.originalManifestUri,sessionIds:t.sessionIds,size:t.size,streams:E.yieldResult})})},shaka.offline.indexeddb.V2StorageCell.prototype.convertPeriod_=function(t,i){for(var r=[],o=$jscomp.makeIterator(t.streams),l=o.next();!l.done;l=o.next())0!=(l=l.value).variantIds.length&&r.push(this.convertStream_(l,t.startTime,t.startTime+i));return r},shaka.offline.indexeddb.V2StorageCell.prototype.convertStream_=function(t,i,r){var o=this;return{id:t.id,originalId:t.originalId,primary:t.primary,type:t.contentType,mimeType:t.mimeType,codecs:t.codecs,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:void 0,kind:t.kind,language:t.language,label:t.label,width:t.width,height:t.height,encrypted:t.encrypted,keyIds:new Set([t.keyId]),segments:t.segments.map(function(l){return o.convertSegment_(l,t.initSegmentKey,i,r,t.presentationTimeOffset)}),variantIds:t.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}},shaka.offline.indexeddb.V2StorageCell.prototype.convertSegment_=function(t,i,r,o,l){return{startTime:r+t.startTime,endTime:r+t.endTime,initSegmentKey:i,appendWindowStart:r,appendWindowEnd:o,timestampOffset:r-l,dataKey:t.dataKey}},shaka.offline.indexeddb.V5StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V5StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V5StorageCell.prototype.hasFixedKeySpace=function(){return!1},shaka.offline.indexeddb.V5StorageCell.prototype.addSegments=function(t){return this.add(this.segmentStore_,t)},shaka.offline.indexeddb.V5StorageCell.prototype.addManifests=function(t){return this.add(this.manifestStore_,t)},shaka.offline.indexeddb.V5StorageCell.prototype.convertManifest=function(t){return null==t.expiration&&(t.expiration=1/0),Promise.resolve(t)},shaka.offline.indexeddb.StorageMechanism=function(){this.sessions_=this.v5_=this.v3_=this.v2_=this.v1_=this.db_=null},shaka.offline.indexeddb.StorageMechanism.prototype.init=function(){var t=this,i=shaka.offline.indexeddb.StorageMechanism.DB_NAME,r=shaka.offline.indexeddb.StorageMechanism.VERSION,o=new shaka.util.PublicPromise,l=window.indexedDB.open(i,r);return l.onsuccess=function(g){t.db_=g=l.result,t.v1_=shaka.offline.indexeddb.StorageMechanism.createV1_(g),t.v2_=shaka.offline.indexeddb.StorageMechanism.createV2_(g),t.v3_=shaka.offline.indexeddb.StorageMechanism.createV3_(g),t.v5_=shaka.offline.indexeddb.StorageMechanism.createV5_(g),t.sessions_=shaka.offline.indexeddb.StorageMechanism.createEmeSessionCell_(g),o.resolve()},l.onupgradeneeded=function(g){t.createStores_(l.result)},l.onerror=function(g){o.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,l.error)),g.preventDefault()},o},shaka.offline.indexeddb.StorageMechanism.prototype.destroy=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){switch(i.nextAddress){case 1:if(!t.v1_){i.jumpTo(2);break}return i.yield(t.v1_.destroy(),2);case 2:if(!t.v2_){i.jumpTo(4);break}return i.yield(t.v2_.destroy(),4);case 4:if(!t.v3_){i.jumpTo(6);break}return i.yield(t.v3_.destroy(),6);case 6:if(!t.v5_){i.jumpTo(8);break}return i.yield(t.v5_.destroy(),8);case 8:if(!t.sessions_){i.jumpTo(10);break}return i.yield(t.sessions_.destroy(),10);case 10:t.db_&&t.db_.close(),i.jumpToEnd()}})},shaka.offline.indexeddb.StorageMechanism.prototype.getCells=function(){var t=new Map;return this.v1_&&t.set("v1",this.v1_),this.v2_&&t.set("v2",this.v2_),this.v3_&&t.set("v3",this.v3_),this.v5_&&t.set("v5",this.v5_),t},shaka.offline.indexeddb.StorageMechanism.prototype.getEmeSessionCell=function(){return goog.asserts.assert(this.sessions_,"Cannot be destroyed."),this.sessions_},shaka.offline.indexeddb.StorageMechanism.prototype.erase=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){switch(i.nextAddress){case 1:if(!t.v1_){i.jumpTo(2);break}return i.yield(t.v1_.destroy(),2);case 2:if(!t.v2_){i.jumpTo(4);break}return i.yield(t.v2_.destroy(),4);case 4:if(!t.v3_){i.jumpTo(6);break}return i.yield(t.v3_.destroy(),6);case 6:if(!t.v5_){i.jumpTo(8);break}return i.yield(t.v5_.destroy(),8);case 8:return t.db_&&t.db_.close(),i.yield(shaka.offline.indexeddb.StorageMechanism.deleteAll_(),10);case 10:return t.db_=null,t.v1_=null,t.v2_=null,t.v3_=null,t.v5_=null,i.yield(t.init(),0)}})},shaka.offline.indexeddb.StorageMechanism.createV1_=function(t){var i=shaka.offline.indexeddb.StorageMechanism,r=i.V1_SEGMENT_STORE,o=t.objectStoreNames;return o.contains(i=i.V1_MANIFEST_STORE)&&o.contains(r)?(shaka.log.debug("Mounting v1 idb storage cell"),new shaka.offline.indexeddb.V1StorageCell(t,r,i)):null},shaka.offline.indexeddb.StorageMechanism.createV2_=function(t){var i=shaka.offline.indexeddb.StorageMechanism,r=i.V2_SEGMENT_STORE,o=t.objectStoreNames;return o.contains(i=i.V2_MANIFEST_STORE)&&o.contains(r)?(shaka.log.debug("Mounting v2 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(t,r,i)):null},shaka.offline.indexeddb.StorageMechanism.createV3_=function(t){var i=shaka.offline.indexeddb.StorageMechanism,r=i.V3_SEGMENT_STORE,o=t.objectStoreNames;return o.contains(i=i.V3_MANIFEST_STORE)&&o.contains(r)?(shaka.log.debug("Mounting v3 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(t,r,i)):null},shaka.offline.indexeddb.StorageMechanism.createV5_=function(t){var i=shaka.offline.indexeddb.StorageMechanism,r=i.V5_SEGMENT_STORE,o=t.objectStoreNames;return o.contains(i=i.V5_MANIFEST_STORE)&&o.contains(r)?(shaka.log.debug("Mounting v5 idb storage cell"),new shaka.offline.indexeddb.V5StorageCell(t,r,i)):null},shaka.offline.indexeddb.StorageMechanism.createEmeSessionCell_=function(t){var i=shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE;return t.objectStoreNames.contains(i)?(shaka.log.debug("Mounting session ID idb storage cell"),new shaka.offline.indexeddb.EmeSessionStorageCell(t,i)):null},shaka.offline.indexeddb.StorageMechanism.prototype.createStores_=function(t){for(var i=$jscomp.makeIterator([shaka.offline.indexeddb.StorageMechanism.V5_SEGMENT_STORE,shaka.offline.indexeddb.StorageMechanism.V5_MANIFEST_STORE,shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE]),r=i.next();!r.done;r=i.next())t.objectStoreNames.contains(r=r.value)||t.createObjectStore(r,{autoIncrement:!0})},shaka.offline.indexeddb.StorageMechanism.deleteAll_=function(){var t=shaka.offline.indexeddb.StorageMechanism.DB_NAME,i=new shaka.util.PublicPromise,r=window.indexedDB.deleteDatabase(t);return r.onblocked=function(o){shaka.log.warning("Deleting",t,"is being blocked")},r.onsuccess=function(o){i.resolve()},r.onerror=function(o){i.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,r.error)),o.preventDefault()},i},shaka.offline.indexeddb.StorageMechanism.DB_NAME="shaka_offline_db",shaka.offline.indexeddb.StorageMechanism.VERSION=5,shaka.offline.indexeddb.StorageMechanism.V1_SEGMENT_STORE="segment",shaka.offline.indexeddb.StorageMechanism.V2_SEGMENT_STORE="segment-v2",shaka.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE="segment-v3",shaka.offline.indexeddb.StorageMechanism.V5_SEGMENT_STORE="segment-v5",shaka.offline.indexeddb.StorageMechanism.V1_MANIFEST_STORE="manifest",shaka.offline.indexeddb.StorageMechanism.V2_MANIFEST_STORE="manifest-v2",shaka.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE="manifest-v3",shaka.offline.indexeddb.StorageMechanism.V5_MANIFEST_STORE="manifest-v5",shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE="session-ids",shaka.offline.StorageMuxer.register("idb",function(){return shaka.util.Platform.isChromecast()||!window.indexedDB?null:new shaka.offline.indexeddb.StorageMechanism}),shaka.offline.OfflineUri=function(t,i,r,o){this.type_=t,this.mechanism_=i,this.cell_=r,this.key_=o,this.asString_=["offline:",t,"/",i,"/",r,"/",o].join("")},shaka.offline.OfflineUri.prototype.isManifest=function(){return"manifest"==this.type_},shaka.offline.OfflineUri.prototype.isSegment=function(){return"segment"==this.type_},shaka.offline.OfflineUri.prototype.mechanism=function(){return this.mechanism_},shaka.offline.OfflineUri.prototype.cell=function(){return this.cell_},shaka.offline.OfflineUri.prototype.key=function(){return this.key_},shaka.offline.OfflineUri.prototype.toString=function(){return this.asString_},shaka.offline.OfflineUri.parse=function(t){if(null==(t=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(t)))return null;var i=t[1];if("manifest"!=i&&"segment"!=i)return null;var r=t[2];if(!r)return null;var o=t[3];return o&&null!=i?new shaka.offline.OfflineUri(i,r,o,Number(t[4])):null},shaka.offline.OfflineUri.manifest=function(t,i,r){return new shaka.offline.OfflineUri("manifest",t,i,r)},shaka.offline.OfflineUri.segment=function(t,i,r){return new shaka.offline.OfflineUri("segment",t,i,r)},shaka.offline.ManifestConverter=function(t,i){this.mechanism_=t,this.cell_=i},shaka.offline.ManifestConverter.prototype.fromManifestDB=function(t){var i=this,r=new shaka.media.PresentationTimeline(null,0);r.setDuration(t.duration);var o=t.streams.filter(function(P){return i.isAudio_(P)}),l=t.streams.filter(function(P){return i.isVideo_(P)});o=this.createVariants(o,l,r),l=t.streams.filter(function(P){return i.isText_(P)}).map(function(P){return i.fromStreamDB_(P,r)});var g=t.streams.filter(function(P){return i.isImage_(P)}).map(function(P){return i.fromStreamDB_(P,r)}),_=t.drmInfo?[t.drmInfo]:[];if(t.drmInfo)for(var v=$jscomp.makeIterator(o.values()),E=v.next();!E.done;E=v.next())(E=E.value).audio&&E.audio.encrypted&&(E.audio.drmInfos=_),E.video&&E.video.encrypted&&(E.video.drmInfos=_);return{presentationTimeline:r,minBufferTime:2,offlineSessionIds:t.sessionIds,variants:Array.from(o.values()),textStreams:l,imageStreams:g}},shaka.offline.ManifestConverter.prototype.createVariants=function(t,i,r){for(var o=new Set,l=$jscomp.makeIterator(t),g=l.next();!g.done;g=l.next()){var _=$jscomp.makeIterator(g.value.variantIds);for(g=_.next();!g.done;g=_.next())o.add(g.value)}for(g=(l=$jscomp.makeIterator(i)).next();!g.done;g=l.next())for(g=(_=$jscomp.makeIterator(g.value.variantIds)).next();!g.done;g=_.next())o.add(g.value);for(l=new Map,g=(o=$jscomp.makeIterator(o)).next();!g.done;g=o.next())l.set(g=g.value,this.createEmptyVariant_(g));for(o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next())for(g=this.fromStreamDB_(o=o.value,r),o=(_=$jscomp.makeIterator(o.variantIds)).next();!o.done;o=_.next())o=l.get(o.value),goog.asserts.assert(!o.audio,"A variant should only have one audio stream"),o.language=g.language,o.primary=o.primary||g.primary,o.audio=g;for(t=(i=$jscomp.makeIterator(i)).next();!t.done;t=i.next())for(t=this.fromStreamDB_(o=t.value,r),o=(g=$jscomp.makeIterator(o.variantIds)).next();!o.done;o=g.next())o=l.get(o.value),goog.asserts.assert(!o.video,"A variant should only have one video stream"),o.primary=o.primary||t.primary,o.video=t;return l},shaka.offline.ManifestConverter.prototype.fromStreamDB_=function(t,i){var r=this,o=t.segments.map(function(l,g){return r.fromSegmentDB_(g,l)});return i.notifySegments(o),o=new shaka.media.SegmentIndex(o),{id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:o,mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:t.hdr,kind:t.kind,encrypted:t.encrypted,drmInfos:[],keyIds:t.keyIds,language:t.language,label:t.label,type:t.type,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:t.roles,forced:t.forced,channelsCount:t.channelsCount,audioSamplingRate:t.audioSamplingRate,spatialAudio:t.spatialAudio,closedCaptions:t.closedCaptions,tilesLayout:t.tilesLayout}},shaka.offline.ManifestConverter.prototype.fromSegmentDB_=function(t,i){var r=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,i.dataKey),o=null!=i.initSegmentKey?this.fromInitSegmentDB_(i.initSegmentKey):null;return new shaka.media.SegmentReference(i.startTime,i.endTime,function(){return[r.toString()]},0,null,o,i.timestampOffset,i.appendWindowStart,i.appendWindowEnd)},shaka.offline.ManifestConverter.prototype.fromInitSegmentDB_=function(t){var i=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,t);return new shaka.media.InitSegmentReference(function(){return[i.toString()]},0,null)},shaka.offline.ManifestConverter.prototype.isAudio_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.offline.ManifestConverter.prototype.isVideo_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.offline.ManifestConverter.prototype.isText_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.TEXT},shaka.offline.ManifestConverter.prototype.isImage_=function(t){return t.type==shaka.util.ManifestParserUtils.ContentType.IMAGE},shaka.offline.ManifestConverter.prototype.createEmptyVariant_=function(t){return{id:t,language:"",primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}},shaka.offline.OfflineManifestParser=function(){this.uri_=null},shaka.offline.OfflineManifestParser.prototype.configure=function(t){},shaka.offline.OfflineManifestParser.prototype.start=function(t,i){var o,l,v,E,P,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){switch(M.nextAddress){case 1:if(o=shaka.offline.OfflineUri.parse(t),r.uri_=o,null==o||!o.isManifest())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,t);return l=new shaka.offline.StorageMuxer,M.setFinallyBlock(2),M.yield(l.init(),4);case 4:return M.yield(l.getCell(o.mechanism(),o.cell()),5);case 5:return M.yield(M.yieldResult.getManifests([o.key()]),6);case 6:return v=M.yieldResult[0],E=new shaka.offline.ManifestConverter(o.mechanism(),o.cell()),P=E.fromManifestDB(v),i.makeTextStreamsForClosedCaptions(P),M.return(P);case 2:return M.enterFinallyBlock(),M.yield(l.destroy(),7);case 7:M.leaveFinallyBlock(0)}})},shaka.offline.OfflineManifestParser.prototype.stop=function(){return Promise.resolve()},shaka.offline.OfflineManifestParser.prototype.update=function(){},shaka.offline.OfflineManifestParser.prototype.onExpirationUpdated=function(t,i){var o,l,g,v,E,P,M,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){switch(R.nextAddress){case 1:return goog.asserts.assert(r.uri_,"Should not get update event before start has been called"),o=r.uri_,l=new shaka.offline.StorageMuxer,R.setCatchFinallyBlocks(2,3),R.yield(l.init(),5);case 5:return R.yield(l.getCell(o.mechanism(),o.cell()),6);case 6:return R.yield((g=R.yieldResult).getManifests([o.key()]),7);case 7:if(E=(v=R.yieldResult[0]).sessionIds.includes(t),P=null==v.expiration||v.expiration>i,!E||!P){R.jumpTo(3);break}return shaka.log.debug("Updating expiration for stored content"),R.yield(g.updateManifestExpiration(o.key(),i),3);case 3:return R.enterFinallyBlock(),R.yield(l.destroy(),10);case 10:R.leaveFinallyBlock(0);break;case 2:M=R.enterCatchBlock(),shaka.log.error("There was an error updating",o,M),R.jumpTo(3)}})},shaka.media.ManifestParser.registerParserByMime("application/x-offline-manifest",function(){return new shaka.offline.OfflineManifestParser}),shaka.offline.OfflineScheme=function(){},shaka.offline.OfflineScheme.plugin=function(t,i,r,o){return(i=shaka.offline.OfflineUri.parse(t))&&i.isManifest()?shaka.offline.OfflineScheme.getManifest_(t):i&&i.isSegment()?shaka.offline.OfflineScheme.getSegment_(i.key(),i):shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,t))},shaka.offline.OfflineScheme.getManifest_=function(t){return t={uri:t,originalUri:t,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},shaka.util.AbortableOperation.completed(t)},shaka.offline.OfflineScheme.getSegment_=function(t,i){goog.asserts.assert(i.isSegment(),"Only segment uri's should be given to getSegment");var r=new shaka.offline.StorageMuxer;return shaka.util.AbortableOperation.completed(void 0).chain(function(){return r.init()}).chain(function(){return r.getCell(i.mechanism(),i.cell())}).chain(function(o){return o.getSegments([i.key()])}).chain(function(o){return{uri:i,data:o[0].data,headers:{}}}).finally(function(){return r.destroy()})},goog.exportSymbol("shaka.offline.OfflineScheme",shaka.offline.OfflineScheme),goog.exportProperty(shaka.offline.OfflineScheme,"plugin",shaka.offline.OfflineScheme.plugin),shaka.net.NetworkingEngine.registerScheme("offline",shaka.offline.OfflineScheme.plugin),shaka.offline.SessionDeleter=function(){},shaka.offline.SessionDeleter.prototype.delete=function(t,i,r){var g,_,v,P,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){switch(R.nextAddress){case 1:g=[],_=$jscomp.makeIterator(shaka.offline.SessionDeleter.createBuckets_(r)),v=_.next();case 2:if(v.done){R.jumpTo(4);break}return P=o.doDelete_(t,i,v.value),R.yield(P,5);case 5:g=g.concat(R.yieldResult),v=_.next(),R.jumpTo(2);break;case 4:return R.return(g)}})},shaka.offline.SessionDeleter.prototype.doDelete_=function(t,i,r){var o,l,g,_;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){switch(v.nextAddress){case 1:return o=new shaka.media.DrmEngine({netEngine:i,onError:function(){},onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),v.setCatchFinallyBlocks(2),o.configure(t),v.yield(o.initForRemoval(r.info.keySystem,r.info.licenseUri,r.info.serverCertificate,r.info.audioCapabilities,r.info.videoCapabilities),4);case 4:v.leaveTryBlock(3);break;case 2:return l=v.enterCatchBlock(),shaka.log.warning("Error initializing EME",l),v.yield(o.destroy(),5);case 5:case 9:return v.return([]);case 3:return v.setCatchFinallyBlocks(6),v.yield(o.setServerCertificate(),8);case 8:v.leaveTryBlock(7);break;case 6:return g=v.enterCatchBlock(),shaka.log.warning("Error setting server certificate",g),v.yield(o.destroy(),9);case 7:return _=[],v.yield(Promise.all(r.sessionIds.map(function(E){var P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?(M.setCatchFinallyBlocks(2),M.yield(o.removeSession(E),4)):2!=M.nextAddress?(_.push(E),M.leaveTryBlock(0)):(P=M.enterCatchBlock(),shaka.log.warning("Error deleting offline session",P),void M.jumpToEnd())})})),10);case 10:return v.yield(o.destroy(),11);case 11:return v.return(_)}})},shaka.offline.SessionDeleter.createBuckets_=function(t){for(var i=shaka.offline.SessionDeleter,r=[],o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next()){o=o.value;for(var l=!1,g=$jscomp.makeIterator(r),_=g.next();!_.done;_=g.next())if(i.isCompatible_((_=_.value).info,o)){_.sessionIds.push(o.sessionId),l=!0;break}l||r.push({info:o,sessionIds:[o.sessionId]})}return r},shaka.offline.SessionDeleter.isCompatible_=function(t,i){var r=shaka.util.ArrayUtils,o=function(l,g){return l.robustness==g.robustness&&l.contentType==g.contentType};return t.keySystem==i.keySystem&&t.licenseUri==i.licenseUri&&r.hasSameElements(t.audioCapabilities,i.audioCapabilities,o)&&r.hasSameElements(t.videoCapabilities,i.videoCapabilities,o)},shaka.offline.StoredContentUtils=function(){},shaka.offline.StoredContentUtils.fromManifest=function(t,i,r,o){return goog.asserts.assert(i.variants.length,"Cannot create stored content from manifest with no variants."),{offlineUri:null,originalManifestUri:t,duration:i.presentationTimeline.getDuration(),size:r,expiration:1/0,tracks:i=shaka.offline.StoredContentUtils.getTracks_(i),appMetadata:o}},shaka.offline.StoredContentUtils.fromManifestDB=function(t,i){goog.asserts.assert(i.streams.length,"Cannot create stored content from manifestDB with no streams.");var r=new shaka.offline.ManifestConverter(t.mechanism(),t.cell()).fromManifestDB(i),o=i.appMetadata||{};return r=shaka.offline.StoredContentUtils.getTracks_(r),goog.asserts.assert(null!=i.expiration,"Manifest expiration must be set by now!"),{offlineUri:t.toString(),originalManifestUri:i.originalManifestUri,duration:i.duration,size:i.size,expiration:i.expiration,tracks:r,appMetadata:o}},shaka.offline.StoredContentUtils.getTracks_=function(t){for(var i=shaka.util.StreamUtils,r=[],o=i.getPlayableVariants(t.variants),l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next())r.push(i.variantToTrack(l.value));for(o=(t=$jscomp.makeIterator(t.textStreams)).next();!o.done;o=t.next())r.push(i.textStreamToTrack(o.value));return r},shaka.offline.StreamBandwidthEstimator=function(){this.estimateByStreamId_={}},shaka.offline.StreamBandwidthEstimator.prototype.addVariant=function(t){var i=t.audio,r=t.video;if(i&&!r&&this.setBitrate_(i.id,i.bandwidth||t.bandwidth),!i&&r&&this.setBitrate_(r.id,r.bandwidth||t.bandwidth),i&&r){var o=i.bandwidth||shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_,l=r.bandwidth||t.bandwidth-o;0>=l&&(shaka.log.warning("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),l=t.bandwidth),this.setBitrate_(i.id,o),this.setBitrate_(r.id,l)}},shaka.offline.StreamBandwidthEstimator.prototype.setBitrate_=function(t,i){this.estimateByStreamId_[t]=i},shaka.offline.StreamBandwidthEstimator.prototype.addText=function(t){this.estimateByStreamId_[t.id]=shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_},shaka.offline.StreamBandwidthEstimator.prototype.addImage=function(t){this.estimateByStreamId_[t.id]=t.bandwidth||shaka.offline.StreamBandwidthEstimator.DEFAULT_IMAGE_BITRATE_},shaka.offline.StreamBandwidthEstimator.prototype.getSegmentEstimate=function(t,i){var r=i.endTime-i.startTime;return this.getEstimate_(t)*r},shaka.offline.StreamBandwidthEstimator.prototype.getInitSegmentEstimate=function(t){return.5*this.getEstimate_(t)},shaka.offline.StreamBandwidthEstimator.prototype.getEstimate_=function(t){return null==(t=this.estimateByStreamId_[t])&&(t=0,shaka.log.error("Asking for bitrate of stream not given to the estimator")),0==t&&shaka.log.warning("Using bitrate of 0, this stream won't affect progress"),t},shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_=393216,shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_=52,shaka.offline.StreamBandwidthEstimator.DEFAULT_IMAGE_BITRATE_=2048,shaka.offline.Storage=function(t){var i=this;if(t&&t.constructor!=shaka.Player)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.LOCAL_PLAYER_INSTANCE_REQUIRED);this.networkingEngine_=this.config_=null,t?(this.config_=t.getSharedConfiguration(),this.networkingEngine_=t.getNetworkingEngine(),goog.asserts.assert(this.networkingEngine_,"Storage should not be initialized with a player that had |destroy| called on it.")):(this.config_=shaka.util.PlayerConfiguration.createDefault(),this.networkingEngine_=new shaka.net.NetworkingEngine),this.segmentsFromStore_=[],this.openOperations_=[],this.openDownloadManagers_=[];var r=!t;this.destroyer_=new shaka.util.Destroyer(function(){var o,l,g,_;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){switch(E.nextAddress){case 1:return E.yield(Promise.all(i.openDownloadManagers_.map(function(P){return P.abortAll()})),2);case 2:for(o=function(){},l=[],g=$jscomp.makeIterator(i.openOperations_),_=g.next();!_.done;_=g.next())l.push(_.value.then(o,o));return E.yield(Promise.all(l),3);case 3:if(!r){E.jumpTo(4);break}return E.yield(i.networkingEngine_.destroy(),4);case 4:i.config_=null,i.networkingEngine_=null,E.jumpToEnd()}})})},shaka.offline.Storage.support=function(){return!!shaka.util.Platform.supportsMediaSource()&&shaka.offline.StorageMuxer.support()},shaka.offline.Storage.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.offline.Storage.prototype.configure=function(t,i){return goog.asserts.assert("object"==typeof t||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof t&&(t=shaka.util.ConfigUtils.convertToConfigObject(t,i)),goog.asserts.assert("object"==typeof t,"Should be an object!"),t.manifest&&t.manifest.dash&&"defaultPresentationDelay"in t.manifest.dash&&(shaka.Deprecate.deprecateFeature(4,"manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),t.manifest.defaultPresentationDelay=t.manifest.dash.defaultPresentationDelay,delete t.manifest.dash.defaultPresentationDelay),goog.asserts.assert(this.config_,"Cannot reconfigure stroage after calling destroy."),shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,t)},shaka.offline.Storage.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var t=shaka.util.PlayerConfiguration.createDefault();return shaka.util.PlayerConfiguration.mergeConfigObjects(t,this.config_,shaka.util.PlayerConfiguration.createDefault()),t},shaka.offline.Storage.prototype.getNetworkingEngine=function(){return this.networkingEngine_},shaka.offline.Storage.prototype.store=function(t,i,r){var o=this;goog.asserts.assert(this.networkingEngine_,"Cannot call |downloadManifest_| after calling |destroy|.");var l=this.getConfiguration(),g=new shaka.offline.DownloadManager(this.networkingEngine_);this.openDownloadManagers_.push(g),i=this.store_(t,i||{},function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?(goog.asserts.assert(o.networkingEngine_,"Should not call |store| after |destroy|"),E.yield(shaka.media.ManifestParser.getFactory(t,o.networkingEngine_,l.manifest.retryParameters,r||null),2)):E.return(shaka.util.Functional.callFactory(E.yieldResult))})},l,g);var _=new shaka.util.AbortableOperation(i,function(){return g.abortAll()});return _.finally(function(){shaka.util.ArrayUtils.remove(o.openDownloadManagers_,g)}),_.then=function(v){return shaka.Deprecate.deprecateFeature(4,"shaka.offline.Storage.store.then","Storage operations now return a shaka.util.AbortableOperation, rather than a promise.  Please update to conform to this new API; you can use the |chain| method instead."),_.promise.then(v)},this.startAbortableOperation_(_)},shaka.offline.Storage.prototype.getStoreInProgress=function(){return shaka.Deprecate.deprecateFeature(4,"shaka.offline.Storage.getStoreInProgress","Multiple concurrent downloads are now supported."),!1},shaka.offline.Storage.prototype.store_=function(t,i,r,o,l){var _,v,E,P,M,R,$,G,z,Z,g=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Y){switch(Y.nextAddress){case 1:return g.requireSupport_(),v=_=null,E=new shaka.offline.StorageMuxer,M=P=null,Y.setCatchFinallyBlocks(2,3),Y.yield(r(),5);case 5:return Y.yield(g.parseManifest(t,_=Y.yieldResult,o),6);case 6:if(R=Y.yieldResult,g.ensureNotDestroyed_(),R.presentationTimeline.isLive()||R.presentationTimeline.isInProgress())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.CANNOT_STORE_LIVE_OFFLINE,t);return Y.yield(g.createDrmEngine(R,function(se){M=M||se},o),7);case 7:if(v=Y.yieldResult,g.ensureNotDestroyed_(),M)throw M;return Y.yield(g.filterManifest_(R,v,o),8);case 8:return Y.yield(E.init(),9);case 9:return g.ensureNotDestroyed_(),Y.yield(E.getActive(),10);case 10:return P=Y.yieldResult,g.ensureNotDestroyed_(),goog.asserts.assert(v,"drmEngine should be non-null here."),Y.yield(g.downloadManifest_(P.cell,v,R,t,i,o,l),11);case 11:if($=Y.yieldResult,g.ensureNotDestroyed_(),M)throw M;return Y.yield(P.cell.addManifests([$]),12);case 12:return G=Y.yieldResult,g.ensureNotDestroyed_(),z=shaka.offline.OfflineUri.manifest(P.path.mechanism,P.path.cell,G[0]),Y.return(shaka.offline.StoredContentUtils.fromManifestDB(z,$));case 3:return Y.enterFinallyBlock(),g.segmentsFromStore_=[],Y.yield(E.destroy(),13);case 13:if(!_){Y.jumpTo(14);break}return Y.yield(_.stop(),14);case 14:if(!v){Y.jumpTo(16);break}return Y.yield(v.destroy(),16);case 16:Y.leaveFinallyBlock(0);break;case 2:if(Z=Y.enterCatchBlock(),!P){Y.jumpTo(18);break}return Y.yield(P.cell.removeSegments(g.segmentsFromStore_,function(){}),18);case 18:throw M||Z}})},shaka.offline.Storage.prototype.filterManifest_=function(t,i,r){var o,g,E,P,M,R,U,G,z,Y,se,Q,te,ce,le,be,Ie,Se,Fe,$e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(He){switch(He.nextAddress){case 1:for((o=shaka.util.StreamUtils).filterByRestrictions(t,r.restrictions,{width:1/0,height:1/0}),r.useMediaCapabilities?o.filterManifestByMediaCapabilities(t,r.offline.usePersistentLicense):(o.filterManifestByMediaSource(t),o.filterManifestByDrm(t,i)),g=[],o.chooseCodecsAndFilterManifest(t,r.preferredAudioChannelCount,r.preferredDecodingAttributes),E=$jscomp.makeIterator(t.variants),P=E.next();!P.done;P=E.next())goog.asserts.assert(o.isPlayable(M=P.value),'We should have already filtered by "is playable"'),g.push(o.variantToTrack(M));for(R=$jscomp.makeIterator(t.textStreams),U=R.next();!U.done;U=R.next())g.push(o.textStreamToTrack(U.value));for(G=$jscomp.makeIterator(t.imageStreams),z=G.next();!z.done;z=G.next())g.push(o.imageStreamToTrack(z.value));return He.yield(r.offline.trackSelectionCallback(g),2);case 2:for(Y=He.yieldResult,se=t.presentationTimeline.getDuration(),Q=0,te=$jscomp.makeIterator(Y),ce=te.next();!ce.done;ce=te.next())Q+=ce.value.bandwidth*se/8;return He.setCatchFinallyBlocks(3),He.yield(r.offline.downloadSizeCallback(Q),5);case 5:if(!He.yieldResult)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_LIMIT_REACHED);He.leaveTryBlock(4);break;case 3:throw(le=He.enterCatchBlock())instanceof shaka.util.Error?le:(shaka.log.warning("downloadSizeCallback has produced an unexpected error",le),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.DOWNLOAD_SIZE_CALLBACK_ERROR));case 4:for(be=new Set,Ie=new Set,Se=new Set,Fe=$jscomp.makeIterator(Y),ce=Fe.next();!ce.done;ce=Fe.next())"variant"==($e=ce.value).type&&be.add($e.id),"text"==$e.type&&Ie.add($e.id),"image"==$e.type&&Se.add($e.id);t.variants=t.variants.filter(function(Xe){return be.has(Xe.id)}),t.textStreams=t.textStreams.filter(function(Xe){return Ie.has(Xe.id)}),t.imageStreams=t.imageStreams.filter(function(Xe){return Se.has(Xe.id)}),shaka.offline.Storage.validateManifest_(t),He.jumpToEnd()}})},shaka.offline.Storage.prototype.downloadManifest_=function(t,i,r,o,l,g,_){var E,P,U,$,G,z,Z,Y,se,Q,v=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(te){switch(te.nextAddress){case 1:return E=shaka.offline.StoredContentUtils.fromManifest(o,r,0,l),P=g.offline.progressCallback,_.setCallbacks(function(ce,me){E.size=me,P(E,ce)},function(ce,me){G&&g.offline.usePersistentLicense&&z==me&&i.newInitData("cenc",ce)}),U=r.variants.some(function(ce){return ce.video&&ce.video.encrypted||ce.audio&&ce.audio.encrypted}),$=r.variants.some(function(ce){return(ce.video?ce.video.drmInfos:[]).concat(ce.audio?ce.audio.drmInfos:[]).some(function(me){return me.initData&&me.initData.length})}),z=null,(G=U&&!$)&&(Z=i.getDrmInfo(),z=shaka.offline.Storage.defaultSystemIds_.get(Z.keySystem)),te.setFinallyBlock(2),se=Y=v.createOfflineManifest_(_,t,i,r,o,l,g),te.yield(_.waitToFinish(),4);case 4:if(se.size=te.yieldResult,Y.expiration=i.getExpiration(),Q=i.getSessionIds(),Y.sessionIds=g.offline.usePersistentLicense?Q:[],U&&g.offline.usePersistentLicense&&!Q.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NO_INIT_DATA_FOR_OFFLINE);return te.return(Y);case 2:return te.enterFinallyBlock(),te.yield(_.destroy(),5);case 5:te.leaveFinallyBlock(0)}})},shaka.offline.Storage.prototype.remove=function(t){return this.startOperation_(this.remove_(t))},shaka.offline.Storage.prototype.remove_=function(t){var r,o,l,g,v,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){switch(E.nextAddress){case 1:if(i.requireSupport_(),null==(r=shaka.offline.OfflineUri.parse(t))||!r.isManifest())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,t);return o=r,l=new shaka.offline.StorageMuxer,E.setFinallyBlock(2),E.yield(l.init(),4);case 4:return E.yield(l.getCell(o.mechanism(),o.cell()),5);case 5:return E.yield((g=E.yieldResult).getManifests([o.key()]),6);case 6:return v=E.yieldResult[0],E.yield(Promise.all([i.removeFromDRM_(o,v,l),i.removeFromStorage_(g,o,v)]),2);case 2:return E.enterFinallyBlock(),E.yield(l.destroy(),8);case 8:E.leaveFinallyBlock(0)}})},shaka.offline.Storage.getCapabilities_=function(t,i){for(var r=shaka.util.MimeUtils,o=[],l=$jscomp.makeIterator(t.streams),g=l.next();!g.done;g=l.next())g=g.value,i&&"video"==g.type?o.push({contentType:r.getFullType(g.mimeType,g.codecs),robustness:t.drmInfo.videoRobustness}):i||"audio"!=g.type||o.push({contentType:r.getFullType(g.mimeType,g.codecs),robustness:t.drmInfo.audioRobustness});return o},shaka.offline.Storage.prototype.removeFromDRM_=function(t,i,r){var o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return goog.asserts.assert(o.networkingEngine_,"Cannot be destroyed"),l.yield(shaka.offline.Storage.deleteLicenseFor_(o.networkingEngine_,o.config_.drm,r,i),0)})},shaka.offline.Storage.prototype.removeFromStorage_=function(t,i,r){var o=this,l=shaka.offline.Storage.getAllSegmentIds_(r),g=l.length+1,_=0,v=shaka.offline.StoredContentUtils.fromManifestDB(i,r);return r=function(E){o.config_.offline.progressCallback(v,(_+=1)/g)},Promise.all([t.removeSegments(l,r),t.removeManifests([i.key()],r)])},shaka.offline.Storage.prototype.removeEmeSessions=function(){return this.startOperation_(this.removeEmeSessions_())},shaka.offline.Storage.prototype.removeEmeSessions_=function(){var i,r,o,l,g,_,v,E,P,M,R,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){switch(U.nextAddress){case 1:return t.requireSupport_(),goog.asserts.assert(t.networkingEngine_,"Cannot be destroyed"),i=t.networkingEngine_,r=t.config_.drm,o=new shaka.offline.StorageMuxer,l=new shaka.offline.SessionDeleter,g=!1,U.setFinallyBlock(2),U.yield(o.init(),4);case 4:_=[],o.forEachEmeSessionCell(function($){return _.push($)}),v=$jscomp.makeIterator(_),E=v.next();case 5:if(E.done){U.jumpTo(2);break}return U.yield((P=E.value).getAll(),8);case 8:return U.yield(l.delete(r,i,M=U.yieldResult),9);case 9:return U.yield(P.remove(R=U.yieldResult),10);case 10:R.length!=M.length&&(g=!0),E=v.next(),U.jumpTo(5);break;case 2:return U.enterFinallyBlock(),U.yield(o.destroy(),11);case 11:U.leaveFinallyBlock(3);break;case 3:return U.return(!g)}})},shaka.offline.Storage.prototype.list=function(){return this.startOperation_(this.list_())},shaka.offline.Storage.prototype.list_=function(){var i,r,o,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:return t.requireSupport_(),i=[],r=new shaka.offline.StorageMuxer,l.setFinallyBlock(2),l.yield(r.init(),4);case 4:return o=Promise.resolve(),r.forEachCell(function(g,_){o=o.then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){if(1==E.nextAddress)return E.yield(_.getAllManifests(),2);E.yieldResult.forEach(function(P,M){var R=shaka.offline.OfflineUri.manifest(g.mechanism,g.cell,M);R=shaka.offline.StoredContentUtils.fromManifestDB(R,P),i.push(R)}),E.jumpToEnd()})})}),l.yield(o,2);case 2:return l.enterFinallyBlock(),l.yield(r.destroy(),6);case 6:l.leaveFinallyBlock(3);break;case 3:return l.return(i)}})},shaka.offline.Storage.prototype.parseManifest=function(t,i,r){var l,g,_,v,E,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){if(1==P.nextAddress)return l=null,goog.asserts.assert(g=o.networkingEngine_,"Should be initialized!"),_={networkingEngine:g,filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(M){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(M){l=M},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){}},i.configure(r.manifest),o.ensureNotDestroyed_(),P.yield(i.start(t,_),2);if(3!=P.nextAddress)return v=P.yieldResult,o.ensureNotDestroyed_(),E=shaka.offline.Storage.getAllStreamsFromManifest_(v),P.yield(Promise.all(shaka.util.Iterables.map(E,function(M){return M.createSegmentIndex()})),3);if(o.ensureNotDestroyed_(),l)throw l;return P.return(v)})},shaka.offline.Storage.prototype.createDrmEngine=function(t,i,r){var l,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return goog.asserts.assert(o.networkingEngine_,"Cannot call |createDrmEngine| after |destroy|"),(l=new shaka.media.DrmEngine({netEngine:o.networkingEngine_,onError:i,onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}})).configure(r.drm),g.yield(l.initForStorage(t.variants,r.offline.usePersistentLicense,r.useMediaCapabilities),2);case 2:return g.yield(l.setServerCertificate(),3);case 3:return g.yield(l.createOrLoad(),4);case 4:return g.return(l)}})},shaka.offline.Storage.prototype.createOfflineManifest_=function(t,i,r,o,l,g,_){var v=new shaka.offline.StreamBandwidthEstimator;return t=this.createStreams_(t,i,v,r,o,_),_=_.offline.usePersistentLicense,(i=r.getDrmInfo())&&_&&(i.initData=[]),{creationTime:Date.now(),originalManifestUri:l,duration:o.presentationTimeline.getDuration(),size:0,expiration:r.getExpiration(),streams:t,sessionIds:_?r.getSessionIds():[],drmInfo:i,appMetadata:g}},shaka.offline.Storage.prototype.createStreams_=function(t,i,r,o,l,g){for(var _=(o=$jscomp.makeIterator(l.variants)).next();!_.done;_=o.next())r.addVariant(_.value);for(_=(o=$jscomp.makeIterator(l.textStreams)).next();!_.done;_=o.next())r.addText(_.value);for(_=(o=$jscomp.makeIterator(l.imageStreams)).next();!_.done;_=o.next())r.addImage(_.value);(_=new Map).set(null,Promise.resolve(null));var v=new Map,E=shaka.offline.Storage.getAllStreamsFromManifest_(l);o=new Map;for(var P=(E=$jscomp.makeIterator(E)).next();!P.done;P=E.next()){var M=this.createStream_(t,i,r,l,P=P.value,g,_,v);o.set(P.id,M)}for(_=(t=$jscomp.makeIterator(l.variants)).next();!_.done;_=t.next())(i=_.value).audio&&o.get(i.audio.id).variantIds.push(i.id),i.video&&o.get(i.video.id).variantIds.push(i.id);return Array.from(o.values())},shaka.offline.Storage.prototype.createStream_=function(t,i,r,o,l,g,_,v){var E=this,P={id:l.id,originalId:l.originalId,primary:l.primary,type:l.type,mimeType:l.mimeType,codecs:l.codecs,frameRate:l.frameRate,pixelAspectRatio:l.pixelAspectRatio,hdr:l.hdr,kind:l.kind,language:l.language,label:l.label,width:l.width||null,height:l.height||null,encrypted:l.encrypted,keyIds:l.keyIds,segments:[],variantIds:[],roles:l.roles,forced:l.forced,channelsCount:l.channelsCount,audioSamplingRate:l.audioSamplingRate,spatialAudio:l.spatialAudio,closedCaptions:l.closedCaptions,tilesLayout:l.tilesLayout},M=l.id;return o=o.presentationTimeline.getSegmentAvailabilityStart(),shaka.offline.Storage.forEachSegment_(l,o,function(R){var U=E.getInitSegmentDbKey_(t,M,l.id,i,r,R.initSegmentReference,g,_),$=E.getSegmentDbKey_(t,M,l.id,i,r,R,g,v);t.queueWork(M,function(){var G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Z){return 1==Z.nextAddress?Z.yield(U,2):3!=Z.nextAddress?(G=Z.yieldResult,Z.yield($,3)):(P.segments.push({initSegmentKey:G,startTime:R.startTime,endTime:R.endTime,appendWindowStart:R.appendWindowStart,appendWindowEnd:R.appendWindowEnd,timestampOffset:R.timestampOffset,dataKey:Z.yieldResult}),void Z.jumpToEnd())})})}),P},shaka.offline.Storage.prototype.getInitSegmentDbKey_=function(t,i,r,o,l,g,_,v){var E=this;return v.has(g)?v.get(g):(_=shaka.util.Networking.createSegmentRequest(g.getUris(),g.startByte,g.endByte,_.streaming.retryParameters),t=t.queue(i,_,l.getInitSegmentEstimate(r),!0,function(P){var M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){return 1==R.nextAddress?R.yield(o.addSegments([{data:P}]),2):(E.segmentsFromStore_.push((M=R.yieldResult)[0]),R.return(M[0]))})}),v.set(g,t),t)},shaka.offline.Storage.prototype.getSegmentDbKey_=function(t,i,r,o,l,g,_,v){var E=this,P=[g.getUris()[0],g.startByte,g.endByte].join("-");return v.has(P)?v.get(P):(_=shaka.util.Networking.createSegmentRequest(g.getUris(),g.startByte,g.endByte,_.streaming.retryParameters),t=t.queue(i,_,l.getSegmentEstimate(r,g),!1,function(M){var R;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return 1==U.nextAddress?U.yield(o.addSegments([{data:M}]),2):(E.segmentsFromStore_.push((R=U.yieldResult)[0]),U.return(R[0]))})}),v.set(P,t),t)},shaka.offline.Storage.forEachSegment_=function(t,i,r){if(null!=(i=t.segmentIndex.find(i)))for(var o=t.segmentIndex.get(i);o;)r(o),o=t.segmentIndex.get(++i)},shaka.offline.Storage.prototype.ensureNotDestroyed_=function(){if(this.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.offline.Storage.prototype.requireSupport_=function(){if(!shaka.offline.Storage.support())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED)},shaka.offline.Storage.prototype.startOperation_=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return 1==r.nextAddress?(i.openOperations_.push(t),r.setFinallyBlock(2),r.yield(t,4)):2!=r.nextAddress?r.return(r.yieldResult):(r.enterFinallyBlock(),shaka.util.ArrayUtils.remove(i.openOperations_,t),r.leaveFinallyBlock(0))})},shaka.offline.Storage.prototype.startAbortableOperation_=function(t){var i=this,r=t.promise;return this.openOperations_.push(r),t.finally(function(){shaka.util.ArrayUtils.remove(i.openOperations_,r)})},shaka.offline.Storage.getAllSegmentIds_=function(t){for(var i=[],r=(t=$jscomp.makeIterator(t.streams)).next();!r.done;r=t.next())for(var o=(r=$jscomp.makeIterator(r.value.segments)).next();!o.done;o=r.next())null!=(o=o.value).initSegmentKey&&i.push(o.initSegmentKey),i.push(o.dataKey);return i},shaka.offline.Storage.deleteAll=function(){var t;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return 1==i.nextAddress?(t=new shaka.offline.StorageMuxer,i.setFinallyBlock(2),i.yield(t.erase(),2)):5!=i.nextAddress?(i.enterFinallyBlock(),i.yield(t.destroy(),5)):i.leaveFinallyBlock(0)})},shaka.offline.Storage.deleteLicenseFor_=function(t,i,r,o){var l,g,_,v;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?o.drmInfo?(l=r.getEmeSessionCell(),g=o.sessionIds.map(function(P){return{sessionId:P,keySystem:o.drmInfo.keySystem,licenseUri:o.drmInfo.licenseServerUri,serverCertificate:o.drmInfo.serverCertificate,audioCapabilities:shaka.offline.Storage.getCapabilities_(o,!1),videoCapabilities:shaka.offline.Storage.getCapabilities_(o,!0)}}),_=new shaka.offline.SessionDeleter,E.yield(_.delete(i,t,g),2)):E.return():3!=E.nextAddress?E.yield(l.remove(v=E.yieldResult),3):E.yield(l.add(g.filter(function(P){return!v.includes(P.sessionId)})),0)})},shaka.offline.Storage.getAllStreamsFromManifest_=function(t){for(var i=new Set,r=$jscomp.makeIterator(t.textStreams),o=r.next();!o.done;o=r.next())i.add(o.value);for(o=(r=$jscomp.makeIterator(t.imageStreams)).next();!o.done;o=r.next())i.add(o.value);for(r=(t=$jscomp.makeIterator(t.variants)).next();!r.done;r=t.next())(r=r.value).audio&&i.add(r.audio),r.video&&i.add(r.video);return i},shaka.offline.Storage.validateManifest_=function(t){var i=new Set(t.variants.map(function(_){return _.video})),r=new Set(t.variants.map(function(_){return _.audio}));t=t.textStreams,1<i.size&&shaka.log.warning("Multiple video tracks selected to be stored");for(var o=(i=$jscomp.makeIterator(r)).next();!o.done;o=i.next()){o=o.value;for(var l=$jscomp.makeIterator(r),g=l.next();!g.done;g=l.next())o!=(g=g.value)&&o.language==g.language&&shaka.log.warning("Similar audio tracks were selected to be stored",o.id,g.id)}for(i=(r=$jscomp.makeIterator(t)).next();!i.done;i=r.next())for(i=i.value,l=(o=$jscomp.makeIterator(t)).next();!l.done;l=o.next())i!=(l=l.value)&&i.language==l.language&&shaka.log.warning("Similar text tracks were selected to be stored",i.id,l.id)},goog.exportSymbol("shaka.offline.Storage",shaka.offline.Storage),goog.exportProperty(shaka.offline.Storage,"deleteAll",shaka.offline.Storage.deleteAll),goog.exportProperty(shaka.offline.Storage.prototype,"list",shaka.offline.Storage.prototype.list),goog.exportProperty(shaka.offline.Storage.prototype,"removeEmeSessions",shaka.offline.Storage.prototype.removeEmeSessions),goog.exportProperty(shaka.offline.Storage.prototype,"remove",shaka.offline.Storage.prototype.remove),goog.exportProperty(shaka.offline.Storage.prototype,"getStoreInProgress",shaka.offline.Storage.prototype.getStoreInProgress),goog.exportProperty(shaka.offline.Storage.prototype,"store",shaka.offline.Storage.prototype.store),goog.exportProperty(shaka.offline.Storage.prototype,"getNetworkingEngine",shaka.offline.Storage.prototype.getNetworkingEngine),goog.exportProperty(shaka.offline.Storage.prototype,"getConfiguration",shaka.offline.Storage.prototype.getConfiguration),goog.exportProperty(shaka.offline.Storage.prototype,"configure",shaka.offline.Storage.prototype.configure),goog.exportProperty(shaka.offline.Storage.prototype,"destroy",shaka.offline.Storage.prototype.destroy),goog.exportProperty(shaka.offline.Storage,"support",shaka.offline.Storage.support),shaka.offline.Storage.defaultSystemIds_=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb"),shaka.Player.registerSupportPlugin("offline",shaka.offline.Storage.support),shaka.polyfill=function(){},shaka.polyfill.installAll=function(){for(var t=$jscomp.makeIterator(shaka.polyfill.polyfills_),i=t.next();!i.done;i=t.next()){i=i.value;try{i.callback()}catch(r){shaka.log.alwaysWarn("Error installing polyfill!",r)}}},shaka.polyfill.register=function(t,i){for(var r={priority:i||0,callback:t},o=$jscomp.makeIterator(shaka.util.Iterables.enumerate(shaka.polyfill.polyfills_)),l=o.next();!l.done;l=o.next())if((l=l.value).item.priority<r.priority)return void shaka.polyfill.polyfills_.splice(l.i,0,r);shaka.polyfill.polyfills_.push(r)},goog.exportSymbol("shaka.polyfill",shaka.polyfill),goog.exportProperty(shaka.polyfill,"register",shaka.polyfill.register),goog.exportProperty(shaka.polyfill,"installAll",shaka.polyfill.installAll),shaka.polyfill.polyfills_=[],shaka.polyfill.EncryptionScheme=function(){},shaka.polyfill.EncryptionScheme.install=function(){EncryptionSchemePolyfills.install()},shaka.polyfill.register(shaka.polyfill.EncryptionScheme.install,-2),shaka.polyfill.Fullscreen=function(){},shaka.polyfill.Fullscreen.install=function(){if(window.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,(t=Document.prototype).exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),t=shaka.polyfill.Fullscreen.proxyEvent_,document.addEventListener("webkitfullscreenchange",t),document.addEventListener("webkitfullscreenerror",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("mozfullscreenerror",t),document.addEventListener("MSFullscreenChange",t),document.addEventListener("MSFullscreenError",t)}},shaka.polyfill.Fullscreen.proxyEvent_=function(t){var i=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),r=document.createEvent("Event");r.initEvent(i,t.bubbles,t.cancelable),t.target.dispatchEvent(r)},shaka.polyfill.register(shaka.polyfill.Fullscreen.install),shaka.polyfill.MathRound=function(){},shaka.polyfill.MathRound.install=function(){shaka.log.debug("mathRound.install");var t=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_+1;if(Math.round(t)!=t){shaka.log.debug("polyfill Math.round");var i=Math.round;Math.round=function(r){var o=r;return r<=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_&&(o=i(r)),o}}},shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_=4503599627370496,shaka.polyfill.register(shaka.polyfill.MathRound.install),shaka.polyfill.MediaCapabilities=function(){},shaka.polyfill.MediaCapabilities.install=function(){shaka.log.debug("MediaCapabilities: install"),!shaka.util.Platform.isChromecast()&&navigator.mediaCapabilities?shaka.log.debug("MediaCapabilities: Native mediaCapabilities support found."):window.MediaSource?(navigator.mediaCapabilities={},navigator.mediaCapabilities.decodingInfo=shaka.polyfill.MediaCapabilities.decodingInfo_):shaka.log.debug("MediaSource must be available to install mediaCapabilities ","polyfill.")},shaka.polyfill.MediaCapabilities.decodingInfo_=function(t){var i,_,v,E,R,U;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){switch($.nextAddress){case 1:return i={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:t},!t||t.video&&!MediaSource.isTypeSupported(t.video.contentType)||t.audio&&!MediaSource.isTypeSupported(t.audio.contentType)?$.return(i):t.keySystemConfiguration?(v=[],E=[],(_=t.keySystemConfiguration).audio&&v.push({robustness:_.audio.robustness||"",contentType:t.audio.contentType}),_.video&&E.push({robustness:_.video.robustness||"",contentType:t.video.contentType}),R={initDataTypes:[_.initDataType],distinctiveIdentifier:_.distinctiveIdentifier,persistentState:_.persistentState,sessionTypes:_.sessionTypes},v.length&&(R.audioCapabilities=v),E.length&&(R.videoCapabilities=E),$.setCatchFinallyBlocks(3),$.yield(navigator.requestMediaKeySystemAccess(_.keySystem,[R]),5)):(i.supported=!0,$.return(Promise.resolve(i)));case 5:U=$.yieldResult,$.leaveTryBlock(4);break;case 3:$.enterCatchBlock(),shaka.log.info("navigator.requestMediaKeySystemAccess failed.");case 4:U&&(i.supported=!0,i.keySystemAccess=U);case 2:return $.return(i)}})},shaka.polyfill.register(shaka.polyfill.MediaCapabilities.install,-1),shaka.polyfill.MediaSource=function(){},shaka.polyfill.MediaSource.install=function(){shaka.log.debug("MediaSource.install");var t=shaka.util.Platform.safariVersion();window.MediaSource?window.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(shaka.log.info("Patching Chromecast MSE bugs."),shaka.polyfill.MediaSource.patchCastIsTypeSupported_()):t?(shaka.polyfill.MediaSource.rejectTsContent_(),12>=t?(shaka.log.info("Patching Safari 11 & 12 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_(),shaka.polyfill.MediaSource.patchRemovalRange_()):(shaka.log.info("Patching Safari 13 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_())):shaka.util.Platform.isTizen2()||shaka.util.Platform.isTizen3()||shaka.util.Platform.isTizen4()?(shaka.log.info("Rejecting Opus."),shaka.polyfill.MediaSource.rejectCodec_("opus")):shaka.log.info("Using native MSE as-is."):shaka.log.info("No MSE implementation available."),window.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&(shaka.log.info("Patching vp09 support queries."),shaka.polyfill.MediaSource.patchVp09_())},shaka.polyfill.MediaSource.stubAbort_=function(){var t=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(i){for(var r=[],o=0;o<arguments.length;++o)r[o-0]=arguments[o];return(r=t.apply(this,r)).abort=function(){},r}},shaka.polyfill.MediaSource.patchRemovalRange_=function(){var t=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(i,r){return t.call(this,i,r-.001)}},shaka.polyfill.MediaSource.rejectTsContent_=function(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){return"mp2t"!=i.split(/ *; */)[0].split("/")[1].toLowerCase()&&t(i)}},shaka.polyfill.MediaSource.rejectCodec_=function(t){var i=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(r){return shaka.util.MimeUtils.getCodecBase(r)!=t&&i(r)}},shaka.polyfill.MediaSource.patchCastIsTypeSupported_=function(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){var r=i.split(/ *; */);return r.shift(),r.some(function(o){return o.startsWith("codecs=")})?cast.__platform__.canDisplayType(i):t(i)}},shaka.polyfill.MediaSource.patchVp09_=function(){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(i){var r=i.split(/ *; */),o=r.findIndex(function(_){return _.startsWith("codecs=")});if(0>o)return t(i);var l=r[o].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),g=l.findIndex(function(_){return _.startsWith("vp09")});return 0<=g&&(l[g]="vp9",r[o]='codecs="'+l.join(",")+'"',i=r.join("; ")),t(i)}},shaka.polyfill.register(shaka.polyfill.MediaSource.install),shaka.polyfill.Orientation=function(){},shaka.polyfill.Orientation.install=function(){screen.orientation||null!=window.orientation&&shaka.polyfill.Orientation.installBasedOnWindowMethods_()},shaka.polyfill.Orientation.installBasedOnWindowMethods_=function(){var t=new shaka.polyfill.Orientation.FakeOrientation;screen.orientation=t;var i=function(){switch(window.orientation){case-90:t.type="landscape-secondary",t.angle=270;break;case 0:t.type="portrait-primary",t.angle=0;break;case 90:t.type="landscape-primary",t.angle=90;break;case 180:t.type="portrait-secondary",t.angle=180}};i(),window.addEventListener("orientationchange",function(){i(),t.dispatchChangeEvent()})},shaka.polyfill.Orientation.FakeOrientation=function(){shaka.util.FakeEventTarget.call(this),this.type="",this.angle=0},$jscomp.inherits(shaka.polyfill.Orientation.FakeOrientation,shaka.util.FakeEventTarget),shaka.polyfill.Orientation.FakeOrientation.prototype.dispatchChangeEvent=function(){var t=new shaka.util.FakeEvent("change",{});this.dispatchEvent(t)},shaka.polyfill.Orientation.FakeOrientation.prototype.lock=function(t){var i=function(o){return screen.lockOrientation?screen.lockOrientation(o):screen.mozLockOrientation?screen.mozLockOrientation(o):!!screen.msLockOrientation&&screen.msLockOrientation(o)},r=!1;switch(t){case"natural":r=i("default");break;case"any":r=!0,this.unlock();break;default:r=i(t)}return r?Promise.resolve():((t=Error("screen.orientation.lock() is not available on this device")).name="NotSupportedError",t.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(t))},shaka.polyfill.Orientation.FakeOrientation.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},shaka.polyfill.register(shaka.polyfill.Orientation.install),shaka.polyfill.PatchedMediaKeysApple=function(){},shaka.polyfill.PatchedMediaKeysApple.install=function(){if(window.HTMLVideoElement&&window.WebKitMediaKeys){shaka.log.info("Using Apple-prefixed EME");var t=shaka.polyfill.PatchedMediaKeysApple;delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysApple.requestMediaKeySystemAccess=function(t,i){shaka.log.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var r=shaka.polyfill.PatchedMediaKeysApple;try{var o=new r.MediaKeySystemAccess(t,i);return Promise.resolve(o)}catch(l){return Promise.reject(l)}},shaka.polyfill.PatchedMediaKeysApple.setMediaKeys=function(t){shaka.log.debug("PatchedMediaKeysApple.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var i=shaka.polyfill.PatchedMediaKeysApple,r=this.mediaKeys;return r&&r!=t&&(goog.asserts.assert(r instanceof i.MediaKeys,"non-polyfill instance of oldMediaKeys"),r.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=t)?(goog.asserts.assert(t instanceof i.MediaKeys,"non-polyfill instance of newMediaKeys"),t.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysApple.onWebkitNeedKey_=function(t){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitNeedKey_",t),goog.asserts.assert(this.mediaKeys instanceof shaka.polyfill.PatchedMediaKeysApple.MediaKeys,"non-polyfill instance of newMediaKeys"),goog.asserts.assert(null!=t.initData,"missing init data!"),t=shaka.util.BufferUtils.toUint8(t.initData),shaka.util.BufferUtils.toDataView(t).getUint32(0,!0)+4!=t.byteLength)throw new RangeError("Malformed FairPlay init data");t=shaka.util.StringUtils.fromUTF16(t.subarray(4),!0),t=shaka.util.StringUtils.toUTF8(t);var i=new Event("encrypted");i.initDataType="skd",i.initData=shaka.util.BufferUtils.toArrayBuffer(t),this.dispatchEvent(i)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess=function(t,i){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=t,t.startsWith("com.apple.fps"))for(var r=$jscomp.makeIterator(i),o=r.next();!o.done;o=r.next())if(o=this.checkConfig_(o.value))return void(this.configuration_=o);throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.checkConfig_=function(t){if("required"==t.persistentState)return null;var i={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:t.initDataTypes,sessionTypes:["temporary"],label:t.label},r=!1,o=!1;if(t.audioCapabilities)for(var l=$jscomp.makeIterator(t.audioCapabilities),g=l.next();!g.done;g=l.next())if((g=g.value).contentType){r=!0;var _=g.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,_)&&(i.audioCapabilities.push(g),o=!0)}if(t.videoCapabilities)for(g=(t=$jscomp.makeIterator(t.videoCapabilities)).next();!g.done;g=t.next())(l=g.value).contentType&&(r=!0,g=l.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,g)&&(i.videoCapabilities.push(l),o=!0));return r||(o=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),o?i:null},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var t=new shaka.polyfill.PatchedMediaKeysApple.MediaKeys(this.keySystem);return Promise.resolve(t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysApple.MediaKeys=function(t){shaka.log.debug("PatchedMediaKeysApple.MediaKeys"),this.nativeMediaKeys_=new WebKitMediaKeys(t),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.createSession=function(t){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeys.createSession"),"temporary"!=(t=t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysApple.MediaKeySession(this.nativeMediaKeys_,t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setServerCertificate=function(t){return shaka.log.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setMedia=function(t){var i=this,r=shaka.polyfill.PatchedMediaKeysApple;if(this.eventManager_.removeAll(),!t)return Promise.resolve();this.eventManager_.listen(t,"webkitneedkey",r.onWebkitNeedKey_);try{return shaka.util.MediaReadyState.waitForReadyState(t,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){t.webkitSetMediaKeys(i.nativeMediaKeys_)}),Promise.resolve()}catch(o){return Promise.reject(o)}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession=function(t,i){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=t,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysApple.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.generateRequest=function(t,i){var r=this;shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{var o=this.nativeMediaKeys_.createSession("video/mp4",shaka.util.BufferUtils.toUint8(i));this.nativeMediaKeySession_=o,this.sessionId=o.sessionId||"",this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeymessage",function(l){return r.onWebkitKeyMessage_(l)}),this.eventManager_.listen(o,"webkitkeyadded",function(l){return r.onWebkitKeyAdded_(l)}),this.eventManager_.listen(o,"webkitkeyerror",function(l){return r.onWebkitKeyError_(l)}),this.updateKeyStatus_("status-pending")}catch(l){this.generateRequestPromise_.reject(l)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.update=function(t){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(shaka.util.BufferUtils.toUint8(t))}catch(i){this.updatePromise_.reject(i)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(t){this.closed.reject(t)}return this.closed},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyMessage_=function(t){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",t),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ should be set before now!"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var i=null==this.keyStatuses.getStatus();t=new shaka.util.FakeEvent("message",{messageType:i?"license-request":"license-renewal",message:shaka.util.BufferUtils.toArrayBuffer(t.message)}),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyAdded_=function(t){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",t),goog.asserts.assert(!this.generateRequestPromise_,"Key added during generate!"),goog.asserts.assert(this.updatePromise_,"updatePromise_ should be set before now!"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyError_=function(t){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyError_",t),(t=Error("EME PatchedMediaKeysApple key error")).errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(t),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(t),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.updateKeyStatus_=function(t){this.keyStatuses.setStatus(t),t=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.setStatus=function(t){this.size=null==t?0:1,this.status_=t},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.forEach=function(t){this.status_&&t(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.get=function(t){if(this.has(t))return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.has=function(t){var i=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!(!this.status_||!shaka.util.BufferUtils.equal(t,i))},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysApple.install),shaka.polyfill.PatchedMediaKeysMs=function(){},shaka.polyfill.PatchedMediaKeysMs.install=function(){if(window.HTMLVideoElement&&window.MSMediaKeys&&(!navigator.requestMediaKeySystemAccess||!MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("Using ms-prefixed EME v20140218");var t=shaka.polyfill.PatchedMediaKeysMs;delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,HTMLMediaElement.prototype.setMediaKeys=t.MediaKeySystemAccess.setMediaKeys}},shaka.polyfill.PatchedMediaKeysMs.requestMediaKeySystemAccess=function(t,i){shaka.log.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var r=shaka.polyfill.PatchedMediaKeysMs;try{var o=new r.MediaKeySystemAccess(t,i);return Promise.resolve(o)}catch(l){return Promise.reject(l)}},shaka.polyfill.PatchedMediaKeysMs.onMsNeedKey_=function(t){if(shaka.log.debug("PatchedMediaKeysMs.onMsNeedKey_",t),t.initData){var i=new CustomEvent("encrypted");i.initDataType="cenc",i.initData=shaka.util.BufferUtils.toArrayBuffer(shaka.util.Pssh.normaliseInitData(t.initData)),this.dispatchEvent(i)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess=function(t,i){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=t;for(var r=!1,o=$jscomp.makeIterator(i),l=o.next();!l.done;l=o.next()){var g={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(l=l.value).initDataTypes,sessionTypes:["temporary"],label:l.label},_=!1;if(l.audioCapabilities)for(var v=$jscomp.makeIterator(l.audioCapabilities),E=v.next();!E.done;E=v.next())if((E=E.value).contentType){_=!0;var P=E.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,P)&&(g.audioCapabilities.push(E),r=!0)}if(l.videoCapabilities)for(E=(v=$jscomp.makeIterator(l.videoCapabilities)).next();!E.done;E=v.next())(E=E.value).contentType&&(_=!0,P=E.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,P)&&(g.videoCapabilities.push(E),r=!0));if(_||(r=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==l.persistentState&&(r=!1),r)return void(this.configuration_=g)}throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var t=new shaka.polyfill.PatchedMediaKeysMs.MediaKeys(this.keySystem);return Promise.resolve(t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.setMediaKeys=function(t){shaka.log.debug("PatchedMediaKeysMs.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var i=shaka.polyfill.PatchedMediaKeysMs,r=this.mediaKeys;return r&&r!=t&&(goog.asserts.assert(r instanceof i.MediaKeys,"non-polyfill instance of oldMediaKeys"),r.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=t)?(goog.asserts.assert(t instanceof i.MediaKeys,"non-polyfill instance of newMediaKeys"),t.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysMs.MediaKeys=function(t){shaka.log.debug("PatchedMediaKeysMs.MediaKeys"),this.nativeMediaKeys_=new MSMediaKeys(t),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.createSession=function(t){if(shaka.log.debug("PatchedMediaKeysMs.MediaKeys.createSession"),"temporary"!=(t=t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysMs.MediaKeySession(this.nativeMediaKeys_,t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setServerCertificate=function(t){return shaka.log.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setMedia=function(t){var i=this,r=shaka.polyfill.PatchedMediaKeysMs;if(this.eventManager_.removeAll(),!t)return Promise.resolve();this.eventManager_.listen(t,"msneedkey",r.onMsNeedKey_);try{return shaka.util.MediaReadyState.waitForReadyState(t,HTMLMediaElement.HAVE_METADATA,this.eventManager_,function(){t.msSetMediaKeys(i.nativeMediaKeys_)}),Promise.resolve()}catch(o){return Promise.reject(o)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession=function(t,i){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=t,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysMs.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.generateRequest=function(t,i){var r=this;shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",shaka.util.BufferUtils.toUint8(i),null),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeymessage",function(o){return r.onMsKeyMessage_(o)}),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyadded",function(o){return r.onMsKeyAdded_(o)}),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyerror",function(o){return r.onMsKeyError_(o)}),this.updateKeyStatus_("status-pending")}catch(o){this.generateRequestPromise_.reject(o)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.update=function(t){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(shaka.util.BufferUtils.toUint8(t))}catch(i){this.updatePromise_.reject(i)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(t){this.closed.reject(t)}return this.closed},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyMessage_=function(t){shaka.log.debug("PatchedMediaKeysMs.onMsKeyMessage_",t),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ not set in onMsKeyMessage_"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var i=null==this.keyStatuses.getStatus();t=new shaka.util.FakeEvent("message",{messageType:i?"license-request":"license-renewal",message:shaka.util.BufferUtils.toArrayBuffer(t.message)}),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyAdded_=function(t){shaka.log.debug("PatchedMediaKeysMs.onMsKeyAdded_",t),this.generateRequestPromise_?(shaka.log.debug("Simulating completion for a PR persistent license."),goog.asserts.assert(!this.updatePromise_,"updatePromise_ and generateRequestPromise_ set in onMsKeyAdded_"),this.updateKeyStatus_("usable"),this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null):(goog.asserts.assert(this.updatePromise_,"updatePromise_ not set in onMsKeyAdded_"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyError_=function(t){if(shaka.log.debug("PatchedMediaKeysMs.onMsKeyError_",t),(t=Error("EME PatchedMediaKeysMs key error")).errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(t),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(t),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.updateKeyStatus_=function(t){this.keyStatuses.setStatus(t),t=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.setStatus=function(t){this.size=null==t?0:1,this.status_=t},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.forEach=function(t){this.status_&&t(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.get=function(t){if(this.has(t))return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.has=function(t){var i=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!(!this.status_||!shaka.util.BufferUtils.equal(t,i))},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysMs.install),shaka.polyfill.PatchedMediaKeysNop=function(){},shaka.polyfill.PatchedMediaKeysNop.install=function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("EME not available.");var t=shaka.polyfill.PatchedMediaKeysNop;navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysNop.requestMediaKeySystemAccess=function(t,i){return shaka.log.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess'),Promise.reject(Error("The key system specified is not supported."))},shaka.polyfill.PatchedMediaKeysNop.setMediaKeys=function(t){return shaka.log.debug("PatchedMediaKeysNop.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys'),null==t?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))},shaka.polyfill.PatchedMediaKeysNop.MediaKeys=function(){throw new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.createSession=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.setServerCertificate=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess=function(){throw this.keySystem="",new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.getConfiguration=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.createMediaKeys=function(){},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysNop.install,-10),shaka.polyfill.PatchedMediaKeysWebkit=function(){},shaka.polyfill.PatchedMediaKeysWebkit.install=function(){var t=shaka.polyfill.PatchedMediaKeysWebkit;if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)shaka.log.info("Using webkit-prefixed EME v0.1b"),t.prefix_="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;shaka.log.info("Using nonprefixed EME v0.1b")}goog.asserts.assert(HTMLMediaElement.prototype[t.prefixApi_("generateKeyRequest")],"PatchedMediaKeysWebkit APIs not available!"),navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,window.MediaKeys=t.MediaKeys,window.MediaKeySystemAccess=t.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_=function(t){var i=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;return i?i+t.charAt(0).toUpperCase()+t.slice(1):t},shaka.polyfill.PatchedMediaKeysWebkit.requestMediaKeySystemAccess=function(t,i){shaka.log.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var r=shaka.polyfill.PatchedMediaKeysWebkit;try{var o=new r.MediaKeySystemAccess(t,i);return Promise.resolve(o)}catch(l){return Promise.reject(l)}},shaka.polyfill.PatchedMediaKeysWebkit.setMediaKeys=function(t){shaka.log.debug("PatchedMediaKeysWebkit.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var i=shaka.polyfill.PatchedMediaKeysWebkit,r=this.mediaKeys;return r&&r!=t&&(goog.asserts.assert(r instanceof i.MediaKeys,"non-polyfill instance of oldMediaKeys"),r.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=t)&&(goog.asserts.assert(t instanceof i.MediaKeys,"non-polyfill instance of newMediaKeys"),t.setMedia(this)),Promise.resolve()},shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_=function(){var t=document.getElementsByTagName("video");return t.length?t[0]:document.createElement("video")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess=function(t,i){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.internalKeySystem_=this.keySystem=t;var r=!1;"org.w3.clearkey"==t&&(this.internalKeySystem_="webkit-org.w3.clearkey",r=!1);for(var o=!1,l=shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_(),g=$jscomp.makeIterator(i),_=g.next();!_.done;_=g.next()){var v={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(_=_.value).initDataTypes,sessionTypes:["temporary"],label:_.label},E=!1;if(_.audioCapabilities)for(var P=$jscomp.makeIterator(_.audioCapabilities),M=P.next();!M.done;M=P.next())if((M=M.value).contentType){E=!0;var R=M.contentType.split(";")[0];l.canPlayType(R,this.internalKeySystem_)&&(v.audioCapabilities.push(M),o=!0)}if(_.videoCapabilities)for(M=(P=$jscomp.makeIterator(_.videoCapabilities)).next();!M.done;M=P.next())(M=M.value).contentType&&(E=!0,l.canPlayType(M.contentType,this.internalKeySystem_)&&(v.videoCapabilities.push(M),o=!0));if(E||(o=l.canPlayType("video/mp4",this.internalKeySystem_)||l.canPlayType("video/webm",this.internalKeySystem_)),"required"==_.persistentState&&(r?(v.persistentState="required",v.sessionTypes=["persistent-license"]):o=!1),o)return void(this.configuration_=v)}throw r="Unsupported keySystem",("org.w3.clearkey"==t||"com.widevine.alpha"==t)&&(r="None of the requested configurations were supported."),(r=Error(r)).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var t=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys(this.internalKeySystem_);return Promise.resolve(t)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys=function(t){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys"),this.keySystem_=t,this.media_=null,this.eventManager_=new shaka.util.EventManager,this.newSessions_=[],this.sessionMap_=new Map},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setMedia=function(t){var i=this;this.media_=t,this.eventManager_.removeAll();var r=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;t&&(this.eventManager_.listen(t,r+"needkey",function(o){return i.onWebkitNeedKey_(o)}),this.eventManager_.listen(t,r+"keymessage",function(o){return i.onWebkitKeyMessage_(o)}),this.eventManager_.listen(t,r+"keyadded",function(o){return i.onWebkitKeyAdded_(o)}),this.eventManager_.listen(t,r+"keyerror",function(o){return i.onWebkitKeyError_(o)}))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.createSession=function(t){if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),"temporary"!=(t=t||"temporary")&&"persistent-license"!=t)throw new TypeError("Session type "+t+" is unsupported on this platform.");var i=shaka.polyfill.PatchedMediaKeysWebkit,r=this.media_||document.createElement("video");return r.src||(r.src="about:blank"),t=new i.MediaKeySession(r,this.keySystem_,t),this.newSessions_.push(t),t},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setServerCertificate=function(t){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitNeedKey_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",t),goog.asserts.assert(this.media_,"media_ not set in onWebkitNeedKey_");var i=new CustomEvent("encrypted");i.initDataType="cenc",i.initData=shaka.util.BufferUtils.toArrayBuffer(t.initData),this.media_.dispatchEvent(i)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyMessage_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",t);var i=this.findSession_(t.sessionId);if(i){var r=null==i.keyStatuses.getStatus();t=new shaka.util.FakeEvent("message",{messageType:r?"licenserequest":"licenserenewal",message:t.message}),i.generated(),i.dispatchEvent(t)}else shaka.log.error("Session not found",t.sessionId)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyAdded_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",t),t=this.findSession_(t.sessionId),goog.asserts.assert(t,"unable to find session in onWebkitKeyAdded_"),t&&t.ready()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyError_=function(t){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",t);var i=this.findSession_(t.sessionId);goog.asserts.assert(i,"unable to find session in onWebkitKeyError_"),i&&i.handleError(t)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.findSession_=function(t){var i=this.sessionMap_.get(t);return i?(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",i),i):(i=this.newSessions_.shift())?(i.sessionId=t,this.sessionMap_.set(t,i),shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",i),i):null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession=function(t,i,r){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.media_=t,this.initialized_=!1,this.updatePromise_=this.generatePromise_=null,this.keySystem_=i,this.type_=r,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generated=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),this.generatePromise_&&(this.generatePromise_.resolve(),this.generatePromise_=null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.ready=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),this.updateKeyStatus_("usable"),this.updatePromise_&&this.updatePromise_.resolve(),this.updatePromise_=null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.handleError=function(t){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",t);var i=Error("EME v0.1b key error"),r=t.errorCode;r.systemCode=t.systemCode,i.errorCode=r,!t.sessionId&&this.generatePromise_?(45==t.systemCode&&(i.message="Unsupported session type."),this.generatePromise_.reject(i),this.generatePromise_=null):t.sessionId&&this.updatePromise_?(this.updatePromise_.reject(i),this.updatePromise_=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?this.updateKeyStatus_("output-restricted"):this.updateKeyStatus_(1==i?"expired":"internal-error"))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generate_=function(t,i){var r=this,o=shaka.polyfill.PatchedMediaKeysWebkit;if(this.initialized_)return Promise.reject(Error("The session is already initialized."));this.initialized_=!0;try{if("persistent-license"==this.type_){var l=shaka.util.StringUtils;if(i)var g=shaka.util.BufferUtils.toUint8(l.toUTF8("LOAD_SESSION|"+i));else{goog.asserts.assert(t,"expecting init data");var _=l.toUTF8("PERSISTENT|");g=shaka.util.Uint8ArrayUtils.concat(_,t)}}else goog.asserts.assert("temporary"==this.type_,"expected temporary session"),goog.asserts.assert(!i,"unexpected offline session ID"),goog.asserts.assert(t,"expecting init data"),g=shaka.util.BufferUtils.toUint8(t);goog.asserts.assert(g,"init data not set!")}catch(E){return Promise.reject(E)}goog.asserts.assert(null==this.generatePromise_,"generatePromise_ should be null"),this.generatePromise_=new shaka.util.PublicPromise;var v=o.prefixApi_("generateKeyRequest");try{this.media_[v](this.keySystem_,g)}catch(E){if("InvalidStateError"!=E.name)return this.generatePromise_=null,Promise.reject(E);new shaka.util.Timer(function(){try{r.media_[v](r.keySystem_,g)}catch(P){r.generatePromise_.reject(P),r.generatePromise_=null}}).tickAfter(.01)}return this.generatePromise_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update_=function(t,i){var r=this,o=shaka.polyfill.PatchedMediaKeysWebkit;if(this.updatePromise_)this.updatePromise_.then(function(){return r.update_(t,i)}).catch(function(){return r.update_(t,i)});else{if(this.updatePromise_=t,"webkit-org.w3.clearkey"==this.keySystem_){var l=shaka.util.Uint8ArrayUtils,g=shaka.util.StringUtils.fromUTF8(i),_=JSON.parse(g);"oct"!=_.keys[0].kty&&(this.updatePromise_.reject(Error("Response is not a valid JSON Web Key Set.")),this.updatePromise_=null),g=l.fromBase64(_.keys[0].k),l=l.fromBase64(_.keys[0].kid)}else g=shaka.util.BufferUtils.toUint8(i),l=null;o=o.prefixApi_("addKey");try{this.media_[o](this.keySystem_,g,l,this.sessionId)}catch(v){this.updatePromise_.reject(v),this.updatePromise_=null}}},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.updateKeyStatus_=function(t){this.keyStatuses.setStatus(t),t=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(t)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generateRequest=function(t,i){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),this.generate_(i,null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.load=function(t){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.type_?this.generate_(null,t):Promise.reject(Error("Not a persistent session."))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update=function(t){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.update",t),goog.asserts.assert(this.sessionId,"update without session ID");var i=new shaka.util.PublicPromise;return this.update_(i,t),i},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.close=function(){var t=shaka.polyfill.PatchedMediaKeysWebkit;if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.type_){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;t=t.prefixApi_("cancelKeyRequest");try{this.media_[t](this.keySystem_,this.sessionId)}catch(i){}}return this.closed.resolve(),this.closed},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.type_?Promise.reject(Error("Not a persistent session.")):this.close()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.setStatus=function(t){this.size=null==t?0:1,this.status_=t},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.forEach=function(t){this.status_&&t(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.get=function(t){if(this.has(t))return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.has=function(t){var i=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!(!this.status_||!shaka.util.BufferUtils.equal(t,i))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.prefix_="",shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysWebkit.install),shaka.polyfill.PiPWebkit=function(){},shaka.polyfill.PiPWebkit.install=function(){if(window.HTMLVideoElement){var t=HTMLVideoElement.prototype;if((!t.requestPictureInPicture||!document.exitPictureInPicture)&&t.webkitSupportsPresentationMode){var i=shaka.polyfill.PiPWebkit;shaka.log.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=i.requestPictureInPicture_,Object.defineProperty(t,"disablePictureInPicture",{get:i.getDisablePictureInPicture_,set:i.setDisablePictureInPicture_,enumerable:!0,configurable:!0}),document.exitPictureInPicture=i.exitPictureInPicture_,document.addEventListener("webkitpresentationmodechanged",i.proxyEvent_,!0)}}},shaka.polyfill.PiPWebkit.proxyEvent_=function(t){if((t=t.target).webkitPresentationMode==shaka.polyfill.PiPWebkit.PIP_MODE_){document.pictureInPictureElement=t;var i=new Event("enterpictureinpicture");t.dispatchEvent(i)}else document.pictureInPictureElement==t&&(document.pictureInPictureElement=null),i=new Event("leavepictureinpicture"),t.dispatchEvent(i)},shaka.polyfill.PiPWebkit.requestPictureInPicture_=function(){var t=shaka.polyfill.PiPWebkit;return this.webkitSupportsPresentationMode(t.PIP_MODE_)?(this.webkitSetPresentationMode(t.PIP_MODE_),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))},shaka.polyfill.PiPWebkit.exitPictureInPicture_=function(){var i=document.pictureInPictureElement;return i?(i.webkitSetPresentationMode(shaka.polyfill.PiPWebkit.INLINE_MODE_),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))},shaka.polyfill.PiPWebkit.getDisablePictureInPicture_=function(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode(shaka.polyfill.PiPWebkit.PIP_MODE_)},shaka.polyfill.PiPWebkit.setDisablePictureInPicture_=function(t){t?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")},shaka.polyfill.PiPWebkit.PIP_MODE_="picture-in-picture",shaka.polyfill.PiPWebkit.INLINE_MODE_="inline",shaka.polyfill.register(shaka.polyfill.PiPWebkit.install),shaka.polyfill.StorageEstimate=function(){},shaka.polyfill.StorageEstimate.install=function(){navigator.storage&&navigator.storage.estimate||!navigator.webkitTemporaryStorage||!navigator.webkitTemporaryStorage.queryUsageAndQuota||("storage"in navigator||(navigator.storage={}),navigator.storage.estimate=shaka.polyfill.StorageEstimate.storageEstimate_)},shaka.polyfill.StorageEstimate.storageEstimate_=function(){return new Promise(function(t,i){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(r,o){t({usage:r,quota:o})},i)})},shaka.polyfill.register(shaka.polyfill.StorageEstimate.install),shaka.polyfill.VideoPlayPromise=function(){},shaka.polyfill.VideoPlayPromise.install=function(){if(shaka.log.debug("VideoPlayPromise.install"),window.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var i=t.apply(this);return i&&i.catch(function(){}),i}}},shaka.polyfill.register(shaka.polyfill.VideoPlayPromise.install),shaka.polyfill.VideoPlaybackQuality=function(){},shaka.polyfill.VideoPlaybackQuality.install=function(){if(window.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=shaka.polyfill.VideoPlaybackQuality.webkit_)}},shaka.polyfill.VideoPlaybackQuality.webkit_=function(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}},shaka.polyfill.register(shaka.polyfill.VideoPlaybackQuality.install),shaka.polyfill.VTTCue=function(){},shaka.polyfill.VTTCue.install=function(){if(window.VTTCue)shaka.log.info("Using native VTTCue.");else if(window.TextTrackCue){var t=null,i=TextTrackCue.length;3==i?(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_):6==i?(shaka.log.info("Using VTTCue polyfill from 6 argument TextTrackCue."),t=shaka.polyfill.VTTCue.from6ArgsTextTrackCue_):shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_()&&(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_),t?window.VTTCue=function(r,o,l){return t(r,o,l)}:shaka.log.error("No recognized signature for TextTrackCue found!")}else shaka.log.error("VTTCue not available.")},shaka.polyfill.VTTCue.from3ArgsTextTrackCue_=function(t,i,r){return new window.TextTrackCue(t,i,r)},shaka.polyfill.VTTCue.from6ArgsTextTrackCue_=function(t,i,r){return new window.TextTrackCue(t+"-"+i+"-"+r,t,i,r)},shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_=function(){try{return!!shaka.polyfill.VTTCue.from3ArgsTextTrackCue_(1,2,"")}catch(t){return!1}},shaka.polyfill.register(shaka.polyfill.VTTCue.install),shaka.text.LrcTextParser=function(){},shaka.text.LrcTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"LRC does not have init segments")},shaka.text.LrcTextParser.prototype.parseMedia=function(t,i){for(var r=shaka.text.LrcTextParser,o=null,l=[],g=shaka.util.StringUtils.fromUTF8(t).split(/\r?\n/),_=(g=$jscomp.makeIterator(g)).next();!_.done;_=g.next()){var v=_.value;v&&!/^\s+$/.test(v)&&((_=r.lyricLine_.exec(v))?(v=r.parseTime_(_[1]),_=new shaka.text.Cue(v,i.segmentEnd?i.segmentEnd:v+2,_[2]),o&&(o.endTime=v,l.push(o)),o=_):shaka.log.warning("LrcTextParser encountered an unknown line.",v))}return o&&l.push(o),l},shaka.text.LrcTextParser.parseTime_=function(t){var i=shaka.text.LrcTextParser.timeFormat_.exec(t);return 60*(t=parseInt(i[1],10))+parseFloat(i[2].replace(",","."))},goog.exportSymbol("shaka.text.LrcTextParser",shaka.text.LrcTextParser),goog.exportProperty(shaka.text.LrcTextParser.prototype,"parseMedia",shaka.text.LrcTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.LrcTextParser.prototype,"parseInit",shaka.text.LrcTextParser.prototype.parseInit),shaka.text.LrcTextParser.lyricLine_=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,shaka.text.LrcTextParser.timeFormat_=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/,shaka.text.TextEngine.registerParser("application/x-subtitle-lrc",function(){return new shaka.text.LrcTextParser}),shaka.text.TtmlTextParser=function(){},shaka.text.TtmlTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"TTML does not have init segments")},shaka.text.TtmlTextParser.prototype.parseMedia=function(t,i){var r=shaka.text.TtmlTextParser,o=shaka.util.XmlUtils,l=r.parameterNs_,g=r.styleNs_,_=shaka.util.StringUtils.fromUTF8(t),v=[],E=new DOMParser,P=null;if(""==_)return v;try{P=E.parseFromString(_,"text/xml")}catch(Z){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"Failed to parse TTML.")}if(P){if(_=P.getElementsByTagName("parsererror")[0])throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,_.textContent);var M=P.getElementsByTagName("tt")[0];if(!M)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"TTML does not contain <tt> tag.");if(!(P=M.getElementsByTagName("body")[0]))return[];_=o.getAttributeNS(M,l,"frameRate"),E=o.getAttributeNS(M,l,"subFrameRate");var R=o.getAttributeNS(M,l,"frameRateMultiplier"),U=o.getAttributeNS(M,l,"tickRate"),$=o.getAttributeNS(M,l,"cellResolution");l=M.getAttribute("xml:space")||"default";var G=o.getAttributeNS(M,g,"extent");if("default"!=l&&"preserve"!=l)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"Invalid xml:space value: "+l);g="default"==l,l=new r.RateInfo_(_,E,R,U),_=r.getCellResolution_($),E=(E=M.getElementsByTagName("metadata")[0])?o.getChildren(E):[],R=Array.from(M.getElementsByTagName("style")),M=Array.from(M.getElementsByTagName("region")),U=[];for(var z=($=$jscomp.makeIterator(M)).next();!z.done;z=$.next())(z=r.parseCueRegion_(z.value,R,G))&&U.push(z);if(o.findChildren(P,"p").length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"<p> can only be inside <div> in TTML");for(G=(P=$jscomp.makeIterator(o.findChildren(P,"div"))).next();!G.done;G=P.next()){if(o.findChildren(G=G.value,"span").length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"<span> can only be inside <p> in TTML");if(($=o.findChildren(G,"p"))&&$.length)for($=(G=$jscomp.makeIterator($)).next();!$.done;$=G.next())($=r.parseCue_($.value,i.periodStart,l,E,R,M,U,g,!1,_))&&v.push($);else(G=r.parseCue_(G,i.periodStart,l,E,R,M,U,g,!1,_))&&v.push(G)}}return v},shaka.text.TtmlTextParser.parseCue_=function(t,i,r,o,l,g,_,v,E,P){var M=t.parentNode;if(t.nodeType==Node.TEXT_NODE){var R=document.createElement("span");R.textContent=t.textContent,t=R}else goog.asserts.assert(t.nodeType==Node.ELEMENT_NODE,"nodeType should be ELEMENT_NODE!");if(goog.asserts.assert(t,"cueElement should be non-null!"),v="default"==(t.getAttribute("xml:space")||(v?"default":"preserve")),R=/\S/.test(t.textContent),!(t.hasAttribute("begin")||t.hasAttribute("end")||t.hasAttribute("dur")||R||"br"==t.tagName||E&&!v))return null;var U=shaka.text.TtmlTextParser.parseTime_(t,r);for(R=U.start,U=U.end;M&&M.nodeType==Node.ELEMENT_NODE&&"tt"!=M.tagName;)R=(U=shaka.text.TtmlTextParser.resolveTime_(M,r,R,U)).start,U=U.end,M=M.parentNode;if(null==R&&(R=0),R+=i,U=null==U?1/0:U+i,"br"==t.tagName)return(o=new shaka.text.Cue(R,U,"")).lineBreak=!0,o;var $="";if(M=[],Array.from(t.childNodes).every(function(Y){return Y.nodeType==Node.TEXT_NODE}))$=t.textContent,v&&($=($=$.trim()).replace(/\s+/g," "));else for(var G=$jscomp.makeIterator(t.childNodes),z=G.next();!z.done;z=G.next())(z=shaka.text.TtmlTextParser.parseCue_(z.value,i,r,o,l,g,_,v,!0,P))&&M.push(z);if((i=new shaka.text.Cue(R,U,$)).nestedCues=M,P&&(i.cellResolution=P),(g=shaka.text.TtmlTextParser.getElementsFromCollection_(t,"region",g,"")[0])&&g.getAttribute("xml:id")){var Z=g.getAttribute("xml:id");i.region=_.filter(function(Y){return Y.id==Z})[0]}for(_=null,r=(P=$jscomp.makeIterator(shaka.text.TtmlTextParser.smpteNsList_)).next();!r.done&&!(_=shaka.text.TtmlTextParser.getElementsFromCollection_(t,"backgroundImage",o,"#",r.value)[0]);r=P.next());return shaka.text.TtmlTextParser.addStyle_(i,t,g,_,l,E,0==M.length),i},shaka.text.TtmlTextParser.parseCueRegion_=function(t,i,r){var _,v,o=shaka.text.TtmlTextParser,l=new shaka.text.CueRegion,g=t.getAttribute("xml:id");return g?(l.id=g,g=null,r&&(g=o.percentValues_.exec(r)||o.pixelValues_.exec(r)),r=g?Number(g[1]):null,g=g?Number(g[2]):null,(_=o.getStyleAttributeFromRegion_(t,i,"extent"))&&null!=(_=(v=o.percentValues_.exec(_))||o.pixelValues_.exec(_))&&(l.width=Number(_[1]),l.height=Number(_[2]),v||(null!=r&&(l.width=100*l.width/r),null!=g&&(l.height=100*l.height/g)),l.widthUnits=v||null!=r?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX,l.heightUnits=v||null!=g?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX),(t=o.getStyleAttributeFromRegion_(t,i,"origin"))&&null!=(_=(v=o.percentValues_.exec(t))||o.pixelValues_.exec(t))&&(l.viewportAnchorX=Number(_[1]),l.viewportAnchorY=Number(_[2]),v||(null!=g&&(l.viewportAnchorY=100*l.viewportAnchorY/g),null!=r&&(l.viewportAnchorX=100*l.viewportAnchorX/r)),l.viewportAnchorUnits=v||null!=r?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX),l):(shaka.log.warning("TtmlTextParser parser encountered a region with no id. Region will be ignored."),null)},shaka.text.TtmlTextParser.addStyle_=function(t,i,r,o,l,g,_){var v=shaka.text.TtmlTextParser,E=shaka.text.Cue;"rtl"==v.getStyleAttribute_(i,r,l,"direction",g=g||_)&&(t.direction=E.direction.HORIZONTAL_RIGHT_TO_LEFT),"tb"==(_=v.getStyleAttribute_(i,r,l,"writingMode",g))||"tblr"==_?t.writingMode=E.writingMode.VERTICAL_LEFT_TO_RIGHT:"tbrl"==_?t.writingMode=E.writingMode.VERTICAL_RIGHT_TO_LEFT:"rltb"==_||"rl"==_?t.direction=E.direction.HORIZONTAL_RIGHT_TO_LEFT:_&&(t.direction=E.direction.HORIZONTAL_LEFT_TO_RIGHT),(_=v.getStyleAttribute_(i,r,l,"textAlign",g))?(t.positionAlign=v.textAlignToPositionAlign_[_],t.lineAlign=v.textAlignToLineAlign_[_],goog.asserts.assert(_.toUpperCase()in E.textAlign,_.toUpperCase()+" Should be in Cue.textAlign values!"),t.textAlign=E.textAlign[_.toUpperCase()]):t.textAlign=E.textAlign.START,(_=v.getStyleAttribute_(i,r,l,"displayAlign",g))&&(goog.asserts.assert(_.toUpperCase()in E.displayAlign,_.toUpperCase()+" Should be in Cue.displayAlign values!"),t.displayAlign=E.displayAlign[_.toUpperCase()]),(_=v.getStyleAttribute_(i,r,l,"color",g))&&(t.color=_),(_=v.getStyleAttribute_(i,r,l,"backgroundColor",g))&&(t.backgroundColor=_),(_=v.getStyleAttribute_(i,r,l,"border",g))&&(t.border=_),(_=v.getStyleAttribute_(i,r,l,"fontFamily",g))&&(t.fontFamily=_),(_=v.getStyleAttribute_(i,r,l,"fontWeight",g))&&"bold"==_&&(t.fontWeight=E.fontWeight.BOLD),_=v.getStyleAttribute_(i,r,l,"wrapOption",g),t.wrapLine=!(_&&"noWrap"==_),(_=v.getStyleAttribute_(i,r,l,"lineHeight",g))&&_.match(v.unitValues_)&&(t.lineHeight=_),(_=v.getStyleAttribute_(i,r,l,"fontSize",g))&&(_.match(v.unitValues_)||_.match(v.percentValue_))&&(t.fontSize=_),(_=v.getStyleAttribute_(i,r,l,"fontStyle",g))&&(goog.asserts.assert(_.toUpperCase()in E.fontStyle,_.toUpperCase()+" Should be in Cue.fontStyle values!"),t.fontStyle=E.fontStyle[_.toUpperCase()]),o&&(E=o.getAttribute("imageType")||o.getAttribute("imagetype"),_=o.getAttribute("encoding"),o=o.textContent.trim(),"PNG"==E&&"Base64"==_&&o&&(t.backgroundImage="data:image/png;base64,"+o)),(o=v.getStyleAttribute_(i,r,l,"letterSpacing",g))&&o.match(v.unitValues_)&&(t.letterSpacing=o),(o=v.getStyleAttribute_(i,r,l,"linePadding",g))&&o.match(v.unitValues_)&&(t.linePadding=o),(g=v.getStyleAttribute_(i,r,l,"opacity",g))&&(t.opacity=parseFloat(g)),(r=v.getStyleAttributeFromRegion_(r,l,"textDecoration"))&&v.addTextDecoration_(t,r),(i=v.getStyleAttributeFromElement_(i,l,"textDecoration"))&&v.addTextDecoration_(t,i)},shaka.text.TtmlTextParser.addTextDecoration_=function(t,i){for(var r=shaka.text.Cue,o=$jscomp.makeIterator(i.split(" ")),l=o.next();!l.done;l=o.next())switch(l.value){case"underline":t.textDecoration.includes(r.textDecoration.UNDERLINE)||t.textDecoration.push(r.textDecoration.UNDERLINE);break;case"noUnderline":t.textDecoration.includes(r.textDecoration.UNDERLINE)&&shaka.util.ArrayUtils.remove(t.textDecoration,r.textDecoration.UNDERLINE);break;case"lineThrough":t.textDecoration.includes(r.textDecoration.LINE_THROUGH)||t.textDecoration.push(r.textDecoration.LINE_THROUGH);break;case"noLineThrough":t.textDecoration.includes(r.textDecoration.LINE_THROUGH)&&shaka.util.ArrayUtils.remove(t.textDecoration,r.textDecoration.LINE_THROUGH);break;case"overline":t.textDecoration.includes(r.textDecoration.OVERLINE)||t.textDecoration.push(r.textDecoration.OVERLINE);break;case"noOverline":t.textDecoration.includes(r.textDecoration.OVERLINE)&&shaka.util.ArrayUtils.remove(t.textDecoration,r.textDecoration.OVERLINE)}},shaka.text.TtmlTextParser.getStyleAttribute_=function(t,i,r,o,l){l=void 0===l||l;var g=shaka.text.TtmlTextParser;return(t=g.getStyleAttributeFromElement_(t,r,o))?t:l?g.getStyleAttributeFromRegion_(i,r,o):null},shaka.text.TtmlTextParser.getStyleAttributeFromRegion_=function(t,i,r){return t?shaka.util.XmlUtils.getAttributeNS(t,shaka.text.TtmlTextParser.styleNs_,r)||shaka.text.TtmlTextParser.getInheritedStyleAttribute_(t,i,r):null},shaka.text.TtmlTextParser.getStyleAttributeFromElement_=function(t,i,r){return shaka.util.XmlUtils.getAttributeNS(t,shaka.text.TtmlTextParser.styleNs_,r)||shaka.text.TtmlTextParser.getInheritedStyleAttribute_(t,i,r)},shaka.text.TtmlTextParser.getInheritedStyleAttribute_=function(t,i,r){var o=shaka.util.XmlUtils,l=shaka.text.TtmlTextParser.styleNs_,g=shaka.text.TtmlTextParser.styleEbuttsNs_;t=shaka.text.TtmlTextParser.getElementsFromCollection_(t,"style",i,"");for(var _=null,v=0;v<t.length;v++){var E=o.getAttributeNS(t[v],g,r);E||(E=o.getAttributeNS(t[v],l,r)),E||(E=shaka.text.TtmlTextParser.getStyleAttributeFromElement_(t[v],i,r)),E&&(_=E)}return _},shaka.text.TtmlTextParser.getElementsFromCollection_=function(t,i,r,o,l){var g=[];if(!t||1>r.length)return g;if(t=shaka.text.TtmlTextParser.getInheritedAttribute_(t,i,l))for(t=t.split(" "),i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){i=i.value;for(var _=(l=$jscomp.makeIterator(r)).next();!_.done;_=l.next())if(o+(_=_.value).getAttribute("xml:id")==i){g.push(_);break}}return g},shaka.text.TtmlTextParser.getInheritedAttribute_=function(t,i,r){for(var o=null,l=shaka.util.XmlUtils;t&&!(o=r?l.getAttributeNS(t,r,i):t.getAttribute(i))&&(t=t.parentNode)instanceof Element;);return o},shaka.text.TtmlTextParser.resolveTime_=function(t,i,r,o){return t=shaka.text.TtmlTextParser.parseTime_(t,i),null==r?r=t.start:null!=t.start&&(r+=t.start),null==o?o=t.end:null!=t.start&&(o+=t.start),{start:r,end:o}},shaka.text.TtmlTextParser.parseTime_=function(t,i){var r=shaka.text.TtmlTextParser.parseTimeAttribute_(t.getAttribute("begin"),i),o=shaka.text.TtmlTextParser.parseTimeAttribute_(t.getAttribute("end"),i),l=shaka.text.TtmlTextParser.parseTimeAttribute_(t.getAttribute("dur"),i);return null==o&&null!=l&&(o=r+l),{start:r,end:o}},shaka.text.TtmlTextParser.parseTimeAttribute_=function(t,i){var r=null,o=shaka.text.TtmlTextParser;if(o.timeColonFormatFrames_.test(t))r=o.parseColonTimeWithFrames_(i,t);else if(o.timeColonFormat_.test(t))r=o.parseTimeFromRegex_(o.timeColonFormat_,t);else if(o.timeColonFormatMilliseconds_.test(t))r=o.parseTimeFromRegex_(o.timeColonFormatMilliseconds_,t);else if(o.timeFramesFormat_.test(t))r=o.parseFramesTime_(i,t);else if(o.timeTickFormat_.test(t))r=o.parseTickTime_(i,t);else if(o.timeHMSFormat_.test(t))r=o.parseTimeFromRegex_(o.timeHMSFormat_,t);else if(t)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"Could not parse cue time range in TTML");return r},shaka.text.TtmlTextParser.parseFramesTime_=function(t,i){var r=shaka.text.TtmlTextParser.timeFramesFormat_.exec(i);return Number(r[1])/t.frameRate},shaka.text.TtmlTextParser.parseTickTime_=function(t,i){var r=shaka.text.TtmlTextParser.timeTickFormat_.exec(i);return Number(r[1])/t.tickRate},shaka.text.TtmlTextParser.parseColonTimeWithFrames_=function(t,i){var r=shaka.text.TtmlTextParser.timeColonFormatFrames_.exec(i),o=Number(r[1]),l=Number(r[2]),g=Number(r[3]),_=Number(r[4]);return(g+=(_+=(Number(r[5])||0)/t.subFrameRate)/t.frameRate)+60*l+3600*o},shaka.text.TtmlTextParser.parseTimeFromRegex_=function(t,i){var r=t.exec(i);return null==r||""==r[0]?null:(Number(r[4])||0)/1e3+(Number(r[3])||0)+60*(Number(r[2])||0)+3600*(Number(r[1])||0)},shaka.text.TtmlTextParser.getCellResolution_=function(t){if(!t)return null;var i=/^(\d+) (\d+)$/.exec(t);return i?{columns:t=parseInt(i[1],10),rows:i=parseInt(i[2],10)}:null},goog.exportSymbol("shaka.text.TtmlTextParser",shaka.text.TtmlTextParser),goog.exportProperty(shaka.text.TtmlTextParser.prototype,"parseMedia",shaka.text.TtmlTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.TtmlTextParser.prototype,"parseInit",shaka.text.TtmlTextParser.prototype.parseInit),shaka.text.TtmlTextParser.RateInfo_=function(t,i,r,o){this.frameRate=Number(t)||30,this.subFrameRate=Number(i)||1,this.tickRate=Number(o),0==this.tickRate&&(this.tickRate=t?this.frameRate*this.subFrameRate:1),r&&(t=/^(\d+) (\d+)$/g.exec(r))&&(this.frameRate*=Number(t[1])/Number(t[2]))},shaka.text.TtmlTextParser.percentValues_=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,shaka.text.TtmlTextParser.percentValue_=/^(\d{1,2}(?:\.\d+)?|100)%$/,shaka.text.TtmlTextParser.unitValues_=/^(\d+px|\d+em|\d*\.?\d+c)$/,shaka.text.TtmlTextParser.pixelValues_=/^(\d+)px (\d+)px$/,shaka.text.TtmlTextParser.timeColonFormatFrames_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,shaka.text.TtmlTextParser.timeColonFormat_=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,shaka.text.TtmlTextParser.timeColonFormatMilliseconds_=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,shaka.text.TtmlTextParser.timeFramesFormat_=/^(\d*(?:\.\d*)?)f$/,shaka.text.TtmlTextParser.timeTickFormat_=/^(\d*(?:\.\d*)?)t$/,shaka.text.TtmlTextParser.timeHMSFormat_=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,shaka.text.TtmlTextParser.textAlignToLineAlign_={left:shaka.text.Cue.lineAlign.START,center:shaka.text.Cue.lineAlign.CENTER,right:shaka.text.Cue.lineAlign.END,start:shaka.text.Cue.lineAlign.START,end:shaka.text.Cue.lineAlign.END},shaka.text.TtmlTextParser.textAlignToPositionAlign_={left:shaka.text.Cue.positionAlign.LEFT,center:shaka.text.Cue.positionAlign.CENTER,right:shaka.text.Cue.positionAlign.RIGHT},shaka.text.TtmlTextParser.parameterNs_="http://www.w3.org/ns/ttml#parameter",shaka.text.TtmlTextParser.styleNs_="http://www.w3.org/ns/ttml#styling",shaka.text.TtmlTextParser.styleEbuttsNs_="urn:ebu:tt:style",shaka.text.TtmlTextParser.smpteNsList_=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"],shaka.text.TextEngine.registerParser("application/ttml+xml",function(){return new shaka.text.TtmlTextParser}),shaka.text.Mp4TtmlParser=function(){this.parser_=new shaka.text.TtmlTextParser},shaka.text.Mp4TtmlParser.prototype.parseInit=function(t){var i=shaka.util.Mp4Parser,r=!1;if((new i).box("moov",i.children).box("trak",i.children).box("mdia",i.children).box("minf",i.children).box("stbl",i.children).fullBox("stsd",i.sampleDescription).box("stpp",function(o){r=!0,o.parser.stop()}).parse(t),!r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML)},shaka.text.Mp4TtmlParser.prototype.parseMedia=function(t,i){var r=this,o=shaka.util.Mp4Parser,l=!1,g=[];if((new o).box("mdat",o.allData(function(_){l=!0,g=g.concat(r.parser_.parseMedia(_,i))})).parse(t,!1),!l)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML);return g},goog.exportSymbol("shaka.text.Mp4TtmlParser",shaka.text.Mp4TtmlParser),goog.exportProperty(shaka.text.Mp4TtmlParser.prototype,"parseMedia",shaka.text.Mp4TtmlParser.prototype.parseMedia),goog.exportProperty(shaka.text.Mp4TtmlParser.prototype,"parseInit",shaka.text.Mp4TtmlParser.prototype.parseInit),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.ttml.im1t"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.TTML.im1t"',function(){return new shaka.text.Mp4TtmlParser}),shaka.text.VttTextParser=function(){},shaka.text.VttTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"VTT does not have init segments")},shaka.text.VttTextParser.prototype.parseMedia=function(t,i){var r=shaka.text.VttTextParser,o=shaka.util.StringUtils.fromUTF8(t);if(o=(o=o.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(o[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);var l=i.periodStart;if(o[0].includes("X-TIMESTAMP-MAP")){var g=o[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),_=o[0].match(/MPEGTS:(\d+)/m);if(g&&_){if(l=new shaka.util.TextParser(g[1]),null==(l=shaka.text.VttTextParser.parseTime_(l)))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);_=Number(_[1]);for(var v=shaka.text.VttTextParser.TS_ROLLOVER_/(g=shaka.text.VttTextParser.MPEG_TIMESCALE_),E=i.segmentStart;E>=v;)E-=v,_+=shaka.text.VttTextParser.TS_ROLLOVER_;l=i.periodStart+_/g-l}}for(_=[],v=(g=$jscomp.makeIterator(o[0].split("\n"))).next();!v.done;v=g.next())/^Region:/.test(v=v.value)&&(v=r.parseRegion_(v),_.push(v));for(r.addDefaultTextColor_(g=new Map),v=[],E=(o=$jscomp.makeIterator(o.slice(1))).next();!E.done;E=o.next())E=E.value.split("\n"),r.parseStyle_(E,g),(E=r.parseCue_(E,l,_,g))&&v.push(E);return v},shaka.text.VttTextParser.addDefaultTextColor_=function(t){for(var i=$jscomp.makeIterator(Object.entries(shaka.text.Cue.defaultTextColor)),r=i.next();!r.done;r=i.next()){var o=$jscomp.makeIterator(r.value);r=o.next().value,o=o.next().value;var l=new shaka.text.Cue(0,0,"");l.color=o,t.set(r,l)}for(r=(i=$jscomp.makeIterator(Object.entries(shaka.text.Cue.defaultTextBackgroundColor))).next();!r.done;r=i.next())r=(o=$jscomp.makeIterator(r.value)).next().value,o=o.next().value,(l=new shaka.text.Cue(0,0,"")).backgroundColor=o,t.set(r,l)},shaka.text.VttTextParser.parseRegion_=function(t){var i=shaka.text.VttTextParser;t=new shaka.util.TextParser(t);var r=new shaka.text.CueRegion;t.readWord(),t.skipWhitespace();for(var o=t.readWord();o;)i.parseRegionSetting_(r,o)||shaka.log.warning("VTT parser encountered an invalid VTTRegion setting: ",o," The setting will be ignored."),t.skipWhitespace(),o=t.readWord();return r},shaka.text.VttTextParser.parseStyle_=function(t,i){if((1!=t.length||t[0])&&!/^NOTE($|[ \t])/.test(t[0])&&"STYLE"==t[0]&&t[1].includes("::cue")){var r="global",o=t[1].match(/\((.*)\)/);if(o&&(r=o.pop()),o=t.slice(2,-1),t[1].includes("}")){var l=/\{(.*?)\}/.exec(t[1]);l&&(o=l[1].split(";"))}l=new shaka.text.Cue(0,0,"");for(var g=!1,_=0;_<o.length;_++){var v=/^\s*([^:]+):\s*(.*)/.exec(o[_]);if(v){var E=v[1].trim(),P=v[2].trim().replace(";","");switch(E){case"background-color":g=!0,l.backgroundColor=P;break;case"color":g=!0,l.color=P;break;case"font-family":g=!0,l.fontFamily=P;break;case"font-size":g=!0,l.fontSize=P;break;case"font-weight":700<=parseInt(P,10)&&(g=!0,l.fontWeight=shaka.text.Cue.fontWeight.BOLD);break;case"font-style":switch(P){case"normal":g=!0,l.fontStyle=shaka.text.Cue.fontStyle.NORMAL;break;case"italic":g=!0,l.fontStyle=shaka.text.Cue.fontStyle.ITALIC;break;case"oblique":g=!0,l.fontStyle=shaka.text.Cue.fontStyle.OBLIQUE}break;case"opacity":g=!0,l.opacity=parseFloat(P);break;case"white-space":g=!0,l.wrapLine="noWrap"!=P;break;default:shaka.log.warning("VTT parser encountered an unsupported style: ",v)}}}g&&i.set(r,l)}},shaka.text.VttTextParser.parseCue_=function(t,i,r,o){var l=shaka.text.VttTextParser;if(1==t.length&&!t[0]||/^NOTE($|[ \t])/.test(t[0])||"STYLE"==t[0])return null;var g=null;t[0].includes("--\x3e")||(g=t[0],t.splice(0,1));var _=new shaka.util.TextParser(t[0]),v=l.parseTime_(_),E=_.readRegex(/[ \t]+--\x3e[ \t]+/g),P=l.parseTime_(_);if(null==v||null==E||null==P)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"Could not parse cue time range in WebVTT");for(v+=i,P+=i,i=t.slice(1).join("\n").trim(),o.has("global")?((t=o.get("global").clone()).startTime=v,t.endTime=P,t.payload=""):t=new shaka.text.Cue(v,P,""),l.parseCueStyles(i,t,o),_.skipWhitespace(),o=_.readWord();o;)l.parseCueSetting(t,o,r)||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",o," The setting will be ignored."),_.skipWhitespace(),o=_.readWord();return null!=g&&(t.id=g),t},shaka.text.VttTextParser.parseCueStyles=function(t,i,r){var o=shaka.text.VttTextParser;0===r.size&&o.addDefaultTextColor_(r),t=o.replaceColorPayload_(t);var l=shaka.util.XmlUtils.parseXmlString("<span>"+t+"</span>","span");if(l){var g=[];if(1==(l=l.childNodes).length){var _=l[0];if(_.nodeType==Node.TEXT_NODE||_.nodeType==Node.CDATA_SECTION_NODE)return void(i.payload=t)}for(l=(t=$jscomp.makeIterator(l)).next();!l.done;l=t.next())o.generateCueFromElement_(l.value,i,g,r);i.nestedCues=g}else shaka.log.warning("The cue's markup could not be parsed: ",t),i.payload=t},shaka.text.VttTextParser.replaceColorPayload_=function(t){for(var i=[],r=-1,o="",l=0;l<t.length;l++)if("/"===t[l]){var g=t.indexOf(">",l);if(g<=l)return t;g=t.substring(l+1,g);var _=i.pop();if(_===g)o+="/"+g+">";else{if(!_.startsWith("c.")||"c"!==g)return t;o+="/"+_+">"}l+=g.length+1}else"<"===t[l]?r=l+1:">"===t[l]&&0<r&&(i.push(t.substr(r,l-r)),r=-1),o+=t[l];return o},shaka.text.VttTextParser.getOrDefault_=function(t,i){return t&&0<t.length?t:i},shaka.text.VttTextParser.mergeStyle_=function(t,i){if(i){var r=shaka.text.VttTextParser;t.backgroundColor=r.getOrDefault_(i.backgroundColor,t.backgroundColor),t.color=r.getOrDefault_(i.color,t.color),t.fontFamily=r.getOrDefault_(i.fontFamily,t.fontFamily),t.fontSize=r.getOrDefault_(i.fontSize,t.fontSize),t.fontWeight=i.fontWeight,t.fontStyle=i.fontStyle,t.opacity=i.opacity,t.wrapLine=i.wrapLine}},shaka.text.VttTextParser.generateCueFromElement_=function(t,i,r,o){var l=shaka.text.VttTextParser,g=i.clone();if(t.nodeType===Node.ELEMENT_NODE&&t.nodeName)for(var _=shaka.text.Cue.fontWeight.BOLD,v=shaka.text.Cue.fontStyle.ITALIC,E=shaka.text.Cue.textDecoration.UNDERLINE,P=t.nodeName.split(/[ .]+/),M=(P=$jscomp.makeIterator(P)).next();!M.done;M=P.next())switch(M=M.value,o.has(M)&&l.mergeStyle_(g,o.get(M)),M){case"b":g.fontWeight=_;break;case"i":g.fontStyle=v;break;case"u":g.textDecoration.push(E)}if(shaka.util.XmlUtils.isText(t))for(o=t.textContent.split("\n"),l=!0,t=(o=$jscomp.makeIterator(o)).next();!t.done;t=o.next())t=t.value,l||((l=i.clone()).lineBreak=!0,r.push(l)),0<t.length&&((l=g.clone()).payload=t,r.push(l)),l=!1;else for(t=(i=$jscomp.makeIterator(t.childNodes)).next();!t.done;t=i.next())l.generateCueFromElement_(t.value,g,r,o)},shaka.text.VttTextParser.parseCueSetting=function(t,i,r){var l,o=shaka.text.VttTextParser;if(l=/^align:(start|middle|center|end|left|right)$/.exec(i))o.setTextAlign_(t,l[1]);else if(l=/^vertical:(lr|rl)$/.exec(i))o.setVerticalWritingMode_(t,l[1]);else if(l=/^size:([\d.]+)%$/.exec(i))t.size=Number(l[1]);else if(l=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(i))t.position=Number(l[1]),l[2]&&o.setPositionAlign_(t,l[2]);else{if(!(l=/^region:(.*)$/.exec(i)))return o.parsedLineValueAndInterpretation_(t,i);(i=o.getRegionById_(r,l[1]))&&(t.region=i)}return!0},shaka.text.VttTextParser.getRegionById_=function(t,i){var r=t.filter(function(o){return o.id==i});return r.length?(goog.asserts.assert(1==r.length,"VTTRegion ids should be unique!"),r[0]):(shaka.log.warning("VTT parser could not find a region with id: ",i," The region will be ignored."),null)},shaka.text.VttTextParser.parseRegionSetting_=function(t,i){var r;if(r=/^id=(.*)$/.exec(i))t.id=r[1];else if(r=/^width=(\d{1,2}|100)%$/.exec(i))t.width=Number(r[1]);else if(r=/^lines=(\d+)$/.exec(i))t.height=Number(r[1]),t.heightUnits=shaka.text.CueRegion.units.LINES;else if(r=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(i))t.regionAnchorX=Number(r[1]),t.regionAnchorY=Number(r[2]);else if(r=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(i))t.viewportAnchorX=Number(r[1]),t.viewportAnchorY=Number(r[2]);else{if(!/^scroll=up$/.exec(i))return!1;t.scroll=shaka.text.CueRegion.scrollMode.UP}return!0},shaka.text.VttTextParser.setTextAlign_=function(t,i){var r=shaka.text.Cue;"middle"==i?t.textAlign=r.textAlign.CENTER:(goog.asserts.assert(i.toUpperCase()in r.textAlign,i.toUpperCase()+" Should be in Cue.textAlign values!"),t.textAlign=r.textAlign[i.toUpperCase()])},shaka.text.VttTextParser.setPositionAlign_=function(t,i){var r=shaka.text.Cue;t.positionAlign="line-left"==i||"start"==i?r.positionAlign.LEFT:"line-right"==i||"end"==i?r.positionAlign.RIGHT:r.positionAlign.CENTER},shaka.text.VttTextParser.setVerticalWritingMode_=function(t,i){var r=shaka.text.Cue;t.writingMode="lr"==i?r.writingMode.VERTICAL_LEFT_TO_RIGHT:r.writingMode.VERTICAL_RIGHT_TO_LEFT},shaka.text.VttTextParser.parsedLineValueAndInterpretation_=function(t,i){var o,r=shaka.text.Cue;if(o=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(i))t.lineInterpretation=r.lineInterpretation.PERCENTAGE,t.line=Number(o[1]),o[2]&&(goog.asserts.assert(o[2].toUpperCase()in r.lineAlign,o[2].toUpperCase()+" Should be in Cue.lineAlign values!"),t.lineAlign=r.lineAlign[o[2].toUpperCase()]);else{if(!(o=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(i)))return!1;t.lineInterpretation=r.lineInterpretation.LINE_NUMBER,t.line=Number(o[1]),o[2]&&(goog.asserts.assert(o[2].toUpperCase()in r.lineAlign,o[2].toUpperCase()+" Should be in Cue.lineAlign values!"),t.lineAlign=r.lineAlign[o[2].toUpperCase()])}return!0},shaka.text.VttTextParser.parseTime_=function(t){if(null==(t=t.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g)))return null;var i=Number(t[2]),r=Number(t[3]);return 59<i||59<r?null:Number(t[4])/1e3+r+60*i+3600*(Number(t[1])||0)},goog.exportSymbol("shaka.text.VttTextParser",shaka.text.VttTextParser),goog.exportProperty(shaka.text.VttTextParser.prototype,"parseMedia",shaka.text.VttTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.VttTextParser.prototype,"parseInit",shaka.text.VttTextParser.prototype.parseInit),shaka.text.VttTextParser.MPEG_TIMESCALE_=9e4,shaka.text.VttTextParser.TS_ROLLOVER_=8589934592,shaka.text.TextEngine.registerParser("text/vtt",function(){return new shaka.text.VttTextParser}),shaka.text.TextEngine.registerParser('text/vtt; codecs="vtt"',function(){return new shaka.text.VttTextParser}),shaka.text.TextEngine.registerParser('text/vtt; codecs="wvtt"',function(){return new shaka.text.VttTextParser}),shaka.text.Mp4VttParser=function(){this.timescale_=null},shaka.text.Mp4VttParser.prototype.parseInit=function(t){var i=this,r=shaka.util.Mp4Parser,o=!1;if((new r).box("moov",r.children).box("trak",r.children).box("mdia",r.children).fullBox("mdhd",function(l){goog.asserts.assert(0==l.version||1==l.version,"MDHD version can only be 0 or 1"),l=shaka.util.Mp4BoxParsers.parseMDHD(l.reader,l.version),i.timescale_=l.timescale}).box("minf",r.children).box("stbl",r.children).fullBox("stsd",r.sampleDescription).box("wvtt",function(l){o=!0}).parse(t),!this.timescale_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);if(!o)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT)},shaka.text.Mp4VttParser.prototype.parseMedia=function(t,i){if(!this.timescale_)throw shaka.log.error("No init segment for MP4+VTT!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);var g,r=shaka.util.Mp4Parser,o=0,l=[],_=[],v=!1,E=!1,P=!1,M=null;if((new r).box("moof",r.children).box("traf",r.children).fullBox("tfdt",function(te){v=!0,goog.asserts.assert(0==te.version||1==te.version,"TFDT version can only be 0 or 1"),o=shaka.util.Mp4BoxParsers.parseTFDT(te.reader,te.version).baseMediaDecodeTime}).fullBox("tfhd",function(te){goog.asserts.assert(null!=te.flags,"A TFHD box should have a valid flags value"),M=shaka.util.Mp4BoxParsers.parseTFHD(te.reader,te.flags).defaultSampleDuration}).fullBox("trun",function(te){E=!0,goog.asserts.assert(null!=te.version,"A TRUN box should have a valid version value"),goog.asserts.assert(null!=te.flags,"A TRUN box should have a valid flags value"),l=shaka.util.Mp4BoxParsers.parseTRUN(te.reader,te.version,te.flags).sampleData}).box("mdat",r.allData(function(te){goog.asserts.assert(!P,"VTT cues in mp4 with multiple MDAT are not currently supported"),P=!0,g=te})).parse(t,!1),!P&&!v&&!E)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);r=o;for(var R=new shaka.util.DataViewReader(g,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),U=$jscomp.makeIterator(l),$=U.next();!$.done;$=U.next()){var G=($=$.value).sampleDuration||M,z=$.sampleCompositionTimeOffset?o+$.sampleCompositionTimeOffset:r;r=z+(G||0);var Z=0;do{var Y=R.readUint32();Z+=Y;var se=R.readUint32(),Q=null;"vttc"==(se=shaka.util.Mp4Parser.typeToString(se))?8<Y&&(Q=R.readBytes(Y-8)):("vtte"!=se&&shaka.log.error("Unknown box "+se+"! Skipping!"),R.skip(Y-8)),G?Q&&(goog.asserts.assert(null!=this.timescale_,"Timescale should not be null!"),Y=shaka.text.Mp4VttParser.parseVTTC_(Q,i.periodStart+z/this.timescale_,i.periodStart+r/this.timescale_),_.push(Y)):shaka.log.error("WVTT sample duration unknown, and no default found!"),goog.asserts.assert(!$.sampleSize||Z<=$.sampleSize,"The samples do not fit evenly into the sample sizes given in the TRUN box!")}while($.sampleSize&&Z<$.sampleSize)}return goog.asserts.assert(!R.hasMoreData(),"MDAT which contain VTT cues and non-VTT data are not currently supported!"),_.filter(shaka.util.Functional.isNotNull)},shaka.text.Mp4VttParser.parseVTTC_=function(t,i,r){var o,l,g;return(new shaka.util.Mp4Parser).box("payl",shaka.util.Mp4Parser.allData(function(_){o=shaka.util.StringUtils.fromUTF8(_)})).box("iden",shaka.util.Mp4Parser.allData(function(_){l=shaka.util.StringUtils.fromUTF8(_)})).box("sttg",shaka.util.Mp4Parser.allData(function(_){g=shaka.util.StringUtils.fromUTF8(_)})).parse(t),o?shaka.text.Mp4VttParser.assembleCue_(o,l,g,i,r):null},shaka.text.Mp4VttParser.assembleCue_=function(t,i,r,o,l){if(o=new shaka.text.Cue(o,l,""),shaka.text.VttTextParser.parseCueStyles(t,o,l=new Map),i&&(o.id=i),r)for(i=(t=new shaka.util.TextParser(r)).readWord();i;)shaka.text.VttTextParser.parseCueSetting(o,i,[])||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",i," The setting will be ignored."),t.skipWhitespace(),i=t.readWord();return o},goog.exportSymbol("shaka.text.Mp4VttParser",shaka.text.Mp4VttParser),goog.exportProperty(shaka.text.Mp4VttParser.prototype,"parseMedia",shaka.text.Mp4VttParser.prototype.parseMedia),goog.exportProperty(shaka.text.Mp4VttParser.prototype,"parseInit",shaka.text.Mp4VttParser.prototype.parseInit),shaka.text.TextEngine.registerParser('application/mp4; codecs="wvtt"',function(){return new shaka.text.Mp4VttParser}),shaka.text.SbvTextParser=function(){},shaka.text.SbvTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"SubViewer does not have init segments")},shaka.text.SbvTextParser.prototype.parseMedia=function(t,i){var r=shaka.text.SbvTextParser,o=shaka.util.StringUtils.fromUTF8(t).replace(/\r+/g,""),l=[];if(""==(o=o.trim()))return l;o=o.split("\n\n");for(var g=(o=$jscomp.makeIterator(o)).next();!g.done;g=o.next()){var _=g.value.split("\n"),v=new shaka.util.TextParser(_[0]);g=r.parseTime_(v);var E=v.readRegex(/,/g);if(v=r.parseTime_(v),null==g||null==E||null==v)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE,"Could not parse cue time range in SubViewer");_=_.slice(1).join("\n").trim(),g=new shaka.text.Cue(g,v,_),l.push(g)}return l},shaka.text.SbvTextParser.parseTime_=function(t){if(null==(t=t.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g)))return null;var i=Number(t[2]),r=Number(t[3]);return 59<i||59<r?null:Number(t[4])/1e3+r+60*i+3600*(Number(t[1])||0)},goog.exportSymbol("shaka.text.SbvTextParser",shaka.text.SbvTextParser),goog.exportProperty(shaka.text.SbvTextParser.prototype,"parseMedia",shaka.text.SbvTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.SbvTextParser.prototype,"parseInit",shaka.text.SbvTextParser.prototype.parseInit),shaka.text.TextEngine.registerParser("text/x-subviewer",function(){return new shaka.text.SbvTextParser}),shaka.text.SrtTextParser=function(){this.parser_=new shaka.text.VttTextParser},shaka.text.SrtTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"SRT does not have init segments")},shaka.text.SrtTextParser.prototype.parseMedia=function(t,i){var r=shaka.text.SrtTextParser,o=shaka.util.BufferUtils,l=shaka.util.StringUtils,g=l.fromUTF8(t);return r=r.srt2webvtt(g),o=o.toUint8(l.toUTF8(r)),this.parser_.parseMedia(o,i)},shaka.text.SrtTextParser.srt2webvtt=function(t){var i=shaka.text.SrtTextParser,r="WEBVTT\n\n";if(""==t)return r;t=(t=(t=t.replace(/\r+/g,"")).trim()).split("\n\n");for(var o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next())r+=i.convertSrtCue_(o.value);return r},shaka.text.SrtTextParser.convertSrtCue_=function(t){return(t=t.split(/\n/))[0].match(/\d+/)&&t.shift(),t[0]=t[0].replace(/,/g,"."),t.join("\n")+"\n\n"},goog.exportSymbol("shaka.text.SrtTextParser",shaka.text.SrtTextParser),goog.exportProperty(shaka.text.SrtTextParser,"srt2webvtt",shaka.text.SrtTextParser.srt2webvtt),goog.exportProperty(shaka.text.SrtTextParser.prototype,"parseMedia",shaka.text.SrtTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.SrtTextParser.prototype,"parseInit",shaka.text.SrtTextParser.prototype.parseInit),shaka.text.TextEngine.registerParser("text/srt",function(){return new shaka.text.SrtTextParser}),shaka.text.SsaTextParser=function(){},shaka.text.SsaTextParser.prototype.parseInit=function(t){goog.asserts.assert(!1,"SSA does not have init segments")},shaka.text.SsaTextParser.prototype.parseMedia=function(t,i){for(var r=shaka.text.SsaTextParser,o="",l="",g=shaka.util.StringUtils.fromUTF8(t).split(/\r?\n\s*\r?\n/),_=(g=$jscomp.makeIterator(g)).next();!_.done;_=g.next()){var v=r.ssaContent_.exec(_=_.value);if(v){var E=v[1];if(v=v[2],"V4 Styles"==E||"V4+ Styles"==E){o=v;continue}if("Events"==E){l=v;continue}}shaka.log.warning("SsaTextParser parser encountered an unknown part.",_)}for(g=[],_=null,o=o.split(/\r?\n/),v=(o=$jscomp.makeIterator(o)).next();!v.done;v=o.next())if(!/^\s*;/.test(E=v.value)&&(v=r.lineParts_.exec(E)))if(E=v[1].trim(),v=v[2].trim(),"Format"==E)_=v.split(r.valuesFormat_);else if("Style"==E){E=v.split(r.valuesFormat_),v={};for(var P=0;P<_.length&&P<E.length;P++)v[_[P]]=E[P];g.push(v)}for(_=[],o=null,E=l.split(/\r?\n/),l={},v=(E=$jscomp.makeIterator(E)).next();!v.done;l={$jscomp$loop$prop$styleName$667:l.$jscomp$loop$prop$styleName$667},v=E.next())if(!/^\s*;/.test(v=v.value)&&(P=r.lineParts_.exec(v)))if(v=P[1].trim(),P=P[2].trim(),"Format"==v)o=P.split(r.valuesFormat_);else if("Dialogue"==v){P=P.split(r.valuesFormat_),v={};for(var M=0;M<o.length&&M<P.length;M++)v[o[M]]=P[M];M=r.parseTime_(v.Start);var R=r.parseTime_(v.End);P=P.slice(o.length-1).join(",").replace(/\\N/g,"\n").replace(/\{[^}]+\}/g,""),P=new shaka.text.Cue(M,R,P),l.$jscomp$loop$prop$styleName$667=v.Style,(v=g.find(function(U){return function($){return $.Name==U.$jscomp$loop$prop$styleName$667}}(l)))&&r.addStyle_(P,v),_.push(P)}return _},shaka.text.SsaTextParser.addStyle_=function(t,i){var r=shaka.text.Cue,o=shaka.text.SsaTextParser,l=i.Fontname;if(l&&(t.fontFamily=l),(l=i.Fontsize)&&(t.fontSize=l+"px"),(l=i.PrimaryColour)&&(l=o.parseSsaColor_(l))&&(t.color=l),(l=i.BackColour)&&(o=o.parseSsaColor_(l))&&(t.backgroundColor=o),i.Bold&&(t.fontWeight=r.fontWeight.BOLD),i.Italic&&(t.fontStyle=r.fontStyle.ITALIC),i.Underline&&t.textDecoration.push(r.textDecoration.UNDERLINE),(o=i.Spacing)&&(t.letterSpacing=o+"px"),o=i.Alignment)switch(parseInt(o,10)){case 1:t.displayAlign=r.displayAlign.AFTER,t.textAlign=r.textAlign.START;break;case 2:t.displayAlign=r.displayAlign.AFTER,t.textAlign=r.textAlign.CENTER;break;case 3:t.displayAlign=r.displayAlign.AFTER,t.textAlign=r.textAlign.END;break;case 5:t.displayAlign=r.displayAlign.BEFORE,t.textAlign=r.textAlign.START;break;case 6:t.displayAlign=r.displayAlign.BEFORE,t.textAlign=r.textAlign.CENTER;break;case 7:t.displayAlign=r.displayAlign.BEFORE,t.textAlign=r.textAlign.END;break;case 9:t.displayAlign=r.displayAlign.CENTER,t.textAlign=r.textAlign.START;break;case 10:t.displayAlign=r.displayAlign.CENTER,t.textAlign=r.textAlign.CENTER;break;case 11:t.displayAlign=r.displayAlign.CENTER,t.textAlign=r.textAlign.END}(r=i.AlphaLevel)&&(t.opacity=parseFloat(r))},shaka.text.SsaTextParser.parseSsaColor_=function(t){return 0<=(t=parseInt(t.replace("&H",""),16))?"rgba("+(255&t)+","+(t>>8&255)+","+(t>>16&255)+","+(t>>24&255^255)/255+")":null},shaka.text.SsaTextParser.parseTime_=function(t){var i=shaka.text.SsaTextParser.timeFormat_.exec(t);return 3600*(t=i[1]?parseInt(i[1].replace(":",""),10):0)+60*parseInt(i[2],10)+parseFloat(i[3])},goog.exportSymbol("shaka.text.SsaTextParser",shaka.text.SsaTextParser),goog.exportProperty(shaka.text.SsaTextParser.prototype,"parseMedia",shaka.text.SsaTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.SsaTextParser.prototype,"parseInit",shaka.text.SsaTextParser.prototype.parseInit),shaka.text.SsaTextParser.ssaContent_=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,shaka.text.SsaTextParser.lineParts_=/^\s*([^:]+):\s*(.*)/,shaka.text.SsaTextParser.valuesFormat_=/\s*,\s*/,shaka.text.SsaTextParser.timeFormat_=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/,shaka.text.TextEngine.registerParser("text/x-ssa",function(){return new shaka.text.SsaTextParser});var EmeEncryptionSchemePolyfill=function(){};EmeEncryptionSchemePolyfill.install=function(){EmeEncryptionSchemePolyfill.originalRMKSA_?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(EmeEncryptionSchemePolyfill.originalRMKSA_=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.probeRMKSA_):console.debug("EmeEncryptionSchemePolyfill: EME not found")},EmeEncryptionSchemePolyfill.probeRMKSA_=function(t,i){var o,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return 1==l.nextAddress?(console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),l.yield(EmeEncryptionSchemePolyfill.originalRMKSA_.call(r,t,i),2)):hasEncryptionScheme(o=l.yieldResult)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.originalRMKSA_,l.return(o)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.polyfillRMKSA_,l.return(EmeEncryptionSchemePolyfill.polyfillRMKSA_.call(r,t,i)))})},EmeEncryptionSchemePolyfill.polyfillRMKSA_=function(t,i){var o,l,g,_,v,E,P,M,R,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function($){if(1==$.nextAddress){for(console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),o=guessSupportedScheme(t),l=[],g=$jscomp.makeIterator(i),_=g.next();!_.done;_=g.next())E=EmeEncryptionSchemePolyfill.filterCapabilities_((v=_.value).videoCapabilities,o),P=EmeEncryptionSchemePolyfill.filterCapabilities_(v.audioCapabilities,o),v.videoCapabilities&&v.videoCapabilities.length&&!E.length||v.audioCapabilities&&v.audioCapabilities.length&&!P.length||((M=Object.assign({},v)).videoCapabilities=E,M.audioCapabilities=P,l.push(M));if(!l.length)throw(R=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",R.code=DOMException.NOT_SUPPORTED_ERR,R;return $.yield(EmeEncryptionSchemePolyfill.originalRMKSA_.call(r,t,l),2)}return $.return(new EmeEncryptionSchemePolyfillMediaKeySystemAccess($.yieldResult,o))})},EmeEncryptionSchemePolyfill.filterCapabilities_=function(t,i){return t&&t.filter(function(r){return!r.encryptionScheme||r.encryptionScheme==i})},goog.exportSymbol("EmeEncryptionSchemePolyfill",EmeEncryptionSchemePolyfill),goog.exportProperty(EmeEncryptionSchemePolyfill,"install",EmeEncryptionSchemePolyfill.install);var McEncryptionSchemePolyfill=function(){};McEncryptionSchemePolyfill.install=function(){McEncryptionSchemePolyfill.originalDecodingInfo_?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(McEncryptionSchemePolyfill.originalDecodingInfo_=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.probeDecodingInfo_):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")},McEncryptionSchemePolyfill.probeDecodingInfo_=function(t){var r,o,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){return 1==l.nextAddress?(console.assert(i==navigator.mediaCapabilities,'bad "this" for decodingInfo'),l.yield(McEncryptionSchemePolyfill.originalDecodingInfo_.call(i,t),2)):(r=l.yieldResult,t.keySystemConfiguration?(o=r.keySystemAccess)&&hasEncryptionScheme(o)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.originalDecodingInfo_,l.return(r)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.polyfillDecodingInfo_,l.return(McEncryptionSchemePolyfill.polyfillDecodingInfo_.call(i,t))):l.return(r))})},McEncryptionSchemePolyfill.polyfillDecodingInfo_=function(t){var r,o,g,_,v,E,P,M,i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){switch(R.nextAddress){case 1:return console.assert(i==navigator.mediaCapabilities,'bad "this" for decodingInfo'),r=null,t.keySystemConfiguration&&(g=(o=t.keySystemConfiguration).audio&&o.audio.encryptionScheme,_=o.video&&o.video.encryptionScheme,r=guessSupportedScheme(o.keySystem),v={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:t},g&&g!=r||_&&_!=r)?R.return(v):R.yield(McEncryptionSchemePolyfill.originalDecodingInfo_.call(i,t),2);case 2:if((E=R.yieldResult).keySystemAccess){E.keySystemAccess=new EmeEncryptionSchemePolyfillMediaKeySystemAccess(E.keySystemAccess,r),R.jumpTo(3);break}if(!t.keySystemConfiguration){R.jumpTo(3);break}return P=McEncryptionSchemePolyfill.convertToMediaKeySystemConfig_(t),M=E,R.yield(navigator.requestMediaKeySystemAccess(t.keySystemConfiguration.keySystem,[P]),5);case 5:M.keySystemAccess=R.yieldResult;case 3:return R.return(E)}})},McEncryptionSchemePolyfill.convertToMediaKeySystemConfig_=function(t){var i=t.keySystemConfiguration,r=[],o=[];return i.audio&&r.push({robustness:i.audio.robustness||"",contentType:t.audio.contentType}),i.video&&o.push({robustness:i.video.robustness||"",contentType:t.video.contentType}),t={initDataTypes:i.initDataType?[i.initDataType]:[],distinctiveIdentifier:i.distinctiveIdentifier,persistentState:i.persistentState,sessionTypes:i.sessionTypes},r.length&&(t.audioCapabilities=r),o.length&&(t.videoCapabilities=o),t},goog.exportSymbol("McEncryptionSchemePolyfill",McEncryptionSchemePolyfill),goog.exportProperty(McEncryptionSchemePolyfill,"install",McEncryptionSchemePolyfill.install);var EmeEncryptionSchemePolyfillMediaKeySystemAccess=function(t,i){this.mksa_=t,this.scheme_=i,this.keySystem=t.keySystem};function guessSupportedScheme(t){return t.startsWith("com.widevine")||t.startsWith("com.microsoft")||t.startsWith("com.adobe")||t.startsWith("org.w3")?"cenc":t.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",t,"Please contribute!"),null)}function hasEncryptionScheme(t){return!(!(t=(t=t.getConfiguration()).videoCapabilities&&t.videoCapabilities[0]||t.audioCapabilities&&t.audioCapabilities[0])||void 0===t.encryptionScheme)}EmeEncryptionSchemePolyfillMediaKeySystemAccess.prototype.getConfiguration=function(){var t=this.mksa_.getConfiguration();if(t.videoCapabilities)for(var i=$jscomp.makeIterator(t.videoCapabilities),r=i.next();!r.done;r=i.next())r.value.encryptionScheme=this.scheme_;if(t.audioCapabilities)for(r=(i=$jscomp.makeIterator(t.audioCapabilities)).next();!r.done;r=i.next())r.value.encryptionScheme=this.scheme_;return t},EmeEncryptionSchemePolyfillMediaKeySystemAccess.prototype.createMediaKeys=function(){return this.mksa_.createMediaKeys()};var EncryptionSchemePolyfills=function(){};EncryptionSchemePolyfills.install=function(){EmeEncryptionSchemePolyfill.install(),McEncryptionSchemePolyfill.install()},goog.exportSymbol("EncryptionSchemePolyfills",EncryptionSchemePolyfills),goog.exportProperty(EncryptionSchemePolyfills,"install",EncryptionSchemePolyfills.install),void 0!==module&&module.exports&&(module.exports=EncryptionSchemePolyfills);for(var mozilla={LanguageMapping:{ach:{nativeName:"Lwo",englishName:"Acholi"},ady:{nativeName:"\u0410\u0434\u044b\u0433\u044d\u0431\u0437\u044d",englishName:"Adyghe"},af:{nativeName:"Afrikaans",englishName:"Afrikaans"},"af-NA":{nativeName:"Afrikaans (Namibia)",englishName:"Afrikaans (Namibia)"},"af-ZA":{nativeName:"Afrikaans (South Africa)",englishName:"Afrikaans (South Africa)"},ak:{nativeName:"T\u0255\u0265i",englishName:"Akan"},ar:{nativeName:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",englishName:"Arabic"},"ar-AR":{nativeName:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",englishName:"Arabic"},"ar-MA":{nativeName:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",englishName:"Arabic (Morocco)"},"ar-SA":{nativeName:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629 (\u0627\u0644\u0633\u0639\u0648\u062f\u064a\u0629)",englishName:"Arabic (Saudi Arabia)"},"ay-BO":{nativeName:"Aymar aru",englishName:"Aymara"},az:{nativeName:"Az\u0259rbaycan dili",englishName:"Azerbaijani"},"az-AZ":{nativeName:"Az\u0259rbaycan dili",englishName:"Azerbaijani"},"be-BY":{nativeName:"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0430\u044f",englishName:"Belarusian"},bg:{nativeName:"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",englishName:"Bulgarian"},"bg-BG":{nativeName:"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",englishName:"Bulgarian"},bn:{nativeName:"\u09ac\u09be\u0982\u09b2\u09be",englishName:"Bengali"},"bn-IN":{nativeName:"\u09ac\u09be\u0982\u09b2\u09be (\u09ad\u09be\u09b0\u09a4)",englishName:"Bengali (India)"},"bn-BD":{nativeName:"\u09ac\u09be\u0982\u09b2\u09be(\u09ac\u09be\u0982\u09b2\u09be\u09a6\u09c7\u09b6)",englishName:"Bengali (Bangladesh)"},"bs-BA":{nativeName:"Bosanski",englishName:"Bosnian"},ca:{nativeName:"Catal\xe0",englishName:"Catalan"},"ca-ES":{nativeName:"Catal\xe0",englishName:"Catalan"},cak:{nativeName:"Maya Kaqchikel",englishName:"Kaqchikel"},"ck-US":{nativeName:"\u13e3\u13b3\u13a9 (tsalagi)",englishName:"Cherokee"},cs:{nativeName:"\u010ce\u0161tina",englishName:"Czech"},"cs-CZ":{nativeName:"\u010ce\u0161tina",englishName:"Czech"},cy:{nativeName:"Cymraeg",englishName:"Welsh"},"cy-GB":{nativeName:"Cymraeg",englishName:"Welsh"},da:{nativeName:"Dansk",englishName:"Danish"},"da-DK":{nativeName:"Dansk",englishName:"Danish"},de:{nativeName:"Deutsch",englishName:"German"},"de-AT":{nativeName:"Deutsch (\xd6sterreich)",englishName:"German (Austria)"},"de-DE":{nativeName:"Deutsch (Deutschland)",englishName:"German (Germany)"},"de-CH":{nativeName:"Deutsch (Schweiz)",englishName:"German (Switzerland)"},dsb:{nativeName:"Dolnoserb\u0161\u0107ina",englishName:"Lower Sorbian"},el:{nativeName:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",englishName:"Greek"},"el-GR":{nativeName:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",englishName:"Greek (Greece)"},en:{nativeName:"English",englishName:"English"},"en-GB":{nativeName:"English (UK)",englishName:"English (UK)"},"en-AU":{nativeName:"English (Australia)",englishName:"English (Australia)"},"en-CA":{nativeName:"English (Canada)",englishName:"English (Canada)"},"en-IE":{nativeName:"English (Ireland)",englishName:"English (Ireland)"},"en-IN":{nativeName:"English (India)",englishName:"English (India)"},"en-PI":{nativeName:"English (Pirate)",englishName:"English (Pirate)"},"en-UD":{nativeName:"English (Upside Down)",englishName:"English (Upside Down)"},"en-US":{nativeName:"English (US)",englishName:"English (US)"},"en-ZA":{nativeName:"English (South Africa)",englishName:"English (South Africa)"},"en@pirate":{nativeName:"English (Pirate)",englishName:"English (Pirate)"},eo:{nativeName:"Esperanto",englishName:"Esperanto"},"eo-EO":{nativeName:"Esperanto",englishName:"Esperanto"},es:{nativeName:"Espa\xf1ol",englishName:"Spanish"},"es-AR":{nativeName:"Espa\xf1ol (Argentine)",englishName:"Spanish (Argentina)"},"es-419":{nativeName:"Espa\xf1ol (Latinoam\xe9rica)",englishName:"Spanish (Latin America)"},"es-CL":{nativeName:"Espa\xf1ol (Chile)",englishName:"Spanish (Chile)"},"es-CO":{nativeName:"Espa\xf1ol (Colombia)",englishName:"Spanish (Colombia)"},"es-EC":{nativeName:"Espa\xf1ol (Ecuador)",englishName:"Spanish (Ecuador)"},"es-ES":{nativeName:"Espa\xf1ol (Espa\xf1a)",englishName:"Spanish (Spain)"},"es-LA":{nativeName:"Espa\xf1ol (Latinoam\xe9rica)",englishName:"Spanish (Latin America)"},"es-NI":{nativeName:"Espa\xf1ol (Nicaragua)",englishName:"Spanish (Nicaragua)"},"es-MX":{nativeName:"Espa\xf1ol (M\xe9xico)",englishName:"Spanish (Mexico)"},"es-US":{nativeName:"Espa\xf1ol (Estados Unidos)",englishName:"Spanish (United States)"},"es-VE":{nativeName:"Espa\xf1ol (Venezuela)",englishName:"Spanish (Venezuela)"},et:{nativeName:"eesti keel",englishName:"Estonian"},"et-EE":{nativeName:"Eesti (Estonia)",englishName:"Estonian (Estonia)"},eu:{nativeName:"Euskara",englishName:"Basque"},"eu-ES":{nativeName:"Euskara",englishName:"Basque"},fa:{nativeName:"\u0641\u0627\u0631\u0633\u06cc",englishName:"Persian"},"fa-IR":{nativeName:"\u0641\u0627\u0631\u0633\u06cc",englishName:"Persian"},"fb-LT":{nativeName:"Leet Speak",englishName:"Leet"},ff:{nativeName:"Fulah",englishName:"Fulah"},fi:{nativeName:"Suomi",englishName:"Finnish"},"fi-FI":{nativeName:"Suomi",englishName:"Finnish"},"fo-FO":{nativeName:"F\xf8royskt",englishName:"Faroese"},fr:{nativeName:"Fran\xe7ais",englishName:"French"},"fr-CA":{nativeName:"Fran\xe7ais (Canada)",englishName:"French (Canada)"},"fr-FR":{nativeName:"Fran\xe7ais (France)",englishName:"French (France)"},"fr-BE":{nativeName:"Fran\xe7ais (Belgique)",englishName:"French (Belgium)"},"fr-CH":{nativeName:"Fran\xe7ais (Suisse)",englishName:"French (Switzerland)"},"fy-NL":{nativeName:"Frysk",englishName:"Frisian (West)"},ga:{nativeName:"Gaeilge",englishName:"Irish"},"ga-IE":{nativeName:"Gaeilge (Gaelic)",englishName:"Irish (Gaelic)"},gl:{nativeName:"Galego",englishName:"Galician"},"gl-ES":{nativeName:"Galego",englishName:"Galician"},"gn-PY":{nativeName:"Ava\xf1e'\u1ebd",englishName:"Guarani"},"gu-IN":{nativeName:"\u0a97\u0ac1\u0a9c\u0ab0\u0abe\u0aa4\u0ac0",englishName:"Gujarati"},"gx-GR":{nativeName:"\u1f19\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ae \u1f00\u03c1\u03c7\u03b1\u03af\u03b1",englishName:"Classical Greek"},he:{nativeName:"\u05e2\u05d1\u05e8\u05d9\u05ea\u200f",englishName:"Hebrew"},"he-IL":{nativeName:"\u05e2\u05d1\u05e8\u05d9\u05ea\u200f",englishName:"Hebrew"},hi:{nativeName:"\u0939\u093f\u0928\u094d\u0926\u0940",englishName:"Hindi"},"hi-IN":{nativeName:"\u0939\u093f\u0928\u094d\u0926\u0940",englishName:"Hindi"},hr:{nativeName:"Hrvatski",englishName:"Croatian"},"hr-HR":{nativeName:"Hrvatski",englishName:"Croatian"},hsb:{nativeName:"Hornjoserb\u0161\u0107ina",englishName:"Upper Sorbian"},ht:{nativeName:"Krey\xf2l",englishName:"Haitian Creole"},hu:{nativeName:"Magyar",englishName:"Hungarian"},"hu-HU":{nativeName:"Magyar",englishName:"Hungarian"},"hy-AM":{nativeName:"\u0540\u0561\u0575\u0565\u0580\u0565\u0576",englishName:"Armenian"},id:{nativeName:"Bahasa Indonesia",englishName:"Indonesian"},"id-ID":{nativeName:"Bahasa Indonesia",englishName:"Indonesian"},is:{nativeName:"\xcdslenska",englishName:"Icelandic"},"is-IS":{nativeName:"\xcdslenska (Iceland)",englishName:"Icelandic (Iceland)"},it:{nativeName:"Italiano",englishName:"Italian"},"it-IT":{nativeName:"Italiano",englishName:"Italian"},ja:{nativeName:"\u65e5\u672c\u8a9e",englishName:"Japanese"},"ja-JP":{nativeName:"\u65e5\u672c\u8a9e",englishName:"Japanese"},"jv-ID":{nativeName:"Basa Jawa",englishName:"Javanese"},"ka-GE":{nativeName:"\u10e5\u10d0\u10e0\u10d7\u10e3\u10da\u10d8",englishName:"Georgian"},"kk-KZ":{nativeName:"\u049a\u0430\u0437\u0430\u049b\u0448\u0430",englishName:"Kazakh"},km:{nativeName:"\u1797\u17b6\u179f\u17b6\u1781\u17d2\u1798\u17c2\u179a",englishName:"Khmer"},"km-KH":{nativeName:"\u1797\u17b6\u179f\u17b6\u1781\u17d2\u1798\u17c2\u179a",englishName:"Khmer"},kab:{nativeName:"Taqbaylit",englishName:"Kabyle"},kn:{nativeName:"\u0c95\u0ca8\u0ccd\u0ca8\u0ca1",englishName:"Kannada"},"kn-IN":{nativeName:"\u0c95\u0ca8\u0ccd\u0ca8\u0ca1 (India)",englishName:"Kannada (India)"},ko:{nativeName:"\ud55c\uad6d\uc5b4",englishName:"Korean"},"ko-KR":{nativeName:"\ud55c\uad6d\uc5b4 (\u97e9\u56fd)",englishName:"Korean (Korea)"},ku:{nativeName:"Kurd\xee",englishName:"Kurdish"},"ku-TR":{nativeName:"Kurd\xee",englishName:"Kurdish"},la:{nativeName:"Latin",englishName:"Latin"},"la-VA":{nativeName:"Latin",englishName:"Latin"},lb:{nativeName:"L\xebtzebuergesch",englishName:"Luxembourgish"},"li-NL":{nativeName:"L\xe8mb\xf6rgs",englishName:"Limburgish"},lt:{nativeName:"Lietuvi\u0173",englishName:"Lithuanian"},"lt-LT":{nativeName:"Lietuvi\u0173",englishName:"Lithuanian"},lv:{nativeName:"Latvie\u0161u",englishName:"Latvian"},"lv-LV":{nativeName:"Latvie\u0161u",englishName:"Latvian"},mai:{nativeName:"\u092e\u0948\u0925\u093f\u0932\u0940, \u09ae\u09c8\u09a5\u09bf\u09b2\u09c0",englishName:"Maithili"},"mg-MG":{nativeName:"Malagasy",englishName:"Malagasy"},mk:{nativeName:"\u041c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438",englishName:"Macedonian"},"mk-MK":{nativeName:"\u041c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438 (\u041c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438)",englishName:"Macedonian (Macedonian)"},ml:{nativeName:"\u0d2e\u0d32\u0d2f\u0d3e\u0d33\u0d02",englishName:"Malayalam"},"ml-IN":{nativeName:"\u0d2e\u0d32\u0d2f\u0d3e\u0d33\u0d02",englishName:"Malayalam"},"mn-MN":{nativeName:"\u041c\u043e\u043d\u0433\u043e\u043b",englishName:"Mongolian"},mr:{nativeName:"\u092e\u0930\u093e\u0920\u0940",englishName:"Marathi"},"mr-IN":{nativeName:"\u092e\u0930\u093e\u0920\u0940",englishName:"Marathi"},ms:{nativeName:"Bahasa Melayu",englishName:"Malay"},"ms-MY":{nativeName:"Bahasa Melayu",englishName:"Malay"},mt:{nativeName:"Malti",englishName:"Maltese"},"mt-MT":{nativeName:"Malti",englishName:"Maltese"},my:{nativeName:"\u1017\u1019\u102c\u1005\u1000\u102c",englishName:"Burmese"},nb:{nativeName:"Norsk (bokm\xe5l)",englishName:"Norwegian (bokmal)"},"nb-NO":{nativeName:"Norsk (bokm\xe5l)",englishName:"Norwegian (bokmal)"},ne:{nativeName:"\u0928\u0947\u092a\u093e\u0932\u0940",englishName:"Nepali"},"ne-NP":{nativeName:"\u0928\u0947\u092a\u093e\u0932\u0940",englishName:"Nepali"},nl:{nativeName:"Nederlands",englishName:"Dutch"},"nl-BE":{nativeName:"Nederlands (Belgi\xeb)",englishName:"Dutch (Belgium)"},"nl-NL":{nativeName:"Nederlands (Nederland)",englishName:"Dutch (Netherlands)"},"nn-NO":{nativeName:"Norsk (nynorsk)",englishName:"Norwegian (nynorsk)"},no:{nativeName:"Norsk",englishName:"Norwegian"},oc:{nativeName:"Occitan",englishName:"Occitan"},"or-IN":{nativeName:"\u0b13\u0b21\u0b3c\u0b3f\u0b06",englishName:"Oriya"},pa:{nativeName:"\u0a2a\u0a70\u0a1c\u0a3e\u0a2c\u0a40",englishName:"Punjabi"},"pa-IN":{nativeName:"\u0a2a\u0a70\u0a1c\u0a3e\u0a2c\u0a40 (\u0a2d\u0a3e\u0a30\u0a24 \u0a28\u0a42\u0a70)",englishName:"Punjabi (India)"},pl:{nativeName:"Polski",englishName:"Polish"},"pl-PL":{nativeName:"Polski",englishName:"Polish"},"ps-AF":{nativeName:"\u067e\u069a\u062a\u0648",englishName:"Pashto"},pt:{nativeName:"Portugu\xeas",englishName:"Portuguese"},"pt-BR":{nativeName:"Portugu\xeas (Brasil)",englishName:"Portuguese (Brazil)"},"pt-PT":{nativeName:"Portugu\xeas (Portugal)",englishName:"Portuguese (Portugal)"},"qu-PE":{nativeName:"Qhichwa",englishName:"Quechua"},"rm-CH":{nativeName:"Rumantsch",englishName:"Romansh"},ro:{nativeName:"Rom\xe2n\u0103",englishName:"Romanian"},"ro-RO":{nativeName:"Rom\xe2n\u0103",englishName:"Romanian"},ru:{nativeName:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",englishName:"Russian"},"ru-RU":{nativeName:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",englishName:"Russian"},"sa-IN":{nativeName:"\u0938\u0902\u0938\u094d\u0915\u0943\u0924\u092e\u094d",englishName:"Sanskrit"},"se-NO":{nativeName:"Davvis\xe1megiella",englishName:"Northern S\xe1mi"},"si-LK":{nativeName:"\u0db4\u0dc5\u0dcf\u0dad",englishName:"Sinhala (Sri Lanka)"},sk:{nativeName:"Sloven\u010dina",englishName:"Slovak"},"sk-SK":{nativeName:"Sloven\u010dina (Slovakia)",englishName:"Slovak (Slovakia)"},sl:{nativeName:"Sloven\u0161\u010dina",englishName:"Slovenian"},"sl-SI":{nativeName:"Sloven\u0161\u010dina",englishName:"Slovenian"},"so-SO":{nativeName:"Soomaaliga",englishName:"Somali"},sq:{nativeName:"Shqip",englishName:"Albanian"},"sq-AL":{nativeName:"Shqip",englishName:"Albanian"},sr:{nativeName:"\u0421\u0440\u043f\u0441\u043a\u0438",englishName:"Serbian"},"sr-RS":{nativeName:"\u0421\u0440\u043f\u0441\u043a\u0438 (Serbia)",englishName:"Serbian (Serbia)"},su:{nativeName:"Basa Sunda",englishName:"Sundanese"},sv:{nativeName:"Svenska",englishName:"Swedish"},"sv-SE":{nativeName:"Svenska",englishName:"Swedish"},sw:{nativeName:"Kiswahili",englishName:"Swahili"},"sw-KE":{nativeName:"Kiswahili",englishName:"Swahili (Kenya)"},ta:{nativeName:"\u0ba4\u0bae\u0bbf\u0bb4\u0bcd",englishName:"Tamil"},"ta-IN":{nativeName:"\u0ba4\u0bae\u0bbf\u0bb4\u0bcd",englishName:"Tamil"},te:{nativeName:"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41",englishName:"Telugu"},"te-IN":{nativeName:"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41",englishName:"Telugu"},tg:{nativeName:"\u0437\u0430\u0431\u043e\u0301\u043d\u0438 \u0442\u043e\u04b7\u0438\u043a\u04e3\u0301",englishName:"Tajik"},"tg-TJ":{nativeName:"\u0442\u043e\u04b7\u0438\u043a\u04e3",englishName:"Tajik"},th:{nativeName:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22",englishName:"Thai"},"th-TH":{nativeName:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22 (\u0e1b\u0e23\u0e30\u0e40\u0e17\u0e28\u0e44\u0e17\u0e22)",englishName:"Thai (Thailand)"},tl:{nativeName:"Filipino",englishName:"Filipino"},"tl-PH":{nativeName:"Filipino",englishName:"Filipino"},tlh:{nativeName:"tlhIngan-Hol",englishName:"Klingon"},tr:{nativeName:"T\xfcrk\xe7e",englishName:"Turkish"},"tr-TR":{nativeName:"T\xfcrk\xe7e",englishName:"Turkish"},"tt-RU":{nativeName:"\u0442\u0430\u0442\u0430\u0440\u0447\u0430",englishName:"Tatar"},uk:{nativeName:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",englishName:"Ukrainian"},"uk-UA":{nativeName:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",englishName:"Ukrainian"},ur:{nativeName:"\u0627\u0631\u062f\u0648",englishName:"Urdu"},"ur-PK":{nativeName:"\u0627\u0631\u062f\u0648",englishName:"Urdu"},uz:{nativeName:"O'zbek",englishName:"Uzbek"},"uz-UZ":{nativeName:"O'zbek",englishName:"Uzbek"},vi:{nativeName:"Ti\u1ebfng Vi\u1ec7t",englishName:"Vietnamese"},"vi-VN":{nativeName:"Ti\u1ebfng Vi\u1ec7t",englishName:"Vietnamese"},"xh-ZA":{nativeName:"isiXhosa",englishName:"Xhosa"},yi:{nativeName:"\u05d9\u05d9\u05b4\u05d3\u05d9\u05e9",englishName:"Yiddish"},"yi-DE":{nativeName:"\u05d9\u05d9\u05b4\u05d3\u05d9\u05e9 (German)",englishName:"Yiddish (German)"},zh:{nativeName:"\u4e2d\u6587",englishName:"Chinese"},"zh-HANS":{nativeName:"\u4e2d\u6587\u7b80\u4f53",englishName:"Chinese Simplified"},"zh-HANT":{nativeName:"\u4e2d\u6587\u7e41\u9ad4",englishName:"Chinese Traditional"},"zh-CN":{nativeName:"\u4e2d\u6587\uff08\u4e2d\u56fd\uff09",englishName:"Chinese Simplified (China)"},"zh-HK":{nativeName:"\u4e2d\u6587\uff08\u9999\u6e2f\uff09",englishName:"Chinese Traditional (Hong Kong)"},"zh-SG":{nativeName:"\u4e2d\u6587\uff08\u65b0\u52a0\u5761\uff09",englishName:"Chinese Simplified (Singapore)"},"zh-TW":{nativeName:"\u4e2d\u6587\uff08\u53f0\u7063\uff09",englishName:"Chinese Traditional (Taiwan)"},"zu-ZA":{nativeName:"isiZulu",englishName:"Zulu"}}},$jscomp$iter$398=$jscomp.makeIterator(Object.keys(mozilla.LanguageMapping)),$jscomp$key$key=$jscomp$iter$398.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$398.next()){var key=$jscomp$key$key.value;mozilla.LanguageMapping[key.toLowerCase()]=mozilla.LanguageMapping[key]}shaka.ui.Element=function(t,i){var r=this;this.parent=t,this.controls=i,this.eventManager=new shaka.util.EventManager,this.localization=this.controls.getLocalization(),this.player=this.controls.getPlayer(),this.video=this.controls.getVideo(),this.adManager=this.player.getAdManager(),this.ad=i.getAd(),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,function(o){r.ad=o.ad}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){r.ad=null})},shaka.ui.Element.prototype.release=function(){this.eventManager.release(),this.ad=this.adManager=this.video=this.player=this.localization=this.eventManager=this.controls=this.parent=null},goog.exportSymbol("shaka.ui.Element",shaka.ui.Element),goog.exportProperty(shaka.ui.Element.prototype,"release",shaka.ui.Element.prototype.release),shaka.ui.Enums={},shaka.ui.Enums.MaterialDesignIcons={FULLSCREEN:"fullscreen",EXIT_FULLSCREEN:"fullscreen_exit",CLOSED_CAPTIONS:"closed_caption",CHECKMARK:"done",LANGUAGE:"language",PIP:"picture_in_picture_alt",EXIT_PIP:"branding_watermark",BACK:"arrow_back",RESOLUTION:"settings",MUTE:"volume_up",UNMUTE:"volume_off",CAST:"cast",EXIT_CAST:"cast_connected",OPEN_OVERFLOW:"more_vert",REWIND:"fast_rewind",FAST_FORWARD:"fast_forward",PLAY:"play_arrow",PLAYBACK_RATE:"slow_motion_video",PAUSE:"pause",LOOP:"repeat",UNLOOP:"repeat_on",AIRPLAY:"airplay",REPLAY:"replay"},shaka.ui.Utils=function(){},shaka.ui.Utils.getFirstDescendantWithClassName=function(t,i){var r=shaka.ui.Utils.getDescendantIfExists(t,i);return goog.asserts.assert(null!=r,"Should not be null!"),r},shaka.ui.Utils.getDescendantIfExists=function(t,i){var r=t.getElementsByClassName(i);return r.length?r[0]:null},shaka.ui.Utils.focusOnTheChosenItem=function(t){t&&(t=shaka.ui.Utils.getDescendantIfExists(t,"shaka-chosen-item"))&&t.parentElement.focus()},shaka.ui.Utils.checkmarkIcon=function(){var t=shaka.util.Dom.createHTMLElement("i");return t.classList.add("material-icons-round"),t.classList.add("shaka-chosen-item"),t.textContent=shaka.ui.Enums.MaterialDesignIcons.CHECKMARK,t.setAttribute("aria-hidden","true"),t},shaka.ui.Utils.setDisplay=function(t,i){t&&(i?t.classList.remove("shaka-hidden"):t.classList.add("shaka-hidden"))},shaka.ui.Utils.buildTimeString=function(t,i){var r=Math.floor(t/3600),o=Math.floor(t/60%60),l=Math.floor(t%60);return 10>l&&(l="0"+l),l=o+":"+l,i&&(10>o&&(l="0"+l),l=r+":"+l),l},shaka.ui.AdCounter=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.container_=shaka.util.Dom.createHTMLElement("div"),this.container_.classList.add("shaka-ad-counter"),this.parent.appendChild(this.container_),this.span_=shaka.util.Dom.createHTMLElement("span"),this.span_.classList.add("shaka-ad-counter-span"),this.container_.appendChild(this.span_),this.timer_=new shaka.util.Timer(function(){r.onTimerTick_()}),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,function(){r.onAdStarted_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){r.reset_()}),this.ad&&this.onAdStarted_()},$jscomp.inherits(shaka.ui.AdCounter,shaka.ui.Element),shaka.ui.AdCounter.prototype.updateAriaLabel_=function(){},shaka.ui.AdCounter.prototype.onAdStarted_=function(){this.timer_.tickNow(),this.timer_.tickEvery(.5)},shaka.ui.AdCounter.prototype.onTimerTick_=function(){goog.asserts.assert(null!=this.ad,"this.ad should exist at this point");var t=Math.round(this.ad.getRemainingTime()),i=this.ad.getDuration();-1!=t&&-1!=i&&(0<t?(i=(t=shaka.ui.Utils.buildTimeString(i-t,!1))+" / "+(i=shaka.ui.Utils.buildTimeString(i,!1)),1<this.ad.getSequenceLength()?this.span_.textContent=i:(t=this.localization.resolve(shaka.ui.Locales.Ids.AD_TIME),this.span_.textContent=t.replace("[AD_TIME]",i))):this.reset_())},shaka.ui.AdCounter.prototype.reset_=function(){this.timer_.stop(),this.span_.textContent=""},shaka.ui.AdCounter.prototype.release=function(){this.timer_.stop(),this.timer_=null,shaka.ui.Element.prototype.release.call(this)},goog.exportSymbol("shaka.ui.AdCounter",shaka.ui.AdCounter),shaka.ui.AdPosition=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.container_=shaka.util.Dom.createHTMLElement("div"),this.container_.classList.add("shaka-ad-position"),shaka.ui.Utils.setDisplay(this.container_,!1),this.parent.appendChild(this.container_),this.span_=shaka.util.Dom.createHTMLElement("span"),this.span_.classList.add("shaka-ad-position-span"),this.container_.appendChild(this.span_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.ad&&(r.updateAriaLabel_(),r.setPosition_())}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.ad&&(r.updateAriaLabel_(),r.setPosition_())}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,function(){r.setPosition_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){r.span_.textContent="",shaka.ui.Utils.setDisplay(r.container_,!1)}),this.ad&&this.setPosition_()},$jscomp.inherits(shaka.ui.AdPosition,shaka.ui.Element),shaka.ui.AdPosition.prototype.updateAriaLabel_=function(){},shaka.ui.AdPosition.prototype.setPosition_=function(){var t=this.ad.getSequenceLength();if(1<t){var i=shaka.ui.Locales.Ids,r=this.ad.getPositionInSequence();this.span_.textContent=this.localization.resolve(i.AD_PROGRESS).replace("[AD_ON]",String(r)).replace("[NUM_ADS]",String(t)),shaka.ui.Utils.setDisplay(this.container_,!0)}},goog.exportSymbol("shaka.ui.AdPosition",shaka.ui.AdPosition),shaka.ui.Constants={},shaka.ui.Constants.ARIA_LABEL="aria-label",shaka.ui.Constants.MIN_SEEK_WINDOW_TO_SHOW_SEEKBAR=5,shaka.ui.PlayButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this,o=shaka.ads.AdManager;this.button=shaka.util.Dom.createButton(),this.parent.appendChild(this.button),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel()}),this.eventManager.listen(this.video,"play",function(){r.updateAriaLabel(),r.updateIcon()}),this.eventManager.listen(this.video,"pause",function(){r.updateAriaLabel(),r.updateIcon()}),this.eventManager.listen(this.adManager,o.AD_PAUSED,function(){r.updateAriaLabel(),r.updateIcon()}),this.eventManager.listen(this.adManager,o.AD_RESUMED,function(){r.updateAriaLabel(),r.updateIcon()}),this.eventManager.listen(this.adManager,o.AD_STARTED,function(){r.updateAriaLabel(),r.updateIcon()}),this.eventManager.listen(this.button,"click",function(){r.ad?r.controls.playPauseAd():r.controls.playPausePresentation()}),this.ad&&(this.updateAriaLabel(),this.updateIcon())},$jscomp.inherits(shaka.ui.PlayButton,shaka.ui.Element),shaka.ui.PlayButton.prototype.isPaused=function(){return this.ad?this.ad.isPaused():this.controls.presentationIsPaused()},shaka.ui.PlayButton.prototype.updateAriaLabel=function(){var t=shaka.ui.Locales.Ids;t=this.isPaused()?t.PLAY:t.PAUSE,this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t))},shaka.ui.PlayButton.prototype.updateIcon=function(){},goog.exportSymbol("shaka.ui.PlayButton",shaka.ui.PlayButton),shaka.ui.BigPlayButton=function(t,i){shaka.ui.PlayButton.call(this,t,i),this.button.classList.add("shaka-play-button"),this.button.classList.add("shaka-no-propagation"),this.updateIcon(),this.updateAriaLabel()},$jscomp.inherits(shaka.ui.BigPlayButton,shaka.ui.PlayButton),shaka.ui.BigPlayButton.prototype.updateIcon=function(){this.isPaused()?this.button.setAttribute("icon","play"):this.button.setAttribute("icon","pause")},goog.exportSymbol("shaka.ui.BigPlayButton",shaka.ui.BigPlayButton),shaka.ui.RangeElement=function(t,i,r,o){shaka.ui.Element.call(this,t,i);var l=this;this.container=shaka.util.Dom.createHTMLElement("div"),this.container.classList.add("shaka-range-container"),this.container.classList.add.apply(this.container.classList,$jscomp.arrayFromIterable(r)),this.isChanging_=!1,this.bar=document.createElement("input"),this.endFakeChangeTimer_=new shaka.util.Timer(function(){l.onChangeEnd(),l.isChanging_=!1}),this.bar.classList.add("shaka-range-element"),this.bar.classList.add.apply(this.bar.classList,$jscomp.arrayFromIterable(o)),this.bar.type="range",this.bar.step="any",this.bar.min="0",this.bar.max="1",this.bar.value="0",this.container.appendChild(this.bar),this.parent.appendChild(this.container),this.eventManager.listen(this.bar,"mousedown",function(){l.controls.isOpaque()&&(l.isChanging_=!0,l.onChangeStart())}),this.eventManager.listen(this.bar,"touchstart",function(g){l.controls.isOpaque()&&(l.isChanging_=!0,l.setBarValueForTouch_(g),l.onChangeStart())}),this.eventManager.listen(this.bar,"input",function(){l.onChange()}),this.eventManager.listen(this.bar,"touchmove",function(g){l.isChanging_&&(l.setBarValueForTouch_(g),l.onChange())}),this.eventManager.listen(this.bar,"touchend",function(g){l.isChanging_&&(l.isChanging_=!1,l.setBarValueForTouch_(g),l.onChangeEnd())}),this.eventManager.listen(this.bar,"mouseup",function(){l.isChanging_&&(l.isChanging_=!1,l.onChangeEnd())})},$jscomp.inherits(shaka.ui.RangeElement,shaka.ui.Element),shaka.ui.RangeElement.prototype.release=function(){this.endFakeChangeTimer_&&(this.endFakeChangeTimer_.stop(),this.endFakeChangeTimer_=null),shaka.ui.Element.prototype.release.call(this)},shaka.ui.RangeElement.prototype.setRange=function(t,i){this.bar.min=t,this.bar.max=i},shaka.ui.RangeElement.prototype.onChangeStart=function(){},shaka.ui.RangeElement.prototype.onChange=function(){},shaka.ui.RangeElement.prototype.onChangeEnd=function(){},shaka.ui.RangeElement.prototype.changeTo=function(t){this.isChanging_||(this.isChanging_=!0,this.onChangeStart());var i=parseFloat(this.bar.min),r=parseFloat(this.bar.max);this.bar.value=t>r?r:t<i?i:t,this.onChange(),this.endFakeChangeTimer_.tickAfter(.5)},shaka.ui.RangeElement.prototype.getValue=function(){return parseFloat(this.bar.value)},shaka.ui.RangeElement.prototype.setValue=function(t){this.isChanging_||(this.bar.value=t)},shaka.ui.RangeElement.prototype.setBarValueForTouch_=function(t){t.preventDefault();var i=t.changedTouches[0],r=this.bar.getBoundingClientRect();t=parseFloat(this.bar.min);var o=parseFloat(this.bar.max);(i=t+(o-t)/r.width*(i.clientX-r.left))<t?i=t:i>o&&(i=o),this.bar.value=i},goog.exportSymbol("shaka.ui.RangeElement",shaka.ui.RangeElement),goog.exportProperty(shaka.ui.RangeElement.prototype,"setValue",shaka.ui.RangeElement.prototype.setValue),goog.exportProperty(shaka.ui.RangeElement.prototype,"getValue",shaka.ui.RangeElement.prototype.getValue),goog.exportProperty(shaka.ui.RangeElement.prototype,"changeTo",shaka.ui.RangeElement.prototype.changeTo),goog.exportProperty(shaka.ui.RangeElement.prototype,"onChangeEnd",shaka.ui.RangeElement.prototype.onChangeEnd),goog.exportProperty(shaka.ui.RangeElement.prototype,"onChange",shaka.ui.RangeElement.prototype.onChange),goog.exportProperty(shaka.ui.RangeElement.prototype,"onChangeStart",shaka.ui.RangeElement.prototype.onChangeStart),goog.exportProperty(shaka.ui.RangeElement.prototype,"setRange",shaka.ui.RangeElement.prototype.setRange),shaka.ui.SeekBar=function(t,i){shaka.ui.RangeElement.call(this,t,i,["shaka-seek-bar-container"],["shaka-seek-bar","shaka-no-propagation","shaka-show-controls-on-mouse-over"]);var r=this;this.adMarkerContainer_=shaka.util.Dom.createHTMLElement("div"),this.adMarkerContainer_.classList.add("shaka-ad-markers"),this.container.insertBefore(this.adMarkerContainer_,this.container.childNodes[0]),this.config_=this.controls.getConfig(),this.seekTimer_=new shaka.util.Timer(function(){r.video.currentTime=r.getValue()}),this.adBreaksTimer_=new shaka.util.Timer(function(){r.markAdBreaks_()}),this.wasPlaying_=!1,this.adCuePoints_=[],this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){return r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){return r.updateAriaLabel_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,function(){shaka.ui.Utils.setDisplay(r.container,!1)}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){r.shouldBeDisplayed_()&&shaka.ui.Utils.setDisplay(r.container,!0)}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.CUEPOINTS_CHANGED,function(o){r.adCuePoints_=o.cuepoints,r.onAdCuePointsChanged_()}),this.eventManager.listen(this.player,"unloading",function(){r.adCuePoints_=[],r.onAdCuePointsChanged_()}),this.setValue(this.video.currentTime),this.update(),this.updateAriaLabel_(),this.ad&&shaka.ui.Utils.setDisplay(this.container,!1)},$jscomp.inherits(shaka.ui.SeekBar,shaka.ui.RangeElement),shaka.ui.SeekBar.prototype.release=function(){this.seekTimer_&&(this.seekTimer_.stop(),this.seekTimer_=null,this.adBreaksTimer_.stop(),this.adBreaksTimer_=null),shaka.ui.RangeElement.prototype.release.call(this)},shaka.ui.SeekBar.prototype.onChangeStart=function(){this.wasPlaying_=!this.video.paused,this.controls.setSeeking(!0),this.video.pause()},shaka.ui.SeekBar.prototype.onChange=function(){this.video.duration&&(this.update(),this.seekTimer_.tickAfter(.125))},shaka.ui.SeekBar.prototype.onChangeEnd=function(){this.seekTimer_.tickNow(),this.controls.setSeeking(!1),this.wasPlaying_&&this.video.play()},shaka.ui.SeekBar.prototype.isShowing=function(){return!this.container.classList.contains("shaka-hidden")},shaka.ui.SeekBar.prototype.update=function(){var t=this.config_.seekBarColors,i=this.getValue(),r=this.video.buffered.length,o=r?this.video.buffered.start(0):0,l=r?this.video.buffered.end(r-1):0,g=this.player.seekRange(),_=g.end-g.start;this.setRange(g.start,g.end),this.shouldBeDisplayed_()?(shaka.ui.Utils.setDisplay(this.container,!0),0==r?this.container.style.background=t.base:(r=(Math.max(o,g.start)-g.start)/_||0,l=(Math.min(l,g.end)-g.start)/_||0,i=(Math.min(Math.max(i,g.start),g.end)-g.start)/_||0,t=["to right",this.makeColor_(this.config_.showUnbufferedStart?t.base:t.played,r),this.makeColor_(t.played,r),this.makeColor_(t.played,i),this.makeColor_(t.buffered,i),this.makeColor_(t.buffered,l),this.makeColor_(t.base,l)],this.container.style.background="linear-gradient("+t.join(",")+")")):shaka.ui.Utils.setDisplay(this.container,!1)},shaka.ui.SeekBar.prototype.markAdBreaks_=function(){if(this.adCuePoints_.length){for(var t=this.player.seekRange(),i=t.end-t.start,r=["to right"],o=[],l=this.config_.seekBarColors.adBreaks,g=!1,_=$jscomp.makeIterator(this.adCuePoints_),v=_.next();!v.done;v=_.next())if(-1!=(v=v.value).start||v.end||(g=!0),v.start>=t.start&&v.start<t.end&&!(v.end&&v.end>t.end)){var E=(v.start-t.start)/i||0,P=E+.01;v.end&&(P=(v.end-t.start)/i||0),o.push({start:E,end:P})}for(v=(t=$jscomp.makeIterator(o)).next();!v.done;v=t.next())r.push(this.makeColor_("transparent",(i=v.value).start)),r.push(this.makeColor_(l,i.start)),r.push(this.makeColor_(l,i.end)),r.push(this.makeColor_("transparent",i.end));g&&(r.push(this.makeColor_("transparent",.99)),r.push(this.makeColor_(l,.99))),this.adMarkerContainer_.style.background="linear-gradient("+r.join(",")+")"}else this.adMarkerContainer_.style.background="transparent"},shaka.ui.SeekBar.prototype.makeColor_=function(t,i){return t+" "+100*i+"%"},shaka.ui.SeekBar.prototype.onAdCuePointsChanged_=function(){this.markAdBreaks_();var t=this.player.seekRange();t=t.end-t.start;var i=shaka.ui.Constants.MIN_SEEK_WINDOW_TO_SHOW_SEEKBAR;this.player.isLive()&&t>i&&this.adBreaksTimer_.tickEvery(1)},shaka.ui.SeekBar.prototype.shouldBeDisplayed_=function(){var t=this.player.seekRange();return t=t.end-t.start,!(this.player.isLive()&&t<shaka.ui.Constants.MIN_SEEK_WINDOW_TO_SHOW_SEEKBAR)&&null==this.ad},shaka.ui.SeekBar.prototype.updateAriaLabel_=function(){this.bar.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.SEEK))},goog.exportSymbol("shaka.ui.SeekBar",shaka.ui.SeekBar),shaka.ui.SeekBar.Factory=function(){},shaka.ui.SeekBar.Factory.prototype.create=function(t,i){return new shaka.ui.SeekBar(t,i)},goog.exportProperty(shaka.ui.SeekBar,"Factory",shaka.ui.SeekBar.Factory),shaka.ui.ControlsPanel={},shaka.ui.Controls=function(t,i,r,o){shaka.util.FakeEventTarget.call(this);var l=this;this.enabled_=!0,this.config_=o,this.castProxy_=new shaka.cast.CastProxy(r,t,this.config_.castReceiverAppId),this.castAllowed_=!0,this.video_=this.castProxy_.getVideo(),this.localVideo_=r,this.player_=this.castProxy_.getPlayer(),this.localPlayer_=t,this.videoContainer_=i,this.adManager_=this.player_.getAdManager(),this.seekBar_=this.ad_=null,this.isSeeking_=!1,this.menus_=[],this.showOnHoverControls_=[],this.recentMouseMovement_=!1,this.mouseStillTimer_=new shaka.util.Timer(function(){l.onMouseStill_()}),this.fadeControlsTimer_=new shaka.util.Timer(function(){l.controlsContainer_.removeAttribute("shown"),l.hideSettingsMenusTimer_.tickAfter(2)}),this.hideSettingsMenusTimer_=new shaka.util.Timer(function(){for(var g=$jscomp.makeIterator(l.menus_),_=g.next();!_.done;_=g.next())shaka.ui.Utils.setDisplay(_.value,!1)}),this.timeAndSeekRangeTimer_=new shaka.util.Timer(function(){l.isOpaque()&&l.updateTimeAndSeekRange_()}),this.lastTouchEventTime_=null,this.elements_=[],this.localization_=shaka.ui.Controls.createLocalization_(),this.eventManager_=new shaka.util.EventManager,this.configure(this.config_),this.addEventListeners_(),this.pressedKeys_=new Set,this.onCastStatusChange_(),this.timeAndSeekRangeTimer_.tickEvery(.125),this.eventManager_.listen(this.localization_,shaka.ui.Localization.LOCALE_CHANGED,function(g){l.adManager_.setLocale(g.locales[0])})},$jscomp.inherits(shaka.ui.Controls,shaka.util.FakeEventTarget),shaka.ui.Controls.prototype.destroy=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){switch(i.nextAddress){case 1:if(t.eventManager_&&(t.eventManager_.release(),t.eventManager_=null),t.mouseStillTimer_&&(t.mouseStillTimer_.stop(),t.mouseStillTimer_=null),t.fadeControlsTimer_&&(t.fadeControlsTimer_.stop(),t.fadeControlsTimer_=null),t.hideSettingsMenusTimer_&&(t.hideSettingsMenusTimer_.stop(),t.hideSettingsMenusTimer_=null),t.timeAndSeekRangeTimer_&&(t.timeAndSeekRangeTimer_.stop(),t.timeAndSeekRangeTimer_=null),t.releaseChildElements_(),t.controlsContainer_&&(t.videoContainer_.removeChild(t.controlsContainer_),t.controlsContainer_=null),!t.castProxy_){i.jumpTo(2);break}return i.yield(t.castProxy_.destroy(),3);case 3:t.castProxy_=null;case 2:if(!t.localPlayer_){i.jumpTo(4);break}return i.yield(t.localPlayer_.destroy(),5);case 5:t.localPlayer_=null;case 4:t.player_=null,t.localVideo_=null,t.video_=null,t.localization_=null,t.pressedKeys_.clear(),i.jumpToEnd()}})},shaka.ui.Controls.prototype.releaseChildElements_=function(){for(var t=$jscomp.makeIterator(this.elements_),i=t.next();!i.done;i=t.next())i.value.release();this.elements_=[]},shaka.ui.Controls.registerElement=function(t,i){shaka.ui.ControlsPanel.elementNamesToFactories_.set(t,i)},shaka.ui.Controls.registerSeekBar=function(t){shaka.ui.ControlsPanel.seekBarFactory_=t},shaka.ui.Controls.prototype.allowCast=function(t){this.castAllowed_=t,this.onCastStatusChange_()},shaka.ui.Controls.prototype.loadComplete=function(){this.onPlayStateChange_()},shaka.ui.Controls.prototype.configure=function(t){this.config_=t,this.castProxy_.changeReceiverId(t.castReceiverAppId),this.seekBar_&&(this.seekBar_=null),this.playButton_&&(this.playButton_=null),this.controlsContainer_?(shaka.util.Dom.removeAllChildren(this.controlsContainer_),this.releaseChildElements_()):(this.addControlsContainer_(),this.addClientAdContainer_()),this.createDOM_(),this.onPlayStateChange_(),t=this.videoContainer_.getElementsByClassName("shaka-no-propagation");for(var i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){var r=function(o){return o.stopPropagation()};this.eventManager_.listen(i=i.value,"click",r),this.eventManager_.listen(i,"dblclick",r)}},shaka.ui.Controls.prototype.setEnabledShakaControls=function(t){(this.enabled_=t)?(this.videoContainer_.setAttribute("shaka-controls","true"),this.localVideo_.tabIndex=-1,this.localVideo_.controls=!1):this.videoContainer_.removeAttribute("shaka-controls"),this.onPlayStateChange_()},shaka.ui.Controls.prototype.setEnabledNativeControls=function(t){this.localVideo_.controls=t,this.localVideo_.tabIndex=t?0:-1,t&&this.setEnabledShakaControls(!1)},shaka.ui.Controls.prototype.getAd=function(){return this.ad_},shaka.ui.Controls.prototype.getCastProxy=function(){return this.castProxy_},shaka.ui.Controls.prototype.getLocalization=function(){return this.localization_},shaka.ui.Controls.prototype.getVideoContainer=function(){return this.videoContainer_},shaka.ui.Controls.prototype.getVideo=function(){return this.video_},shaka.ui.Controls.prototype.getLocalVideo=function(){return this.localVideo_},shaka.ui.Controls.prototype.getPlayer=function(){return this.player_},shaka.ui.Controls.prototype.getLocalPlayer=function(){return this.localPlayer_},shaka.ui.Controls.prototype.getControlsContainer=function(){return goog.asserts.assert(this.controlsContainer_,"No controls container after destruction!"),this.controlsContainer_},shaka.ui.Controls.prototype.getServerSideAdContainer=function(){return this.daiAdContainer_},shaka.ui.Controls.prototype.getClientSideAdContainer=function(){return this.clientAdContainer_},shaka.ui.Controls.prototype.getConfig=function(){return this.config_},shaka.ui.Controls.prototype.isSeeking=function(){return this.isSeeking_},shaka.ui.Controls.prototype.setSeeking=function(t){this.isSeeking_=t},shaka.ui.Controls.prototype.isCastAllowed=function(){return this.castAllowed_},shaka.ui.Controls.prototype.getDisplayTime=function(){return this.seekBar_?this.seekBar_.getValue():this.video_.currentTime},shaka.ui.Controls.prototype.setLastTouchEventTime=function(t){this.lastTouchEventTime_=t},shaka.ui.Controls.prototype.anySettingsMenusAreOpen=function(){return this.menus_.some(function(t){return!t.classList.contains("shaka-hidden")})},shaka.ui.Controls.prototype.hideSettingsMenus=function(){this.hideSettingsMenusTimer_.tickNow()},shaka.ui.Controls.prototype.toggleFullScreen=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:if(document.fullscreenElement)return screen.orientation&&screen.orientation.unlock(),r.yield(document.exitFullscreen(),0);if(r.setCatchFinallyBlocks(4),!document.pictureInPictureElement){r.jumpTo(6);break}return r.yield(document.exitPictureInPicture(),6);case 6:return r.yield(t.videoContainer_.requestFullscreen({navigationUI:"hide"}),8);case 8:if(!t.config_.forceLandscapeOnFullscreen||!screen.orientation){r.jumpTo(9);break}return r.setCatchFinallyBlocks(10),r.yield(screen.orientation.lock("landscape"),12);case 12:r.leaveTryBlock(9,4);break;case 10:r.enterCatchBlock(4);case 9:r.leaveTryBlock(0);break;case 4:i=r.enterCatchBlock(),t.dispatchEvent(new shaka.util.FakeEvent("error",{detail:i})),r.jumpTo(0)}})},shaka.ui.Controls.prototype.showAdUI=function(){shaka.ui.Utils.setDisplay(this.adPanel_,!0),shaka.ui.Utils.setDisplay(this.clientAdContainer_,!0),this.controlsContainer_.setAttribute("ad-active","true")},shaka.ui.Controls.prototype.hideAdUI=function(){shaka.ui.Utils.setDisplay(this.adPanel_,!1),shaka.ui.Utils.setDisplay(this.clientAdContainer_,!1),this.controlsContainer_.removeAttribute("ad-active")},shaka.ui.Controls.prototype.playPausePresentation=function(){this.enabled_&&this.video_.duration&&(this.player_.cancelTrickPlay(),this.presentationIsPaused()?this.video_.play():this.video_.pause())},shaka.ui.Controls.prototype.playPauseAd=function(){this.ad_&&this.ad_.isPaused()?this.ad_.play():this.ad_&&this.ad_.pause()},shaka.ui.Controls.prototype.presentationIsPaused=function(){return this.video_.paused&&!this.isSeeking()},shaka.ui.Controls.prototype.createDOM_=function(){this.videoContainer_.classList.add("shaka-video-container"),this.localVideo_.classList.add("shaka-video"),this.addScrimContainer_(),this.config_.addBigPlayButton&&this.addPlayButton_(),this.spinnerContainer_||this.addBufferingSpinner_(),this.addDaiAdContainer_(),this.addControlsButtonPanel_(),this.menus_=Array.from(this.videoContainer_.getElementsByClassName("shaka-settings-menu")),this.menus_.push.apply(this.menus_,$jscomp.arrayFromIterable(Array.from(this.videoContainer_.getElementsByClassName("shaka-overflow-menu")))),this.addSeekBar_(),this.showOnHoverControls_=Array.from(this.videoContainer_.getElementsByClassName("shaka-show-controls-on-mouse-over"))},shaka.ui.Controls.prototype.addControlsContainer_=function(){var t=this;this.controlsContainer_=shaka.util.Dom.createHTMLElement("div"),this.controlsContainer_.classList.add("shaka-controls-container"),this.videoContainer_.appendChild(this.controlsContainer_),this.videoContainer_.setAttribute("shaka-controls","true"),this.eventManager_.listen(this.controlsContainer_,"touchstart",function(i){t.onContainerTouch_(i)},{passive:!1}),this.eventManager_.listen(this.controlsContainer_,"click",function(){t.onContainerClick_()}),this.eventManager_.listen(this.controlsContainer_,"dblclick",function(){t.config_.doubleClickForFullscreen&&t.toggleFullScreen()})},shaka.ui.Controls.prototype.addPlayButton_=function(){var t=shaka.util.Dom.createHTMLElement("div");t.classList.add("shaka-play-button-container"),this.controlsContainer_.appendChild(t),this.playButton_=new shaka.ui.BigPlayButton(t,this),this.elements_.push(this.playButton_)},shaka.ui.Controls.prototype.addScrimContainer_=function(){var t=shaka.util.Dom.createHTMLElement("div");t.classList.add("shaka-scrim-container"),this.controlsContainer_.appendChild(t)},shaka.ui.Controls.prototype.addAdControls_=function(){this.adPanel_=shaka.util.Dom.createHTMLElement("div"),this.adPanel_.classList.add("shaka-ad-controls"),shaka.ui.Utils.setDisplay(this.adPanel_,null!=this.ad_),this.bottomControls_.appendChild(this.adPanel_);var t=new shaka.ui.AdPosition(this.adPanel_,this);this.elements_.push(t),t=new shaka.ui.AdCounter(this.adPanel_,this),this.elements_.push(t)},shaka.ui.Controls.prototype.addBufferingSpinner_=function(){this.spinnerContainer_=shaka.util.Dom.createHTMLElement("div"),this.spinnerContainer_.classList.add("shaka-spinner-container"),this.videoContainer_.appendChild(this.spinnerContainer_);var t=shaka.util.Dom.createHTMLElement("div");t.classList.add("shaka-spinner"),this.spinnerContainer_.appendChild(t);var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("shaka-spinner-svg"),i.setAttribute("viewBox","0 0 30 30"),t.appendChild(i),(t=document.createElementNS("http://www.w3.org/2000/svg","circle")).classList.add("shaka-spinner-path"),t.setAttribute("cx","15"),t.setAttribute("cy","15"),t.setAttribute("r","14.5"),t.setAttribute("fill","none"),t.setAttribute("stroke-width","1"),t.setAttribute("stroke-miterlimit","10"),i.appendChild(t)},shaka.ui.Controls.prototype.addControlsButtonPanel_=function(){var t=this;this.bottomControls_=shaka.util.Dom.createHTMLElement("div"),this.bottomControls_.classList.add("shaka-bottom-controls"),this.bottomControls_.classList.add("shaka-no-propagation"),this.controlsContainer_.appendChild(this.bottomControls_),this.eventManager_.listen(this.bottomControls_,"click",function(){t.hideSettingsMenus()}),this.addAdControls_(),this.controlsButtonPanel_=shaka.util.Dom.createHTMLElement("div"),this.controlsButtonPanel_.classList.add("shaka-controls-button-panel"),this.controlsButtonPanel_.classList.add("shaka-show-controls-on-mouse-over"),this.bottomControls_.appendChild(this.controlsButtonPanel_);for(var i={},r=$jscomp.makeIterator(this.config_.controlPanelElements),o=r.next();!o.done;i={$jscomp$loop$prop$moddableElement$669:i.$jscomp$loop$prop$moddableElement$669},o=r.next())shaka.ui.ControlsPanel.elementNamesToFactories_.get(o=o.value)?("function"!=typeof(o=shaka.ui.ControlsPanel.elementNamesToFactories_.get(o).create(this.controlsButtonPanel_,this)).release&&(shaka.Deprecate.deprecateFeature(4,"shaka.extern.IUIElement","Please update UI elements to have a release() method."),i.$jscomp$loop$prop$moddableElement$669=o,i.$jscomp$loop$prop$moddableElement$669.release=function(l){return function(){l.$jscomp$loop$prop$moddableElement$669.destroy&&l.$jscomp$loop$prop$moddableElement$669.destroy()}}(i)),this.elements_.push(o)):shaka.log.alwaysWarn("Unrecognized control panel element requested:",o)},shaka.ui.Controls.prototype.addDaiAdContainer_=function(){this.daiAdContainer_=shaka.util.Dom.createHTMLElement("div"),this.daiAdContainer_.classList.add("shaka-server-side-ad-container"),this.controlsContainer_.appendChild(this.daiAdContainer_)},shaka.ui.Controls.prototype.addSeekBar_=function(){if(this.config_.addSeekBar)this.seekBar_=shaka.ui.ControlsPanel.seekBarFactory_.create(this.bottomControls_,this),this.elements_.push(this.seekBar_);else for(var t=$jscomp.makeIterator(this.menus_),i=t.next();!i.done;i=t.next())i.value.classList.add("shaka-low-position")},shaka.ui.Controls.prototype.addClientAdContainer_=function(){this.clientAdContainer_=shaka.util.Dom.createHTMLElement("div"),this.clientAdContainer_.classList.add("shaka-client-side-ad-container"),shaka.ui.Utils.setDisplay(this.clientAdContainer_,!1),this.videoContainer_.appendChild(this.clientAdContainer_)},shaka.ui.Controls.prototype.addEventListeners_=function(){var t=this;this.eventManager_.listen(this.player_,"buffering",function(){t.onBufferingStateChange_()}),this.onBufferingStateChange_(),this.eventManager_.listen(window,"keydown",function(i){t.onWindowKeyDown_(i)}),this.eventManager_.listen(window,"click",function(){return t.hideSettingsMenus()}),this.eventManager_.listen(this.video_,"play",function(){t.onPlayStateChange_()}),this.eventManager_.listen(this.video_,"pause",function(){t.onPlayStateChange_()}),this.eventManager_.listen(this.videoContainer_,"mousemove",function(i){t.onMouseMove_(i)}),this.eventManager_.listen(this.videoContainer_,"touchmove",function(i){t.onMouseMove_(i)},{passive:!0}),this.eventManager_.listen(this.videoContainer_,"touchend",function(i){t.onMouseMove_(i)},{passive:!0}),this.eventManager_.listen(this.videoContainer_,"mouseleave",function(){t.onMouseLeave_()}),this.eventManager_.listen(this.castProxy_,"caststatuschanged",function(){t.onCastStatusChange_()}),this.eventManager_.listen(this.videoContainer_,"keydown",function(i){t.onControlsKeyDown_(i)}),this.eventManager_.listen(this.videoContainer_,"keyup",function(i){t.onControlsKeyUp_(i)}),this.eventManager_.listen(this.adManager_,shaka.ads.AdManager.AD_STARTED,function(i){t.ad_=i.ad,t.showAdUI()}),this.eventManager_.listen(this.adManager_,shaka.ads.AdManager.AD_STOPPED,function(){t.ad_=null,t.hideAdUI()}),screen.orientation&&this.eventManager_.listen(screen.orientation,"change",function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return i.yield(t.onScreenRotation_(),0)})}),this.eventManager_.listen(document,"fullscreenchange",function(){t.ad_&&t.ad_.resize(t.localVideo_.offsetWidth,t.localVideo_.offsetHeight)})},shaka.ui.Controls.prototype.onScreenRotation_=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return t.video_&&0!=t.video_.readyState&&!t.castProxy_.isCasting()&&t.config_.enableFullscreenOnRotation?screen.orientation.type.includes("landscape")&&!document.fullscreenElement?i.yield(t.videoContainer_.requestFullscreen({navigationUI:"hide"}),0):screen.orientation.type.includes("portrait")&&document.fullscreenElement?i.yield(document.exitFullscreen(),0):i.jumpTo(0):i.return()})},shaka.ui.Controls.prototype.onMouseMove_=function(t){"mousemove"==t.type&&(this.controlsContainer_.classList.remove("shaka-keyboard-navigation"),this.computeOpacity()),"touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"keyup"==t.type?this.lastTouchEventTime_=Date.now():this.lastTouchEventTime_+1e3<Date.now()&&(this.lastTouchEventTime_=null),this.lastTouchEventTime_&&"mousemove"==t.type||(this.videoContainer_.style.cursor="",this.recentMouseMovement_=!0,this.hideSettingsMenusTimer_.stop(),this.isOpaque()||(this.updateTimeAndSeekRange_(),this.computeOpacity()),this.mouseStillTimer_.stop(),"touchend"!=t.type&&"keyup"!=t.type&&this.lastTouchEventTime_||this.mouseStillTimer_.tickAfter(3))},shaka.ui.Controls.prototype.onMouseLeave_=function(){this.lastTouchEventTime_||this.mouseStillTimer_.tickNow()},shaka.ui.Controls.prototype.onMouseStill_=function(){this.videoContainer_.style.cursor="none",this.recentMouseMovement_=!1,this.computeOpacity()},shaka.ui.Controls.prototype.isHovered_=function(){return!!window.matchMedia("hover: hover").matches&&this.showOnHoverControls_.some(function(t){return t.matches(":hover")})},shaka.ui.Controls.prototype.computeOpacity=function(){var t=!!this.ad_&&this.ad_.isPaused(),i=this.video_.paused&&!this.isSeeking_,r=this.controlsContainer_.classList.contains("shaka-keyboard-navigation");t||!this.ad_&&i||this.recentMouseMovement_||r||this.isHovered_()?(this.updateTimeAndSeekRange_(),this.controlsContainer_.setAttribute("shown","true"),this.fadeControlsTimer_.stop()):this.fadeControlsTimer_.tickAfter(this.config_.fadeDelay)},shaka.ui.Controls.prototype.onContainerTouch_=function(t){this.video_.duration&&(this.isOpaque()?this.lastTouchEventTime_=Date.now():(this.onMouseMove_(t),t.preventDefault()))},shaka.ui.Controls.prototype.onContainerClick_=function(){this.enabled_&&(this.anySettingsMenusAreOpen()?this.hideSettingsMenusTimer_.tickNow():this.onPlayPauseClick_())},shaka.ui.Controls.prototype.onPlayPauseClick_=function(){this.ad_?this.playPauseAd():this.playPausePresentation()},shaka.ui.Controls.prototype.onCastStatusChange_=function(){var t=this.castProxy_.isCasting();this.dispatchEvent(new shaka.util.FakeEvent("caststatuschanged",{newStatus:t})),t?this.controlsContainer_.setAttribute("casting","true"):this.controlsContainer_.removeAttribute("casting")},shaka.ui.Controls.prototype.onPlayStateChange_=function(){this.computeOpacity()},shaka.ui.Controls.prototype.onControlsKeyDown_=function(t){var i=document.activeElement,r=!(!i||!i.classList)&&i.classList.contains("shaka-volume-bar"),o=i&&i.classList&&i.classList.contains("shaka-seek-bar");if(this.controlsContainer_.contains(i)&&this.onMouseMove_(t),this.config_.enableKeyboardPlaybackControls)switch(t.key){case"ArrowLeft":this.seekBar_&&!r&&(t.preventDefault(),this.seek_(this.seekBar_.getValue()-5));break;case"ArrowRight":this.seekBar_&&!r&&(t.preventDefault(),this.seek_(this.seekBar_.getValue()+5));break;case"Home":this.seekBar_&&this.seek_(this.player_.seekRange().start);break;case"End":this.seekBar_&&this.seek_(this.player_.seekRange().end);break;case" ":o&&this.onPlayPauseClick_()}},shaka.ui.Controls.prototype.onControlsKeyUp_=function(t){this.pressedKeys_.delete(t.key)},shaka.ui.Controls.prototype.onBufferingStateChange_=function(){this.enabled_&&shaka.ui.Utils.setDisplay(this.spinnerContainer_,this.player_.isBuffering())},shaka.ui.Controls.prototype.isOpaque=function(){return!!this.enabled_&&(null!=this.controlsContainer_.getAttribute("shown")||null!=this.controlsContainer_.getAttribute("casting"))},shaka.ui.Controls.prototype.seek_=function(t){goog.asserts.assert(this.seekBar_,"Caller of seek_ must check for seekBar_ first!"),this.seekBar_.changeTo(t),this.isOpaque()&&this.updateTimeAndSeekRange_()},shaka.ui.Controls.prototype.updateTimeAndSeekRange_=function(){if(this.seekBar_)if(this.seekBar_.setValue(this.video_.currentTime),this.seekBar_.update(),this.seekBar_.isShowing())for(var t=$jscomp.makeIterator(this.menus_),i=t.next();!i.done;i=t.next())i.value.classList.remove("shaka-low-position");else for(i=(t=$jscomp.makeIterator(this.menus_)).next();!i.done;i=t.next())i.value.classList.add("shaka-low-position");this.dispatchEvent(new shaka.util.FakeEvent("timeandseekrangeupdated"))},shaka.ui.Controls.prototype.onWindowKeyDown_=function(t){var i=this;this.pressedKeys_.add(t.key);var r=this.anySettingsMenusAreOpen();"Tab"==t.key&&(this.controlsContainer_.classList.add("shaka-keyboard-navigation"),this.computeOpacity(),this.eventManager_.listen(window,"mousedown",function(){return i.onMouseDown_()})),"Escape"==t.key&&this.hideSettingsMenusTimer_.tickNow(),r&&this.pressedKeys_.has("Tab")&&this.keepFocusInMenu_(t)},shaka.ui.Controls.prototype.keepFocusInMenu_=function(t){var i=this.menus_.filter(function(l){return!l.classList.contains("shaka-hidden")});if(i.length){var r=i[0];if(r.childNodes.length){for(i=r.firstElementChild;i&&i.classList.contains("shaka-hidden");)i=i.nextElementSibling;for(r=r.lastElementChild;r&&r.classList.contains("shaka-hidden");)r=r.previousElementSibling;var o=document.activeElement;this.pressedKeys_.has("Shift")?o==i&&(t.preventDefault(),r.focus()):o==r&&(t.preventDefault(),i.focus())}}},shaka.ui.Controls.prototype.onMouseDown_=function(){this.eventManager_.unlisten(window,"mousedown")},shaka.ui.Controls.createLocalization_=function(){var t=new shaka.ui.Localization("en");return shaka.ui.Locales.addTo(t),t.changeLocale(navigator.languages||[]),t},goog.exportSymbol("shaka.ui.Controls",shaka.ui.Controls),goog.exportProperty(shaka.ui.Controls.prototype,"isOpaque",shaka.ui.Controls.prototype.isOpaque),goog.exportProperty(shaka.ui.Controls.prototype,"hideAdUI",shaka.ui.Controls.prototype.hideAdUI),goog.exportProperty(shaka.ui.Controls.prototype,"showAdUI",shaka.ui.Controls.prototype.showAdUI),goog.exportProperty(shaka.ui.Controls.prototype,"toggleFullScreen",shaka.ui.Controls.prototype.toggleFullScreen),goog.exportProperty(shaka.ui.Controls.prototype,"hideSettingsMenus",shaka.ui.Controls.prototype.hideSettingsMenus),goog.exportProperty(shaka.ui.Controls.prototype,"anySettingsMenusAreOpen",shaka.ui.Controls.prototype.anySettingsMenusAreOpen),goog.exportProperty(shaka.ui.Controls.prototype,"setLastTouchEventTime",shaka.ui.Controls.prototype.setLastTouchEventTime),goog.exportProperty(shaka.ui.Controls.prototype,"getDisplayTime",shaka.ui.Controls.prototype.getDisplayTime),goog.exportProperty(shaka.ui.Controls.prototype,"isCastAllowed",shaka.ui.Controls.prototype.isCastAllowed),goog.exportProperty(shaka.ui.Controls.prototype,"setSeeking",shaka.ui.Controls.prototype.setSeeking),goog.exportProperty(shaka.ui.Controls.prototype,"isSeeking",shaka.ui.Controls.prototype.isSeeking),goog.exportProperty(shaka.ui.Controls.prototype,"getConfig",shaka.ui.Controls.prototype.getConfig),goog.exportProperty(shaka.ui.Controls.prototype,"getClientSideAdContainer",shaka.ui.Controls.prototype.getClientSideAdContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getServerSideAdContainer",shaka.ui.Controls.prototype.getServerSideAdContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getControlsContainer",shaka.ui.Controls.prototype.getControlsContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getLocalPlayer",shaka.ui.Controls.prototype.getLocalPlayer),goog.exportProperty(shaka.ui.Controls.prototype,"getPlayer",shaka.ui.Controls.prototype.getPlayer),goog.exportProperty(shaka.ui.Controls.prototype,"getLocalVideo",shaka.ui.Controls.prototype.getLocalVideo),goog.exportProperty(shaka.ui.Controls.prototype,"getVideo",shaka.ui.Controls.prototype.getVideo),goog.exportProperty(shaka.ui.Controls.prototype,"getVideoContainer",shaka.ui.Controls.prototype.getVideoContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getLocalization",shaka.ui.Controls.prototype.getLocalization),goog.exportProperty(shaka.ui.Controls.prototype,"getCastProxy",shaka.ui.Controls.prototype.getCastProxy),goog.exportProperty(shaka.ui.Controls.prototype,"getAd",shaka.ui.Controls.prototype.getAd),goog.exportProperty(shaka.ui.Controls.prototype,"setEnabledNativeControls",shaka.ui.Controls.prototype.setEnabledNativeControls),goog.exportProperty(shaka.ui.Controls.prototype,"setEnabledShakaControls",shaka.ui.Controls.prototype.setEnabledShakaControls),goog.exportProperty(shaka.ui.Controls.prototype,"configure",shaka.ui.Controls.prototype.configure),goog.exportProperty(shaka.ui.Controls.prototype,"loadComplete",shaka.ui.Controls.prototype.loadComplete),goog.exportProperty(shaka.ui.Controls.prototype,"allowCast",shaka.ui.Controls.prototype.allowCast),goog.exportProperty(shaka.ui.Controls,"registerSeekBar",shaka.ui.Controls.registerSeekBar),goog.exportProperty(shaka.ui.Controls,"registerElement",shaka.ui.Controls.registerElement),goog.exportProperty(shaka.ui.Controls.prototype,"destroy",shaka.ui.Controls.prototype.destroy),shaka.ui.ControlsPanel.elementNamesToFactories_=new Map,shaka.ui.ControlsPanel.seekBarFactory_=new shaka.ui.SeekBar.Factory,shaka.ui.OverflowMenu=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.config_=this.controls.getConfig(),this.controlsContainer_=this.controls.getControlsContainer(),this.children_=[],this.addOverflowMenuButton_(),this.addOverflowMenu_(),this.createChildren_();for(var o=this.controls.getVideoContainer().getElementsByClassName("shaka-back-to-overflow-button"),l=(o=$jscomp.makeIterator(o)).next();!l.done;l=o.next())this.eventManager.listen(l.value,"click",function(){r.controls.hideSettingsMenus(),shaka.ui.Utils.setDisplay(r.overflowMenu_,!0),r.overflowMenu_.childNodes.length&&r.overflowMenu_.childNodes[0].focus(),r.controls.computeOpacity()});this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,function(){shaka.ui.Utils.setDisplay(r.overflowMenuButton_,!1)}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){shaka.ui.Utils.setDisplay(r.overflowMenuButton_,!0)}),this.eventManager.listen(this.controls,"submenuopen",function(){shaka.ui.Utils.setDisplay(r.overflowMenu_,!1)}),this.eventManager.listen(this.overflowMenu_,"touchstart",function(g){r.controls.setLastTouchEventTime(Date.now()),g.stopPropagation()}),this.eventManager.listen(this.overflowMenuButton_,"click",function(){r.onOverflowMenuButtonClick_()}),this.updateAriaLabel_(),this.ad&&shaka.ui.Utils.setDisplay(this.overflowMenuButton_,!1)},$jscomp.inherits(shaka.ui.OverflowMenu,shaka.ui.Element),shaka.ui.OverflowMenu.prototype.release=function(){this.controlsContainer_=null;for(var t=$jscomp.makeIterator(this.children_),i=t.next();!i.done;i=t.next())i.value.release();this.children_=[],shaka.ui.Element.prototype.release.call(this)},shaka.ui.OverflowMenu.registerElement=function(t,i){shaka.ui.OverflowMenu.elementNamesToFactories_.set(t,i)},shaka.ui.OverflowMenu.prototype.addOverflowMenu_=function(){this.overflowMenu_=shaka.util.Dom.createHTMLElement("div"),this.overflowMenu_.classList.add("shaka-overflow-menu"),this.overflowMenu_.classList.add("shaka-no-propagation"),this.overflowMenu_.classList.add("shaka-show-controls-on-mouse-over"),this.overflowMenu_.classList.add("shaka-hidden"),this.controlsContainer_.appendChild(this.overflowMenu_)},shaka.ui.OverflowMenu.prototype.addOverflowMenuButton_=function(){this.overflowMenuButton_=shaka.util.Dom.createButton(),this.overflowMenuButton_.classList.add("shaka-overflow-menu-button"),this.overflowMenuButton_.classList.add("shaka-no-propagation"),this.overflowMenuButton_.classList.add("material-icons-round"),this.overflowMenuButton_.textContent=shaka.ui.Enums.MaterialDesignIcons.OPEN_OVERFLOW,this.parent.appendChild(this.overflowMenuButton_)},shaka.ui.OverflowMenu.prototype.createChildren_=function(){for(var t=$jscomp.makeIterator(this.config_.overflowMenuButtons),i=t.next();!i.done;i=t.next())shaka.ui.OverflowMenu.elementNamesToFactories_.get(i=i.value)?(i=shaka.ui.OverflowMenu.elementNamesToFactories_.get(i),goog.asserts.assert(this.controls,"Controls should not be null!"),this.children_.push(i.create(this.overflowMenu_,this.controls))):shaka.log.alwaysWarn("Unrecognized overflow menu element requested:",i)},shaka.ui.OverflowMenu.prototype.onOverflowMenuButtonClick_=function(){if(this.controls.anySettingsMenusAreOpen())this.controls.hideSettingsMenus();else{shaka.ui.Utils.setDisplay(this.overflowMenu_,!0),this.controls.computeOpacity();var t=function(r){return 0==r.classList.contains("shaka-hidden")},i=shaka.util.Iterables;i.some(this.overflowMenu_.childNodes,t)&&i.filter(this.overflowMenu_.childNodes,t)[0].focus()}},shaka.ui.OverflowMenu.prototype.updateAriaLabel_=function(){this.overflowMenuButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.MORE_SETTINGS))},goog.exportSymbol("shaka.ui.OverflowMenu",shaka.ui.OverflowMenu),goog.exportProperty(shaka.ui.OverflowMenu,"registerElement",shaka.ui.OverflowMenu.registerElement),shaka.ui.OverflowMenu.Factory=function(){},shaka.ui.OverflowMenu.Factory.prototype.create=function(t,i){return new shaka.ui.OverflowMenu(t,i)},shaka.ui.Controls.registerElement("overflow_menu",new shaka.ui.OverflowMenu.Factory),shaka.ui.OverflowMenu.elementNamesToFactories_=new Map,shaka.ui.AirPlayButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.airplayButton_=shaka.util.Dom.createButton(),this.airplayButton_.classList.add("shaka-airplay-button"),this.airplayButton_.setAttribute("aria-pressed","false"),this.airplayIcon_=shaka.util.Dom.createHTMLElement("i"),this.airplayIcon_.classList.add("material-icons-round"),this.airplayIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.AIRPLAY,this.airplayButton_.appendChild(this.airplayIcon_);var o=shaka.util.Dom.createHTMLElement("label");o.classList.add("shaka-overflow-button-label"),o.classList.add("shaka-overflow-menu-only"),this.airplayNameSpan_=shaka.util.Dom.createHTMLElement("span"),o.appendChild(this.airplayNameSpan_),this.airplayCurrentSelectionSpan_=shaka.util.Dom.createHTMLElement("span"),this.airplayCurrentSelectionSpan_.classList.add("shaka-current-selection-span"),o.appendChild(this.airplayCurrentSelectionSpan_),this.airplayButton_.appendChild(o),this.parent.appendChild(this.airplayButton_),this.updateLocalizedStrings_(),this.onAirPlayStatusChange_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.airplayButton_,"click",function(){r.onAirPlayClick_()}),o=this.controls.getVideo(),goog.asserts.assert(null!=o,"Should have a video!"),this.eventManager.listen(o,"webkitplaybacktargetavailabilitychanged",function(l){r.onAirPlayAvailabilityChange_(l)}),this.eventManager.listen(o,"webkitcurrentplaybacktargetiswirelesschanged",function(){r.onAirPlayStatusChange_()})},$jscomp.inherits(shaka.ui.AirPlayButton,shaka.ui.Element),shaka.ui.AirPlayButton.prototype.onAirPlayClick_=function(){var t=this.controls.getVideo();goog.asserts.assert(null!=t,"Should have a video!"),t.webkitShowPlaybackTargetPicker()},shaka.ui.AirPlayButton.prototype.onAirPlayAvailabilityChange_=function(t){t="available"==t.availability;var i=this.player.getLoadMode()==shaka.Player.LoadMode.SRC_EQUALS;shaka.ui.Utils.setDisplay(this.airplayButton_,t&&i)},shaka.ui.AirPlayButton.prototype.onAirPlayStatusChange_=function(){var t=this.controls.getVideo();goog.asserts.assert(null!=t,"Should have a video!"),this.airplayButton_.ariaPressed=t&&t.webkitCurrentPlaybackTargetIsWireless?"true":"false"},shaka.ui.AirPlayButton.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.airplayButton_.ariaLabel=this.localization.resolve(t.AIRPLAY),this.airplayNameSpan_.textContent=this.localization.resolve(t.AIRPLAY)},goog.exportSymbol("shaka.ui.AirPlayButton",shaka.ui.AirPlayButton),shaka.ui.AirPlayButton.Factory=function(){},shaka.ui.AirPlayButton.Factory.prototype.create=function(t,i){return new shaka.ui.AirPlayButton(t,i)},shaka.ui.OverflowMenu.registerElement("airplay",new shaka.ui.AirPlayButton.Factory),shaka.ui.Controls.registerElement("airplay",new shaka.ui.AirPlayButton.Factory),shaka.ui.Overlay=function(t,i,r){this.player_=t,this.config_=this.defaultConfig_(),i.dataset.shakaPlayerContainer="",i.ui=this,this.isMobile()&&i.classList.add("shaka-mobile"),this.controls_=new shaka.ui.Controls(t,i,r,this.config_),this.configure({}),r.controls||t.setVideoContainer(i),i.ui=this,r.ui=this},shaka.ui.Overlay.prototype.destroy=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return 1==i.nextAddress?t.controls_?i.yield(t.controls_.destroy(),2):i.jumpTo(2):4!=i.nextAddress?(t.controls_=null,t.player_?i.yield(t.player_.destroy(),4):i.jumpTo(4)):(t.player_=null,void i.jumpToEnd())})},shaka.ui.Overlay.prototype.isMobile=function(){return shaka.util.Platform.isMobile()},shaka.ui.Overlay.prototype.getConfiguration=function(){var t=this.defaultConfig_();return shaka.util.ConfigUtils.mergeConfigObjects(t,this.config_,this.defaultConfig_(),{},""),t},shaka.ui.Overlay.prototype.configure=function(t,i){goog.asserts.assert("object"==typeof t||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof t&&(t=shaka.util.ConfigUtils.convertToConfigObject(t,i)),goog.asserts.assert("object"==typeof t,"Should be an object!"),shaka.util.ConfigUtils.mergeConfigObjects(this.config_,t,this.defaultConfig_(),{},""),this.config_.castReceiverAppId&&!this.config_.overflowMenuButtons.includes("cast")&&this.config_.overflowMenuButtons.push("cast"),goog.asserts.assert(null!=this.player_,"Should have a player!"),this.controls_.configure(this.config_),this.controls_.dispatchEvent(new shaka.util.FakeEvent("uiupdated"))},shaka.ui.Overlay.prototype.getControls=function(){return this.controls_},shaka.ui.Overlay.prototype.setEnabled=function(t){this.controls_.setEnabledShakaControls(t)},shaka.ui.Overlay.prototype.defaultConfig_=function(){var t={controlPanelElements:"play_pause time_and_duration spacer mute volume fullscreen overflow_menu".split(" "),overflowMenuButtons:"captions quality language picture_in_picture cast playback_rate".split(" "),addSeekBar:!0,addBigPlayButton:!1,castReceiverAppId:"",clearBufferOnQualityChange:!0,showUnbufferedStart:!1,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"},volumeBarColors:{base:"rgba(255, 255, 255, 0.54)",level:"rgb(255, 255, 255)"},trackLabelFormat:shaka.ui.Overlay.TrackLabelFormat.LANGUAGE,fadeDelay:0,doubleClickForFullscreen:!0,enableKeyboardPlaybackControls:!0,enableFullscreenOnRotation:!0,forceLandscapeOnFullscreen:!0};return window.WebKitPlaybackTargetAvailabilityEvent&&t.overflowMenuButtons.push("airplay"),this.isMobile()&&(t.addBigPlayButton=!0,t.controlPanelElements=t.controlPanelElements.filter(function(i){return"play_pause"!=i&&"volume"!=i})),t},shaka.ui.Overlay.scanPageForShakaElements_=function(){var t,i,r,o,l,g,v,E,P,M,R,U,$;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){switch(G.nextAddress){case 1:if(shaka.polyfill.installAll(),!shaka.Player.isBrowserSupported())return shaka.log.error("Shaka Player does not support this browser. Please see https://tinyurl.com/y7s4j9tr for the list of supported browsers."),shaka.ui.Overlay.dispatchLoadedEvent_("shaka-ui-load-failed",shaka.ui.Overlay.FailReasonCode.NO_BROWSER_SUPPORT),G.return();if(t=document.querySelectorAll("[data-shaka-player-container]"),!(i=document.querySelectorAll("[data-shaka-player]")).length&&!t.length){G.jumpTo(2);break}if(i.length&&!t.length){for(r=$jscomp.makeIterator(i),o=r.next();!o.done;o=r.next())(l=o.value).ui||(goog.asserts.assert("video"==l.tagName.toLowerCase(),"Should be a video element!"),g=document.createElement("div"),l.parentElement.replaceChild(g,l),g.appendChild(l),shaka.ui.Overlay.setupUIandAutoLoad_(g,l));G.jumpTo(2);break}v=$jscomp.makeIterator(t),E=v.next();case 4:if(E.done){G.jumpTo(2);break}if((P=E.value).ui){G.jumpTo(5);break}for(goog.asserts.assert("div"==P.tagName.toLowerCase(),"Container should be a div!"),M=null,R=$jscomp.makeIterator(i),o=R.next();!o.done;o=R.next())if(goog.asserts.assert("video"==(U=o.value).tagName.toLowerCase(),"Should be a video element!"),U.parentElement==P){M=U;break}return M||((M=document.createElement("video")).setAttribute("playsinline",""),P.appendChild(M)),G.setCatchFinallyBlocks(7),G.yield(shaka.ui.Overlay.setupUIandAutoLoad_(P,M),9);case 9:G.leaveTryBlock(5);break;case 7:return $=G.enterCatchBlock(),shaka.log.error("Error setting up Shaka Player",$),shaka.ui.Overlay.dispatchLoadedEvent_("shaka-ui-load-failed",shaka.ui.Overlay.FailReasonCode.PLAYER_FAILED_TO_LOAD),G.return();case 5:E=v.next(),G.jumpTo(4);break;case 2:shaka.ui.Overlay.dispatchLoadedEvent_("shaka-ui-loaded"),G.jumpToEnd()}})},shaka.ui.Overlay.dispatchLoadedEvent_=function(t,i){var r=null;null!=i&&(r={reasonCode:i}),r=new CustomEvent(t,{detail:r}),document.dispatchEvent(r)},shaka.ui.Overlay.setupUIandAutoLoad_=function(t,i){var r,o,l,g,_,v,E,P,M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(R){switch(R.nextAddress){case 1:r=new shaka.Player(shaka.util.Dom.asHTMLMediaElement(i)),o=new shaka.ui.Overlay(r,shaka.util.Dom.asHTMLElement(t),shaka.util.Dom.asHTMLMediaElement(i)),l="",t.dataset&&t.dataset.shakaPlayerCastReceiverId?l=t.dataset.shakaPlayerCastReceiverId:i.dataset&&i.dataset.shakaPlayerCastReceiverId&&(l=i.dataset.shakaPlayerCastReceiverId),l.length&&o.configure({castReceiverAppId:l}),shaka.util.Dom.asHTMLMediaElement(i).controls&&o.getControls().setEnabledNativeControls(!0),(g=i.getAttribute("src"))&&((_=document.createElement("source")).setAttribute("src",g),i.appendChild(_),i.removeAttribute("src")),v=$jscomp.makeIterator(i.querySelectorAll("source")),E=v.next();case 2:if(E.done){R.jumpTo(0);break}return P=E.value,R.setCatchFinallyBlocks(5),R.yield(o.getControls().getPlayer().load(P.getAttribute("src")),7);case 7:R.jumpTo(0);break;case 5:M=R.enterCatchBlock(),shaka.log.error("Error auto-loading asset",M);case 3:E=v.next(),R.jumpTo(2)}})},goog.exportSymbol("shaka.ui.Overlay",shaka.ui.Overlay),goog.exportProperty(shaka.ui.Overlay.prototype,"setEnabled",shaka.ui.Overlay.prototype.setEnabled),goog.exportProperty(shaka.ui.Overlay.prototype,"getControls",shaka.ui.Overlay.prototype.getControls),goog.exportProperty(shaka.ui.Overlay.prototype,"configure",shaka.ui.Overlay.prototype.configure),goog.exportProperty(shaka.ui.Overlay.prototype,"getConfiguration",shaka.ui.Overlay.prototype.getConfiguration),goog.exportProperty(shaka.ui.Overlay.prototype,"isMobile",shaka.ui.Overlay.prototype.isMobile),goog.exportProperty(shaka.ui.Overlay.prototype,"destroy",shaka.ui.Overlay.prototype.destroy),shaka.ui.Overlay.TrackLabelFormat={LANGUAGE:0,ROLE:1,LANGUAGE_ROLE:2,LABEL:3},goog.exportProperty(shaka.ui.Overlay,"TrackLabelFormat",shaka.ui.Overlay.TrackLabelFormat),shaka.ui.TrackLabelFormat=shaka.ui.Overlay.TrackLabelFormat,shaka.ui.Overlay.FailReasonCode={NO_BROWSER_SUPPORT:0,PLAYER_FAILED_TO_LOAD:1},goog.exportProperty(shaka.ui.Overlay,"FailReasonCode",shaka.ui.Overlay.FailReasonCode),shaka.ui.FailReasonCode=shaka.ui.Overlay.FailReasonCode,"complete"==document.readyState?$jscomp.asyncExecutePromiseGeneratorProgram(function(t){if(1==t.nextAddress)return t.yield(Promise.resolve(),2);shaka.ui.Overlay.scanPageForShakaElements_(),t.jumpToEnd()}):window.addEventListener("load",shaka.ui.Overlay.scanPageForShakaElements_),shaka.ui.LanguageUtils=function(){},shaka.ui.LanguageUtils.updateTracks=function(t,i,r,o,l,g,_){var v=t.find(function(Q){return 1==Q.active}),E=shaka.ui.Utils.getFirstDescendantWithClassName(i,"shaka-back-to-overflow-button");shaka.util.Dom.removeAllChildren(i),i.appendChild(E),E=function(Q){return"variant"==Q.type?Q.audioRoles?Q.audioRoles.join(", "):void 0:Q.roles.join(", ")};for(var P=function(Q,te){return Q+": "+te},M=new Map,R=$jscomp.makeIterator(t),U=R.next();!U.done;U=R.next())M.has((U=U.value).language)||M.set(U.language,new Set),M.get(U.language).add(E(U));for(M=new Set,v=v?P(v.language,E(v)):"",R={},U=(t=$jscomp.makeIterator(t)).next();!U.done;R={$jscomp$loop$prop$track$611$671:R.$jscomp$loop$prop$track$611$671},U=t.next()){R.$jscomp$loop$prop$track$611$671=U.value,U=R.$jscomp$loop$prop$track$611$671.language;var $=R.$jscomp$loop$prop$track$611$671.forced,G=g.resolve(shaka.ui.Locales.Ids.SUBTITLE_FORCED),z=E(R.$jscomp$loop$prop$track$611$671),Z=P(U,z);if(!M.has(Z)){M.add(Z);var Y=shaka.util.Dom.createButton();Y.addEventListener("click",function(Q){return function(){r(Q.$jscomp$loop$prop$track$611$671)}}(R));var se=shaka.util.Dom.createHTMLElement("span");switch(Y.appendChild(se),se.textContent=shaka.ui.LanguageUtils.getLanguageName(U,g),_){case shaka.ui.Overlay.TrackLabelFormat.LANGUAGE:$&&(se.textContent+=" ("+G+")");break;case shaka.ui.Overlay.TrackLabelFormat.ROLE:z?se.textContent=z:(shaka.log.alwaysWarn("Track #"+R.$jscomp$loop$prop$track$611$671.id+" does not have a role, but the UI is configured to only show role."),se.textContent="?"),$&&(se.textContent+=" ("+G+")");break;case shaka.ui.Overlay.TrackLabelFormat.LANGUAGE_ROLE:z&&(se.textContent+=": "+z),$&&(se.textContent+=" ("+G+")");break;case shaka.ui.Overlay.TrackLabelFormat.LABEL:R.$jscomp$loop$prop$track$611$671.label?se.textContent=R.$jscomp$loop$prop$track$611$671.label:(shaka.log.alwaysWarn("Track #"+R.$jscomp$loop$prop$track$611$671.id+" does not have a label, but the UI is configured to only show labels."),se.textContent="?")}o&&Z==v&&(Y.appendChild(shaka.ui.Utils.checkmarkIcon()),se.classList.add("shaka-chosen-item"),Y.setAttribute("aria-selected","true"),l.textContent=se.textContent),i.appendChild(Y)}}},shaka.ui.LanguageUtils.getLanguageName=function(t,i){if(!t&&!i)return"";switch(t){case"mul":return i.resolve(shaka.ui.Locales.Ids.MULTIPLE_LANGUAGES);case"und":return i.resolve(shaka.ui.Locales.Ids.UNDETERMINED_LANGUAGE);case"zxx":return i.resolve(shaka.ui.Locales.Ids.NOT_APPLICABLE)}var r=shaka.util.LanguageUtils.getBase(t);return t in mozilla.LanguageMapping?mozilla.LanguageMapping[t].nativeName:r in mozilla.LanguageMapping?mozilla.LanguageMapping[r].nativeName+" ("+t+")":i.resolve(shaka.ui.Locales.Ids.UNRECOGNIZED_LANGUAGE)+" ("+t+")"},shaka.ui.SettingsMenu=function(t,i,r){shaka.ui.Element.call(this,t,i);var o=this;this.addButton_(r),this.addMenu_(),this.eventManager.listen(this.button,"click",function(){o.onButtonClick_()})},$jscomp.inherits(shaka.ui.SettingsMenu,shaka.ui.Element),shaka.ui.SettingsMenu.prototype.addButton_=function(t){this.button=shaka.util.Dom.createButton(),this.icon=shaka.util.Dom.createHTMLElement("i"),this.icon.classList.add("material-icons-round"),this.icon.textContent=t,this.button.appendChild(this.icon),(t=shaka.util.Dom.createHTMLElement("label")).classList.add("shaka-overflow-button-label"),this.nameSpan=shaka.util.Dom.createHTMLElement("span"),t.appendChild(this.nameSpan),this.currentSelection=shaka.util.Dom.createHTMLElement("span"),this.currentSelection.classList.add("shaka-current-selection-span"),t.appendChild(this.currentSelection),this.button.appendChild(t),this.parent.appendChild(this.button)},shaka.ui.SettingsMenu.prototype.addMenu_=function(){this.menu=shaka.util.Dom.createHTMLElement("div"),this.menu.classList.add("shaka-no-propagation"),this.menu.classList.add("shaka-show-controls-on-mouse-over"),this.menu.classList.add("shaka-settings-menu"),this.menu.classList.add("shaka-hidden"),this.backButton=shaka.util.Dom.createButton(),this.backButton.classList.add("shaka-back-to-overflow-button"),this.menu.appendChild(this.backButton);var t=shaka.util.Dom.createHTMLElement("i");t.classList.add("material-icons-round"),t.textContent=shaka.ui.Enums.MaterialDesignIcons.BACK,this.backButton.appendChild(t),this.backSpan=shaka.util.Dom.createHTMLElement("span"),this.backButton.appendChild(this.backSpan),this.controls.getControlsContainer().appendChild(this.menu)},shaka.ui.SettingsMenu.prototype.onButtonClick_=function(){this.controls.dispatchEvent(new shaka.util.FakeEvent("submenuopen")),shaka.ui.Utils.setDisplay(this.menu,!0),shaka.ui.Utils.focusOnTheChosenItem(this.menu)},goog.exportSymbol("shaka.ui.SettingsMenu",shaka.ui.SettingsMenu),shaka.ui.AudioLanguageSelection=function(t,i){shaka.ui.SettingsMenu.call(this,t,i,shaka.ui.Enums.MaterialDesignIcons.LANGUAGE);var r=this;this.button.classList.add("shaka-language-button"),this.menu.classList.add("shaka-audio-languages"),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.player,"trackschanged",function(){r.onTracksChanged_()}),this.eventManager.listen(this.player,"variantchanged",function(){r.updateAudioLanguages_()}),this.updateLocalizedStrings_(),this.updateAudioLanguages_()},$jscomp.inherits(shaka.ui.AudioLanguageSelection,shaka.ui.SettingsMenu),shaka.ui.AudioLanguageSelection.prototype.updateAudioLanguages_=function(){var t=this,i=this.player.getVariantTracks();shaka.ui.LanguageUtils.updateTracks(i,this.menu,function(r){return t.onAudioTrackSelected_(r)},!0,this.currentSelection,this.localization,this.controls.getConfig().trackLabelFormat),shaka.ui.Utils.focusOnTheChosenItem(this.menu),this.controls.dispatchEvent(new shaka.util.FakeEvent("languageselectionupdated"))},shaka.ui.AudioLanguageSelection.prototype.onTracksChanged_=function(){var t=0<this.player.getVariantTracks().length;shaka.ui.Utils.setDisplay(this.button,t),this.updateAudioLanguages_()},shaka.ui.AudioLanguageSelection.prototype.onAudioTrackSelected_=function(t){this.player.selectAudioLanguage(t.language,t.roles[0])},shaka.ui.AudioLanguageSelection.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.BACK)),this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.LANGUAGE)),this.nameSpan.textContent=this.localization.resolve(t.LANGUAGE),this.backSpan.textContent=this.localization.resolve(t.LANGUAGE)},goog.exportSymbol("shaka.ui.AudioLanguageSelection",shaka.ui.AudioLanguageSelection),shaka.ui.AudioLanguageSelection.Factory=function(){},shaka.ui.AudioLanguageSelection.Factory.prototype.create=function(t,i){return new shaka.ui.AudioLanguageSelection(t,i)},shaka.ui.OverflowMenu.registerElement("language",new shaka.ui.AudioLanguageSelection.Factory),shaka.ui.CastButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.castProxy_=this.controls.getCastProxy(),this.castButton_=shaka.util.Dom.createButton(),this.castButton_.classList.add("shaka-cast-button"),this.castButton_.setAttribute("aria-pressed","false"),this.castIcon_=shaka.util.Dom.createHTMLElement("i"),this.castIcon_.classList.add("material-icons-round"),this.castIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.CAST,this.castButton_.appendChild(this.castIcon_);var o=shaka.util.Dom.createHTMLElement("label");o.classList.add("shaka-overflow-button-label"),o.classList.add("shaka-overflow-menu-only"),this.castNameSpan_=shaka.util.Dom.createHTMLElement("span"),o.appendChild(this.castNameSpan_),this.castCurrentSelectionSpan_=shaka.util.Dom.createHTMLElement("span"),this.castCurrentSelectionSpan_.classList.add("shaka-current-selection-span"),o.appendChild(this.castCurrentSelectionSpan_),this.castButton_.appendChild(o),this.parent.appendChild(this.castButton_),this.updateLocalizedStrings_(),this.onCastStatusChange_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.castButton_,"click",function(){r.onCastClick_()}),this.eventManager.listen(this.controls,"caststatuschanged",function(){r.onCastStatusChange_()})},$jscomp.inherits(shaka.ui.CastButton,shaka.ui.Element),shaka.ui.CastButton.prototype.onCastClick_=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return 1==r.nextAddress?t.castProxy_.isCasting()?(t.castProxy_.suggestDisconnect(),r.jumpTo(0)):(r.setCatchFinallyBlocks(3),t.castButton_.disabled=!0,r.yield(t.castProxy_.cast(),5)):3!=r.nextAddress?(t.castButton_.disabled=!1,r.leaveTryBlock(0)):(i=r.enterCatchBlock(),t.castButton_.disabled=!1,i.code!=shaka.util.Error.Code.CAST_CANCELED_BY_USER&&t.controls.dispatchEvent(new shaka.util.FakeEvent("error",{detail:i})),void r.jumpToEnd())})},shaka.ui.CastButton.prototype.onCastStatusChange_=function(){var t=this.castProxy_.canCast()&&this.controls.isCastAllowed(),i=this.castProxy_.isCasting(),r=shaka.ui.Enums.MaterialDesignIcons;shaka.ui.Utils.setDisplay(this.castButton_,t),this.castIcon_.textContent=i?r.EXIT_CAST:r.CAST,t&&this.castButton_.setAttribute("aria-pressed",i?"true":"false"),this.setCurrentCastSelection_()},shaka.ui.CastButton.prototype.setCurrentCastSelection_=function(){this.castCurrentSelectionSpan_.textContent=this.castProxy_.isCasting()?this.castProxy_.receiverName():this.localization.resolve(shaka.ui.Locales.Ids.OFF)},shaka.ui.CastButton.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.castButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.CAST)),this.castNameSpan_.textContent=this.localization.resolve(t.CAST),this.setCurrentCastSelection_()},goog.exportSymbol("shaka.ui.CastButton",shaka.ui.CastButton),shaka.ui.CastButton.Factory=function(){},shaka.ui.CastButton.Factory.prototype.create=function(t,i){return new shaka.ui.CastButton(t,i)},shaka.ui.OverflowMenu.registerElement("cast",new shaka.ui.CastButton.Factory),shaka.ui.Controls.registerElement("cast",new shaka.ui.CastButton.Factory),shaka.ui.FastForwardButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("material-icons-round"),this.button_.classList.add("shaka-fast-forward-button"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.FAST_FORWARD,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.button_,"click",function(){r.fastForward_()})},$jscomp.inherits(shaka.ui.FastForwardButton,shaka.ui.Element),shaka.ui.FastForwardButton.prototype.updateAriaLabel_=function(){this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.FAST_FORWARD))},shaka.ui.FastForwardButton.prototype.fastForward_=function(){if(this.video.duration){var t=this.player.getPlaybackRate();this.player.trickPlay(0>t||4<t?1:2*t)}},goog.exportSymbol("shaka.ui.FastForwardButton",shaka.ui.FastForwardButton),shaka.ui.FastForwardButton.Factory=function(){},shaka.ui.FastForwardButton.Factory.prototype.create=function(t,i){return new shaka.ui.FastForwardButton(t,i)},shaka.ui.Controls.registerElement("fast_forward",new shaka.ui.FastForwardButton.Factory),shaka.ui.FullscreenButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-fullscreen-button"),this.button_.classList.add("material-icons-round"),document.fullscreenEnabled||this.button_.classList.add("shaka-hidden"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.FULLSCREEN,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.button_,"click",function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(o){return o.yield(r.controls.toggleFullScreen(),0)})}),this.eventManager.listen(document,"fullscreenchange",function(){r.updateIcon_(),r.updateAriaLabel_()})},$jscomp.inherits(shaka.ui.FullscreenButton,shaka.ui.Element),shaka.ui.FullscreenButton.prototype.updateAriaLabel_=function(){var t=shaka.ui.Locales.Ids;this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(document.fullscreenElement?t.EXIT_FULL_SCREEN:t.FULL_SCREEN))},shaka.ui.FullscreenButton.prototype.updateIcon_=function(){this.button_.textContent=document.fullscreenElement?shaka.ui.Enums.MaterialDesignIcons.EXIT_FULLSCREEN:shaka.ui.Enums.MaterialDesignIcons.FULLSCREEN},goog.exportSymbol("shaka.ui.FullscreenButton",shaka.ui.FullscreenButton),shaka.ui.FullscreenButton.Factory=function(){},shaka.ui.FullscreenButton.Factory.prototype.create=function(t,i){return new shaka.ui.FullscreenButton(t,i)},shaka.ui.Controls.registerElement("fullscreen",new shaka.ui.FullscreenButton.Factory),shaka.ui.LoopButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this,o=shaka.ui.Locales.Ids;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-loop-button"),this.icon_=shaka.util.Dom.createHTMLElement("i"),this.icon_.classList.add("material-icons-round"),this.icon_.textContent=shaka.ui.Enums.MaterialDesignIcons.LOOP,this.button_.appendChild(this.icon_);var l=shaka.util.Dom.createHTMLElement("label");l.classList.add("shaka-overflow-button-label"),l.classList.add("shaka-overflow-menu-only"),this.nameSpan_=shaka.util.Dom.createHTMLElement("span"),this.nameSpan_.textContent=this.localization.resolve(o.LOOP),l.appendChild(this.nameSpan_),this.currentState_=shaka.util.Dom.createHTMLElement("span"),this.currentState_.classList.add("shaka-current-selection-span"),l.appendChild(this.currentState_),this.button_.appendChild(l),this.updateLocalizedStrings_(),this.parent.appendChild(this.button_),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.button_,"click",function(){r.onClick_()}),this.loopEnabled_=this.video.loop,this.timer_=new shaka.util.Timer(function(){r.onTimerTick_()}),this.timer_.tickEvery(1)},$jscomp.inherits(shaka.ui.LoopButton,shaka.ui.Element),shaka.ui.LoopButton.prototype.release=function(){this.timer_.stop(),this.timer_=null,shaka.ui.Element.prototype.release.call(this)},shaka.ui.LoopButton.prototype.onClick_=function(){this.video.loop=!this.video.loop,this.timer_.tickNow(),this.timer_.tickEvery(1)},shaka.ui.LoopButton.prototype.onTimerTick_=function(){this.loopEnabled_!=this.video.loop&&(this.updateLocalizedStrings_(),this.loopEnabled_=this.video.loop)},shaka.ui.LoopButton.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids,i=shaka.ui.Enums.MaterialDesignIcons;this.nameSpan_.textContent=this.localization.resolve(t.LOOP),this.currentState_.textContent=this.localization.resolve(this.video.loop?t.ON:t.OFF),this.icon_.textContent=this.video.loop?i.UNLOOP:i.LOOP,this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(this.video.loop?t.EXIT_LOOP_MODE:t.ENTER_LOOP_MODE))},goog.exportSymbol("shaka.ui.LoopButton",shaka.ui.LoopButton),shaka.ui.LoopButton.Factory=function(){},shaka.ui.LoopButton.Factory.prototype.create=function(t,i){return new shaka.ui.LoopButton(t,i)},shaka.ui.OverflowMenu.registerElement("loop",new shaka.ui.LoopButton.Factory),shaka.ui.Controls.registerElement("loop",new shaka.ui.LoopButton.Factory),shaka.ui.MuteButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-mute-button"),this.button_.classList.add("material-icons-round"),this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.updateIcon_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.button_,"click",function(){r.ad?r.ad.setMuted(!r.ad.isMuted()):r.video.muted=!r.video.muted}),this.eventManager.listen(this.video,"volumechange",function(){r.updateAriaLabel_(),r.updateIcon_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_VOLUME_CHANGED,function(){r.updateAriaLabel_(),r.updateIcon_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_MUTED,function(){r.updateAriaLabel_(),r.updateIcon_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){r.ad=null,r.updateAriaLabel_(),r.updateIcon_()})},$jscomp.inherits(shaka.ui.MuteButton,shaka.ui.Element),shaka.ui.MuteButton.prototype.updateAriaLabel_=function(){var t=shaka.ui.Locales.Ids;t=this.ad?this.ad.isMuted()?t.UNMUTE:t.MUTE:this.video.muted?t.UNMUTE:t.MUTE,this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t))},shaka.ui.MuteButton.prototype.updateIcon_=function(){var t=shaka.ui.Enums.MaterialDesignIcons;t=this.ad?this.ad.isMuted()?t.UNMUTE:t.MUTE:this.video.muted?t.UNMUTE:t.MUTE,this.button_.textContent=t},goog.exportSymbol("shaka.ui.MuteButton",shaka.ui.MuteButton),shaka.ui.MuteButton.Factory=function(){},shaka.ui.MuteButton.Factory.prototype.create=function(t,i){return new shaka.ui.MuteButton(t,i)},shaka.ui.Controls.registerElement("mute",new shaka.ui.MuteButton.Factory),shaka.ui.PipButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.localVideo_=this.controls.getLocalVideo();var o=shaka.ui.Locales.Ids;this.pipButton_=shaka.util.Dom.createButton(),this.pipButton_.classList.add("shaka-pip-button"),this.pipIcon_=shaka.util.Dom.createHTMLElement("i"),this.pipIcon_.classList.add("material-icons-round"),this.pipIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.PIP,this.pipButton_.appendChild(this.pipIcon_);var l=shaka.util.Dom.createHTMLElement("label");l.classList.add("shaka-overflow-button-label"),l.classList.add("shaka-overflow-menu-only"),this.pipNameSpan_=shaka.util.Dom.createHTMLElement("span"),this.pipNameSpan_.textContent=this.localization.resolve(o.PICTURE_IN_PICTURE),l.appendChild(this.pipNameSpan_),this.currentPipState_=shaka.util.Dom.createHTMLElement("span"),this.currentPipState_.classList.add("shaka-current-selection-span"),l.appendChild(this.currentPipState_),this.pipButton_.appendChild(l),this.updateLocalizedStrings_(),this.parent.appendChild(this.pipButton_),this.isPipAllowed_()||shaka.ui.Utils.setDisplay(this.pipButton_,!1),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.pipButton_,"click",function(){r.onPipClick_()}),this.eventManager.listen(this.localVideo_,"enterpictureinpicture",function(){r.onEnterPictureInPicture_()}),this.eventManager.listen(this.localVideo_,"leavepictureinpicture",function(){r.onLeavePictureInPicture_()}),this.eventManager.listen(this.controls,"caststatuschanged",function(g){r.onCastStatusChange_(g)}),this.eventManager.listen(this.player,"trackschanged",function(){r.onTracksChanged_()})},$jscomp.inherits(shaka.ui.PipButton,shaka.ui.Element),shaka.ui.PipButton.prototype.isPipAllowed_=function(){return document.pictureInPictureEnabled&&!this.video.disablePictureInPicture},shaka.ui.PipButton.prototype.onPipClick_=function(){var i,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return 1==r.nextAddress?(r.setCatchFinallyBlocks(2),document.pictureInPictureElement?r.yield(document.exitPictureInPicture(),5):(document.fullscreenElement&&document.exitFullscreen(),r.yield(t.video.requestPictureInPicture(),5))):2!=r.nextAddress?r.leaveTryBlock(0):(i=r.enterCatchBlock(),t.controls.dispatchEvent(new shaka.util.FakeEvent("error",{detail:i})),void r.jumpToEnd())})},shaka.ui.PipButton.prototype.onEnterPictureInPicture_=function(){var t=shaka.ui.Locales.Ids;this.pipIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.EXIT_PIP,this.pipButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.EXIT_PICTURE_IN_PICTURE)),this.currentPipState_.textContent=this.localization.resolve(t.ON)},shaka.ui.PipButton.prototype.onLeavePictureInPicture_=function(){var t=shaka.ui.Locales.Ids;this.pipIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.PIP,this.pipButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.ENTER_PICTURE_IN_PICTURE)),this.currentPipState_.textContent=this.localization.resolve(t.OFF)},shaka.ui.PipButton.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.pipNameSpan_.textContent=this.localization.resolve(t.PICTURE_IN_PICTURE),this.pipButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(document.pictureInPictureElement?t.EXIT_PICTURE_IN_PICTURE:t.ENTER_PICTURE_IN_PICTURE)),this.currentPipState_.textContent=this.localization.resolve(document.pictureInPictureElement?t.ON:t.OFF)},shaka.ui.PipButton.prototype.onCastStatusChange_=function(t){t.newStatus?this.isPipAllowed_()&&shaka.ui.Utils.setDisplay(this.pipButton_,!1):this.isPipAllowed_()&&shaka.ui.Utils.setDisplay(this.pipButton_,!0)},shaka.ui.PipButton.prototype.onTracksChanged_=function(){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(i){return t.isPipAllowed_()?t.player&&t.player.isAudioOnly()?(shaka.ui.Utils.setDisplay(t.pipButton_,!1),document.pictureInPictureElement?i.yield(document.exitPictureInPicture(),0):i.jumpTo(0)):(shaka.ui.Utils.setDisplay(t.pipButton_,!0),i.jumpTo(0)):(shaka.ui.Utils.setDisplay(t.pipButton_,!1),i.jumpTo(0))})},goog.exportSymbol("shaka.ui.PipButton",shaka.ui.PipButton),shaka.ui.PipButton.Factory=function(){},shaka.ui.PipButton.Factory.prototype.create=function(t,i){return new shaka.ui.PipButton(t,i)},shaka.ui.OverflowMenu.registerElement("picture_in_picture",new shaka.ui.PipButton.Factory),shaka.ui.Controls.registerElement("picture_in_picture",new shaka.ui.PipButton.Factory),shaka.ui.PlaybackRateSelection=function(t,i){shaka.ui.SettingsMenu.call(this,t,i,shaka.ui.Enums.MaterialDesignIcons.PLAYBACK_RATE);var r=this;this.button.classList.add("shaka-playbackrate-button"),this.menu.classList.add("shaka-playback-rates"),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.player,"ratechange",function(){r.updatePlaybackRateSelection_(r.player.getPlaybackRate())}),this.playbackRates_=new Map([["0.5x",.5],["0.75x",.75],["1x",1],["1.25x",1.25],["1.5x",1.5],["1.75x",1.75],["2x",2]]),this.updateLocalizedStrings_(),this.addPlaybackRates_(),this.updatePlaybackRateSelection_(this.player.getPlaybackRate())},$jscomp.inherits(shaka.ui.PlaybackRateSelection,shaka.ui.SettingsMenu),shaka.ui.PlaybackRateSelection.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.BACK)),this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.PLAYBACK_RATE)),this.nameSpan.textContent=this.localization.resolve(t.PLAYBACK_RATE),this.backSpan.textContent=this.localization.resolve(t.PLAYBACK_RATE)},shaka.ui.PlaybackRateSelection.prototype.updatePlaybackRateSelection_=function(t){var i=this,r=shaka.ui.Utils.getDescendantIfExists(this.menu,"material-icons-round shaka-chosen-item");if(r){var o=r.parentElement;o.removeAttribute("aria-selected"),o.getElementsByTagName("span")[0].classList.remove("shaka-chosen-item"),o.removeChild(r)}(r=Array.from(this.menu.querySelectorAll("span")).find(function(l){return i.playbackRates_.get(l.textContent)==t}))&&((o=r.parentElement).appendChild(shaka.ui.Utils.checkmarkIcon()),o.setAttribute("aria-selected","true"),r.classList.add("shaka-chosen-item")),this.currentSelection.textContent=t+"x"},shaka.ui.PlaybackRateSelection.prototype.addPlaybackRates_=function(){for(var t=this,i={},r=$jscomp.makeIterator(this.playbackRates_.keys()),o=r.next();!o.done;i={$jscomp$loop$prop$rateStr$673:i.$jscomp$loop$prop$rateStr$673},o=r.next()){i.$jscomp$loop$prop$rateStr$673=o.value,o=shaka.util.Dom.createButton();var l=shaka.util.Dom.createHTMLElement("span");l.textContent=i.$jscomp$loop$prop$rateStr$673,o.appendChild(l),this.eventManager.listen(o,"click",function(g){return function(){t.video.playbackRate=t.playbackRates_.get(g.$jscomp$loop$prop$rateStr$673),t.video.defaultPlaybackRate=t.playbackRates_.get(g.$jscomp$loop$prop$rateStr$673)}}(i)),this.menu.appendChild(o)}shaka.ui.Utils.focusOnTheChosenItem(this.menu)},goog.exportSymbol("shaka.ui.PlaybackRateSelection",shaka.ui.PlaybackRateSelection),shaka.ui.PlaybackRateSelection.Factory=function(){},shaka.ui.PlaybackRateSelection.Factory.prototype.create=function(t,i){return new shaka.ui.PlaybackRateSelection(t,i)},shaka.ui.OverflowMenu.registerElement("playback_rate",new shaka.ui.PlaybackRateSelection.Factory),shaka.ui.PresentationTimeTracker=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.currentTime_=shaka.util.Dom.createButton(),this.currentTime_.classList.add("shaka-current-time"),this.setValue_("0:00"),this.parent.appendChild(this.currentTime_),this.eventManager.listen(this.currentTime_,"click",function(){r.player.isLive()&&(r.video.currentTime=r.player.seekRange().end)}),this.eventManager.listen(this.controls,"timeandseekrangeupdated",function(){r.updateTime_()}),this.eventManager.listen(this.player,"trackschanged",function(){r.onTracksChanged_()})},$jscomp.inherits(shaka.ui.PresentationTimeTracker,shaka.ui.Element),shaka.ui.PresentationTimeTracker.prototype.setValue_=function(t){t!=this.currentTime_.textContent&&(this.currentTime_.textContent=t)},shaka.ui.PresentationTimeTracker.prototype.updateTime_=function(){var t=this.controls.isSeeking(),i=this.controls.getDisplayTime(),r=this.video.duration,o=this.player.seekRange(),l=o.end-o.start,g=shaka.ui.Utils;this.player.isLive()?(r=3600<=l,1<=(i=Math.max(0,Math.floor(o.end-i)))||t?(this.setValue_("- "+g.buildTimeString(i,r)),this.currentTime_.disabled=!1):(this.setValue_(this.localization.resolve(shaka.ui.Locales.Ids.LIVE)),this.currentTime_.disabled=!0)):(i=g.buildTimeString(i,t=3600<=r),r&&(i+=" / "+g.buildTimeString(r,t)),this.setValue_(i),this.currentTime_.disabled=!0)},shaka.ui.PresentationTimeTracker.prototype.onTracksChanged_=function(){this.player.isLive()&&this.currentTime_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.SKIP_TO_LIVE))},goog.exportSymbol("shaka.ui.PresentationTimeTracker",shaka.ui.PresentationTimeTracker),shaka.ui.PresentationTimeTracker.Factory=function(){},shaka.ui.PresentationTimeTracker.Factory.prototype.create=function(t,i){return new shaka.ui.PresentationTimeTracker(t,i)},shaka.ui.Controls.registerElement("time_and_duration",new shaka.ui.PresentationTimeTracker.Factory),shaka.ui.ResolutionSelection=function(t,i){shaka.ui.SettingsMenu.call(this,t,i,shaka.ui.Enums.MaterialDesignIcons.RESOLUTION);var r=this;this.button.classList.add("shaka-resolution-button"),this.menu.classList.add("shaka-resolutions"),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_()}),this.eventManager.listen(this.player,"variantchanged",function(){r.updateResolutionSelection_()}),this.eventManager.listen(this.player,"trackschanged",function(){r.updateResolutionSelection_()}),this.eventManager.listen(this.player,"abrstatuschanged",function(){r.updateResolutionSelection_()}),this.updateResolutionSelection_(),this.updateLocalizedStrings_()},$jscomp.inherits(shaka.ui.ResolutionSelection,shaka.ui.SettingsMenu),shaka.ui.ResolutionSelection.prototype.updateResolutionSelection_=function(){var t=this,i=this.player.getVariantTracks();if(i.length&&!i[0].height)shaka.ui.Utils.setDisplay(this.menu,!1),shaka.ui.Utils.setDisplay(this.button,!1);else{shaka.ui.Utils.setDisplay(this.button,!0),i.sort(function(E,P){return goog.asserts.assert(null!=E.height,"Null height"),goog.asserts.assert(null!=P.height,"Null height"),P.height-E.height});var r=i.find(function(E){return E.active});r&&(i=i.filter(function(E){return E.language==r.language&&E.channelsCount==r.channelsCount})),i=i.filter(function(E,P){return i.findIndex(function(M){return M.height==E.height})==P});var o=shaka.ui.Utils.getFirstDescendantWithClassName(this.menu,"shaka-back-to-overflow-button");shaka.util.Dom.removeAllChildren(this.menu),this.menu.appendChild(o),o=this.player.getConfiguration().abr.enabled;for(var l={},g=$jscomp.makeIterator(i),_=g.next();!_.done;l={$jscomp$loop$prop$track$675:l.$jscomp$loop$prop$track$675},_=g.next()){l.$jscomp$loop$prop$track$675=_.value,(_=shaka.util.Dom.createButton()).classList.add("explicit-resolution"),this.eventManager.listen(_,"click",function(E){return function(){return t.onTrackSelected_(E.$jscomp$loop$prop$track$675)}}(l));var v=shaka.util.Dom.createHTMLElement("span");v.textContent=l.$jscomp$loop$prop$track$675.height+"p",_.appendChild(v),o||l.$jscomp$loop$prop$track$675!=r||(_.setAttribute("aria-selected","true"),_.appendChild(shaka.ui.Utils.checkmarkIcon()),v.classList.add("shaka-chosen-item"),this.currentSelection.textContent=v.textContent),this.menu.appendChild(_)}(l=shaka.util.Dom.createButton()).classList.add("shaka-enable-abr-button"),this.eventManager.listen(l,"click",function(){t.player.configure({abr:{enabled:!0}}),t.updateResolutionSelection_()}),this.abrOnSpan_=shaka.util.Dom.createHTMLElement("span"),this.abrOnSpan_.classList.add("shaka-auto-span"),this.abrOnSpan_.textContent=this.localization.resolve(shaka.ui.Locales.Ids.AUTO_QUALITY),l.appendChild(this.abrOnSpan_),o&&(l.setAttribute("aria-selected","true"),l.appendChild(shaka.ui.Utils.checkmarkIcon()),this.abrOnSpan_.classList.add("shaka-chosen-item"),this.currentSelection.textContent=this.localization.resolve(shaka.ui.Locales.Ids.AUTO_QUALITY)),this.menu.appendChild(l),shaka.ui.Utils.focusOnTheChosenItem(this.menu),this.controls.dispatchEvent(new shaka.util.FakeEvent("resolutionselectionupdated"))}},shaka.ui.ResolutionSelection.prototype.onTrackSelected_=function(t){this.player.configure({abr:{enabled:!1}});var i=this.controls.getConfig().clearBufferOnQualityChange;this.player.selectVariantTrack(t,i)},shaka.ui.ResolutionSelection.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.RESOLUTION)),this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.RESOLUTION)),this.backSpan.textContent=this.localization.resolve(t.RESOLUTION),this.nameSpan.textContent=this.localization.resolve(t.RESOLUTION),this.abrOnSpan_.textContent=this.localization.resolve(t.AUTO_QUALITY),this.player.getConfiguration().abr.enabled&&(this.currentSelection.textContent=this.localization.resolve(shaka.ui.Locales.Ids.AUTO_QUALITY))},goog.exportSymbol("shaka.ui.ResolutionSelection",shaka.ui.ResolutionSelection),shaka.ui.ResolutionSelection.Factory=function(){},shaka.ui.ResolutionSelection.Factory.prototype.create=function(t,i){return new shaka.ui.ResolutionSelection(t,i)},shaka.ui.OverflowMenu.registerElement("quality",new shaka.ui.ResolutionSelection.Factory),shaka.ui.RewindButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("material-icons-round"),this.button_.classList.add("shaka-rewind-button"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.REWIND,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_()}),this.eventManager.listen(this.button_,"click",function(){r.rewind_()})},$jscomp.inherits(shaka.ui.RewindButton,shaka.ui.Element),shaka.ui.RewindButton.prototype.updateAriaLabel_=function(){this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.REWIND))},shaka.ui.RewindButton.prototype.rewind_=function(){if(this.video.duration){var t=this.player.getPlaybackRate();this.player.trickPlay(0<t||-4>t?-1:2*t)}},goog.exportSymbol("shaka.ui.RewindButton",shaka.ui.RewindButton),shaka.ui.RewindButton.Factory=function(){},shaka.ui.RewindButton.Factory.prototype.create=function(t,i){return new shaka.ui.RewindButton(t,i)},shaka.ui.Controls.registerElement("rewind",new shaka.ui.RewindButton.Factory),shaka.ui.SkipAdButton=function(t,i){shaka.ui.Element.call(this,t,i);var r=this;this.container_=shaka.util.Dom.createHTMLElement("div"),this.container_.classList.add("shaka-skip-ad-container"),this.parent.appendChild(this.container_),this.counter_=shaka.util.Dom.createHTMLElement("div"),this.counter_.classList.add("shaka-skip-ad-counter"),shaka.ui.Utils.setDisplay(this.counter_,!1),this.container_.appendChild(this.counter_),this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-skip-ad-button"),this.button_.disabled=!0,shaka.ui.Utils.setDisplay(this.button_,!1),this.button_.classList.add("shaka-no-propagation"),this.container_.appendChild(this.button_),this.updateAriaLabel_(),this.updateLocalizedStrings_(),this.timer_=new shaka.util.Timer(function(){r.onTimerTick_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateAriaLabel_(),r.updateLocalizedStrings_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateAriaLabel_(),r.updateLocalizedStrings_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,function(){r.onAdStarted_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_SKIP_STATE_CHANGED,function(){r.onSkipStateChanged_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){r.reset_()}),this.eventManager.listen(this.button_,"click",function(){r.ad.skip()}),this.ad&&this.onAdStarted_()},$jscomp.inherits(shaka.ui.SkipAdButton,shaka.ui.Element),shaka.ui.SkipAdButton.prototype.release=function(){this.timer_.stop(),this.timer_=null,shaka.ui.Element.prototype.release.call(this)},shaka.ui.SkipAdButton.prototype.updateLocalizedStrings_=function(){this.button_.textContent=this.localization.resolve(shaka.ui.Locales.Ids.SKIP_AD)},shaka.ui.SkipAdButton.prototype.updateAriaLabel_=function(){},shaka.ui.SkipAdButton.prototype.onAdStarted_=function(){this.ad.isSkippable()&&(shaka.ui.Utils.setDisplay(this.button_,!0),shaka.ui.Utils.setDisplay(this.counter_,!0),this.counter_.textContent="",this.timer_.tickNow(),this.timer_.tickEvery(.5))},shaka.ui.SkipAdButton.prototype.onTimerTick_=function(){goog.asserts.assert(null!=this.ad,"this.ad should exist at this point");var t=Math.round(this.ad.getTimeUntilSkippable());0<t?this.counter_.textContent=t:(this.timer_.stop(),shaka.ui.Utils.setDisplay(this.counter_,!1))},shaka.ui.SkipAdButton.prototype.onSkipStateChanged_=function(){this.ad.canSkipNow()&&(this.button_.disabled=!1,this.timer_.stop(),shaka.ui.Utils.setDisplay(this.counter_,!1))},shaka.ui.SkipAdButton.prototype.reset_=function(){this.timer_.stop(),this.button_.disabled=!0,shaka.ui.Utils.setDisplay(this.button_,!1),shaka.ui.Utils.setDisplay(this.counter_,!1)},goog.exportSymbol("shaka.ui.SkipAdButton",shaka.ui.SkipAdButton),shaka.ui.SmallPlayButton=function(t,i){shaka.ui.PlayButton.call(this,t,i),this.button.classList.add("shaka-small-play-button"),this.button.classList.add("material-icons-round"),this.updateIcon(),this.updateAriaLabel()},$jscomp.inherits(shaka.ui.SmallPlayButton,shaka.ui.PlayButton),shaka.ui.SmallPlayButton.prototype.updateIcon=function(){var t=shaka.ui.Enums.MaterialDesignIcons;this.button.textContent=this.video.ended?t.REPLAY:this.isPaused()?t.PLAY:t.PAUSE},goog.exportSymbol("shaka.ui.SmallPlayButton",shaka.ui.SmallPlayButton),shaka.ui.SmallPlayButton.Factory=function(){},shaka.ui.SmallPlayButton.Factory.prototype.create=function(t,i){return new shaka.ui.SmallPlayButton(t,i)},shaka.ui.Controls.registerElement("play_pause",new shaka.ui.SmallPlayButton.Factory),shaka.ui.Spacer=function(t,i){shaka.ui.Element.call(this,t,i);var r=shaka.util.Dom.createHTMLElement("div");r.classList.add("shaka-spacer"),r.setAttribute("aria-hidden",!0),this.parent.appendChild(r)},$jscomp.inherits(shaka.ui.Spacer,shaka.ui.Element),goog.exportSymbol("shaka.ui.Spacer",shaka.ui.Spacer),shaka.ui.Spacer.Factory=function(){},shaka.ui.Spacer.Factory.prototype.create=function(t,i){return new shaka.ui.Spacer(t,i)},shaka.ui.Controls.registerElement("spacer",new shaka.ui.Spacer.Factory),shaka.ui.TextSelection=function(t,i){shaka.ui.SettingsMenu.call(this,t,i,shaka.ui.Enums.MaterialDesignIcons.CLOSED_CAPTIONS);var r=this;this.button.classList.add("shaka-caption-button"),this.menu.classList.add("shaka-text-languages"),this.player&&this.player.isTextTrackVisible()?this.button.setAttribute("aria-pressed","true"):this.button.setAttribute("aria-pressed","false"),this.addOffOption_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){r.updateLocalizedStrings_(),r.updateTextLanguages_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){r.updateLocalizedStrings_(),r.updateTextLanguages_()}),this.eventManager.listen(this.player,"texttrackvisibility",function(){r.onCaptionStateChange_()}),this.eventManager.listen(this.player,"textchanged",function(){r.updateTextLanguages_()}),this.eventManager.listen(this.player,"trackschanged",function(){r.onTracksChanged_()}),this.onCaptionStateChange_(),this.updateLocalizedStrings_(),this.updateTextLanguages_(),this.onTracksChanged_()},$jscomp.inherits(shaka.ui.TextSelection,shaka.ui.SettingsMenu),shaka.ui.TextSelection.prototype.addOffOption_=function(){var t=shaka.util.Dom.createButton();t.setAttribute("aria-selected","true"),this.menu.appendChild(t),t.appendChild(shaka.ui.Utils.checkmarkIcon()),this.captionsOffSpan_=shaka.util.Dom.createHTMLElement("span"),this.captionsOffSpan_.classList.add("shaka-auto-span"),t.appendChild(this.captionsOffSpan_)},shaka.ui.TextSelection.prototype.onCaptionStateChange_=function(){this.player.isTextTrackVisible()?(this.icon.classList.add("shaka-captions-on"),this.icon.classList.remove("shaka-captions-off"),this.button.setAttribute("aria-pressed","true")):(this.icon.classList.add("shaka-captions-off"),this.icon.classList.remove("shaka-captions-on"),this.button.setAttribute("aria-pressed","false")),this.controls.dispatchEvent(new shaka.util.FakeEvent("captionselectionupdated"))},shaka.ui.TextSelection.prototype.updateTextLanguages_=function(){var t=this,i=this.player.getTextTracks();shaka.ui.LanguageUtils.updateTracks(i,this.menu,function(r){return t.onTextTrackSelected_(r)},this.player.isTextTrackVisible(),this.currentSelection,this.localization,this.controls.getConfig().trackLabelFormat),(i=shaka.util.Dom.createButton()).classList.add("shaka-turn-captions-off-button"),this.eventManager.listen(i,"click",function(){t.player.setTextTrackVisibility(!1),t.updateTextLanguages_()}),i.appendChild(this.captionsOffSpan_),this.menu.appendChild(i),this.player.isTextTrackVisible()||(i.setAttribute("aria-selected","true"),i.appendChild(shaka.ui.Utils.checkmarkIcon()),this.captionsOffSpan_.classList.add("shaka-chosen-item"),this.currentSelection.textContent=this.localization.resolve(shaka.ui.Locales.Ids.OFF)),shaka.ui.Utils.focusOnTheChosenItem(this.menu),this.controls.dispatchEvent(new shaka.util.FakeEvent("captionselectionupdated"))},shaka.ui.TextSelection.prototype.onTextTrackSelected_=function(t){var i=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){return i.player.selectTextTrack(t),r.yield(i.player.setTextTrackVisibility(!0),0)})},shaka.ui.TextSelection.prototype.updateLocalizedStrings_=function(){var t=shaka.ui.Locales.Ids;this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.CAPTIONS)),this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(t.BACK)),this.nameSpan.textContent=this.localization.resolve(t.CAPTIONS),this.backSpan.textContent=this.localization.resolve(t.CAPTIONS),this.captionsOffSpan_.textContent=this.localization.resolve(t.OFF)},shaka.ui.TextSelection.prototype.onTracksChanged_=function(){var t=0<this.player.getTextTracks().length;shaka.ui.Utils.setDisplay(this.button,t),this.updateTextLanguages_()},goog.exportSymbol("shaka.ui.TextSelection",shaka.ui.TextSelection),shaka.ui.TextSelection.Factory=function(){},shaka.ui.TextSelection.Factory.prototype.create=function(t,i){return new shaka.ui.TextSelection(t,i)},shaka.ui.OverflowMenu.registerElement("captions",new shaka.ui.TextSelection.Factory),shaka.ui.VolumeBar=function(t,i){shaka.ui.RangeElement.call(this,t,i,["shaka-volume-bar-container"],["shaka-volume-bar"]);var r=this;this.config_=this.controls.getConfig(),this.eventManager.listen(this.video,"volumechange",function(){return r.onPresentationVolumeChange_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_VOLUME_CHANGED,function(){return r.onAdVolumeChange_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_MUTED,function(){return r.onAdVolumeChange_()}),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,function(){return r.onPresentationVolumeChange_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,function(){return r.updateAriaLabel_()}),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,function(){return r.updateAriaLabel_()}),this.onPresentationVolumeChange_(),this.updateAriaLabel_(),this.ad&&this.onChange()},$jscomp.inherits(shaka.ui.VolumeBar,shaka.ui.RangeElement),shaka.ui.VolumeBar.prototype.onChange=function(){this.ad?this.ad.setVolume(this.getValue()):(this.video.volume=this.getValue(),this.video.muted=0==this.video.volume)},shaka.ui.VolumeBar.prototype.onPresentationVolumeChange_=function(){this.setValue(this.video.muted?0:this.video.volume),this.updateColors_()},shaka.ui.VolumeBar.prototype.onAdVolumeChange_=function(){goog.asserts.assert(null!=this.ad,"This.ad should exist at this point!");var t=this.ad.getVolume();this.setValue(t),this.updateColors_()},shaka.ui.VolumeBar.prototype.updateColors_=function(){var t=this.config_.volumeBarColors,i=["to right"];i.push(t.level+100*this.getValue()+"%"),i.push(t.base+100*this.getValue()+"%"),i.push(t.base+"100%"),this.container.style.background="linear-gradient("+i.join(",")+")"},shaka.ui.VolumeBar.prototype.updateAriaLabel_=function(){this.bar.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.VOLUME))},goog.exportSymbol("shaka.ui.VolumeBar",shaka.ui.VolumeBar),shaka.ui.VolumeBar.Factory=function(){},shaka.ui.VolumeBar.Factory.prototype.create=function(t,i){return new shaka.ui.VolumeBar(t,i)},shaka.ui.Controls.registerElement("volume",new shaka.ui.VolumeBar.Factory)}.call(exportTo,innerGlobal,innerGlobal,void 0),"undefined"!=typeof exports)for(var k in exportTo.shaka)exports[k]=exportTo.shaka[k];else"function"==typeof define&&define.amd?define(function(){return exportTo.shaka}):innerGlobal.shaka=exportTo.shaka})(),function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).videojs=i()}(this,function(){"use strict";for(var t,i="7.17.0",r={},o=function(s,p){return r[s]=r[s]||[],p&&(r[s]=r[s].concat(p)),r[s]},l=function(s,p){return!((p=o(s).indexOf(p))<=-1||(r[s]=r[s].slice(),r[s].splice(p,1),0))},g={prefixed:!0},_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],v=_[0],E=0;E<_.length;E++)if(_[E][1]in document){t=_[E];break}if(t){for(var P=0;P<t.length;P++)g[v[P]]=t[P];g.prefixed=t[0]!==v[0]}var M=[],U=function s(p){function h(){for(var m=arguments.length,y=new Array(m),T=0;T<m;T++)y[T]=arguments[T];u("log",n,y)}var n="info",u=function(s,p){return function(h,n,u){var m,y=p.levels[n];n=new RegExp("^("+y+")$"),"log"!==h&&u.unshift(h.toUpperCase()+":"),u.unshift(s+":"),M&&(M.push([].concat(u)),M.splice(0,0<(m=M.length-1e3)?m:0)),!window.console||(m=(m=window.console[h])||"debug"!==h?m:window.console.info||window.console.log)&&y&&n.test(h)&&m[Array.isArray(u)?"apply":"call"](window.console,u)}}(p,h);return h.createLogger=function(m){return s(p+": "+m)},h.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},h.level=function(m){if("string"==typeof m){if(!h.levels.hasOwnProperty(m))throw new Error('"'+m+'" in not a valid log level');n=m}return n},(h.history=function(){return M?[].concat(M):[]}).filter=function(m){return(M||[]).filter(function(y){return new RegExp(".*"+m+".*").test(y[0])})},h.history.clear=function(){M&&(M.length=0)},h.history.disable=function(){null!==M&&(M.length=0,M=null)},h.history.enable=function(){null===M&&(M=[])},h.error=function(){for(var m=arguments.length,y=new Array(m),T=0;T<m;T++)y[T]=arguments[T];return u("error",n,y)},h.warn=function(){for(var m=arguments.length,y=new Array(m),T=0;T<m;T++)y[T]=arguments[T];return u("warn",n,y)},h.debug=function(){for(var m=arguments.length,y=new Array(m),T=0;T<m;T++)y[T]=arguments[T];return u("debug",n,y)},h}("VIDEOJS"),$=U.createLogger,G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function z(s,p){return s(p={exports:{}},p.exports),p.exports}var Z=z(function(s){function p(){return s.exports=p=Object.assign||function(h){for(var n=1;n<arguments.length;n++){var u,m=arguments[n];for(u in m)Object.prototype.hasOwnProperty.call(m,u)&&(h[u]=m[u])}return h},p.apply(this,arguments)}s.exports=p}),Y=Object.prototype.toString,se=function(s){return ce(s)?Object.keys(s):[]};function Q(s,p){se(s).forEach(function(h){return p(s[h],h)})}function te(s){for(var p=arguments.length,h=new Array(1<p?p-1:0),n=1;n<p;n++)h[n-1]=arguments[n];return Object.assign?Z.apply(void 0,[s].concat(h)):(h.forEach(function(u){u&&Q(u,function(m,y){s[y]=m})}),s)}function ce(s){return!!s&&"object"==typeof s}function me(s){return ce(s)&&"[object Object]"===Y.call(s)&&s.constructor===Object}function ye(s,p){if(!s||!p||"function"!=typeof window.getComputedStyle)return"";var h;try{h=window.getComputedStyle(s)}catch(n){return""}return h?h.getPropertyValue(p)||h[p]:""}var fe=window.navigator&&window.navigator.userAgent||"",be=(le=/AppleWebKit\/([\d.]+)/i.exec(fe))?parseFloat(le.pop()):null,Ie=/iPod/i.test(fe),Se=(kt=fe.match(/OS (\d+)_/i))&&kt[1]?kt[1]:null,Fe=/Android/i.test(fe),$e=function(){var s=fe.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!s)return null;var p=s[1]&&parseFloat(s[1]),h=s[2]&&parseFloat(s[2]);return p&&h?parseFloat(s[1]+"."+s[2]):p||null}(),He=Fe&&$e<5&&be<537,Xe=/Firefox/i.test(fe),Ye=/Edg/i.test(fe),ct=!Ye&&(/Chrome/i.test(fe)||/CriOS/i.test(fe)),yt=(da=fe.match(/(Chrome|CriOS)\/(\d+)/))&&da[2]?parseFloat(da[2]):null,_t=dt=!(dt=(dt=/MSIE\s(\d+)\.\d/.exec(fe))&&parseFloat(dt[1]))&&/Trident\/7.0/i.test(fe)&&/rv:11.0/.test(fe)?11:dt,Qe=/Safari/i.test(fe)&&!ct&&!Fe&&!Ye,Aa=/Windows/i.test(fe),ua=Boolean(ga()&&("ontouchstart"in window||window.navigator.maxTouchPoints||window.DocumentTouch&&window.document instanceof window.DocumentTouch)),We=/iPad/i.test(fe)||Qe&&ua&&!/iPhone/i.test(fe),Xa=/iPhone/i.test(fe)&&!We,At=Xa||We||Ie,La=(Qe||At)&&!ct,tt=Object.freeze({__proto__:null,IS_IPOD:Ie,IOS_VERSION:Se,IS_ANDROID:Fe,ANDROID_VERSION:$e,IS_NATIVE_ANDROID:He,IS_FIREFOX:Xe,IS_EDGE:Ye,IS_CHROME:ct,CHROME_VERSION:yt,IE_VERSION:_t,IS_SAFARI:Qe,IS_WINDOWS:Aa,TOUCH_ENABLED:ua,IS_IPAD:We,IS_IPHONE:Xa,IS_IOS:At,IS_ANY_SAFARI:La});function Ya(s){return"string"==typeof s&&Boolean(s.trim())}function Na(s){if(0<=s.indexOf(" "))throw new Error("class has illegal whitespace characters")}function ga(){return document===window.document}function fa(s){return ce(s)&&1===s.nodeType}function xi(){try{return window.parent!==window.self}catch(s){return!0}}function Mi(s){return function(p,h){return Ya(p)?(h=fa(h=Ya(h)?document.querySelector(h):h)?h:document)[s]&&h[s](p):document[s](null)}}function Re(s,p,h,n){void 0===s&&(s="div"),void 0===p&&(p={}),void 0===h&&(h={});var u=document.createElement(s);return Object.getOwnPropertyNames(p).forEach(function(m){var y=p[m];-1!==m.indexOf("aria-")||"role"===m||"type"===m?(U.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+m+" to "+y+"."),u.setAttribute(m,y)):"textContent"===m?Oa(u,y):u[m]===y&&"tabIndex"!==m||(u[m]=y)}),Object.getOwnPropertyNames(h).forEach(function(m){u.setAttribute(m,h[m])}),n&&Pn(u,n),u}function Oa(s,p){return void 0===s.textContent?s.innerText=p:s.textContent=p,s}function Cn(s,p){p.firstChild?p.insertBefore(s,p.firstChild):p.appendChild(s)}function Ua(s,p){return Na(p),s.classList?s.classList.contains(p):new RegExp("(^|\\s)"+p+"($|\\s)").test(s.className)}function ya(s,p){return s.classList?s.classList.add(p):Ua(s,p)||(s.className=(s.className+" "+p).trim()),s}function wi(s,p){return s?(s.classList?s.classList.remove(p):(Na(p),s.className=s.className.split(/\s+/).filter(function(h){return h!==p}).join(" ")),s):(U.warn("removeClass was called with an element that doesn't exist"),null)}function fo(s,p,h){var n=Ua(s,p);if((h="boolean"!=typeof(h="function"==typeof h?h(s,p):h)?!n:h)!==n)return(h?ya:wi)(s,p),s}function yo(s,p){Object.getOwnPropertyNames(p).forEach(function(h){var n=p[h];null==n||!1===n?s.removeAttribute(h):s.setAttribute(h,!0===n?"":n)})}function _a(s){var p={};if(s&&s.attributes&&0<s.attributes.length)for(var n=s.attributes,u=n.length-1;0<=u;u--){var m=n[u].name,y=n[u].value;"boolean"!=typeof s[m]&&-1===",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+m+",")||(y=null!==y),p[m]=y}return p}function _o(s,p){return s.getAttribute(p)}function Qa(s,p,h){s.setAttribute(p,h)}function cr(s,p){s.removeAttribute(p)}function ko(){document.body.focus(),document.onselectstart=function(){return!1}}function vo(){document.onselectstart=function(){return!0}}function Ja(s){if(s&&s.getBoundingClientRect&&s.parentNode){var p=s.getBoundingClientRect(),h={};return["bottom","height","left","right","top","width"].forEach(function(n){void 0!==p[n]&&(h[n]=p[n])}),h.height||(h.height=parseFloat(ye(s,"height"))),h.width||(h.width=parseFloat(ye(s,"width"))),h}}function Di(s){if(!s||s&&!s.offsetParent)return{left:0,top:0,width:0,height:0};for(var p=s.offsetWidth,h=s.offsetHeight,n=0,u=0;s.offsetParent&&s!==document[g.fullscreenElement];)n+=s.offsetLeft,u+=s.offsetTop,s=s.offsetParent;return{left:n,top:u,width:p,height:h}}function pr(s,p){var h={x:0,y:0};if(At)for(var n=s;n&&"html"!==n.nodeName.toLowerCase();){var u,m=ye(n,"transform");/^matrix/.test(m)?(u=m.slice(7,-1).split(/,\s/).map(Number),h.x+=u[4],h.y+=u[5]):/^matrix3d/.test(m)&&(m=m.slice(9,-1).split(/,\s/).map(Number),h.x+=m[12],h.y+=m[13]),n=n.parentNode}var y={},T=Di(p.target),S=Di(s),x=S.width;return s=p.offsetY-(S.top-T.top),T=p.offsetX-(S.left-T.left),p.changedTouches&&(T=p.changedTouches[0].pageX-S.left,s=p.changedTouches[0].pageY+S.top,At&&(T-=h.x,s-=h.y)),y.y=1-Math.max(0,Math.min(1,s/S.height)),y.x=Math.max(0,Math.min(1,T/x)),y}function To(s){return ce(s)&&3===s.nodeType}function bn(s){for(;s.firstChild;)s.removeChild(s.firstChild);return s}function Eo(s){return"function"==typeof s&&(s=s()),(Array.isArray(s)?s:[s]).map(function(p){return fa(p="function"==typeof p?p():p)||To(p)?p:"string"==typeof p&&/\S/.test(p)?document.createTextNode(p):void 0}).filter(function(p){return p})}function Pn(s,p){return Eo(p).forEach(function(h){return s.appendChild(h)}),s}function So(s,p){return Pn(bn(s),p)}function Ri(s){return void 0===s.button&&void 0===s.buttons||0===s.button&&void 0===s.buttons||"mouseup"===s.type&&0===s.button&&0===s.buttons||0===s.button&&1===s.buttons}var An,Ia=Mi("querySelector"),Co=Mi("querySelectorAll"),bo=Object.freeze({__proto__:null,isReal:ga,isEl:fa,isInFrame:xi,createEl:Re,textContent:Oa,prependTo:Cn,hasClass:Ua,addClass:ya,removeClass:wi,toggleClass:fo,setAttributes:yo,getAttributes:_a,getAttribute:_o,setAttribute:Qa,removeAttribute:cr,blockTextSelection:ko,unblockTextSelection:vo,getBoundingClientRect:Ja,findPosition:Di,getPointerPosition:pr,isTextNode:To,emptyEl:bn,normalizeContent:Eo,appendContent:Pn,insertContent:So,isSingleLeftClick:Ri,$:Ia,$$:Co}),Po=!1,Qd=function(){if(!1!==An.options.autoSetup){var s=Array.prototype.slice.call(document.getElementsByTagName("video")),p=Array.prototype.slice.call(document.getElementsByTagName("audio")),h=Array.prototype.slice.call(document.getElementsByTagName("video-js")),n=s.concat(p,h);if(n&&0<n.length)for(var u=0,m=n.length;u<m;u++){var y=n[u];if(!y||!y.getAttribute){In(1);break}void 0===y.player&&null!==y.getAttribute("data-setup")&&An(y)}else Po||In(1)}};function In(s,p){ga()&&(p&&(An=p),window.setTimeout(Qd,s))}function xn(){Po=!0,window.removeEventListener("load",xn)}function Ao(s){var p=document.createElement("style");return p.className=s,p}function Io(s,p){s.styleSheet?s.styleSheet.cssText=p:s.textContent=p}ga()&&("complete"===document.readyState?xn():window.addEventListener("load",xn));var xa=3;window.WeakMap||(It=function(){function s(){this.vdata="vdata"+Math.floor(window.performance&&window.performance.now()||Date.now()),this.data={}}var p=s.prototype;return p.set=function(h,n){var u=h[this.vdata]||xa++;return h[this.vdata]||(h[this.vdata]=u),this.data[u]=n,this},p.get=function(h){var n=h[this.vdata];if(n)return this.data[n];U("We have no data for this element",h)},p.has=function(h){return h[this.vdata]in this.data},p.delete=function(h){var n=h[this.vdata];n&&(delete this.data[n],delete h[this.vdata])},s}());var mr,Ut=new(window.WeakMap?WeakMap:It);function xo(s,p){var h;Ut.has(s)&&(0===(h=Ut.get(s)).handlers[p].length&&(delete h.handlers[p],s.removeEventListener?s.removeEventListener(p,h.dispatcher,!1):s.detachEvent&&s.detachEvent("on"+p,h.dispatcher)),Object.getOwnPropertyNames(h.handlers).length<=0&&(delete h.handlers,delete h.dispatcher,delete h.disabled),0===Object.getOwnPropertyNames(h).length&&Ut.delete(s))}function Mn(s,p,h,n){h.forEach(function(u){s(p,u,n)})}function gr(s){if(s.fixed_)return s;function p(){return!0}function h(){return!1}if(!s||!s.isPropagationStopped||!s.isImmediatePropagationStopped){var n,u,m,y=s||window.event;for(n in s={},y)"layerX"!==n&&"layerY"!==n&&"keyLocation"!==n&&"webkitMovementX"!==n&&"webkitMovementY"!==n&&("returnValue"===n&&y.preventDefault||(s[n]=y[n]));s.target||(s.target=s.srcElement||document),s.relatedTarget||(s.relatedTarget=s.fromElement===s.target?s.toElement:s.fromElement),s.preventDefault=function(){y.preventDefault&&y.preventDefault(),s.returnValue=!1,y.returnValue=!1,s.defaultPrevented=!0},s.defaultPrevented=!1,s.stopPropagation=function(){y.stopPropagation&&y.stopPropagation(),s.cancelBubble=!0,y.cancelBubble=!0,s.isPropagationStopped=p},s.isPropagationStopped=h,s.stopImmediatePropagation=function(){y.stopImmediatePropagation&&y.stopImmediatePropagation(),s.isImmediatePropagationStopped=p,s.stopPropagation()},s.isImmediatePropagationStopped=h,null!=s.clientX&&(u=document.documentElement,m=document.body,s.pageX=s.clientX+(u&&u.scrollLeft||m&&m.scrollLeft||0)-(u&&u.clientLeft||m&&m.clientLeft||0),s.pageY=s.clientY+(u&&u.scrollTop||m&&m.scrollTop||0)-(u&&u.clientTop||m&&m.clientTop||0)),s.which=s.charCode||s.keyCode,null!=s.button&&(s.button=1&s.button?0:4&s.button?1:2&s.button?2:0)}return s.fixed_=!0,s}var Zd=["touchstart","touchmove"];function Xt(s,p,h){if(Array.isArray(p))return Mn(Xt,s,p,h);Ut.has(s)||Ut.set(s,{});var n=Ut.get(s);n.handlers||(n.handlers={}),n.handlers[p]||(n.handlers[p]=[]),h.guid||(h.guid=xa++),n.handlers[p].push(h),n.dispatcher||(n.disabled=!1,n.dispatcher=function(u,m){if(!n.disabled){u=gr(u);var y=n.handlers[u.type];if(y)for(var T=y.slice(0),S=0,x=T.length;S<x&&!u.isImmediatePropagationStopped();S++)try{T[S].call(s,u,m)}catch(A){U.error(A)}}}),1===n.handlers[p].length&&(s.addEventListener?(h=!1,function(){if("boolean"!=typeof mr){mr=!1;try{var s=Object.defineProperty({},"passive",{get:function(){mr=!0}});window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch(p){}}return mr}()&&-1<Zd.indexOf(p)&&(h={passive:!0}),s.addEventListener(p,n.dispatcher,h)):s.attachEvent&&s.attachEvent("on"+p,n.dispatcher))}function Dt(s,p,h){if(Ut.has(s)){var n=Ut.get(s);if(n.handlers){if(Array.isArray(p))return Mn(Dt,s,p,h);var u=function(S,x){n.handlers[x]=[],xo(S,x)};if(void 0!==p){var m=n.handlers[p];if(m)if(h){if(h.guid)for(var y=0;y<m.length;y++)m[y].guid===h.guid&&m.splice(y--,1);xo(s,p)}else u(s,p)}else for(var T in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},T)&&u(s,T)}}}function Za(s,p,h){var n=Ut.has(s)?Ut.get(s):{},u=s.parentNode||s.ownerDocument;return"string"==typeof p?p={type:p,target:s}:p.target||(p.target=s),p=gr(p),n.dispatcher&&n.dispatcher.call(s,p,h),u&&!p.isPropagationStopped()&&!0===p.bubbles?Za.call(null,u,p,h):!u&&!p.defaultPrevented&&p.target&&p.target[p.type]&&(Ut.has(p.target)||Ut.set(p.target,{}),u=Ut.get(p.target),p.target[p.type]&&(u.disabled=!0,"function"==typeof p.target[p.type]&&p.target[p.type](),u.disabled=!1)),!p.defaultPrevented}function fr(s,p,h){if(Array.isArray(p))return Mn(fr,s,p,h);function n(){Dt(s,p,n),h.apply(this,arguments)}n.guid=h.guid=h.guid||xa++,Xt(s,p,n)}function Mo(s,p,h){function n(){Dt(s,p,n),h.apply(this,arguments)}n.guid=h.guid=h.guid||xa++,Xt(s,p,n)}function Je(s,p,h){return p.guid||(p.guid=xa++),(s=p.bind(s)).guid=h?h+"_"+p.guid:p.guid,s}function ka(s,p){var h=window.performance.now();return function(){var n=window.performance.now();p<=n-h&&(s.apply(void 0,arguments),h=n)}}function Bt(){}var Li,th=Object.freeze({__proto__:null,fixEvent:gr,on:Xt,off:Dt,trigger:Za,one:fr,any:Mo});function yr(s){return"function"==typeof s.name?s.name():"string"==typeof s.name?s.name:s.name_||(s.constructor&&s.constructor.name?s.constructor.name:typeof s)}function wn(s){return"string"==typeof s&&/\S/.test(s)||Array.isArray(s)&&!!s.length}function _r(s,p,h){if(!s||!s.nodeName&&!va(s))throw new Error("Invalid target for "+yr(p)+"#"+h+"; must be a DOM node or evented object.")}function wo(s,p,h){if(!wn(s))throw new Error("Invalid event type for "+yr(p)+"#"+h+"; must be a non-empty string or array.")}function Do(s,p,h){if("function"!=typeof s)throw new Error("Invalid listener for "+yr(p)+"#"+h+"; must be a function.")}function Dn(s,p,h){var n,u,m=p.length<3||p[0]===s||p[0]===s.eventBusEl_;return p=m?(n=s.eventBusEl_,3<=p.length&&p.shift(),u=p[0],p[1]):(n=p[0],u=p[1],p[2]),_r(n,s,h),wo(u,s,h),Do(p,s,h),{isTargetingSelf:m,target:n,type:u,listener:p=Je(s,p)}}function Ba(s,p,h,n){_r(s,s,p),s.nodeName?th[p](s,h,n):s[p](h,n)}Bt.prototype.allowedEvents_={},Bt.prototype.addEventListener=Bt.prototype.on=function(s,p){var h=this.addEventListener;this.addEventListener=function(){},Xt(this,s,p),this.addEventListener=h},Bt.prototype.removeEventListener=Bt.prototype.off=function(s,p){Dt(this,s,p)},Bt.prototype.one=function(s,p){var h=this.addEventListener;this.addEventListener=function(){},fr(this,s,p),this.addEventListener=h},Bt.prototype.any=function(s,p){var h=this.addEventListener;this.addEventListener=function(){},Mo(this,s,p),this.addEventListener=h},Bt.prototype.dispatchEvent=Bt.prototype.trigger=function(s){var p=s.type||s;s=gr(s="string"==typeof s?{type:p}:s),this.allowedEvents_[p]&&this["on"+p]&&this["on"+p](s),Za(this,s)},Bt.prototype.queueTrigger=function(s){var p=this,h=s.type||s,n=(Li=Li||new Map).get(this);n||Li.set(this,n=new Map);var u=n.get(h);n.delete(h),window.clearTimeout(u),u=window.setTimeout(function(){0===n.size&&(n=null,Li.delete(p)),p.trigger(s)},0),n.set(h,u)};var va=function(s){return s instanceof Bt||!!s.eventBusEl_&&["on","one","off","trigger"].every(function(p){return"function"==typeof s[p]})},ah={on:function(){for(var s=this,p=arguments.length,h=new Array(p),n=0;n<p;n++)h[n]=arguments[n];var u,m=Dn(this,h,"on"),y=m.isTargetingSelf,T=m.target,S=m.type,x=m.listener;Ba(T,"on",S,x),y||((u=function(){return s.off(T,S,x)}).guid=x.guid,(y=function(){return s.off("dispose",u)}).guid=x.guid,Ba(this,"on","dispose",u),Ba(T,"on","dispose",y))},one:function(){for(var s=this,p=arguments.length,h=new Array(p),n=0;n<p;n++)h[n]=arguments[n];var u=Dn(this,h,"one"),m=u.isTargetingSelf,y=u.target,T=u.type,S=u.listener;m?Ba(y,"one",T,S):((m=function x(){s.off(y,T,x);for(var A=arguments.length,L=new Array(A),O=0;O<A;O++)L[O]=arguments[O];S.apply(null,L)}).guid=S.guid,Ba(y,"one",T,m))},any:function(){for(var s=this,p=arguments.length,h=new Array(p),n=0;n<p;n++)h[n]=arguments[n];var u=Dn(this,h,"any"),m=u.isTargetingSelf,y=u.target,T=u.type,S=u.listener;m?Ba(y,"any",T,S):((m=function x(){s.off(y,T,x);for(var A=arguments.length,L=new Array(A),O=0;O<A;O++)L[O]=arguments[O];S.apply(null,L)}).guid=S.guid,Ba(y,"any",T,m))},off:function(s,p,h){!s||wn(s)?Dt(this.eventBusEl_,s,p):(p=p,_r(s=s,this,"off"),wo(p,this,"off"),Do(h,this,"off"),h=Je(this,h),this.off("dispose",h),s.nodeName?(Dt(s,p,h),Dt(s,"dispose",h)):va(s)&&(s.off(p,h),s.off("dispose",h)))},trigger:function(s,p){_r(this.eventBusEl_,this,"trigger");var h=s&&"string"!=typeof s?s.type:s;if(!wn(h)){if(h="Invalid event type for "+yr(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.",!s)throw new Error(h);(this.log||U).error(h)}return Za(this.eventBusEl_,s,p)}};function Rn(s,p){if(p=(p=void 0===p?{}:p).eventBusKey){if(!s[p].nodeName)throw new Error('The eventBusKey "'+p+'" does not refer to an element.');s.eventBusEl_=s[p]}else s.eventBusEl_=Re("span",{className:"vjs-event-bus"});return te(s,ah),s.eventedCallbacks&&s.eventedCallbacks.forEach(function(h){h()}),s.on("dispose",function(){s.off(),[s,s.el_,s.eventBusEl_].forEach(function(h){h&&Ut.has(h)&&Ut.delete(h)}),window.setTimeout(function(){s.eventBusEl_=null},0)}),s}var ih={state:{},setState:function(s){var p,h=this;return Q(s="function"==typeof s?s():s,function(n,u){h.state[u]!==n&&((p=p||{})[u]={from:h.state[u],to:n}),h.state[u]=n}),p&&va(this)&&this.trigger({changes:p,type:"statechanged"}),p}};function Ro(s,p){return te(s,ih),s.state=te({},s.state,p),"function"==typeof s.handleStateChanged&&va(s)&&s.on("statechanged",s.handleStateChanged),s}function kr(s){return"string"!=typeof s?s:s.replace(/./,function(p){return p.toLowerCase()})}function pt(s){return"string"!=typeof s?s:s.replace(/./,function(p){return p.toUpperCase()})}function at(){for(var s={},p=arguments.length,h=new Array(p),n=0;n<p;n++)h[n]=arguments[n];return h.forEach(function(u){u&&Q(u,function(m,y){me(m)?(me(s[y])||(s[y]={}),s[y]=at(s[y],m)):s[y]=m})}),s}var rh=window.Map||function(){function s(){this.map_={}}var p=s.prototype;return p.has=function(h){return h in this.map_},p.delete=function(h){var n=this.has(h);return delete this.map_[h],n},p.set=function(h,n){return this.map_[h]=n,this},p.forEach=function(h,n){for(var u in this.map_)h.call(n,this.map_[u],u,this)},s}(),Ln=window.Set||function(){function s(){this.set_={}}var p=s.prototype;return p.has=function(h){return h in this.set_},p.delete=function(h){var n=this.has(h);return delete this.set_[h],n},p.add=function(h){return this.set_[h]=1,this},p.forEach=function(h,n){for(var u in this.set_)h.call(n,u,u,this)},s}(),de=function(){function s(h,n,u){this.player_=!h&&this.play?h=this:h,this.isDisposed_=!1,this.parentComponent_=null,this.options_=at({},this.options_),n=this.options_=at(this.options_,n),this.id_=n.id||n.el&&n.el.id,this.id_||(h=h&&h.id&&h.id()||"no_player",this.id_=h+"_component_"+xa++),this.name_=n.name||null,n.el?this.el_=n.el:!1!==n.createEl&&(this.el_=this.createEl()),!1!==n.evented&&(Rn(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Ro(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Ln,this.setIntervalIds_=new Ln,this.rafIds_=new Ln,this.namedRafs_=new rh,(this.clearingTimersOnDispose_=!1)!==n.initChildren&&this.initChildren(),this.ready(u),!1!==n.reportTouchActivity&&this.enableTouchActivity()}var p=s.prototype;return p.dispose=function(){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var h=this.children_.length-1;0<=h;h--)this.children_[h].dispose&&this.children_[h].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),this.el_=null),this.player_=null}},p.isDisposed=function(){return Boolean(this.isDisposed_)},p.player=function(){return this.player_},p.options=function(h){return h&&(this.options_=at(this.options_,h)),this.options_},p.el=function(){return this.el_},p.createEl=function(h,n,u){return Re(h,n,u)},p.localize=function(h,n,u){void 0===u&&(u=h);var m=this.player_.language&&this.player_.language(),y=this.player_.languages&&this.player_.languages(),T=y&&y[m];return m=m&&m.split("-")[0],m=y&&y[m],u=u,T&&T[h]?u=T[h]:m&&m[h]&&(u=m[h]),n?u.replace(/\{(\d+)\}/g,function(S,x){return void 0===(x=n[x-1])?S:x}):u},p.handleLanguagechange=function(){},p.contentEl=function(){return this.contentEl_||this.el_},p.id=function(){return this.id_},p.name=function(){return this.name_},p.children=function(){return this.children_},p.getChildById=function(h){return this.childIndex_[h]},p.getChild=function(h){if(h)return this.childNameIndex_[h]},p.getDescendant=function(){for(var h=arguments.length,n=new Array(h),u=0;u<h;u++)n[u]=arguments[u];n=n.reduce(function(S,x){return S.concat(x)},[]);for(var m=this,y=0;y<n.length;y++)if(!(m=m.getChild(n[y]))||!m.getChild)return;return m},p.addChild=function(h,n,u){if(void 0===n&&(n={}),void 0===u&&(u=this.children_.length),"string"==typeof h){var m=pt(h),y=n.componentClass||m;n.name=m;var T=s.getComponent(y);if(!T)throw new Error("Component "+y+" does not exist");if("function"!=typeof T)return null;T=new T(this.player_||this,n)}else T=h;return T.parentComponent_&&T.parentComponent_.removeChild(T),this.children_.splice(u,0,T),T.parentComponent_=this,"function"==typeof T.id&&(this.childIndex_[T.id()]=T),(m=m||T.name&&pt(T.name()))&&(this.childNameIndex_[m]=T,this.childNameIndex_[kr(m)]=T),"function"==typeof T.el&&T.el()&&(m=null,this.children_[u+1]&&(this.children_[u+1].el_?m=this.children_[u+1].el_:fa(this.children_[u+1])&&(m=this.children_[u+1])),this.contentEl().insertBefore(T.el(),m)),T},p.removeChild=function(h){if((h="string"==typeof h?this.getChild(h):h)&&this.children_){for(var n,u=!1,m=this.children_.length-1;0<=m;m--)if(this.children_[m]===h){u=!0,this.children_.splice(m,1);break}u&&(h.parentComponent_=null,this.childIndex_[h.id()]=null,this.childNameIndex_[pt(h.name())]=null,this.childNameIndex_[kr(h.name())]=null,(n=h.el())&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(h.el()))}},p.initChildren=function(){var h,n,u,m=this,y=this.options_.children;y&&(h=this.options_,n=s.getComponent("Tech"),(u=Array.isArray(y)?y:Object.keys(y)).concat(Object.keys(this.options_).filter(function(T){return!u.some(function(S){return"string"==typeof S?T===S:T===S.name})})).map(function(T){var S;return T="string"==typeof T?y[S=T]||m.options_[S]||{}:(S=T.name,T),{name:S,opts:T}}).filter(function(T){return(T=s.getComponent(T.opts.componentClass||pt(T.name)))&&!n.isTech(T)}).forEach(function(T){var S=T.name;T=T.opts,!1!==(T=void 0!==h[S]?h[S]:T)&&((T=!0===T?{}:T).playerOptions=m.options_.playerOptions,(T=m.addChild(S,T))&&(m[S]=T))}))},p.buildCSSClass=function(){return""},p.ready=function(h,n){if(void 0===n&&(n=!1),h)return this.isReady_?void(n?h.call(this):this.setTimeout(h,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(h))},p.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var h=this.readyQueue_;this.readyQueue_=[],h&&0<h.length&&h.forEach(function(n){n.call(this)},this),this.trigger("ready")},1)},p.$=function(h,n){return Ia(h,n||this.contentEl())},p.$$=function(h,n){return Co(h,n||this.contentEl())},p.hasClass=function(h){return Ua(this.el_,h)},p.addClass=function(h){ya(this.el_,h)},p.removeClass=function(h){wi(this.el_,h)},p.toggleClass=function(h,n){fo(this.el_,h,n)},p.show=function(){this.removeClass("vjs-hidden")},p.hide=function(){this.addClass("vjs-hidden")},p.lockShowing=function(){this.addClass("vjs-lock-showing")},p.unlockShowing=function(){this.removeClass("vjs-lock-showing")},p.getAttribute=function(h){return _o(this.el_,h)},p.setAttribute=function(h,n){Qa(this.el_,h,n)},p.removeAttribute=function(h){cr(this.el_,h)},p.width=function(h,n){return this.dimension("width",h,n)},p.height=function(h,n){return this.dimension("height",h,n)},p.dimensions=function(h,n){this.width(h,!0),this.height(n)},p.dimension=function(h,n,u){return void 0!==n?(this.el_.style[h]=-1!==(""+(n=null===n||n!=n?0:n)).indexOf("%")||-1!==(""+n).indexOf("px")?n:"auto"===n?"":n+"px",void(u||this.trigger("componentresize"))):this.el_?(u=(n=this.el_.style[h]).indexOf("px"),parseInt(-1!==u?n.slice(0,u):this.el_["offset"+pt(h)],10)):0},p.currentDimension=function(h){var n=0;if("width"!==h&&"height"!==h)throw new Error("currentDimension only accepts width or height value");return n=ye(this.el_,h),0!==(n=parseFloat(n))&&!isNaN(n)||(h="offset"+pt(h),n=this.el_[h]),n},p.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},p.currentWidth=function(){return this.currentDimension("width")},p.currentHeight=function(){return this.currentDimension("height")},p.focus=function(){this.el_.focus()},p.blur=function(){this.el_.blur()},p.handleKeyDown=function(h){this.player_&&(h.stopPropagation(),this.player_.handleKeyDown(h))},p.handleKeyPress=function(h){this.handleKeyDown(h)},p.emitTapEvents=function(){var h,n=0,u=null;function m(){h=!1}this.on("touchstart",function(y){1===y.touches.length&&(u={pageX:y.touches[0].pageX,pageY:y.touches[0].pageY},n=window.performance.now(),h=!0)}),this.on("touchmove",function(y){var T;1<y.touches.length?h=!1:u&&(T=y.touches[0].pageX-u.pageX,y=y.touches[0].pageY-u.pageY,10<Math.sqrt(T*T+y*y)&&(h=!1))}),this.on("touchleave",m),this.on("touchcancel",m),this.on("touchend",function(y){!(u=null)===h&&window.performance.now()-n<200&&(y.preventDefault(),this.trigger("tap"))})},p.enableTouchActivity=function(){var h,n,u;this.player()&&this.player().reportUserActivity&&(h=Je(this.player(),this.player().reportUserActivity),this.on("touchstart",function(){h(),this.clearInterval(n),n=this.setInterval(h,250)}),u=function(m){h(),this.clearInterval(n)},this.on("touchmove",h),this.on("touchend",u),this.on("touchcancel",u))},p.setTimeout=function(h,n){var u,m=this;return h=Je(this,h),this.clearTimersOnDispose_(),u=window.setTimeout(function(){m.setTimeoutIds_.has(u)&&m.setTimeoutIds_.delete(u),h()},n),this.setTimeoutIds_.add(u),u},p.clearTimeout=function(h){return this.setTimeoutIds_.has(h)&&(this.setTimeoutIds_.delete(h),window.clearTimeout(h)),h},p.setInterval=function(h,n){return h=Je(this,h),this.clearTimersOnDispose_(),n=window.setInterval(h,n),this.setIntervalIds_.add(n),n},p.clearInterval=function(h){return this.setIntervalIds_.has(h)&&(this.setIntervalIds_.delete(h),window.clearInterval(h)),h},p.requestAnimationFrame=function(h){var n,u=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),h=Je(this,h),n=window.requestAnimationFrame(function(){u.rafIds_.has(n)&&u.rafIds_.delete(n),h()}),this.rafIds_.add(n),n):this.setTimeout(h,1e3/60)},p.requestNamedAnimationFrame=function(h,n){var u=this;if(!this.namedRafs_.has(h)){this.clearTimersOnDispose_(),n=Je(this,n);var m=this.requestAnimationFrame(function(){n(),u.namedRafs_.has(h)&&u.namedRafs_.delete(h)});return this.namedRafs_.set(h,m),h}},p.cancelNamedAnimationFrame=function(h){this.namedRafs_.has(h)&&(this.cancelAnimationFrame(this.namedRafs_.get(h)),this.namedRafs_.delete(h))},p.cancelAnimationFrame=function(h){return this.supportsRaf_?(this.rafIds_.has(h)&&(this.rafIds_.delete(h),window.cancelAnimationFrame(h)),h):this.clearTimeout(h)},p.clearTimersOnDispose_=function(){var h=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(n){var m=n[1];h[n[0]].forEach(function(y,T){return h[m](T)})}),h.clearingTimersOnDispose_=!1}))},s.registerComponent=function(h,n){if("string"!=typeof h||!h)throw new Error('Illegal component name, "'+h+'"; must be a non-empty string.');var m=(u=s.getComponent("Tech"))&&u.isTech(n),u=s===n||s.prototype.isPrototypeOf(n.prototype);if(m||!u){var y=m?"techs must be registered using Tech.registerTech()":"must be a Component subclass";throw new Error('Illegal component, "'+h+'"; '+y+".")}if(h=pt(h),s.components_||(s.components_={}),y=s.getComponent("Player"),"Player"===h&&y&&y.players){var T=y.players;if(y=Object.keys(T),T&&0<y.length&&y.map(function(x){return T[x]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return s.components_[h]=n,s.components_[kr(h)]=n},s.getComponent=function(h){if(h&&s.components_)return s.components_[h]},s}();de.prototype.supportsRaf_="function"==typeof window.requestAnimationFrame&&"function"==typeof window.cancelAnimationFrame,de.registerComponent("Component",de);var De=function(s){if(void 0===s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s},ge=function(s,p){s.prototype=Object.create(p.prototype),(s.prototype.constructor=s).__proto__=p};function Lo(s,p,h,n){return function(u,m,y){if("number"!=typeof m||m<0||y<m)throw new Error("Failed to execute '"+u+"' on 'TimeRanges': The index provided ("+m+") is non-numeric or out of bounds (0-"+y+").")}(s,n,h.length-1),h[n][p]}function Nn(s){var p=void 0===s||0===s.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:s.length,start:Lo.bind(null,"start",0,s),end:Lo.bind(null,"end",1,s)};return window.Symbol&&window.Symbol.iterator&&(p[window.Symbol.iterator]=function(){return(s||[]).values()}),p}function Fa(s,p){return Array.isArray(s)?Nn(s):void 0===s||void 0===p?Nn():Nn([[s,p]])}function No(s,p){var h,n,u=0;if(!p)return 0;s&&s.length||(s=Fa(0,0));for(var m=0;m<s.length;m++)h=s.start(m),u+=(n=p<(n=s.end(m))?p:n)-h;return u/p}function Ft(s){if(s instanceof Ft)return s;"number"==typeof s?this.code=s:"string"==typeof s?this.message=s:ce(s)&&("number"==typeof s.code&&(this.code=s.code),te(this,s)),this.message||(this.message=Ft.defaultMessages[this.code]||"")}Ft.prototype.code=0,Ft.prototype.message="",Ft.prototype.status=null,Ft.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Ft.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var ei=0;ei<Ft.errorTypes.length;ei++)Ft[Ft.errorTypes[ei]]=ei,Ft.prototype[Ft.errorTypes[ei]]=ei;function Ni(s){return null!=s&&"function"==typeof s.then}function la(s){Ni(s)&&s.then(null,function(p){})}function Oo(s){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(p,h,n){return s[h]&&(p[h]=s[h]),p},{cues:s.cues&&Array.prototype.map.call(s.cues,function(p){return{startTime:p.startTime,endTime:p.endTime,text:p.text,id:p.id}})})}var we=z(function(s,p){function h(S){if(!S||"object"!=typeof S||(x=S.which||S.keyCode||S.charCode)&&(S=x),"number"==typeof S)return T[S];var x=String(S);return(S=n[x.toLowerCase()])||((S=u[x.toLowerCase()])?S:1===x.length?x.charCodeAt(0):void 0)}h.isEventKey=function(S,x){if(S&&"object"==typeof S){var A=S.which||S.keyCode||S.charCode;if(null==A)return!1;if("string"==typeof x){if((S=n[x.toLowerCase()])||(S=u[x.toLowerCase()]))return S===A}else if("number"==typeof x)return x===A;return!1}};for(var n=(p=s.exports=h).code=p.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},u=p.aliases={windows:91,"\u21e7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91},m=97;m<123;m++)n[String.fromCharCode(m)]=m-32;for(m=48;m<58;m++)n[m-48]=m;for(m=1;m<13;m++)n["f"+m]=m+111;for(m=0;m<10;m++)n["numpad "+m]=m+96;var y,T=p.names=p.title={};for(m in n)T[n[m]]=m;for(y in u)n[y]=u[y]}),On="vjs-modal-dialog",ti=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.handleKeyDown_=function(y){return m.handleKeyDown(y)},m.close_=function(y){return m.close(y)},m.opened_=m.hasBeenOpened_=m.hasBeenFilled_=!1,m.closeable(!m.options_.uncloseable),m.content(m.options_.content),m.contentEl_=Re("div",{className:On+"-content"},{role:"document"}),m.descEl_=Re("p",{className:On+"-description vjs-control-text",id:m.el().getAttribute("aria-describedby")}),Oa(m.descEl_,m.description()),m.el_.appendChild(m.descEl_),m.el_.appendChild(m.contentEl_),m}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},h.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,s.prototype.dispose.call(this)},h.buildCSSClass=function(){return On+" vjs-hidden "+s.prototype.buildCSSClass.call(this)},h.label=function(){return this.localize(this.options_.label||"Modal Window")},h.description=function(){var n=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(n+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),n},h.open=function(){var n;this.opened_||(n=this.player(),this.trigger("beforemodalopen"),this.opened_=!0,!this.options_.fillAlways&&(this.hasBeenOpened_||this.hasBeenFilled_)||this.fill(),this.wasPlaying_=!n.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&n.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=n.controls(),n.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0)},h.opened=function(n){return"boolean"==typeof n&&this[n?"open":"close"](),this.opened_},h.close=function(){var n;this.opened_&&(n=this.player(),this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&n.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&n.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose())},h.closeable=function(n){var u,m;return"boolean"==typeof n&&(u=this.closeable_=!!n,m=this.getChild("closeButton"),u&&!m&&(n=this.contentEl_,this.contentEl_=this.el_,m=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=n,this.on(m,"close",this.close_)),!u&&m&&(this.off(m,"close",this.close_),this.removeChild(m),m.dispose())),this.closeable_},h.fill=function(){this.fillWith(this.content())},h.fillWith=function(n){var u=this.contentEl(),m=u.parentNode,y=u.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,m.removeChild(u),this.empty(),So(u,n),this.trigger("modalfill"),y?m.insertBefore(u,y):m.appendChild(u),(u=this.getChild("closeButton"))&&m.appendChild(u.el_)},h.empty=function(){this.trigger("beforemodalempty"),bn(this.contentEl()),this.trigger("modalempty")},h.content=function(n){return void 0!==n&&(this.content_=n),this.content_},h.conditionalFocus_=function(){var n=document.activeElement,u=this.player_.el_;this.previouslyActiveEl_=null,!u.contains(n)&&u!==n||(this.previouslyActiveEl_=n,this.focus())},h.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},h.handleKeyDown=function(n){if(n.stopPropagation(),we.isEventKey(n,"Escape")&&this.closeable())return n.preventDefault(),void this.close();if(we.isEventKey(n,"Tab")){for(var u,m=this.focusableEls_(),y=this.el_.querySelector(":focus"),T=0;T<m.length;T++)if(y===m[T]){u=T;break}document.activeElement===this.el_&&(u=0),n.shiftKey&&0===u?(m[m.length-1].focus(),n.preventDefault()):n.shiftKey||u!==m.length-1||(m[0].focus(),n.preventDefault())}},h.focusableEls_=function(){var n=this.el_.querySelectorAll("*");return Array.prototype.filter.call(n,function(u){return(u instanceof window.HTMLAnchorElement||u instanceof window.HTMLAreaElement)&&u.hasAttribute("href")||(u instanceof window.HTMLInputElement||u instanceof window.HTMLSelectElement||u instanceof window.HTMLTextAreaElement||u instanceof window.HTMLButtonElement)&&!u.hasAttribute("disabled")||u instanceof window.HTMLIFrameElement||u instanceof window.HTMLObjectElement||u instanceof window.HTMLEmbedElement||u.hasAttribute("tabindex")&&-1!==u.getAttribute("tabindex")||u.hasAttribute("contenteditable")})},p}(de);ti.prototype.options_={pauseOnOpen:!0,temporary:!0},de.registerComponent("ModalDialog",ti);var Uo,ai=function(s){function p(n){var u;void 0===n&&(n=[]),(u=s.call(this)||this).tracks_=[],Object.defineProperty(De(u),"length",{get:function(){return this.tracks_.length}});for(var m=0;m<n.length;m++)u.addTrack(n[m]);return u}ge(p,s);var h=p.prototype;return h.addTrack=function(n){var u=this,m=this.tracks_.length;""+m in this||Object.defineProperty(this,m,{get:function(){return this.tracks_[m]}}),-1===this.tracks_.indexOf(n)&&(this.tracks_.push(n),this.trigger({track:n,type:"addtrack",target:this})),n.labelchange_=function(){u.trigger({track:n,type:"labelchange",target:u})},va(n)&&n.addEventListener("labelchange",n.labelchange_)},h.removeTrack=function(n){for(var u,m=0,y=this.length;m<y;m++)if(this[m]===n){(u=this[m]).off&&u.off(),this.tracks_.splice(m,1);break}u&&this.trigger({track:u,type:"removetrack",target:this})},h.getTrackById=function(n){for(var u=null,m=0,y=this.length;m<y;m++){var T=this[m];if(T.id===n){u=T;break}}return u},p}(Bt);for(Uo in ai.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},ai.prototype.allowedEvents_)ai.prototype["on"+Uo]=null;function Un(s,p){for(var h=0;h<s.length;h++)Object.keys(s[h]).length&&p.id!==s[h].id&&(s[h].enabled=!1)}function Bn(s,p){for(var h=0;h<s.length;h++)Object.keys(s[h]).length&&p.id!==s[h].id&&(s[h].selected=!1)}function Fn(s){var p=["protocol","hostname","port","pathname","search","hash","host"],h=document.createElement("a");h.href=s;for(var n={},u=0;u<p.length;u++)n[p[u]]=h[p[u]];return"http:"===n.protocol&&(n.host=n.host.replace(/:80$/,"")),"https:"===n.protocol&&(n.host=n.host.replace(/:443$/,"")),n.protocol||(n.protocol=window.location.protocol),n.host||(n.host=window.location.host),n}function Bo(s){var p;return s.match(/^https?:\/\//)||((p=document.createElement("a")).href=s,s=p.href),s}function jn(s){return"string"==typeof s&&(s=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(s))?s.pop().toLowerCase():""}function vr(s,p){return void 0===p&&(p=window.location),(":"===(s=Fn(s)).protocol?p:s).protocol+s.host!==p.protocol+p.host}var jt=function(s){function p(n){for(var u,m=(n=void 0===n?[]:n).length-1;0<=m;m--)if(n[m].enabled){Un(n,n[m]);break}return(u=s.call(this,n)||this).changing_=!1,u}ge(p,s);var h=p.prototype;return h.addTrack=function(n){var u=this;n.enabled&&Un(this,n),s.prototype.addTrack.call(this,n),n.addEventListener&&(n.enabledChange_=function(){u.changing_||(u.changing_=!0,Un(u,n),u.changing_=!1,u.trigger("change"))},n.addEventListener("enabledchange",n.enabledChange_))},h.removeTrack=function(n){s.prototype.removeTrack.call(this,n),n.removeEventListener&&n.enabledChange_&&(n.removeEventListener("enabledchange",n.enabledChange_),n.enabledChange_=null)},p}(ai),Ht=function(s){function p(n){for(var u,m=(n=void 0===n?[]:n).length-1;0<=m;m--)if(n[m].selected){Bn(n,n[m]);break}return(u=s.call(this,n)||this).changing_=!1,Object.defineProperty(De(u),"selectedIndex",{get:function(){for(var y=0;y<this.length;y++)if(this[y].selected)return y;return-1},set:function(){}}),u}ge(p,s);var h=p.prototype;return h.addTrack=function(n){var u=this;n.selected&&Bn(this,n),s.prototype.addTrack.call(this,n),n.addEventListener&&(n.selectedChange_=function(){u.changing_||(u.changing_=!0,Bn(u,n),u.changing_=!1,u.trigger("change"))},n.addEventListener("selectedchange",n.selectedChange_))},h.removeTrack=function(n){s.prototype.removeTrack.call(this,n),n.removeEventListener&&n.selectedChange_&&(n.removeEventListener("selectedchange",n.selectedChange_),n.selectedChange_=null)},p}(ai),le=function(s){function p(){return s.apply(this,arguments)||this}ge(p,s);var h=p.prototype;return h.addTrack=function(n){var u=this;s.prototype.addTrack.call(this,n),this.queueChange_||(this.queueChange_=function(){return u.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return u.trigger("selectedlanguagechange")}),n.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(n.kind)&&n.addEventListener("modechange",this.triggerSelectedlanguagechange_)},h.removeTrack=function(n){s.prototype.removeTrack.call(this,n),n.removeEventListener&&(this.queueChange_&&n.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&n.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},p}(ai),kt=function(){function s(h){void 0===h&&(h=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var n=0,u=h.length;n<u;n++)this.addTrackElement_(h[n])}var p=s.prototype;return p.addTrackElement_=function(h){var n=this.trackElements_.length;""+n in this||Object.defineProperty(this,n,{get:function(){return this.trackElements_[n]}}),-1===this.trackElements_.indexOf(h)&&this.trackElements_.push(h)},p.getTrackElementByTrack_=function(h){for(var n,u=0,m=this.trackElements_.length;u<m;u++)if(h===this.trackElements_[u].track){n=this.trackElements_[u];break}return n},p.removeTrackElement_=function(h){for(var n=0,u=this.trackElements_.length;n<u;n++)if(h===this.trackElements_[n]){this.trackElements_[n].track&&"function"==typeof this.trackElements_[n].track.off&&this.trackElements_[n].track.off(),"function"==typeof this.trackElements_[n].off&&this.trackElements_[n].off(),this.trackElements_.splice(n,1);break}},s}(),Fo=function(){function s(h){s.prototype.setCues_.call(this,h),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var p=s.prototype;return p.setCues_=function(h){var n=this.length||0,u=0,m=h.length;function y(T){""+T in this||Object.defineProperty(this,""+T,{get:function(){return this.cues_[T]}})}if(this.cues_=h,this.length_=h.length,n<m)for(u=n;u<m;u++)y.call(this,u)},p.getCueById=function(h){for(var n=null,u=0,m=this.length;u<m;u++){var y=this[u];if(y.id===h){n=y;break}}return n},s}(),uh={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},lh={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},dh={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},jo={disabled:"disabled",hidden:"hidden",showing:"showing"},da=(be=function(s){function p(h){void 0===h&&(h={});var n,u=s.call(this)||this,m={id:h.id||"vjs_track_"+xa++,kind:h.kind||"",language:h.language||""},y=h.label||"";for(n in m)!function(T){Object.defineProperty(De(u),T,{get:function(){return m[T]},set:function(){}})}(n);return Object.defineProperty(De(u),"label",{get:function(){return y},set:function(T){T!==y&&(y=T,this.trigger("labelchange"))}}),u}return ge(p,s),p}(Bt),Object.freeze({__proto__:null,parseUrl:Fn,getAbsoluteURL:Bo,getFileExtension:jn,isCrossOrigin:vr})),Jt=dt="undefined"!=typeof window?window:void 0!==G?G:"undefined"!=typeof self?self:{},ch=Object.prototype.toString;ha.httpHandler=function(s,p){return void 0===p&&(p=!1),function(h,n,u){if(h)s(h);else if(400<=n.statusCode&&n.statusCode<=599){if(h=u,p)if(Jt.TextDecoder){void 0===(m=n.headers&&n.headers["content-type"])&&(m=""),n=m.toLowerCase().split(";").reduce(function(y,T){T=(S=T.split("="))[0];var S=S[1];return"charset"===T.trim()?S.trim():y},"utf-8");try{h=new TextDecoder(n).decode(u)}catch(m){}}else h=String.fromCharCode.apply(null,new Uint8Array(u));s({cause:h})}else s(null,u);var m}};var $n=ha;function $o(s,p,h){var n=s;return function(s){if(!s)return!1;var p=ch.call(s);return"[object Function]"===p||"function"==typeof s&&"[object RegExp]"!==p||"undefined"!=typeof window&&(s===window.setTimeout||s===window.alert||s===window.confirm||s===window.prompt)}(p)?(h=p,"string"==typeof s&&(n={uri:s})):n=Z({},p,{uri:s}),n.callback=h,n}function ha(s,p,h){return Vo(p=$o(s,p,h))}function Vo(s){if(void 0===s.callback)throw new Error("callback argument missing");var p=!1,h=function(V,ee,ae){p||(p=!0,s.callback(V,ee,ae))};function n(){var V=void 0;if(V=x.response||x.responseText||function(ee){try{if("document"===ee.responseType)return ee.responseXML;if(""===ee.responseType&&(!ee.responseXML||"parsererror"!==ee.responseXML.documentElement.nodeName))return ee.responseXML}catch(ne){}return null}(x),H)try{V=JSON.parse(V)}catch(ee){}return V}function u(V){return clearTimeout(S),(V=V instanceof Error?V:new Error(""+(V||"Unknown XMLHttpRequest Error"))).statusCode=0,h(V,q)}function m(){if(!T){clearTimeout(S);var V=s.useXDR&&void 0===x.status?200:1223===x.status?204:x.status,ee=q,ae=null;return 0!==V?(ee={body:n(),statusCode:V,method:L,headers:{},url:A,rawRequest:x},x.getAllResponseHeaders&&(ee.headers=function(s){var p={};return s&&s.trim().split("\n").forEach(function(h){var n=h.indexOf(":"),u=h.slice(0,n).trim().toLowerCase();n=h.slice(n+1).trim(),void 0===p[u]?p[u]=n:Array.isArray(p[u])?p[u].push(n):p[u]=[p[u],n]}),p}(x.getAllResponseHeaders()))):ae=new Error("Internal XMLHttpRequest Error"),h(ae,ee,ee.body)}}var y,T,S,x=s.xhr||null,A=(x=x||new(s.cors||s.useXDR?ha.XDomainRequest:ha.XMLHttpRequest)).url=s.uri||s.url,L=x.method=s.method||"GET",O=s.body||s.data,j=x.headers=s.headers||{},B=!!s.sync,H=!1,q={body:void 0,headers:{},statusCode:0,method:L,url:A,rawRequest:x};if("json"in s&&!1!==s.json&&(H=!0,j.accept||j.Accept||(j.Accept="application/json"),"GET"!==L&&"HEAD"!==L&&(j["content-type"]||j["Content-Type"]||(j["Content-Type"]="application/json"),O=JSON.stringify(!0===s.json?O:s.json))),x.onreadystatechange=function(){4===x.readyState&&setTimeout(m,0)},x.onload=m,x.onerror=u,x.onprogress=function(){},x.onabort=function(){T=!0},x.ontimeout=u,x.open(L,A,!B,s.username,s.password),B||(x.withCredentials=!!s.withCredentials),!B&&0<s.timeout&&(S=setTimeout(function(){var V;T||(T=!0,x.abort("timeout"),(V=new Error("XMLHttpRequest timeout")).code="ETIMEDOUT",u(V))},s.timeout)),x.setRequestHeader)for(y in j)j.hasOwnProperty(y)&&x.setRequestHeader(y,j[y]);else if(s.headers&&!function(V){for(var ee in V)if(V.hasOwnProperty(ee))return;return 1}(s.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in s&&(x.responseType=s.responseType),"beforeSend"in s&&"function"==typeof s.beforeSend&&s.beforeSend(x),x.send(O||null),x}function Go(s,p){var h=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()),n=[];h.oncue=function(u){p.addCue(u)},h.onparsingerror=function(u){n.push(u)},h.onflush=function(){p.trigger({type:"loadeddata",target:p})},h.parse(s),0<n.length&&(window.console&&window.console.groupCollapsed&&window.console.groupCollapsed("Text Track parsing errors for "+p.src),n.forEach(function(u){return U.error(u)}),window.console&&window.console.groupEnd&&window.console.groupEnd()),h.flush()}function Ko(s,p){var h={uri:s};(s=vr(s))&&(h.cors=s),(s="use-credentials"===p.tech_.crossOrigin())&&(h.withCredentials=s),$n(h,Je(this,function(n,u,m){return n?U.error(n,u):(p.loaded_=!0,void("function"!=typeof window.WebVTT?p.tech_&&p.tech_.any(["vttjsloaded","vttjserror"],function(y){return"vttjserror"!==y.type?Go(m,p):void U.error("vttjs failed to load, stopping trying to process "+p.src)}):Go(m,p)))}))}Ie=ha,ha.XMLHttpRequest=Jt.XMLHttpRequest||function(){},ha.XDomainRequest="withCredentials"in new ha.XMLHttpRequest?ha.XMLHttpRequest:Jt.XDomainRequest,function(s,p){for(var h=0;h<s.length;h++)p(s[h])}(["get","put","post","patch","head","delete"],function(s){ha["delete"===s?"del":s]=function(p,h,n){return(h=$o(p,h,n)).method=s.toUpperCase(),Vo(h)}}),$n.default=Ie;var Oi=function(s){function p(n){var u;if(!(n=void 0===n?{}:n).tech)throw new Error("A tech was not provided.");n=at(n,{kind:dh[n.kind]||"subtitles",language:n.language||n.srclang||""});var m=jo[n.mode]||"disabled",y=n.default;"metadata"!==n.kind&&"chapters"!==n.kind||(m="hidden"),(u=s.call(this,n)||this).tech_=n.tech,u.cues_=[],u.activeCues_=[],u.preload_=!1!==u.tech_.preloadTextTracks;var T=new Fo(u.cues_),S=new Fo(u.activeCues_),x=!1,A=Je(De(u),function(){this.tech_.isReady_&&!this.tech_.isDisposed()&&(this.activeCues=this.activeCues,x&&(this.trigger("cuechange"),x=!1))});return u.tech_.one("dispose",function(){u.tech_.off("timeupdate",A)}),"disabled"!==m&&u.tech_.on("timeupdate",A),Object.defineProperties(De(u),{default:{get:function(){return y},set:function(){}},mode:{get:function(){return m},set:function(L){jo[L]&&m!==L&&(m=L,this.preload_||"disabled"===m||0!==this.cues.length||Ko(this.src,this),this.tech_.off("timeupdate",A),"disabled"!==m&&this.tech_.on("timeupdate",A),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?T:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return S;for(var L=this.tech_.currentTime(),O=[],j=0,B=this.cues.length;j<B;j++){var H=this.cues[j];(H.startTime<=L&&H.endTime>=L||H.startTime===H.endTime&&H.startTime<=L&&H.startTime+.5>=L)&&O.push(H)}if(x=!1,O.length!==this.activeCues_.length)x=!0;else for(var q=0;q<O.length;q++)-1===this.activeCues_.indexOf(O[q])&&(x=!0);return this.activeCues_=O,S.setCues_(this.activeCues_),S},set:function(){}}}),n.src?(u.src=n.src,u.preload_||(u.loaded_=!0),(u.preload_||"subtitles"!==n.kind&&"captions"!==n.kind)&&Ko(u.src,De(u))):u.loaded_=!0,u}ge(p,s);var h=p.prototype;return h.addCue=function(n){var u=n;if(window.vttjs&&!(n instanceof window.vttjs.VTTCue)){for(var m in u=new window.vttjs.VTTCue(n.startTime,n.endTime,n.text),n)m in u||(u[m]=n[m]);u.id=n.id,u.originalCue_=n}for(var y=this.tech_.textTracks(),T=0;T<y.length;T++)y[T]!==this&&y[T].removeCue(u);this.cues_.push(u),this.cues.setCues_(this.cues_)},h.removeCue=function(n){for(var u=this.cues_.length;u--;){var m=this.cues_[u];if(m===n||m.originalCue_&&m.originalCue_===n){this.cues_.splice(u,1),this.cues.setCues_(this.cues_);break}}},p}(be);Oi.prototype.allowedEvents_={cuechange:"cuechange"},Se=function(s){function p(h){var n=at(h=void 0===h?{}:h,{kind:lh[h.kind]||""}),u=(h=s.call(this,n)||this,!1);return Object.defineProperty(De(h),"enabled",{get:function(){return u},set:function(m){"boolean"==typeof m&&m!==u&&(u=m,this.trigger("enabledchange"))}}),n.enabled&&(h.enabled=n.enabled),h.loaded_=!0,h}return ge(p,s),p}(be),Qe=function(s){function p(h){var n=at(h=void 0===h?{}:h,{kind:uh[h.kind]||""}),u=(h=s.call(this,n)||this,!1);return Object.defineProperty(De(h),"selected",{get:function(){return u},set:function(m){"boolean"==typeof m&&m!==u&&(u=m,this.trigger("selectedchange"))}}),n.selected&&(h.selected=n.selected),h}return ge(p,s),p}(be),(We=function(s){function p(h){var n;void 0===h&&(h={});var u=s.call(this)||this,m=new Oi(h);return u.kind=m.kind,u.src=m.src,u.srclang=m.language,u.label=m.label,u.default=m.default,Object.defineProperties(De(u),{readyState:{get:function(){return n}},track:{get:function(){return m}}}),n=0,m.addEventListener("loadeddata",function(){n=2,u.trigger({type:"load",target:De(u)})}),u}return ge(p,s),p}(Bt)).prototype.allowedEvents_={load:"load"},We.NONE=0,We.LOADING=1,We.LOADED=2,We.ERROR=3;var Zt={audio:{ListClass:jt,TrackClass:Se,capitalName:"Audio"},video:{ListClass:Ht,TrackClass:Qe,capitalName:"Video"},text:{ListClass:le,TrackClass:Oi,capitalName:"Text"}};Object.keys(Zt).forEach(function(s){Zt[s].getterName=s+"Tracks",Zt[s].privateName=s+"Tracks_"});var ii={remoteText:{ListClass:le,TrackClass:Oi,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:kt,TrackClass:We,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},$t=Z({},Zt,ii);ii.names=Object.keys(ii),Zt.names=Object.keys(Zt),$t.names=[].concat(ii.names).concat(Zt.names);var It=void 0!==G?G:"undefined"!=typeof window?window:{},dt=Et="undefined"!=typeof document?document:(Et=It["__GLOBAL_DOCUMENT_CACHE@4"])||(It["__GLOBAL_DOCUMENT_CACHE@4"]={}),Vn=Object.create||function(s){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return Ho.prototype=s,new Ho};function Ho(){}function ea(s,p){this.name="ParsingError",this.code=s.code,this.message=p||s.message}function Gn(s){function p(h,n,u,m){return 3600*(0|h)+60*(0|n)+(0|u)+(0|m)/1e3}return(s=s.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/))?s[3]?p(s[1],s[2],s[3].replace(":",""),s[4]):59<s[1]?p(s[1],s[2],0,s[4]):p(0,s[1],s[2],s[4]):null}function Ui(){this.values=Vn(null)}function Bi(s,p,h,n){var u,m,y=n?s.split(n):[s];for(u in y)"string"==typeof y[u]&&2===(m=y[u].split(h)).length&&p(m[0],m[1])}function mh(s,p,h){var n=s;function u(){var y=Gn(s);if(null===y)throw new ea(ea.Errors.BadTimeStamp,"Malformed timestamp: "+n);return s=s.replace(/^[^\sa-zA-Z-]+/,""),y}function m(){s=s.replace(/^\s+/,"")}if(m(),p.startTime=u(),m(),"--\x3e"!==s.substr(0,3))throw new ea(ea.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);s=s.substr(3),m(),p.endTime=u(),m(),function(y,T){var S=new Ui;Bi(y,function(x,A){switch(x){case"region":for(var L=h.length-1;0<=L;L--)if(h[L].id===A){S.set(x,h[L].region);break}break;case"vertical":S.alt(x,A,["rl","lr"]);break;case"line":var O=A.split(","),j=O[0];S.integer(x,j),S.percent(x,j)&&S.set("snapToLines",!1),S.alt(x,j,["auto"]),2===O.length&&S.alt("lineAlign",O[1],["start","center","end"]);break;case"position":O=A.split(","),S.percent(x,O[0]),2===O.length&&S.alt("positionAlign",O[1],["start","center","end"]);break;case"size":S.percent(x,A);break;case"align":S.alt(x,A,["start","center","end","left","right"])}},/:/,/\s/),T.region=S.get("region",null),T.vertical=S.get("vertical","");try{T.line=S.get("line","auto")}catch(x){}T.lineAlign=S.get("lineAlign","start"),T.snapToLines=S.get("snapToLines",!0),T.size=S.get("size",100);try{T.align=S.get("align","center")}catch(x){T.align=S.get("align","middle")}try{T.position=S.get("position","auto")}catch(x){T.position=S.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},T.align)}T.positionAlign=S.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},T.align)}(s,p)}((ea.prototype=Vn(Error.prototype)).constructor=ea).Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},Ui.prototype={set:function(s,p){this.get(s)||""===p||(this.values[s]=p)},get:function(s,p,h){return h?this.has(s)?this.values[s]:p[h]:this.has(s)?this.values[s]:p},has:function(s){return s in this.values},alt:function(s,p,h){for(var n=0;n<h.length;++n)if(p===h[n]){this.set(s,p);break}},integer:function(s,p){/^-?\d+$/.test(p)&&this.set(s,parseInt(p,10))},percent:function(s,p){return!!(p.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(p=parseFloat(p))&&p<=100)&&(this.set(s,p),!0)}};var Kn=dt.createElement&&dt.createElement("textarea"),gh={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Wo={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},fh={v:"title",lang:"lang"},zo={rt:"ruby"};function qo(s,p){for(var h,n,u,m,y,S,x,A,L,O=s.document.createElement("div"),j=O,B=[];null!==(h=function(){if(!p)return null;var H=p.match(/^([^<]*)(<[^>]*>?)?/);return p=p.substr((H=H[1]||H[2]).length),H}());)"<"!==h[0]?j.appendChild(s.document.createTextNode((Kn.innerHTML=h,y=Kn.textContent,Kn.textContent="",y))):"/"!==h[1]?(m=Gn(h.substr(1,h.length-2)))?(n=s.document.createProcessingInstruction("timestamp",m),j.appendChild(n)):(u=h.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/))&&(A=u[3],L=void 0,(n=(L=gh[x=u[1]])?(L=s.document.createElement(L),(x=fh[x])&&A&&(L[x]=A.trim()),L):null)&&(zo[(S=n).localName]&&zo[S.localName]!==j.localName||(u[2]&&((m=u[2].split(".")).forEach(function(H){var q=/^bg_/.test(H);H=q?H.slice(3):H,Wo.hasOwnProperty(H)&&(n.style[q?"background-color":"color"]=H=Wo[H])}),n.className=m.join(" ")),B.push(u[1]),j.appendChild(n),j=n))):B.length&&B[B.length-1]===h.substr(2).replace(">","")&&(B.pop(),j=j.parentNode);return O}var Xo=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function yh(s){var p=[],h="";if(!s||!s.childNodes)return"ltr";function n(m,y){for(var T=y.childNodes.length-1;0<=T;T--)m.push(y.childNodes[T])}for(n(p,s);h=function m(y){if(!y||!y.length)return null;var T=y.pop(),S=T.textContent||T.innerText;if(S){var x=S.match(/^.*(\n|\r)/);return x?x[y.length=0]:S}return"ruby"===T.tagName?m(y):T.childNodes?(n(y,T),m(y)):void 0}(p);)for(var u=0;u<h.length;u++)if(function(m){for(var y=0;y<Xo.length;y++){var T=Xo[y];if(m>=T[0]&&m<=T[1])return 1}}(h.charCodeAt(u)))return"rtl";return"ltr"}function Tr(){}function Hn(s,p,h){Tr.call(this),this.cue=p,this.cueDiv=qo(s,p.text);var n={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===p.vertical?"horizontal-tb":"lr"===p.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(n,this.cueDiv),this.div=s.document.createElement("div"),n={direction:yh(this.cueDiv),writingMode:""===p.vertical?"horizontal-tb":"lr"===p.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===p.align?"center":p.align,font:h.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var u=0;switch(p.positionAlign){case"start":u=p.position;break;case"center":u=p.position-p.size/2;break;case"end":u=p.position-p.size}this.applyStyles(""===p.vertical?{left:this.formatStyle(u,"%"),width:this.formatStyle(p.size,"%")}:{top:this.formatStyle(u,"%"),height:this.formatStyle(p.size,"%")}),this.move=function(m){this.applyStyles({top:this.formatStyle(m.top,"px"),bottom:this.formatStyle(m.bottom,"px"),left:this.formatStyle(m.left,"px"),right:this.formatStyle(m.right,"px"),height:this.formatStyle(m.height,"px"),width:this.formatStyle(m.width,"px")})}}function Vt(s){var p,h,n,u;s.div&&(p=s.div.offsetHeight,h=s.div.offsetWidth,n=s.div.offsetTop,u=(u=s.div.childNodes)&&(u=u[0])&&u.getClientRects&&u.getClientRects(),s=s.div.getBoundingClientRect(),u=u?Math.max(u[0]&&u[0].height||0,s.height/u.length):0),this.left=s.left,this.right=s.right,this.top=s.top||n,this.height=s.height||p,this.bottom=s.bottom||n+(s.height||p),this.width=s.width||h,this.lineHeight=void 0!==u?u:s.lineHeight}function _h(s,p,h,n){var u,m=new Vt(p),y=p.cue,T=function(B){if("number"==typeof B.line&&(B.snapToLines||0<=B.line&&B.line<=100))return B.line;if(!B.track||!B.track.textTrackList||!B.track.textTrackList.mediaElement)return-1;for(var H=B.track,q=H.textTrackList,V=0,ee=0;ee<q.length&&q[ee]!==H;ee++)"showing"===q[ee].mode&&V++;return-1*++V}(y),S=[];if(y.snapToLines){switch(y.vertical){case"":S=["+y","-y"],u="height";break;case"rl":S=["+x","-x"],u="width";break;case"lr":S=["-x","+x"],u="width"}var x=m.lineHeight,A=x*Math.round(T),L=h[u]+x,O=S[0];Math.abs(A)>L&&(A=A<0?-1:1,A*=Math.ceil(L/x)*x),T<0&&(A+=""===y.vertical?h.height:h.width,S=S.reverse()),m.move(O,A)}else{var j=m.lineHeight/h.height*100;switch(y.lineAlign){case"center":T-=j/2;break;case"end":T-=j}switch(y.vertical){case"":p.applyStyles({top:p.formatStyle(T,"%")});break;case"rl":p.applyStyles({left:p.formatStyle(T,"%")});break;case"lr":p.applyStyles({right:p.formatStyle(T,"%")})}S=["+y","-x","+x","-y"],m=new Vt(p)}m=function(B,H){for(var q,V=new Vt(B),ee=1,ae=0;ae<H.length;ae++){for(;B.overlapsOppositeAxis(h,H[ae])||B.within(h)&&B.overlapsAny(n);)B.move(H[ae]);if(B.within(h))return B;var ne=B.intersectPercentage(h);ne<ee&&(q=new Vt(B),ee=ne),B=new Vt(V)}return q||V}(m,S),p.move(m.toCSSCompatValues(h))}function Fi(){}Tr.prototype.applyStyles=function(s,p){for(var h in p=p||this.div,s)s.hasOwnProperty(h)&&(p.style[h]=s[h])},Tr.prototype.formatStyle=function(s,p){return 0===s?0:s+p},(Hn.prototype=Vn(Tr.prototype)).constructor=Hn,Vt.prototype.move=function(s,p){switch(p=void 0!==p?p:this.lineHeight,s){case"+x":this.left+=p,this.right+=p;break;case"-x":this.left-=p,this.right-=p;break;case"+y":this.top+=p,this.bottom+=p;break;case"-y":this.top-=p,this.bottom-=p}},Vt.prototype.overlaps=function(s){return this.left<s.right&&this.right>s.left&&this.top<s.bottom&&this.bottom>s.top},Vt.prototype.overlapsAny=function(s){for(var p=0;p<s.length;p++)if(this.overlaps(s[p]))return!0;return!1},Vt.prototype.within=function(s){return this.top>=s.top&&this.bottom<=s.bottom&&this.left>=s.left&&this.right<=s.right},Vt.prototype.overlapsOppositeAxis=function(s,p){switch(p){case"+x":return this.left<s.left;case"-x":return this.right>s.right;case"+y":return this.top<s.top;case"-y":return this.bottom>s.bottom}},Vt.prototype.intersectPercentage=function(s){return Math.max(0,Math.min(this.right,s.right)-Math.max(this.left,s.left))*Math.max(0,Math.min(this.bottom,s.bottom)-Math.max(this.top,s.top))/(this.height*this.width)},Vt.prototype.toCSSCompatValues=function(s){return{top:this.top-s.top,bottom:s.bottom-this.bottom,left:this.left-s.left,right:s.right-this.right,height:this.height,width:this.width}},Vt.getSimpleBoxPosition=function(s){var p=s.div?s.div.offsetHeight:s.tagName?s.offsetHeight:0,h=s.div?s.div.offsetWidth:s.tagName?s.offsetWidth:0,n=s.div?s.div.offsetTop:s.tagName?s.offsetTop:0;return{left:(s=s.div?s.div.getBoundingClientRect():s.tagName?s.getBoundingClientRect():s).left,right:s.right,top:s.top||n,height:s.height||p,bottom:s.bottom||n+(s.height||p),width:s.width||h}},Fi.StringDecoder=function(){return{decode:function(s){if(!s)return"";if("string"!=typeof s)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(s))}}},Fi.convertCueToDOMTree=function(s,p){return s&&p?qo(s,p):null},Fi.processCues=function(s,p,h){if(!s||!p||!h)return null;for(;h.firstChild;)h.removeChild(h.firstChild);var n=s.document.createElement("div");if(n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin="1.5%",h.appendChild(n),function(S){for(var x=0;x<S.length;x++)if(S[x].hasBeenReset||!S[x].displayState)return 1}(p)){var u=[],m=Vt.getSimpleBoxPosition(n),y={font:Math.round(.05*m.height*100)/100+"px sans-serif"};!function(){for(var S,x,A=0;A<p.length;A++)S=new Hn(s,x=p[A],y),n.appendChild(S.div),_h(0,S,m,u),x.displayState=S.div,u.push(Vt.getSimpleBoxPosition(S))}()}else for(var T=0;T<p.length;T++)n.appendChild(p[T].displayState)},(Fi.Parser=function(s,p,h){h||(h=p,p={}),p=p||{},this.window=s,this.vttjs=p,this.state="INITIAL",this.buffer="",this.decoder=h||new TextDecoder("utf8"),this.regionList=[]}).prototype={reportOrThrowError:function(s){if(!(s instanceof ea))throw s;this.onparsingerror&&this.onparsingerror(s)},parse:function(s){var S,p=this;function h(){for(var S=p.buffer,x=0;x<S.length&&"\r"!==S[x]&&"\n"!==S[x];)++x;var A=S.substr(0,x);return"\r"===S[x]&&++x,"\n"===S[x]&&++x,p.buffer=S.substr(x),A}s&&(p.buffer+=p.decoder.decode(s,{stream:!0}));try{if("INITIAL"===p.state){if(!/\r\n|\n/.test(p.buffer))return this;var u,m=(u=h()).match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new ea(ea.Errors.BadSignature);p.state="HEADER"}for(var y=!1;p.buffer;){if(!/\r\n|\n/.test(p.buffer))return this;switch(y?y=!1:u=h(),p.state){case"HEADER":/:/.test(u)?(S=u).match(/X-TIMESTAMP-MAP/)?Bi(S,function(x,A){var L;"X-TIMESTAMP-MAP"===x&&(A=A,L=new Ui,Bi(A,function(O,j){switch(O){case"MPEGT":L.integer(O+"S",j);break;case"LOCA":L.set(O+"L",Gn(j))}},/[^\d]:/,/,/),p.ontimestampmap&&p.ontimestampmap({MPEGTS:L.get("MPEGTS"),LOCAL:L.get("LOCAL")}))},/=/):Bi(S,function(x,A){var L;"Region"===x&&(A=A,L=new Ui,Bi(A,function(O,j){switch(O){case"id":L.set(O,j);break;case"width":L.percent(O,j);break;case"lines":L.integer(O,j);break;case"regionanchor":case"viewportanchor":var B=j.split(",");if(2!==B.length)break;var H=new Ui;if(H.percent("x",B[0]),H.percent("y",B[1]),!H.has("x")||!H.has("y"))break;L.set(O+"X",H.get("x")),L.set(O+"Y",H.get("y"));break;case"scroll":L.alt(O,j,["up"])}},/=/,/\s/),L.has("id")&&((A=new(p.vttjs.VTTRegion||p.window.VTTRegion)).width=L.get("width",100),A.lines=L.get("lines",3),A.regionAnchorX=L.get("regionanchorX",0),A.regionAnchorY=L.get("regionanchorY",100),A.viewportAnchorX=L.get("viewportanchorX",0),A.viewportAnchorY=L.get("viewportanchorY",100),A.scroll=L.get("scroll",""),p.onregion&&p.onregion(A),p.regionList.push({id:L.get("id"),region:A})))},/:/):u||(p.state="ID");continue;case"NOTE":u||(p.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(u)){p.state="NOTE";break}if(!u)continue;p.cue=new(p.vttjs.VTTCue||p.window.VTTCue)(0,0,"");try{p.cue.align="center"}catch(S){p.cue.align="middle"}if(p.state="CUE",-1===u.indexOf("--\x3e")){p.cue.id=u;continue}case"CUE":try{mh(u,p.cue,p.regionList)}catch(S){p.reportOrThrowError(S),p.cue=null,p.state="BADCUE";continue}p.state="CUETEXT";continue;case"CUETEXT":var T=-1!==u.indexOf("--\x3e");if(!u||T&&(y=!0)){p.oncue&&p.oncue(p.cue),p.cue=null,p.state="ID";continue}p.cue.text&&(p.cue.text+="\n"),p.cue.text+=u.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":u||(p.state="ID");continue}}}catch(S){p.reportOrThrowError(S),"CUETEXT"===p.state&&p.cue&&p.oncue&&p.oncue(p.cue),p.cue=null,p.state="INITIAL"===p.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var s=this;try{if(s.buffer+=s.decoder.decode(),!s.cue&&"HEADER"!==s.state||(s.buffer+="\n\n",s.parse()),"INITIAL"===s.state)throw new ea(ea.Errors.BadSignature)}catch(p){s.reportOrThrowError(p)}return s.onflush&&s.onflush(),this}};var kh=Fi,vh={"":1,lr:1,rl:1},Th={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Wn(s){return"string"==typeof s&&!!Th[s.toLowerCase()]&&s.toLowerCase()}function Yo(s,p,h){this.hasBeenReset=!1;var n="",u=!1,m=s,y=p,T=h,S=null,x="",A=!0,L="auto",O="start",j="auto",B="auto",H=100,q="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return n},set:function(V){n=""+V}},pauseOnExit:{enumerable:!0,get:function(){return u},set:function(V){u=!!V}},startTime:{enumerable:!0,get:function(){return m},set:function(V){if("number"!=typeof V)throw new TypeError("Start time must be set to a number.");m=V,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return y},set:function(V){if("number"!=typeof V)throw new TypeError("End time must be set to a number.");y=V,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return T},set:function(V){T=""+V,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return S},set:function(V){S=V,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return x},set:function(V){if(!1===(V="string"==typeof(V=V)&&!!vh[V.toLowerCase()]&&V.toLowerCase()))throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");x=V,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return A},set:function(V){A=!!V,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return L},set:function(V){if("number"!=typeof V&&"auto"!==V)throw new SyntaxError("Line: an invalid number or illegal string was specified.");L=V,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return O},set:function(V){(V=Wn(V))&&(O=V,this.hasBeenReset=!0)}},position:{enumerable:!0,get:function(){return j},set:function(V){if(V<0||100<V)throw new Error("Position must be between 0 and 100.");j=V,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return B},set:function(V){(V=Wn(V))&&(B=V,this.hasBeenReset=!0)}},size:{enumerable:!0,get:function(){return H},set:function(V){if(V<0||100<V)throw new Error("Size must be between 0 and 100.");H=V,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return q},set:function(V){if(!(V=Wn(V)))throw new SyntaxError("align: an invalid or illegal alignment string was specified.");q=V,this.hasBeenReset=!0}}}),this.displayState=void 0}Yo.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var Eh=Yo,Sh={"":!0,up:!0};function ji(s){return"number"==typeof s&&0<=s&&s<=100}function Ch(){var s=100,p=3,h=0,n=100,u=0,m=100,y="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return s},set:function(T){if(!ji(T))throw new Error("Width must be between 0 and 100.");s=T}},lines:{enumerable:!0,get:function(){return p},set:function(T){if("number"!=typeof T)throw new TypeError("Lines must be set to a number.");p=T}},regionAnchorY:{enumerable:!0,get:function(){return n},set:function(T){if(!ji(T))throw new Error("RegionAnchorX must be between 0 and 100.");n=T}},regionAnchorX:{enumerable:!0,get:function(){return h},set:function(T){if(!ji(T))throw new Error("RegionAnchorY must be between 0 and 100.");h=T}},viewportAnchorY:{enumerable:!0,get:function(){return m},set:function(T){if(!ji(T))throw new Error("ViewportAnchorY must be between 0 and 100.");m=T}},viewportAnchorX:{enumerable:!0,get:function(){return u},set:function(T){if(!ji(T))throw new Error("ViewportAnchorX must be between 0 and 100.");u=T}},scroll:{enumerable:!0,get:function(){return y},set:function(T){!1===(T="string"==typeof(T=T)&&!!Sh[T.toLowerCase()]&&T.toLowerCase())||(y=T)}}})}var $i=z(function(s){s=s.exports={WebVTT:kh,VTTCue:Eh,VTTRegion:Ch},Jt.vttjs=s,Jt.WebVTT=s.WebVTT;var p=s.VTTCue,h=s.VTTRegion,n=Jt.VTTCue,u=Jt.VTTRegion;s.shim=function(){Jt.VTTCue=p,Jt.VTTRegion=h},s.restore=function(){Jt.VTTCue=n,Jt.VTTRegion=u},Jt.VTTCue||s.shim()}),Ze=function(s){function p(n,u){var m;return void 0===u&&(u=function(){}),(n=void 0===n?{}:n).reportTouchActivity=!1,(m=s.call(this,null,n,u)||this).onDurationChange_=function(y){return m.onDurationChange(y)},m.trackProgress_=function(y){return m.trackProgress(y)},m.trackCurrentTime_=function(y){return m.trackCurrentTime(y)},m.stopTrackingCurrentTime_=function(y){return m.stopTrackingCurrentTime(y)},m.disposeSourceHandler_=function(y){return m.disposeSourceHandler(y)},m.hasStarted_=!1,m.on("playing",function(){this.hasStarted_=!0}),m.on("loadstart",function(){this.hasStarted_=!1}),$t.names.forEach(function(y){y=$t[y],n&&n[y.getterName]&&(m[y.privateName]=n[y.getterName])}),m.featuresProgressEvents||m.manualProgressOn(),m.featuresTimeupdateEvents||m.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(y){!1===n["native"+y+"Tracks"]&&(m["featuresNative"+y+"Tracks"]=!1)}),!1===n.nativeCaptions||!1===n.nativeTextTracks?m.featuresNativeTextTracks=!1:!0!==n.nativeCaptions&&!0!==n.nativeTextTracks||(m.featuresNativeTextTracks=!0),m.featuresNativeTextTracks||m.emulateTextTracks(),m.preloadTextTracks=!1!==n.preloadTextTracks,m.autoRemoteTextTracks_=new $t.text.ListClass,m.initTrackListeners(),n.nativeControlsForTouch||m.emitTapEvents(),m.constructor&&(m.name_=m.constructor.name||"Unknown Tech"),m}ge(p,s);var h=p.prototype;return h.triggerSourceset=function(n){var u=this;this.isReady_||this.one("ready",function(){return u.setTimeout(function(){return u.triggerSourceset(n)},1)}),this.trigger({src:n,type:"sourceset"})},h.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},h.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},h.trackProgress=function(n){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Je(this,function(){var u=this.bufferedPercent();this.bufferedPercent_!==u&&this.trigger("progress"),1===(this.bufferedPercent_=u)&&this.stopTrackingProgress()}),500)},h.onDurationChange=function(n){this.duration_=this.duration()},h.buffered=function(){return Fa(0,0)},h.bufferedPercent=function(){return No(this.buffered(),this.duration_)},h.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},h.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},h.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},h.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},h.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},h.dispose=function(){this.clearTracks(Zt.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),s.prototype.dispose.call(this)},h.clearTracks=function(n){var u=this;(n=[].concat(n)).forEach(function(m){for(var y=u[m+"Tracks"]()||[],T=y.length;T--;){var S=y[T];"text"===m&&u.removeRemoteTextTrack(S),y.removeTrack(S)}})},h.cleanupAutoTextTracks=function(){for(var n=this.autoRemoteTextTracks_||[],u=n.length;u--;)this.removeRemoteTextTrack(n[u])},h.reset=function(){},h.crossOrigin=function(){},h.setCrossOrigin=function(){},h.error=function(n){return void 0!==n&&(this.error_=new Ft(n),this.trigger("error")),this.error_},h.played=function(){return this.hasStarted_?Fa(0,0):Fa()},h.play=function(){},h.setScrubbing=function(){},h.scrubbing=function(){},h.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},h.initTrackListeners=function(){var n=this;Zt.names.forEach(function(u){function m(){n.trigger(u+"trackchange")}var T=n[Zt[u].getterName]();T.addEventListener("removetrack",m),T.addEventListener("addtrack",m),n.on("dispose",function(){T.removeEventListener("removetrack",m),T.removeEventListener("addtrack",m)})})},h.addWebVttScript_=function(){var n,u=this;window.WebVTT||(document.body.contains(this.el())?!this.options_["vtt.js"]&&me($i)&&0<Object.keys($i).length?this.trigger("vttjsloaded"):((n=document.createElement("script")).src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",n.onload=function(){u.trigger("vttjsloaded")},n.onerror=function(){u.trigger("vttjserror")},this.on("dispose",function(){n.onload=null,n.onerror=null}),window.WebVTT=!0,this.el().parentNode.appendChild(n)):this.ready(this.addWebVttScript_))},h.emulateTextTracks=function(){function n(A){return y.addTrack(A.track)}function u(A){return y.removeTrack(A.track)}var m=this,y=this.textTracks(),T=this.remoteTextTracks();function S(){return m.trigger("texttrackchange")}function x(){S();for(var A=0;A<y.length;A++){var L=y[A];L.removeEventListener("cuechange",S),"showing"===L.mode&&L.addEventListener("cuechange",S)}}T.on("addtrack",n),T.on("removetrack",u),this.addWebVttScript_(),x(),y.addEventListener("change",x),y.addEventListener("addtrack",x),y.addEventListener("removetrack",x),this.on("dispose",function(){T.off("addtrack",n),T.off("removetrack",u),y.removeEventListener("change",x),y.removeEventListener("addtrack",x),y.removeEventListener("removetrack",x);for(var A=0;A<y.length;A++)y[A].removeEventListener("cuechange",S)})},h.addTextTrack=function(n,u,m){if(!n)throw new Error("TextTrack kind is required but was not provided");return function(y,T,S,x,A){void 0===A&&(A={});var L=y.textTracks();return A.kind=T,S&&(A.label=S),x&&(A.language=x),A.tech=y,A=new $t.text.TrackClass(A),L.addTrack(A),A}(this,n,u,m)},h.createRemoteTextTrack=function(n){return n=at(n,{tech:this}),new ii.remoteTextEl.TrackClass(n)},h.addRemoteTextTrack=function(n,u){var m=this,y=this.createRemoteTextTrack(n=void 0===n?{}:n);return!0!==u&&!1!==u&&(U.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),u=!0),this.remoteTextTrackEls().addTrackElement_(y),this.remoteTextTracks().addTrack(y.track),!0!==u&&this.ready(function(){return m.autoRemoteTextTracks_.addTrack(y.track)}),y},h.removeRemoteTextTrack=function(n){var u=this.remoteTextTrackEls().getTrackElementByTrack_(n);this.remoteTextTrackEls().removeTrackElement_(u),this.remoteTextTracks().removeTrack(n),this.autoRemoteTextTracks_.removeTrack(n)},h.getVideoPlaybackQuality=function(){return{}},h.requestPictureInPicture=function(){var n=this.options_.Promise||window.Promise;if(n)return n.reject()},h.disablePictureInPicture=function(){return!0},h.setDisablePictureInPicture=function(){},h.setPoster=function(){},h.playsinline=function(){},h.setPlaysinline=function(){},h.overrideNativeAudioTracks=function(){},h.overrideNativeVideoTracks=function(){},h.canPlayType=function(){return""},p.canPlayType=function(){return""},p.canPlaySource=function(n,u){return p.canPlayType(n.type)},p.isTech=function(n){return n.prototype instanceof p||n instanceof p||n===p},p.registerTech=function(n,u){if(p.techs_||(p.techs_={}),!p.isTech(u))throw new Error("Tech "+n+" must be a Tech");if(!p.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!p.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return n=pt(n),p.techs_[n]=u,p.techs_[kr(n)]=u,"Tech"!==n&&p.defaultTechOrder_.push(n),u},p.getTech=function(n){if(n)return p.techs_&&p.techs_[n]?p.techs_[n]:(n=pt(n),window&&window.videojs&&window.videojs[n]?(U.warn("The "+n+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),window.videojs[n]):void 0)},p}(de);$t.names.forEach(function(s){var p=$t[s];Ze.prototype[p.getterName]=function(){return this[p.privateName]=this[p.privateName]||new p.ListClass,this[p.privateName]}}),Ze.prototype.featuresVolumeControl=!0,Ze.prototype.featuresMuteControl=!0,Ze.prototype.featuresFullscreenResize=!1,Ze.prototype.featuresPlaybackRate=!1,Ze.prototype.featuresProgressEvents=!1,Ze.prototype.featuresSourceset=!1,Ze.prototype.featuresTimeupdateEvents=!1,Ze.prototype.featuresNativeTextTracks=!1,Ze.withSourceHandlers=function(s){s.registerSourceHandler=function(p,h){var n=(n=s.sourceHandlers)||(s.sourceHandlers=[]);void 0===h&&(h=n.length),n.splice(h,0,p)},s.canPlayType=function(p){for(var h,n=s.sourceHandlers||[],u=0;u<n.length;u++)if(h=n[u].canPlayType(p))return h;return""},s.selectSourceHandler=function(p,h){for(var n=s.sourceHandlers||[],u=0;u<n.length;u++)if(n[u].canHandleSource(p,h))return n[u];return null},s.canPlaySource=function(p,h){var n=s.selectSourceHandler(p,h);return n?n.canHandleSource(p,h):""},["seekable","seeking","duration"].forEach(function(p){var h=this[p];"function"==typeof h&&(this[p]=function(){return this.sourceHandler_&&this.sourceHandler_[p]?this.sourceHandler_[p].apply(this.sourceHandler_,arguments):h.apply(this,arguments)})},s.prototype),s.prototype.setSource=function(p){var h=s.selectSourceHandler(p,this.options_);h||(s.nativeSourceHandler?h=s.nativeSourceHandler:U.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),h!==s.nativeSourceHandler&&(this.currentSource_=p),this.sourceHandler_=h.handleSource(p,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},s.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},de.registerComponent("Tech",Ze),Ze.registerTech("Tech",Ze),Ze.defaultTechOrder_=[];var ja={},zn={},Er={};function Qo(s,p,h,n){void 0===n&&(n=null);var u="call"+pt(h);return u=s.reduce(qn(u),n),function(m,y,T,S){for(var x=m.length-1;0<=x;x--){var A=m[x];A[y]&&A[y](S,T)}}(s,h,u=(n=u===Er)?null:p[h](u),n),u}var Ph={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Ah={setCurrentTime:1,setMuted:1,setVolume:1},Jo={play:1,pause:1};function qn(s){return function(p,h){return p===Er?Er:h[s]?h[s](p):p}}function Sr(s){return s=jn(s=void 0===s?"":s),xh[s.toLowerCase()]||""}function Zo(s){var p;return Array.isArray(s)?(p=[],s.forEach(function(h){h=Zo(h),Array.isArray(h)?p=p.concat(h):ce(h)&&p.push(h)}),p):"string"==typeof s&&s.trim()?[eu({src:s})]:ce(s)&&"string"==typeof s.src&&s.src&&s.src.trim()?[eu(s)]:[]}var xh={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"};function eu(s){var p;return s.type||(p=Sr(s.src))&&(s.type=p),s}Ie=function(s){function p(h,n,u){var m=at({createEl:!1},n);if(u=s.call(this,h,m,u)||this,n.playerOptions.sources&&0!==n.playerOptions.sources.length)h.src(n.playerOptions.sources);else for(var y=0,T=n.playerOptions.techOrder;y<T.length;y++){var S=pt(T[y]),x=Ze.getTech(S);if((x=S?x:de.getComponent(S))&&x.isSupported()){h.loadTech_(S);break}}return u}return ge(p,s),p}(de),de.registerComponent("MediaLoader",Ie),be=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.handleMouseOver_=function(y){return m.handleMouseOver(y)},m.handleMouseOut_=function(y){return m.handleMouseOut(y)},m.handleClick_=function(y){return m.handleClick(y)},m.handleKeyDown_=function(y){return m.handleKeyDown(y)},m.emitTapEvents(),m.enable(),m}ge(p,s);var h=p.prototype;return h.createEl=function(n,u,m){return void 0===n&&(n="div"),void 0===u&&(u={}),void 0===m&&(m={}),u=te({className:this.buildCSSClass(),tabIndex:0},u),"button"===n&&U.error("Creating a ClickableComponent with an HTML element of "+n+" is not supported; use a Button instead."),m=te({role:"button"},m),this.tabIndex_=u.tabIndex,(m=Re(n,u,m)).appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(m),m},h.dispose=function(){this.controlTextEl_=null,s.prototype.dispose.call(this)},h.createControlTextEl=function(n){return this.controlTextEl_=Re("span",{className:"vjs-control-text"},{"aria-live":"polite"}),n&&n.appendChild(this.controlTextEl_),this.controlText(this.controlText_,n),this.controlTextEl_},h.controlText=function(n,u){if(void 0===u&&(u=this.el()),void 0===n)return this.controlText_||"Need Text";var m=this.localize(n);this.controlText_=n,Oa(this.controlTextEl_,m),this.nonIconControl||this.player_.options_.noUITitleAttributes||u.setAttribute("title",m)},h.buildCSSClass=function(){return"vjs-control vjs-button "+s.prototype.buildCSSClass.call(this)},h.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},h.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},h.handleLanguagechange=function(){this.controlText(this.controlText_)},h.handleClick=function(n){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},h.handleKeyDown=function(n){we.isEventKey(n,"Space")||we.isEventKey(n,"Enter")?(n.preventDefault(),n.stopPropagation(),this.trigger("click")):s.prototype.handleKeyDown.call(this,n)},p}(de),de.registerComponent("ClickableComponent",be),de.registerComponent("PosterImage",function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.update(),m.update_=function(y){return m.update(y)},n.on("posterchange",m.update_),m}ge(p,s);var h=p.prototype;return h.dispose=function(){this.player().off("posterchange",this.update_),s.prototype.dispose.call(this)},h.createEl=function(){return Re("div",{className:"vjs-poster",tabIndex:-1})},h.update=function(n){var u=this.player().poster();this.setSrc(u),u?this.show():this.hide()},h.setSrc=function(n){this.el_.style.backgroundImage=n?'url("'+n+'")':""},h.handleClick=function(n){var u;this.player_.controls()&&(u=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length,!this.player_.tech(!0)||(_t||Ye)&&u||this.player_.tech(!0).focus(),this.player_.paused()?la(this.player_.play()):this.player_.pause())},p}(be));var Cr="#222",Mh={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Xn(s,p){var h;if(4===s.length)h=s[1]+s[1]+s[2]+s[2]+s[3]+s[3];else{if(7!==s.length)throw new Error("Invalid color code provided, "+s+"; must be formatted as e.g. #f0e or #f604e2.");h=s.slice(1)}return"rgba("+parseInt(h.slice(0,2),16)+","+parseInt(h.slice(2,4),16)+","+parseInt(h.slice(4,6),16)+","+p+")"}function Yn(s,p,h){try{s.style[p]=h}catch(n){return}}de.registerComponent("TextTrackDisplay",function(s){function p(n,u,m){function y(S){return T.updateDisplay(S)}var T=s.call(this,n,u,m)||this;return n.on("loadstart",function(S){return T.toggleDisplay(S)}),n.on("texttrackchange",y),n.on("loadedmetadata",function(S){return T.preselectTrack(S)}),n.ready(Je(De(T),function(){if(n.tech_&&n.tech_.featuresNativeTextTracks)this.hide();else{n.on("fullscreenchange",y),n.on("playerresize",y),window.addEventListener("orientationchange",y),n.on("dispose",function(){return window.removeEventListener("orientationchange",y)});for(var S=this.options_.playerOptions.tracks||[],x=0;x<S.length;x++)this.player_.addRemoteTextTrack(S[x],!0);this.preselectTrack()}})),T}ge(p,s);var h=p.prototype;return h.preselectTrack=function(){for(var n,u,m,y={captions:1,subtitles:1},T=this.player_.textTracks(),S=this.player_.cache_.selectedLanguage,x=0;x<T.length;x++){var A=T[x];S&&S.enabled&&S.language&&S.language===A.language&&A.kind in y?m=A.kind!==S.kind&&m||A:S&&!S.enabled?u=n=m=null:A.default&&("descriptions"!==A.kind||n?A.kind in y&&!u&&(u=A):n=A)}m?m.mode="showing":u?u.mode="showing":n&&(n.mode="showing")},h.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},h.clearDisplay=function(){"function"==typeof window.WebVTT&&window.WebVTT.processCues(window,[],this.el_)},h.updateDisplay=function(){var n=this.player_.textTracks(),u=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),u){for(var m=[],y=0;y<n.length;++y){var T=n[y];"showing"===T.mode&&m.push(T)}this.updateForTrack(m)}else{for(var S=null,x=null,A=n.length;A--;){var L=n[A];"showing"===L.mode&&("descriptions"===L.kind?S=L:x=L)}x?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(x)):S&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(S))}},h.updateDisplayState=function(n){for(var u=this.player_.textTrackSettings.getValues(),m=n.activeCues,y=m.length;y--;){var T,S=m[y];S&&(T=S.displayState,u.color&&(T.firstChild.style.color=u.color),u.textOpacity&&Yn(T.firstChild,"color",Xn(u.color||"#fff",u.textOpacity)),u.backgroundColor&&(T.firstChild.style.backgroundColor=u.backgroundColor),u.backgroundOpacity&&Yn(T.firstChild,"backgroundColor",Xn(u.backgroundColor||"#000",u.backgroundOpacity)),u.windowColor&&(u.windowOpacity?Yn(T,"backgroundColor",Xn(u.windowColor,u.windowOpacity)):T.style.backgroundColor=u.windowColor),u.edgeStyle&&("dropshadow"===u.edgeStyle?T.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px "+Cr:"raised"===u.edgeStyle?T.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px "+Cr:"depressed"===u.edgeStyle?T.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px "+Cr:"uniform"===u.edgeStyle&&(T.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px "+Cr)),u.fontPercent&&1!==u.fontPercent&&(S=window.parseFloat(T.style.fontSize),T.style.fontSize=S*u.fontPercent+"px",T.style.height="auto",T.style.top="auto"),u.fontFamily&&"default"!==u.fontFamily&&("small-caps"===u.fontFamily?T.firstChild.style.fontVariant="small-caps":T.firstChild.style.fontFamily=Mh[u.fontFamily]))}},h.updateForTrack=function(n){if(Array.isArray(n)||(n=[n]),"function"==typeof window.WebVTT&&!n.every(function(O){return!O.activeCues})){for(var u=[],m=0;m<n.length;++m)for(var y=n[m],T=0;T<y.activeCues.length;++T)u.push(y.activeCues[T]);window.WebVTT.processCues(window,u,this.el_);for(var S=0;S<n.length;++S){for(var x=n[S],A=0;A<x.activeCues.length;++A){var L=x.activeCues[A].displayState;ya(L,"vjs-text-track-cue"),ya(L,"vjs-text-track-cue-"+(x.language||S)),x.language&&Qa(L,"lang",x.language)}this.player_.textTrackSettings&&this.updateDisplayState(x)}}},p}(de)),de.registerComponent("LoadingSpinner",function(s){function p(){return s.apply(this,arguments)||this}return ge(p,s),p.prototype.createEl=function(){var h=this.player_.isAudio(),n=this.localize(h?"Audio Player":"Video Player");return h=Re("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[n])}),(n=s.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"})).appendChild(h),n},p}(de));var ta=function(s){function p(){return s.apply(this,arguments)||this}ge(p,s);var h=p.prototype;return h.createEl=function(n,u,m){return void 0===u&&(u={}),void 0===m&&(m={}),(m=Re("button",u=te({className:this.buildCSSClass()},u),m=te({type:"button"},m))).appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(m),m},h.addChild=function(n,u){return void 0===u&&(u={}),U.warn("Adding an actionable (user controllable) child to a Button ("+this.constructor.name+") is not supported; use a ClickableComponent instead."),de.prototype.addChild.call(this,n,u)},h.enable=function(){s.prototype.enable.call(this),this.el_.removeAttribute("disabled")},h.disable=function(){s.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},h.handleKeyDown=function(n){we.isEventKey(n,"Space")||we.isEventKey(n,"Enter")?n.stopPropagation():s.prototype.handleKeyDown.call(this,n)},p}(be);function tu(s,p){s=s<0?0:s;var h=Math.floor(s%60),n=Math.floor(s/60%60),u=Math.floor(s/3600),m=Math.floor(p/60%60);return p=Math.floor(p/3600),(u=0<(u=isNaN(s)||s===1/0?n=h="-":u)||0<p?u+":":"")+(n=((u||10<=m)&&n<10?"0"+n:n)+":")+(h<10?"0"+h:h)}de.registerComponent("Button",ta),(jt=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.mouseused_=!1,m.on("mousedown",function(y){return m.handleMouseDown(y)}),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-big-play-button"},h.handleClick=function(n){var u=this.player_.play();if(this.mouseused_&&n.clientX&&n.clientY){var m=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length;return la(u),void(!this.player_.tech(!0)||(_t||Ye)&&m||this.player_.tech(!0).focus())}var y=(m=this.player_.getChild("controlBar"))&&m.getChild("playToggle");y?(m=function(){return y.focus()},Ni(u)?u.then(m,function(){}):this.setTimeout(m,1)):this.player_.tech(!0).focus()},h.handleKeyDown=function(n){this.mouseused_=!1,s.prototype.handleKeyDown.call(this,n)},h.handleMouseDown=function(n){this.mouseused_=!0},p}(ta)).prototype.controlText_="Play Video",de.registerComponent("BigPlayButton",jt),de.registerComponent("CloseButton",function(s){function p(n,u){return(n=s.call(this,n,u)||this).controlText(u&&u.controlText||n.localize("Close")),n}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-close-button "+s.prototype.buildCSSClass.call(this)},h.handleClick=function(n){this.trigger({type:"close",bubbles:!1})},h.handleKeyDown=function(n){we.isEventKey(n,"Esc")?(n.preventDefault(),n.stopPropagation(),this.trigger("click")):s.prototype.handleKeyDown.call(this,n)},p}(ta)),(Ht=function(s){function p(n,u){var m=s.call(this,n,u=void 0===u?{}:u)||this;return u.replay=void 0===u.replay||u.replay,m.on(n,"play",function(y){return m.handlePlay(y)}),m.on(n,"pause",function(y){return m.handlePause(y)}),u.replay&&m.on(n,"ended",function(y){return m.handleEnded(y)}),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-play-control "+s.prototype.buildCSSClass.call(this)},h.handleClick=function(n){this.player_.paused()?la(this.player_.play()):this.player_.pause()},h.handleSeeked=function(n){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(n):this.handlePlay(n)},h.handlePlay=function(n){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},h.handlePause=function(n){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},h.handleEnded=function(n){var u=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(m){return u.handleSeeked(m)})},p}(ta)).prototype.controlText_="Play",de.registerComponent("PlayToggle",Ht);var Qn=tu;function ri(s,p){return Qn(s,p=void 0===p?s:p)}function br(s,p,h){return s=Number(s),Math.min(h,Math.max(p,isNaN(s)?p:s))}function Jn(s,p){return br(s/p*100,0,100).toFixed(2)+"%"}(le=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.on(n,["timeupdate","ended"],function(y){return m.updateContent(y)}),m.updateTextNode_(),m}ge(p,s);var h=p.prototype;return h.createEl=function(){var n=this.buildCSSClass(),u=s.prototype.createEl.call(this,"div",{className:n+" vjs-time-control vjs-control"}),m=Re("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+"\xa0"},{role:"presentation"});return u.appendChild(m),this.contentEl_=Re("span",{className:n+"-display"},{"aria-live":"off",role:"presentation"}),u.appendChild(this.contentEl_),u},h.dispose=function(){this.contentEl_=null,this.textNode_=null,s.prototype.dispose.call(this)},h.updateTextNode_=function(n){var u=this;n=ri(n=void 0===n?0:n),this.formattedTime_!==n&&(this.formattedTime_=n,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){var m;u.contentEl_&&((m=u.textNode_)&&u.contentEl_.firstChild!==m&&(m=null,U.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),u.textNode_=document.createTextNode(u.formattedTime_),u.textNode_&&(m?u.contentEl_.replaceChild(u.textNode_,m):u.contentEl_.appendChild(u.textNode_)))}))},h.updateContent=function(n){},p}(de)).prototype.labelText_="Time",le.prototype.controlText_="Time",de.registerComponent("TimeDisplay",le),kt=function(s){function p(){return s.apply(this,arguments)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-current-time"},h.updateContent=function(n){var u=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.updateTextNode_(u)},p}(le),kt.prototype.labelText_="Current Time",kt.prototype.controlText_="Current Time",de.registerComponent("CurrentTimeDisplay",kt),(We=function(s){function p(n,u){var m=s.call(this,n,u)||this;return u=function(y){return m.updateContent(y)},m.on(n,"durationchange",u),m.on(n,"loadstart",u),m.on(n,"loadedmetadata",u),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-duration"},h.updateContent=function(n){var u=this.player_.duration();this.updateTextNode_(u)},p}(le)).prototype.labelText_="Duration",We.prototype.controlText_="Duration",de.registerComponent("DurationDisplay",We),de.registerComponent("TimeDivider",function(s){function p(){return s.apply(this,arguments)||this}return ge(p,s),p.prototype.createEl=function(){var h=s.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),n=s.prototype.createEl.call(this,"div"),u=s.prototype.createEl.call(this,"span",{textContent:"/"});return n.appendChild(u),h.appendChild(n),h},p}(de)),(G=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.on(n,"durationchange",function(y){return m.updateContent(y)}),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-remaining-time"},h.createEl=function(){var n=s.prototype.createEl.call(this);return n.insertBefore(Re("span",{},{"aria-hidden":!0},"-"),this.contentEl_),n},h.updateContent=function(n){var u;"number"==typeof this.player_.duration()&&(u=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(u))},p}(le)).prototype.labelText_="Remaining Time",G.prototype.controlText_="Remaining Time",de.registerComponent("RemainingTimeDisplay",G),de.registerComponent("LiveDisplay",function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.updateShowing(),m.on(m.player(),"durationchange",function(y){return m.updateShowing(y)}),m}ge(p,s);var h=p.prototype;return h.createEl=function(){var n=s.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Re("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Re("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+"\xa0"})),this.contentEl_.appendChild(document.createTextNode(this.localize("LIVE"))),n.appendChild(this.contentEl_),n},h.dispose=function(){this.contentEl_=null,s.prototype.dispose.call(this)},h.updateShowing=function(n){this.player().duration()===1/0?this.show():this.hide()},p}(de)),(It=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.updateLiveEdgeStatus(),m.player_.liveTracker&&(m.updateLiveEdgeStatusHandler_=function(y){return m.updateLiveEdgeStatus(y)},m.on(m.player_.liveTracker,"liveedgechange",m.updateLiveEdgeStatusHandler_)),m}ge(p,s);var h=p.prototype;return h.createEl=function(){var n=s.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Re("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),n.appendChild(this.textEl_),n},h.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},h.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},h.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,s.prototype.dispose.call(this)},p}(ta)).prototype.controlText_="Seek to live, currently playing live",de.registerComponent("SeekToLive",It),Et=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.handleMouseDown_=function(y){return m.handleMouseDown(y)},m.handleMouseUp_=function(y){return m.handleMouseUp(y)},m.handleKeyDown_=function(y){return m.handleKeyDown(y)},m.handleClick_=function(y){return m.handleClick(y)},m.handleMouseMove_=function(y){return m.handleMouseMove(y)},m.update_=function(y){return m.update(y)},m.bar=m.getChild(m.options_.barName),m.vertical(!!m.options_.vertical),m.enable(),m}ge(p,s);var h=p.prototype;return h.enabled=function(){return this.enabled_},h.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},h.disable=function(){var n;this.enabled()&&(n=this.bar.el_.ownerDocument,this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(n,"mousemove",this.handleMouseMove_),this.off(n,"mouseup",this.handleMouseUp_),this.off(n,"touchmove",this.handleMouseMove_),this.off(n,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1)},h.createEl=function(n,u,m){return void 0===m&&(m={}),(u=void 0===u?{}:u).className=u.className+" vjs-slider",u=te({tabIndex:0},u),m=te({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},m),s.prototype.createEl.call(this,n,u,m)},h.handleMouseDown=function(n){var u=this.bar.el_.ownerDocument;"mousedown"===n.type&&n.preventDefault(),"touchstart"!==n.type||ct||n.preventDefault(),ko(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(u,"mousemove",this.handleMouseMove_),this.on(u,"mouseup",this.handleMouseUp_),this.on(u,"touchmove",this.handleMouseMove_),this.on(u,"touchend",this.handleMouseUp_),this.handleMouseMove(n)},h.handleMouseMove=function(n){},h.handleMouseUp=function(){var n=this.bar.el_.ownerDocument;vo(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(n,"mousemove",this.handleMouseMove_),this.off(n,"mouseup",this.handleMouseUp_),this.off(n,"touchmove",this.handleMouseMove_),this.off(n,"touchend",this.handleMouseUp_),this.update()},h.update=function(){var n=this;if(this.el_&&this.bar){var u=this.getProgress();return u===this.progress_||(this.progress_=u,this.requestNamedAnimationFrame("Slider#update",function(){var m=n.vertical()?"height":"width";n.bar.el().style[m]=(100*u).toFixed(2)+"%"})),u}},h.getProgress=function(){return Number(br(this.getPercent(),0,1).toFixed(4))},h.calculateDistance=function(n){return n=pr(this.el_,n),this.vertical()?n.y:n.x},h.handleKeyDown=function(n){we.isEventKey(n,"Left")||we.isEventKey(n,"Down")?(n.preventDefault(),n.stopPropagation(),this.stepBack()):we.isEventKey(n,"Right")||we.isEventKey(n,"Up")?(n.preventDefault(),n.stopPropagation(),this.stepForward()):s.prototype.handleKeyDown.call(this,n)},h.handleClick=function(n){n.stopPropagation(),n.preventDefault()},h.vertical=function(n){if(void 0===n)return this.vertical_||!1;this.vertical_=!!n,this.addClass(this.vertical_?"vjs-slider-vertical":"vjs-slider-horizontal")},p}(de),de.registerComponent("Slider",Et),de.registerComponent("LoadProgressBar",function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.partEls_=[],m.on(n,"progress",function(y){return m.update(y)}),m}ge(p,s);var h=p.prototype;return h.createEl=function(){var n=s.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),u=Re("span",{className:"vjs-control-text"}),m=Re("span",{textContent:this.localize("Loaded")}),y=document.createTextNode(": ");return this.percentageEl_=Re("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),n.appendChild(u),u.appendChild(m),u.appendChild(y),u.appendChild(this.percentageEl_),n},h.dispose=function(){this.partEls_=null,this.percentageEl_=null,s.prototype.dispose.call(this)},h.update=function(n){var u=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var m=u.player_.liveTracker,y=u.player_.buffered(),T=(m=m&&m.isLive()?m.seekableEnd():u.player_.duration(),u.player_.bufferedEnd()),S=u.partEls_;m=Jn(T,m),u.percent_!==m&&(u.el_.style.width=m,Oa(u.percentageEl_,m),u.percent_=m);for(var x=0;x<y.length;x++){var A=y.start(x),L=y.end(x),O=S[x];O||(O=u.el_.appendChild(Re()),S[x]=O),O.dataset.start===A&&O.dataset.end===L||(O.dataset.start=A,O.dataset.end=L,O.style.left=Jn(A,T),O.style.width=Jn(L-A,T))}for(var j=S.length;j>y.length;j--)u.el_.removeChild(S[j-1]);S.length=y.length})},p}(de)),de.registerComponent("TimeTooltip",function(s){function p(n,u){return(u=s.call(this,n,u)||this).update=ka(Je(De(u),u.update),30),u}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},h.update=function(n,u,m){var y=Di(this.el_),T=Ja(this.player_.el()),S=n.width*u;T&&y&&(u=n.left-T.left+S,T=n.width-S+(T.right-n.right),u<(n=y.width/2)?n+=n-u:T<n&&(n=T),n<0?n=0:n>y.width&&(n=y.width),n=Math.round(n),this.el_.style.right="-"+n+"px",this.write(m))},h.write=function(n){Oa(this.el_,n)},h.updateTime=function(n,u,m,y){var T=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var S,x,A=T.player_.duration();A=T.player_.liveTracker&&T.player_.liveTracker.isLive()?((x=(S=T.player_.liveTracker.liveWindow())-u*S)<1?"":"-")+ri(x,S):ri(m,A),T.update(n,u,A),y&&y()})},p}(de)),(dt=function(s){function p(n,u){return(u=s.call(this,n,u)||this).update=ka(Je(De(u),u.update),30),u}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},h.update=function(n,u){var m,y=this.getChild("timeTooltip");y&&(m=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),y.updateTime(n,u,m))},p}(de)).prototype.options_={children:[]},At||Fe||dt.prototype.options_.children.push("timeTooltip"),de.registerComponent("PlayProgressBar",dt),(Ie=function(s){function p(n,u){return(u=s.call(this,n,u)||this).update=ka(Je(De(u),u.update),30),u}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},h.update=function(n,u){var m=this,y=u*this.player_.duration();this.getChild("timeTooltip").updateTime(n,u,y,function(){m.el_.style.left=n.width*u+"px"})},p}(de)).prototype.options_={children:["timeTooltip"]},de.registerComponent("MouseTimeDisplay",Ie),(jt=function(s){function p(n,u){return(u=s.call(this,n,u)||this).setEventHandlers_(),u}ge(p,s);var h=p.prototype;return h.setEventHandlers_=function(){var n=this;this.update_=Je(this,this.update),this.update=ka(this.update_,30),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(u){return n.enableInterval_(u)},this.disableIntervalHandler_=function(u){return n.disableInterval_(u)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.on(document,"visibilitychange",this.toggleVisibility_)},h.toggleVisibility_=function(n){"hidden"===document.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(n)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())},h.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,30))},h.disableInterval_=function(n){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&n&&"ended"!==n.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},h.update=function(n){var u=this;if("hidden"!==document.visibilityState){var m=s.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var y=u.player_.ended()?u.player_.duration():u.getCurrentTime_(),T=u.player_.liveTracker,S=u.player_.duration();T&&T.isLive()&&(S=u.player_.liveTracker.liveCurrentTime()),u.percent_!==m&&(u.el_.setAttribute("aria-valuenow",(100*m).toFixed(2)),u.percent_=m),u.currentTime_===y&&u.duration_===S||(u.el_.setAttribute("aria-valuetext",u.localize("progress bar timing: currentTime={1} duration={2}",[ri(y,S),ri(S,S)],"{1} of {2}")),u.currentTime_=y,u.duration_=S),u.bar&&u.bar.update(Ja(u.el()),u.getProgress())}),m}},h.userSeek_=function(n){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(n)},h.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},h.getPercent=function(){var n,u=this.getCurrentTime_(),m=this.player_.liveTracker;return m&&m.isLive()?(n=(u-m.seekableStart())/m.liveWindow(),m.atLiveEdge()&&(n=1)):n=u/this.player_.duration(),n},h.handleMouseDown=function(n){Ri(n)&&(n.stopPropagation(),this.player_.scrubbing(!0),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),s.prototype.handleMouseDown.call(this,n))},h.handleMouseMove=function(n){if(Ri(n)){var u=this.calculateDistance(n),m=this.player_.liveTracker;if(m&&m.isLive()){if(.99<=u)return void m.seekToLiveEdge();var y,T=m.seekableStart();if((y=(y=(n=m.liveCurrentTime())<=(y=T+u*m.liveWindow())?n:y)<=T?T+.1:y)===1/0)return}else(y=u*this.player_.duration())===this.player_.duration()&&(y-=.1);this.userSeek_(y)}},h.enable=function(){s.prototype.enable.call(this);var n=this.getChild("mouseTimeDisplay");n&&n.show()},h.disable=function(){s.prototype.disable.call(this);var n=this.getChild("mouseTimeDisplay");n&&n.hide()},h.handleMouseUp=function(n){s.prototype.handleMouseUp.call(this,n),n&&n.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?la(this.player_.play()):this.update_()},h.stepForward=function(){this.userSeek_(this.player_.currentTime()+5)},h.stepBack=function(){this.userSeek_(this.player_.currentTime()-5)},h.handleAction=function(n){this.player_.paused()?this.player_.play():this.player_.pause()},h.handleKeyDown=function(n){var u,m=this.player_.liveTracker;we.isEventKey(n,"Space")||we.isEventKey(n,"Enter")?(n.preventDefault(),n.stopPropagation(),this.handleAction(n)):we.isEventKey(n,"Home")?(n.preventDefault(),n.stopPropagation(),this.userSeek_(0)):we.isEventKey(n,"End")?(n.preventDefault(),n.stopPropagation(),m&&m.isLive()?this.userSeek_(m.liveCurrentTime()):this.userSeek_(this.player_.duration())):/^[0-9]$/.test(we(n))?(n.preventDefault(),n.stopPropagation(),u=10*(we.codes[we(n)]-we.codes[0])/100,m&&m.isLive()?this.userSeek_(m.seekableStart()+m.liveWindow()*u):this.userSeek_(this.player_.duration()*u)):we.isEventKey(n,"PgDn")?(n.preventDefault(),n.stopPropagation(),this.userSeek_(this.player_.currentTime()-60)):we.isEventKey(n,"PgUp")?(n.preventDefault(),n.stopPropagation(),this.userSeek_(this.player_.currentTime()+60)):s.prototype.handleKeyDown.call(this,n)},h.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.off(document,"visibilitychange",this.toggleVisibility_),s.prototype.dispose.call(this)},p}(Et)).prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},At||Fe||jt.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),de.registerComponent("SeekBar",jt),(Ht=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.handleMouseMove=ka(Je(De(m),m.handleMouseMove),30),m.throttledHandleMouseSeek=ka(Je(De(m),m.handleMouseSeek),30),m.handleMouseUpHandler_=function(y){return m.handleMouseUp(y)},m.handleMouseDownHandler_=function(y){return m.handleMouseDown(y)},m.enable(),m}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},h.handleMouseMove=function(n){var u,m,y,T,S=this.getChild("seekBar");S&&(u=S.getChild("playProgressBar"),m=S.getChild("mouseTimeDisplay"),(u||m)&&(T=Di(y=S.el()),n=br(n=pr(y,n).x,0,1),m&&m.update(T,n),u&&u.update(T,S.getProgress())))},h.handleMouseSeek=function(n){var u=this.getChild("seekBar");u&&u.handleMouseMove(n)},h.enabled=function(){return this.enabled_},h.disable=function(){var n;this.children().forEach(function(u){return u.disable&&u.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing()&&(n=this.getChild("seekBar"),this.player_.scrubbing(!1),n.videoWasPlaying&&la(this.player_.play())))},h.enable=function(){this.children().forEach(function(n){return n.enable&&n.enable()}),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},h.removeListenersAddedOnMousedownAndTouchstart=function(){var n=this.el_.ownerDocument;this.off(n,"mousemove",this.throttledHandleMouseSeek),this.off(n,"touchmove",this.throttledHandleMouseSeek),this.off(n,"mouseup",this.handleMouseUpHandler_),this.off(n,"touchend",this.handleMouseUpHandler_)},h.handleMouseDown=function(n){var u=this.el_.ownerDocument,m=this.getChild("seekBar");m&&m.handleMouseDown(n),this.on(u,"mousemove",this.throttledHandleMouseSeek),this.on(u,"touchmove",this.throttledHandleMouseSeek),this.on(u,"mouseup",this.handleMouseUpHandler_),this.on(u,"touchend",this.handleMouseUpHandler_)},h.handleMouseUp=function(n){var u=this.getChild("seekBar");u&&u.handleMouseUp(n),this.removeListenersAddedOnMousedownAndTouchstart()},p}(de)).prototype.options_={children:["seekBar"]},de.registerComponent("ProgressControl",Ht),(kt=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.on(n,["enterpictureinpicture","leavepictureinpicture"],function(y){return m.handlePictureInPictureChange(y)}),m.on(n,["disablepictureinpicturechanged","loadedmetadata"],function(y){return m.handlePictureInPictureEnabledChange(y)}),m.disable(),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-picture-in-picture-control "+s.prototype.buildCSSClass.call(this)},h.handlePictureInPictureEnabledChange=function(){document.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},h.handlePictureInPictureChange=function(n){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},h.handleClick=function(n){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},p}(ta)).prototype.controlText_="Picture-in-Picture",de.registerComponent("PictureInPictureToggle",kt),(We=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.on(n,"fullscreenchange",function(y){return m.handleFullscreenChange(y)}),!1===document[n.fsApi_.fullscreenEnabled]&&m.disable(),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-fullscreen-control "+s.prototype.buildCSSClass.call(this)},h.handleFullscreenChange=function(n){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},h.handleClick=function(n){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},p}(ta)).prototype.controlText_="Fullscreen",de.registerComponent("FullscreenToggle",We),de.registerComponent("VolumeLevel",function(s){function p(){return s.apply(this,arguments)||this}return ge(p,s),p.prototype.createEl=function(){var h=s.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return h.appendChild(s.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),h},p}(de)),de.registerComponent("VolumeLevelTooltip",function(s){function p(n,u){return(u=s.call(this,n,u)||this).update=ka(Je(De(u),u.update),30),u}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},h.update=function(n,u,m,y){if(!m){var T=Ja(this.el_),S=Ja(this.player_.el());if(!S||!T)return;u=n.left-S.left+(m=n.width*u),S=n.width-m+(S.right-n.right),u<(n=T.width/2)?n+=n-u:S<n&&(n=S),n<0?n=0:n>T.width&&(n=T.width),this.el_.style.right="-"+n+"px"}this.write(y+"%")},h.write=function(n){Oa(this.el_,n)},h.updateVolume=function(n,u,m,y,T){var S=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){S.update(n,u,m,y.toFixed(0)),T&&T()})},p}(de)),(le=function(s){function p(n,u){return(u=s.call(this,n,u)||this).update=ka(Je(De(u),u.update),30),u}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},h.update=function(n,u,m){var y=this,T=100*u;this.getChild("volumeLevelTooltip").updateVolume(n,u,m,T,function(){m?y.el_.style.bottom=n.height*u+"px":y.el_.style.left=n.width*u+"px"})},p}(de)).prototype.options_={children:["volumeLevelTooltip"]},de.registerComponent("MouseVolumeLevelDisplay",le),(G=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.on("slideractive",function(y){return m.updateLastVolume_(y)}),m.on(n,"volumechange",function(y){return m.updateARIAAttributes(y)}),n.ready(function(){return m.updateARIAAttributes()}),m}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},h.handleMouseDown=function(n){Ri(n)&&s.prototype.handleMouseDown.call(this,n)},h.handleMouseMove=function(n){var u,m,y,T=this.getChild("mouseVolumeLevelDisplay");T&&(u=Ja(y=this.el()),m=this.vertical(),y=pr(y,n),y=br(y=m?y.y:y.x,0,1),T.update(u,y,m)),Ri(n)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(n)))},h.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},h.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},h.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},h.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},h.updateARIAAttributes=function(n){var u=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",u),this.el_.setAttribute("aria-valuetext",u+"%")},h.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},h.updateLastVolume_=function(){var n=this,u=this.player_.volume();this.one("sliderinactive",function(){0===n.player_.volume()&&n.player_.lastVolume_(u)})},p}(Et)).prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},At||Fe||G.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),G.prototype.playerEvent="volumechange",de.registerComponent("VolumeBar",G),(It=function(s){function p(n,u){var m,y,T;return(u=void 0===u?{}:u).vertical=u.vertical||!1,void 0!==u.volumeBar&&!me(u.volumeBar)||(u.volumeBar=u.volumeBar||{},u.volumeBar.vertical=u.vertical),m=s.call(this,n,u)||this,y=De(m),(T=n).tech_&&!T.tech_.featuresVolumeControl&&y.addClass("vjs-hidden"),y.on(T,"loadstart",function(){T.tech_.featuresVolumeControl?y.removeClass("vjs-hidden"):y.addClass("vjs-hidden")}),m.throttledHandleMouseMove=ka(Je(De(m),m.handleMouseMove),30),m.handleMouseUpHandler_=function(S){return m.handleMouseUp(S)},m.on("mousedown",function(S){return m.handleMouseDown(S)}),m.on("touchstart",function(S){return m.handleMouseDown(S)}),m.on("mousemove",function(S){return m.handleMouseMove(S)}),m.on(m.volumeBar,["focus","slideractive"],function(){m.volumeBar.addClass("vjs-slider-active"),m.addClass("vjs-slider-active"),m.trigger("slideractive")}),m.on(m.volumeBar,["blur","sliderinactive"],function(){m.volumeBar.removeClass("vjs-slider-active"),m.removeClass("vjs-slider-active"),m.trigger("sliderinactive")}),m}ge(p,s);var h=p.prototype;return h.createEl=function(){var n="vjs-volume-horizontal";return this.options_.vertical&&(n="vjs-volume-vertical"),s.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+n})},h.handleMouseDown=function(n){var u=this.el_.ownerDocument;this.on(u,"mousemove",this.throttledHandleMouseMove),this.on(u,"touchmove",this.throttledHandleMouseMove),this.on(u,"mouseup",this.handleMouseUpHandler_),this.on(u,"touchend",this.handleMouseUpHandler_)},h.handleMouseUp=function(n){var u=this.el_.ownerDocument;this.off(u,"mousemove",this.throttledHandleMouseMove),this.off(u,"touchmove",this.throttledHandleMouseMove),this.off(u,"mouseup",this.handleMouseUpHandler_),this.off(u,"touchend",this.handleMouseUpHandler_)},h.handleMouseMove=function(n){this.volumeBar.handleMouseMove(n)},p}(de)).prototype.options_={children:["volumeBar"]},de.registerComponent("VolumeControl",It),(dt=function(s){function p(n,u){var m,y,T=s.call(this,n,u)||this;return m=De(T),(y=n).tech_&&!y.tech_.featuresMuteControl&&m.addClass("vjs-hidden"),m.on(y,"loadstart",function(){y.tech_.featuresMuteControl?m.removeClass("vjs-hidden"):m.addClass("vjs-hidden")}),T.on(n,["loadstart","volumechange"],function(S){return T.update(S)}),T}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-mute-control "+s.prototype.buildCSSClass.call(this)},h.handleClick=function(n){var u=this.player_.volume(),m=this.player_.lastVolume_();0===u?(this.player_.volume(m<.1?.1:m),this.player_.muted(!1)):this.player_.muted(!this.player_.muted())},h.update=function(n){this.updateIcon_(),this.updateControlText_()},h.updateIcon_=function(){var n=this.player_.volume(),u=3;At&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===n||this.player_.muted()?u=0:n<.33?u=1:n<.67&&(u=2);for(var m=0;m<4;m++)wi(this.el_,"vjs-vol-"+m);ya(this.el_,"vjs-vol-"+u)},h.updateControlText_=function(){var n=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==n&&this.controlText(n)},p}(ta)).prototype.controlText_="Mute",de.registerComponent("MuteToggle",dt),(Ie=function(s){function p(n,u){var m;return u.inline=void 0===(u=void 0===u?{}:u).inline||u.inline,void 0!==u.volumeControl&&!me(u.volumeControl)||(u.volumeControl=u.volumeControl||{},u.volumeControl.vertical=!u.inline),(m=s.call(this,n,u)||this).handleKeyPressHandler_=function(y){return m.handleKeyPress(y)},m.on(n,["loadstart"],function(y){return m.volumePanelState_(y)}),m.on(m.muteToggle,"keyup",function(y){return m.handleKeyPress(y)}),m.on(m.volumeControl,"keyup",function(y){return m.handleVolumeControlKeyUp(y)}),m.on("keydown",function(y){return m.handleKeyPress(y)}),m.on("mouseover",function(y){return m.handleMouseOver(y)}),m.on("mouseout",function(y){return m.handleMouseOut(y)}),m.on(m.volumeControl,["slideractive"],m.sliderActive_),m.on(m.volumeControl,["sliderinactive"],m.sliderInactive_),m}ge(p,s);var h=p.prototype;return h.sliderActive_=function(){this.addClass("vjs-slider-active")},h.sliderInactive_=function(){this.removeClass("vjs-slider-active")},h.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},h.createEl=function(){var n="vjs-volume-panel-horizontal";return this.options_.inline||(n="vjs-volume-panel-vertical"),s.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+n})},h.dispose=function(){this.handleMouseOut(),s.prototype.dispose.call(this)},h.handleVolumeControlKeyUp=function(n){we.isEventKey(n,"Esc")&&this.muteToggle.focus()},h.handleMouseOver=function(n){this.addClass("vjs-hover"),Xt(document,"keyup",this.handleKeyPressHandler_)},h.handleMouseOut=function(n){this.removeClass("vjs-hover"),Dt(document,"keyup",this.handleKeyPressHandler_)},h.handleKeyPress=function(n){we.isEventKey(n,"Esc")&&this.handleMouseOut()},p}(de)).prototype.options_={children:["muteToggle","volumeControl"]},de.registerComponent("VolumePanel",Ie);var au=function(s){function p(n,u){var m=s.call(this,n,u)||this;return u&&(m.menuButton_=u.menuButton),m.focusedChild_=-1,m.on("keydown",function(y){return m.handleKeyDown(y)}),m.boundHandleBlur_=function(y){return m.handleBlur(y)},m.boundHandleTapClick_=function(y){return m.handleTapClick(y)},m}ge(p,s);var h=p.prototype;return h.addEventListenerForItem=function(n){n instanceof de&&(this.on(n,"blur",this.boundHandleBlur_),this.on(n,["tap","click"],this.boundHandleTapClick_))},h.removeEventListenerForItem=function(n){n instanceof de&&(this.off(n,"blur",this.boundHandleBlur_),this.off(n,["tap","click"],this.boundHandleTapClick_))},h.removeChild=function(n){"string"==typeof n&&(n=this.getChild(n)),this.removeEventListenerForItem(n),s.prototype.removeChild.call(this,n)},h.addItem=function(n){(n=this.addChild(n))&&this.addEventListenerForItem(n)},h.createEl=function(){var n=this.options_.contentElType||"ul";return this.contentEl_=Re(n,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu"),(n=s.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"})).appendChild(this.contentEl_),Xt(n,"click",function(u){u.preventDefault(),u.stopImmediatePropagation()}),n},h.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,s.prototype.dispose.call(this)},h.handleBlur=function(n){var u=n.relatedTarget||document.activeElement;this.children().some(function(m){return m.el()===u})||(n=this.menuButton_)&&n.buttonPressed_&&u!==n.el().firstChild&&n.unpressButton()},h.handleTapClick=function(n){var u;this.menuButton_&&(this.menuButton_.unpressButton(),u=this.children(),!Array.isArray(u)||(u=u.filter(function(m){return m.el()===n.target})[0])&&"CaptionSettingsMenuItem"!==u.name()&&this.menuButton_.focus())},h.handleKeyDown=function(n){we.isEventKey(n,"Left")||we.isEventKey(n,"Down")?(n.preventDefault(),n.stopPropagation(),this.stepForward()):(we.isEventKey(n,"Right")||we.isEventKey(n,"Up"))&&(n.preventDefault(),n.stopPropagation(),this.stepBack())},h.stepForward=function(){var n=0;void 0!==this.focusedChild_&&(n=this.focusedChild_+1),this.focus(n)},h.stepBack=function(){var n=0;void 0!==this.focusedChild_&&(n=this.focusedChild_-1),this.focus(n)},h.focus=function(n){void 0===n&&(n=0);var u=this.children().slice();u.length&&u[0].hasClass("vjs-menu-title")&&u.shift(),0<u.length&&(n<0?n=0:n>=u.length&&(n=u.length-1),u[this.focusedChild_=n].el_.focus())},p}(de);de.registerComponent("Menu",au),jt=function(s){function p(n,u){var m;return(m=s.call(this,n,u=void 0===u?{}:u)||this).menuButton_=new ta(n,u),m.menuButton_.controlText(m.controlText_),m.menuButton_.el_.setAttribute("aria-haspopup","true"),u=ta.prototype.buildCSSClass(),m.menuButton_.el_.className=m.buildCSSClass()+" "+u,m.menuButton_.removeClass("vjs-control"),m.addChild(m.menuButton_),m.update(),m.enabled_=!0,u=function(y){return m.handleClick(y)},m.handleMenuKeyUp_=function(y){return m.handleMenuKeyUp(y)},m.on(m.menuButton_,"tap",u),m.on(m.menuButton_,"click",u),m.on(m.menuButton_,"keydown",function(y){return m.handleKeyDown(y)}),m.on(m.menuButton_,"mouseenter",function(){m.addClass("vjs-hover"),m.menu.show(),Xt(document,"keyup",m.handleMenuKeyUp_)}),m.on("mouseleave",function(y){return m.handleMouseLeave(y)}),m.on("keydown",function(y){return m.handleSubmenuKeyDown(y)}),m}ge(p,s);var h=p.prototype;return h.update=function(){var n=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=n,this.addChild(n),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},h.createMenu=function(){var n,u=new au(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title&&(n=Re("li",{className:"vjs-menu-title",textContent:pt(this.options_.title),tabIndex:-1}),n=new de(this.player_,{el:n}),u.addItem(n)),this.items=this.createItems(),this.items)for(var m=0;m<this.items.length;m++)u.addItem(this.items[m]);return u},h.createItems=function(){},h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},h.buildWrapperCSSClass=function(){var n="vjs-menu-button";return"vjs-menu-button "+(n+=!0===this.options_.inline?"-inline":"-popup")+" "+ta.prototype.buildCSSClass()+" "+s.prototype.buildCSSClass.call(this)},h.buildCSSClass=function(){var n="vjs-menu-button";return"vjs-menu-button "+(n+=!0===this.options_.inline?"-inline":"-popup")+" "+s.prototype.buildCSSClass.call(this)},h.controlText=function(n,u){return void 0===u&&(u=this.menuButton_.el()),this.menuButton_.controlText(n,u)},h.dispose=function(){this.handleMouseLeave(),s.prototype.dispose.call(this)},h.handleClick=function(n){this.buttonPressed_?this.unpressButton():this.pressButton()},h.handleMouseLeave=function(n){this.removeClass("vjs-hover"),Dt(document,"keyup",this.handleMenuKeyUp_)},h.focus=function(){this.menuButton_.focus()},h.blur=function(){this.menuButton_.blur()},h.handleKeyDown=function(n){we.isEventKey(n,"Esc")||we.isEventKey(n,"Tab")?(this.buttonPressed_&&this.unpressButton(),we.isEventKey(n,"Tab")||(n.preventDefault(),this.menuButton_.focus())):(we.isEventKey(n,"Up")||we.isEventKey(n,"Down"))&&(this.buttonPressed_||(n.preventDefault(),this.pressButton()))},h.handleMenuKeyUp=function(n){(we.isEventKey(n,"Esc")||we.isEventKey(n,"Tab"))&&this.removeClass("vjs-hover")},h.handleSubmenuKeyPress=function(n){this.handleSubmenuKeyDown(n)},h.handleSubmenuKeyDown=function(n){(we.isEventKey(n,"Esc")||we.isEventKey(n,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),we.isEventKey(n,"Tab")||(n.preventDefault(),this.menuButton_.focus()))},h.pressButton=function(){this.enabled_&&(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),At&&xi()||this.menu.focus())},h.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},h.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},h.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},p}(de),de.registerComponent("MenuButton",jt),Ht=function(s){function p(h,n){var u=n.tracks;if((n=s.call(this,h,n)||this).items.length<=1&&n.hide(),!u)return De(n);var m=Je(De(n),n.update);return u.addEventListener("removetrack",m),u.addEventListener("addtrack",m),u.addEventListener("labelchange",m),n.player_.on("ready",m),n.player_.on("dispose",function(){u.removeEventListener("removetrack",m),u.removeEventListener("addtrack",m),u.removeEventListener("labelchange",m)}),n}return ge(p,s),p}(jt),de.registerComponent("TrackButton",Ht);var wh=["Tab","Esc","Up","Down","Right","Left"];kt=function(s){function p(n,u){return(n=s.call(this,n,u)||this).selectable=u.selectable,n.isSelected_=u.selected||!1,n.multiSelectable=u.multiSelectable,n.selected(n.isSelected_),n.el_.setAttribute("role",n.selectable?n.multiSelectable?"menuitemcheckbox":"menuitemradio":"menuitem"),n}ge(p,s);var h=p.prototype;return h.createEl=function(n,u,m){return this.nonIconControl=!0,(m=s.prototype.createEl.call(this,"li",te({className:"vjs-menu-item",tabIndex:-1},u),m)).replaceChild(Re("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),m.querySelector(".vjs-icon-placeholder")),m},h.handleKeyDown=function(n){wh.some(function(u){return we.isEventKey(n,u)})||s.prototype.handleKeyDown.call(this,n)},h.handleClick=function(n){this.selected(!0)},h.selected=function(n){this.selectable&&(n?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},p}(be),de.registerComponent("MenuItem",kt);var Vi=function(s){function p(n,u){var m,A,y=u.track,T=n.textTracks();function S(){for(var L=arguments.length,O=new Array(L),j=0;j<L;j++)O[j]=arguments[j];m.handleTracksChange.apply(De(m),O)}function x(){for(var L=arguments.length,O=new Array(L),j=0;j<L;j++)O[j]=arguments[j];m.handleSelectedLanguageChange.apply(De(m),O)}return u.label=y.label||y.language||"Unknown",u.selected="showing"===y.mode,(m=s.call(this,n,u)||this).track=y,m.kinds=(u.kinds||[u.kind||m.track.kind]).filter(Boolean),n.on(["loadstart","texttrackchange"],S),T.addEventListener("change",S),T.addEventListener("selectedlanguagechange",x),m.on("dispose",function(){n.off(["loadstart","texttrackchange"],S),T.removeEventListener("change",S),T.removeEventListener("selectedlanguagechange",x)}),void 0===T.onchange&&m.on(["tap","click"],function(){if("object"!=typeof window.Event)try{A=new window.Event("change")}catch(L){}A||(A=document.createEvent("Event")).initEvent("change",!0,!0),T.dispatchEvent(A)}),m.handleTracksChange(),m}ge(p,s);var h=p.prototype;return h.handleClick=function(n){var u=this.track,m=this.player_.textTracks();if(s.prototype.handleClick.call(this,n),m)for(var y=0;y<m.length;y++){var T=m[y];-1!==this.kinds.indexOf(T.kind)&&(T===u?"showing"!==T.mode&&(T.mode="showing"):"disabled"!==T.mode&&(T.mode="disabled"))}},h.handleTracksChange=function(n){var u="showing"===this.track.mode;u!==this.isSelected_&&this.selected(u)},h.handleSelectedLanguageChange=function(n){var u;"showing"===this.track.mode&&((u=this.player_.cache_.selectedLanguage)&&u.enabled&&u.language===this.track.language&&u.kind!==this.track.kind||(this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}))},h.dispose=function(){this.track=null,s.prototype.dispose.call(this)},p}(kt);de.registerComponent("TextTrackMenuItem",Vi);var iu=function(s){function p(n,u){return u.track={player:n,kind:u.kind,kinds:u.kinds,default:!1,mode:"disabled"},u.kinds||(u.kinds=[u.kind]),u.track.label=u.label?u.label:u.kinds.join(" and ")+" off",u.selectable=!0,u.multiSelectable=!1,s.call(this,n,u)||this}ge(p,s);var h=p.prototype;return h.handleTracksChange=function(n){for(var u=this.player().textTracks(),m=!0,y=0,T=u.length;y<T;y++){var S=u[y];if(-1<this.options_.kinds.indexOf(S.kind)&&"showing"===S.mode){m=!1;break}}m!==this.isSelected_&&this.selected(m)},h.handleSelectedLanguageChange=function(n){for(var u=this.player().textTracks(),m=!0,y=0,T=u.length;y<T;y++){var S=u[y];if(-1<["captions","descriptions","subtitles"].indexOf(S.kind)&&"showing"===S.mode){m=!1;break}}m&&(this.player_.cache_.selectedLanguage={enabled:!1})},p}(Vi);de.registerComponent("OffTextTrackMenuItem",iu),We=function(s){function p(h,n){return(n=void 0===n?{}:n).tracks=h.textTracks(),s.call(this,h,n)||this}return ge(p,s),p.prototype.createItems=function(h,n){var u;void 0===n&&(n=Vi),this.label_&&(u=this.label_+" off"),(h=void 0===h?[]:h).push(new iu(this.player_,{kinds:this.kinds_,kind:this.kind_,label:u})),this.hideThreshold_+=1;var m=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var y=0;y<m.length;y++){var T,S=m[y];-1<this.kinds_.indexOf(S.kind)&&((T=new n(this.player_,{track:S,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1})).addClass("vjs-"+S.kind+"-menu-item"),h.push(T))}return h},p}(Ht),de.registerComponent("TextTrackButton",We);var ru=function(s){function p(n,u){var m=u.track,y=u.cue,T=n.currentTime();return u.selectable=!0,u.multiSelectable=!1,u.label=y.text,u.selected=y.startTime<=T&&T<y.endTime,(u=s.call(this,n,u)||this).track=m,u.cue=y,m.addEventListener("cuechange",Je(De(u),u.update)),u}ge(p,s);var h=p.prototype;return h.handleClick=function(n){s.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},h.update=function(n){var u=this.cue,m=this.player_.currentTime();this.selected(u.startTime<=m&&m<u.endTime)},p}(kt);de.registerComponent("ChaptersTrackMenuItem",ru),(le=function(s){function p(n,u,m){return s.call(this,n,u,m)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-chapters-button "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-chapters-button "+s.prototype.buildWrapperCSSClass.call(this)},h.update=function(n){this.track_&&(!n||"addtrack"!==n.type&&"removetrack"!==n.type)||this.setTrack(this.findChaptersTrack()),s.prototype.update.call(this)},h.setTrack=function(n){var u;this.track_!==n&&(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_&&((u=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_))&&u.removeEventListener("load",this.updateHandler_),this.track_=null),this.track_=n,this.track_&&(this.track_.mode="hidden",(n=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_))&&n.addEventListener("load",this.updateHandler_)))},h.findChaptersTrack=function(){for(var n=this.player_.textTracks()||[],u=n.length-1;0<=u;u--){var m=n[u];if(m.kind===this.kind_)return m}},h.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(pt(this.kind_))},h.createMenu=function(){return this.options_.title=this.getMenuCaption(),s.prototype.createMenu.call(this)},h.createItems=function(){var n=[];if(!this.track_)return n;var u=this.track_.cues;if(!u)return n;for(var m=0,y=u.length;m<y;m++){var T=new ru(this.player_,{track:this.track_,cue:T=u[m]});n.push(T)}return n},p}(We)).prototype.kind_="chapters",le.prototype.controlText_="Chapters",de.registerComponent("ChaptersButton",le),(Et=function(s){function p(n,u,m){m=s.call(this,n,u,m)||this;var y=n.textTracks(),T=Je(De(m),m.handleTracksChange);return y.addEventListener("change",T),m.on("dispose",function(){y.removeEventListener("change",T)}),m}ge(p,s);var h=p.prototype;return h.handleTracksChange=function(n){for(var u=this.player().textTracks(),m=!1,y=0,T=u.length;y<T;y++){var S=u[y];if(S.kind!==this.kind_&&"showing"===S.mode){m=!0;break}}m?this.disable():this.enable()},h.buildCSSClass=function(){return"vjs-descriptions-button "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+s.prototype.buildWrapperCSSClass.call(this)},p}(We)).prototype.kind_="descriptions",Et.prototype.controlText_="Descriptions",de.registerComponent("DescriptionsButton",Et),(G=function(s){function p(n,u,m){return s.call(this,n,u,m)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-subtitles-button "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+s.prototype.buildWrapperCSSClass.call(this)},p}(We)).prototype.kind_="subtitles",G.prototype.controlText_="Subtitles",de.registerComponent("SubtitlesButton",G);var Zn=function(s){function p(h,n){return n.track={player:h,kind:n.kind,label:n.kind+" settings",selectable:!1,default:!1,mode:"disabled"},n.selectable=!1,n.name="CaptionSettingsMenuItem",(h=s.call(this,h,n)||this).addClass("vjs-texttrack-settings"),h.controlText(", opens "+n.kind+" settings dialog"),h}return ge(p,s),p.prototype.handleClick=function(h){this.player().getChild("textTrackSettings").open()},p}(Vi);de.registerComponent("CaptionSettingsMenuItem",Zn),(It=function(s){function p(n,u,m){return s.call(this,n,u,m)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-captions-button "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-captions-button "+s.prototype.buildWrapperCSSClass.call(this)},h.createItems=function(){var n=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(n.push(new Zn(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),s.prototype.createItems.call(this,n)},p}(We)).prototype.kind_="captions",It.prototype.controlText_="Captions",de.registerComponent("CaptionsButton",It);var nu=function(s){function p(){return s.apply(this,arguments)||this}return ge(p,s),p.prototype.createEl=function(h,n,u){return u=(n=s.prototype.createEl.call(this,h,n,u)).querySelector(".vjs-menu-item-text"),"captions"===this.options_.track.kind&&(u.appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),u.appendChild(Re("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),n},p}(Vi);de.registerComponent("SubsCapsMenuItem",nu),(dt=function(s){function p(n,u){return(u=s.call(this,n,u=void 0===u?{}:u)||this).label_="subtitles",-1<["en","en-us","en-ca","fr-ca"].indexOf(u.player_.language_)&&(u.label_="captions"),u.menuButton_.controlText(pt(u.label_)),u}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-subs-caps-button "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+s.prototype.buildWrapperCSSClass.call(this)},h.createItems=function(){var n=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(n.push(new Zn(this.player_,{kind:this.label_})),this.hideThreshold_+=1),s.prototype.createItems.call(this,n,nu)},p}(We)).prototype.kinds_=["captions","subtitles"],dt.prototype.controlText_="Subtitles",de.registerComponent("SubsCapsButton",dt);var su=function(s){function p(n,u){var m,y=u.track,T=n.audioTracks();function S(){for(var x=arguments.length,A=new Array(x),L=0;L<x;L++)A[L]=arguments[L];m.handleTracksChange.apply(De(m),A)}return u.label=y.label||y.language||"Unknown",u.selected=y.enabled,(m=s.call(this,n,u)||this).track=y,m.addClass("vjs-"+y.kind+"-menu-item"),T.addEventListener("change",S),m.on("dispose",function(){T.removeEventListener("change",S)}),m}ge(p,s);var h=p.prototype;return h.createEl=function(n,u,m){return m=(u=s.prototype.createEl.call(this,n,u,m)).querySelector(".vjs-menu-item-text"),"main-desc"===this.options_.track.kind&&(m.appendChild(s.prototype.createEl.call(this,"span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),m.appendChild(s.prototype.createEl.call(this,"span",{className:"vjs-control-text",textContent:this.localize("Descriptions")}))),u},h.handleClick=function(n){s.prototype.handleClick.call(this,n),this.track.enabled=!0},h.handleTracksChange=function(n){this.selected(this.track.enabled)},p}(kt);de.registerComponent("AudioTrackMenuItem",su),(Ie=function(s){function p(n,u){return(u=void 0===u?{}:u).tracks=n.audioTracks(),s.call(this,n,u)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-audio-button "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-audio-button "+s.prototype.buildWrapperCSSClass.call(this)},h.createItems=function(n){void 0===n&&(n=[]),this.hideThreshold_=1;for(var u=this.player_.audioTracks(),m=0;m<u.length;m++)n.push(new su(this.player_,{track:u[m],selectable:!0,multiSelectable:!1}));return n},p}(Ht)).prototype.controlText_="Audio Track",de.registerComponent("AudioTrackButton",Ie);var es=function(s){function p(n,u){var m,y=u.rate,T=parseFloat(y,10);return u.label=y,u.selected=T===n.playbackRate(),u.selectable=!0,u.multiSelectable=!1,(m=s.call(this,n,u)||this).label=y,m.rate=T,m.on(n,"ratechange",function(S){return m.update(S)}),m}ge(p,s);var h=p.prototype;return h.handleClick=function(n){s.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},h.update=function(n){this.selected(this.player().playbackRate()===this.rate)},p}(kt);es.prototype.contentElType="button",de.registerComponent("PlaybackRateMenuItem",es),(be=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.menuButton_.el_.setAttribute("aria-describedby",m.labelElId_),m.updateVisibility(),m.updateLabel(),m.on(n,"loadstart",function(y){return m.updateVisibility(y)}),m.on(n,"ratechange",function(y){return m.updateLabel(y)}),m.on(n,"playbackrateschange",function(y){return m.handlePlaybackRateschange(y)}),m}ge(p,s);var h=p.prototype;return h.createEl=function(){var n=s.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Re("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),n.appendChild(this.labelEl_),n},h.dispose=function(){this.labelEl_=null,s.prototype.dispose.call(this)},h.buildCSSClass=function(){return"vjs-playback-rate "+s.prototype.buildCSSClass.call(this)},h.buildWrapperCSSClass=function(){return"vjs-playback-rate "+s.prototype.buildWrapperCSSClass.call(this)},h.createItems=function(){for(var n=this.playbackRates(),u=[],m=n.length-1;0<=m;m--)u.push(new es(this.player(),{rate:n[m]+"x"}));return u},h.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},h.handleClick=function(n){for(var u=this.player().playbackRate(),m=this.playbackRates(),y=m[0],T=0;T<m.length;T++)if(m[T]>u){y=m[T];break}this.player().playbackRate(y)},h.handlePlaybackRateschange=function(n){this.update()},h.playbackRates=function(){var n=this.player();return n.playbackRates&&n.playbackRates()||[]},h.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&0<this.playbackRates().length},h.updateVisibility=function(n){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},h.updateLabel=function(n){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},p}(jt)).prototype.controlText_="Playback Rate",de.registerComponent("PlaybackRateMenuButton",be),le=function(s){function p(){return s.apply(this,arguments)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-spacer "+s.prototype.buildCSSClass.call(this)},h.createEl=function(n,u,m){return void 0===n&&(n="div"),void 0===m&&(m={}),(u=void 0===u?{}:u).className||(u.className=this.buildCSSClass()),s.prototype.createEl.call(this,n,u,m)},p}(de),de.registerComponent("Spacer",le),de.registerComponent("CustomControlSpacer",function(s){function p(){return s.apply(this,arguments)||this}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-custom-control-spacer "+s.prototype.buildCSSClass.call(this)},h.createEl=function(){return s.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:"\xa0"})},p}(le)),Et=function(s){function p(){return s.apply(this,arguments)||this}return ge(p,s),p.prototype.createEl=function(){return s.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},p}(de),Et.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in document&&Et.prototype.options_.children.splice(Et.prototype.options_.children.length-1,0,"pictureInPictureToggle"),de.registerComponent("ControlBar",Et),(G=function(s){function p(n,u){var m=s.call(this,n,u)||this;return m.on(n,"error",function(y){return m.open(y)}),m}ge(p,s);var h=p.prototype;return h.buildCSSClass=function(){return"vjs-error-display "+s.prototype.buildCSSClass.call(this)},h.content=function(){var n=this.player().error();return n?this.localize(n.message):""},p}(ti)).prototype.options_=Z({},ti.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),de.registerComponent("ErrorDisplay",G);var Et,ts="vjs-text-track-settings",$a={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[It=["#000","Black"],jt=["#FFF","White"],kt=["#F00","Red"],Ht=["#0F0","Green"],We=["#00F","Blue"],be=["#FF0","Yellow"],Ie=["#F0F","Magenta"],dt=["#0FF","Cyan"]]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[le=["1","Opaque"],Et=["0.5","Semi-Transparent"],G=["0","Transparent"]]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[jt,It,kt,Ht,We,be,Ie,dt]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(s){return"1.00"===s?null:Number(s)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[le,Et]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[G,Et,le]}};function ou(s,p){if((s=p?p(s):s)&&"none"!==s)return s}$a.windowColor.options=$a.backgroundColor.options,de.registerComponent("TextTrackSettings",function(s){function p(n,u){var m;return u.temporary=!1,(m=s.call(this,n,u)||this).updateDisplay=m.updateDisplay.bind(De(m)),m.fill(),m.hasBeenOpened_=m.hasBeenFilled_=!0,m.endDialog=Re("p",{className:"vjs-control-text",textContent:m.localize("End of dialog window.")}),m.el().appendChild(m.endDialog),m.setDefaults(),void 0===u.persistTextTrackSettings&&(m.options_.persistTextTrackSettings=m.options_.playerOptions.persistTextTrackSettings),m.on(m.$(".vjs-done-button"),"click",function(){m.saveSettings(),m.close()}),m.on(m.$(".vjs-default-button"),"click",function(){m.setDefaults(),m.updateDisplay()}),Q($a,function(y){m.on(m.$(y.selector),"change",m.updateDisplay)}),m.options_.persistTextTrackSettings&&m.restoreSettings(),m}ge(p,s);var h=p.prototype;return h.dispose=function(){this.endDialog=null,s.prototype.dispose.call(this)},h.createElSelect_=function(n,u,m){var y=this;void 0===u&&(u=""),void 0===m&&(m="label");var T=(n=$a[n]).id.replace("%s",this.id_),S=[u,T].join(" ").trim();return["<"+m+' id="'+T+'" class="'+("label"===m?"vjs-label":"")+'">',this.localize(n.label),"</"+m+">",'<select aria-labelledby="'+S+'">'].concat(n.options.map(function(x){var A=T+"-"+x[1].replace(/\W+/g,"");return['<option id="'+A+'" value="'+x[0]+'" ','aria-labelledby="'+S+" "+A+'">',y.localize(x[1]),"</option>"].join("")})).concat("</select>").join("")},h.createElFgColor_=function(){var n="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+n+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",n),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",n),"</span>","</fieldset>"].join("")},h.createElBgColor_=function(){var n="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+n+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",n),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",n),"</span>","</fieldset>"].join("")},h.createElWinColor_=function(){var n="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+n+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",n),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",n),"</span>","</fieldset>"].join("")},h.createElColors_=function(){return Re("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},h.createElFont_=function(){return Re("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},h.createElControls_=function(){var n=this.localize("restore all settings to the default values");return Re("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+n+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+n+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},h.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},h.label=function(){return this.localize("Caption Settings Dialog")},h.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},h.buildCSSClass=function(){return s.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},h.getValues=function(){var n,u,m,y=this;return u=function(T,S,x){var A;return void 0!==(S=ou((A=y.$(S.selector)).options[A.options.selectedIndex].value,S=S.parser))&&(T[x]=S),T},void 0===(m={})&&(m=0),se(n=$a).reduce(function(T,S){return u(T,n[S],S)},m)},h.setValues=function(n){var u=this;Q($a,function(m,y){!function(T,S,x){if(S)for(var A=0;A<T.options.length;A++)if(ou(T.options[A].value,x)===S){T.selectedIndex=A;break}}(u.$(m.selector),n[y],m.parser)})},h.setDefaults=function(){var n=this;Q($a,function(u){var m=u.hasOwnProperty("default")?u.default:0;n.$(u.selector).selectedIndex=m})},h.restoreSettings=function(){var n;try{n=JSON.parse(window.localStorage.getItem(ts))}catch(u){U.warn(u)}n&&this.setValues(n)},h.saveSettings=function(){if(this.options_.persistTextTrackSettings){var n=this.getValues();try{Object.keys(n).length?window.localStorage.setItem(ts,JSON.stringify(n)):window.localStorage.removeItem(ts)}catch(u){U.warn(u)}}},h.updateDisplay=function(){var n=this.player_.getChild("textTrackDisplay");n&&n.updateDisplay()},h.conditionalBlur_=function(){this.previouslyActiveEl_=null;var u=(n=this.player_.controlBar)&&n.subsCapsButton,n=n&&n.captionsButton;u?u.focus():n&&n.focus()},p}(ti)),de.registerComponent("ResizeManager",function(s){function p(n,u){var m,y=u.ResizeObserver||window.ResizeObserver,T=at({createEl:!(y=null!==u.ResizeObserver&&y),reportTouchActivity:!1},u);return(m=s.call(this,n,T)||this).ResizeObserver=u.ResizeObserver||window.ResizeObserver,m.loadListener_=null,m.resizeObserver_=null,m.debouncedHandler_=function(s,p,h,n){var u;function m(){var y=this,T=arguments,S=function(){S=u=null,s.apply(y,T)};n.clearTimeout(u),u=n.setTimeout(S,100)}return void 0===n&&(n=window),m.cancel=function(){n.clearTimeout(u),u=null},m}(function(){m.resizeHandler()},0,0,De(m)),y?(m.resizeObserver_=new m.ResizeObserver(m.debouncedHandler_),m.resizeObserver_.observe(n.el())):(m.loadListener_=function(){var S,x;m.el_&&m.el_.contentWindow&&(S=m.debouncedHandler_,x=m.unloadListener_=function(){Dt(this,"resize",S),Dt(this,"unload",x),x=null},Xt(m.el_.contentWindow,"unload",x),Xt(m.el_.contentWindow,"resize",S))},m.one("load",m.loadListener_)),m}ge(p,s);var h=p.prototype;return h.createEl=function(){return s.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1},{"aria-hidden":"true"})},h.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")},h.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,s.prototype.dispose.call(this)},p}(de));var Dh={trackingThreshold:20,liveTolerance:15};function as(s){if((n=s.el()).hasAttribute("src"))return s.triggerSourceset(n.src),1;var p=s.$$("source"),h=[],n="";if(p.length){for(var u=0;u<p.length;u++){var m=p[u].src;m&&-1===h.indexOf(m)&&h.push(m)}return!!h.length&&(1===h.length&&(n=h[0]),s.triggerSourceset(n),!0)}}function uu(s,p){for(var h={},n=0;n<s.length&&!((h=Object.getOwnPropertyDescriptor(s[n],p))&&h.set&&h.get);n++);return h.enumerable=!0,h.configurable=!0,h}function lu(s){var p,h,n,u=s.el();u.resetSourceWatch_||(p={},h=uu([s.el(),window.HTMLMediaElement.prototype,window.Element.prototype,Lh],"innerHTML"),n=function(m){return function(){for(var y=arguments.length,T=new Array(y),S=0;S<y;S++)T[S]=arguments[S];var x=m.apply(u,T);return as(s),x}},["append","appendChild","insertAdjacentHTML"].forEach(function(m){u[m]&&(p[m]=u[m],u[m]=n(p[m]))}),Object.defineProperty(u,"innerHTML",at(h,{set:n(h.set)})),u.resetSourceWatch_=function(){u.resetSourceWatch_=null,Object.keys(p).forEach(function(m){u[m]=p[m]}),Object.defineProperty(u,"innerHTML",h)},s.one("sourceset",u.resetSourceWatch_))}function is(s,p,h,n){function u(y){return Object.defineProperty(s,p,{value:y,enumerable:!0,writable:!0})}var m={configurable:!0,enumerable:!0,get:function(){var y=h();return u(y),y}};return(n=void 0===n||n)&&(m.set=u),Object.defineProperty(s,p,m)}de.registerComponent("LiveTracker",function(s){function p(n,u){u=at(Dh,u,{createEl:!1});var m=s.call(this,n,u)||this;return m.handleVisibilityChange_=function(y){return m.handleVisibilityChange(y)},m.trackLiveHandler_=function(){return m.trackLive_()},m.handlePlay_=function(y){return m.handlePlay(y)},m.handleFirstTimeupdate_=function(y){return m.handleFirstTimeupdate(y)},m.handleSeeked_=function(y){return m.handleSeeked(y)},m.seekToLiveEdge_=function(y){return m.seekToLiveEdge(y)},m.reset_(),m.on(m.player_,"durationchange",function(y){return m.handleDurationchange(y)}),m.one(m.player_,"canplay",function(){return m.toggleTracking()}),_t&&"hidden"in document&&"visibilityState"in document&&m.on(document,"visibilitychange",m.handleVisibilityChange_),m}ge(p,s);var h=p.prototype;return h.handleVisibilityChange=function(){this.player_.duration()===1/0&&(document.hidden?this.stopTracking():this.startTracking())},h.trackLive_=function(){var n,u=this.player_.seekable();u&&u.length&&(n=Number(window.performance.now().toFixed(4)),u=-1===this.lastTime_?0:(n-this.lastTime_)/1e3,this.lastTime_=n,this.pastSeekEnd_=this.pastSeekEnd()+u,n=this.liveCurrentTime(),u=this.player_.currentTime(),u=this.player_.paused()||this.seekedBehindLive_||Math.abs(n-u)>this.options_.liveTolerance,(u=!(!this.timeupdateSeen_||n===1/0)&&u)!==this.behindLiveEdge_&&(this.behindLiveEdge_=u,this.trigger("liveedgechange")))},h.handleDurationchange=function(){this.toggleTracking()},h.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},h.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,30),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},h.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},h.handleSeeked=function(){var n=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&2<n,this.nextSeekedFromUser_=!1,this.trackLive_()},h.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},h.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},h.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},h.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},h.seekableEnd=function(){for(var n=this.player_.seekable(),u=[],m=n?n.length:0;m--;)u.push(n.end(m));return u.length?u.sort()[u.length-1]:1/0},h.seekableStart=function(){for(var n=this.player_.seekable(),u=[],m=n?n.length:0;m--;)u.push(n.start(m));return u.length?u.sort()[0]:0},h.liveWindow=function(){var n=this.liveCurrentTime();return n===1/0?0:n-this.seekableStart()},h.isLive=function(){return this.isTracking()},h.atLiveEdge=function(){return!this.behindLiveEdge()},h.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},h.pastSeekEnd=function(){var n=this.seekableEnd();return-1!==this.lastSeekEnd_&&n!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=n,this.pastSeekEnd_},h.behindLiveEdge=function(){return this.behindLiveEdge_},h.isTracking=function(){return"number"==typeof this.trackingInterval_},h.seekToLiveEdge=function(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},h.dispose=function(){this.off(document,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),s.prototype.dispose.call(this)},p}(de));var Pr,Lh=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(s){var p=document.createElement(this.nodeName.toLowerCase());p.innerHTML=s;for(var h=document.createDocumentFragment();p.childNodes.length;)h.appendChild(p.childNodes[0]);return this.innerText="",window.Element.prototype.appendChild.call(this,h),this.innerHTML}}),Nh=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?Bo(window.Element.prototype.getAttribute.call(this,"src")):""},set:function(s){return window.Element.prototype.setAttribute.call(this,"src",s),s}}),Te=function(s){function p(n,u){var m=s.call(this,n,u)||this,y=!1;if((u=n.source)&&(m.el_.currentSrc!==u.src||n.tag&&3===n.tag.initNetworkState_)?m.setSource(u):m.handleLateInit_(m.el_),n.enableSourceset&&m.setupSourcesetHandling_(),m.isScrubbing_=!1,m.el_.hasChildNodes()){for(var T=m.el_.childNodes,S=T.length,x=[];S--;){var A=T[S];"track"===A.nodeName.toLowerCase()&&(m.featuresNativeTextTracks?(m.remoteTextTrackEls().addTrackElement_(A),m.remoteTextTracks().addTrack(A.track),m.textTracks().addTrack(A.track),y||m.el_.hasAttribute("crossorigin")||!vr(A.src)||(y=!0)):x.push(A))}for(var L=0;L<x.length;L++)m.el_.removeChild(x[L])}return m.proxyNativeTracks_(),m.featuresNativeTextTracks&&y&&U.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),m.restoreMetadataTracksInIOSNativePlayer_(),(ua||Xa||He)&&!0===n.nativeControlsForTouch&&m.setControls(!0),m.proxyWebkitFullscreen_(),m.triggerReady(),m}ge(p,s);var h=p.prototype;return h.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),p.disposeMediaElement(this.el_),this.options_=null,s.prototype.dispose.call(this)},h.setupSourcesetHandling_=function(){!function(s){var p,h,n,u;s.featuresSourceset&&((p=s.el()).resetSourceset_||(h=uu([s.el(),window.HTMLMediaElement.prototype,Nh],"src"),n=p.setAttribute,u=p.load,Object.defineProperty(p,"src",at(h,{set:function(m){return m=h.set.call(p,m),s.triggerSourceset(p.src),m}})),p.setAttribute=function(m,y){return y=n.call(p,m,y),/src/i.test(m)&&s.triggerSourceset(p.src),y},p.load=function(){var m=u.call(p);return as(s)||(s.triggerSourceset(""),lu(s)),m},p.currentSrc?s.triggerSourceset(p.currentSrc):as(s)||lu(s),p.resetSourceset_=function(){p.resetSourceset_=null,p.load=u,p.setAttribute=n,Object.defineProperty(p,"src",h),p.resetSourceWatch_&&p.resetSourceWatch_()}))}(this)},h.restoreMetadataTracksInIOSNativePlayer_=function(){function n(){u=[];for(var T=0;T<m.length;T++){var S=m[T];"metadata"===S.kind&&u.push({track:S,storedMode:S.mode})}}var u,m=this.textTracks();function y(){for(var T=0;T<u.length;T++){var S=u[T];"disabled"===S.track.mode&&S.track.mode!==S.storedMode&&(S.track.mode=S.storedMode)}m.removeEventListener("change",y)}n(),m.addEventListener("change",n),this.on("dispose",function(){return m.removeEventListener("change",n)}),this.on("webkitbeginfullscreen",function(){m.removeEventListener("change",n),m.removeEventListener("change",y),m.addEventListener("change",y)}),this.on("webkitendfullscreen",function(){m.removeEventListener("change",n),m.addEventListener("change",n),m.removeEventListener("change",y)})},h.overrideNative_=function(n,u){var m,y=this;u===this["featuresNative"+n+"Tracks"]&&(this[(m=n.toLowerCase())+"TracksListeners_"]&&Object.keys(this[m+"TracksListeners_"]).forEach(function(T){y.el()[m+"Tracks"].removeEventListener(T,y[m+"TracksListeners_"][T])}),this["featuresNative"+n+"Tracks"]=!u,this[m+"TracksListeners_"]=null,this.proxyNativeTracksForType_(m))},h.overrideNativeAudioTracks=function(n){this.overrideNative_("Audio",n)},h.overrideNativeVideoTracks=function(n){this.overrideNative_("Video",n)},h.proxyNativeTracksForType_=function(n){var u,m,y=this,T=Zt[n],S=this.el()[T.getterName],x=this[T.getterName]();this["featuresNative"+T.capitalName+"Tracks"]&&S&&S.addEventListener&&(m=function(){for(var A=[],L=0;L<x.length;L++){for(var O=!1,j=0;j<S.length;j++)if(S[j]===x[L]){O=!0;break}O||A.push(x[L])}for(;A.length;)x.removeTrack(A.shift())},this[T.getterName+"Listeners_"]=u={change:function(A){var L={type:"change",target:x,currentTarget:x,srcElement:x};x.trigger(L),"text"===n&&y[ii.remoteText.getterName]().trigger(L)},addtrack:function(A){x.addTrack(A.track)},removetrack:function(A){x.removeTrack(A.track)}},Object.keys(u).forEach(function(A){var L=u[A];S.addEventListener(A,L),y.on("dispose",function(O){return S.removeEventListener(A,L)})}),this.on("loadstart",m),this.on("dispose",function(A){return y.off("loadstart",m)}))},h.proxyNativeTracks_=function(){var n=this;Zt.names.forEach(function(u){n.proxyNativeTracksForType_(u)})},h.createEl=function(){var n,u=this.options_.tag;u&&(this.options_.playerElIngest||this.movingMediaElementInDOM)||(u?(n=u.cloneNode(!0),u.parentNode&&u.parentNode.insertBefore(n,u),p.disposeMediaElement(u),u=n):(u=document.createElement("video"),n=at({},this.options_.tag&&_a(this.options_.tag)),ua&&!0===this.options_.nativeControlsForTouch||delete n.controls,yo(u,te(n,{id:this.options_.techId,class:"vjs-tech"}))),u.playerId=this.options_.playerId),void 0!==this.options_.preload&&Qa(u,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(u.disablePictureInPicture=this.options_.disablePictureInPicture);for(var m=["loop","muted","playsinline","autoplay"],y=0;y<m.length;y++){var T=m[y],S=this.options_[T];void 0!==S&&(S?Qa(u,T,T):cr(u,T),u[T]=S)}return u},h.handleLateInit_=function(n){if(0!==n.networkState&&3!==n.networkState){if(0===n.readyState){var u=!1,m=function(){u=!0};this.on("loadstart",m);var y=function(){u||this.trigger("loadstart")};return this.on("loadedmetadata",y),void this.ready(function(){this.off("loadstart",m),this.off("loadedmetadata",y),u||this.trigger("loadstart")})}var T=["loadstart"];T.push("loadedmetadata"),2<=n.readyState&&T.push("loadeddata"),3<=n.readyState&&T.push("canplay"),4<=n.readyState&&T.push("canplaythrough"),this.ready(function(){T.forEach(function(S){this.trigger(S)},this)})}},h.setScrubbing=function(n){this.isScrubbing_=n},h.scrubbing=function(){return this.isScrubbing_},h.setCurrentTime=function(n){try{this.isScrubbing_&&this.el_.fastSeek&&La?this.el_.fastSeek(n):this.el_.currentTime=n}catch(u){U(u,"Video is not ready. (Video.js)")}},h.duration=function(){var n=this;return this.el_.duration===1/0&&Fe&&ct&&0===this.el_.currentTime?(this.on("timeupdate",function u(){0<n.el_.currentTime&&(n.el_.duration===1/0&&n.trigger("durationchange"),n.off("timeupdate",u))}),NaN):this.el_.duration||NaN},h.width=function(){return this.el_.offsetWidth},h.height=function(){return this.el_.offsetHeight},h.proxyWebkitFullscreen_=function(){var n,u,m=this;"webkitDisplayingFullscreen"in this.el_&&(n=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},this.on("webkitbeginfullscreen",u=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",n),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))}),this.on("dispose",function(){m.off("webkitbeginfullscreen",u),m.off("webkitendfullscreen",n)}))},h.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var n=window.navigator&&window.navigator.userAgent||"";if(/Android/.test(n)||!/Chrome|Mac OS X 10.5/.test(n))return!0}return!1},h.enterFullScreen=function(){var n=this.el_;if(n.paused&&n.networkState<=n.HAVE_METADATA)la(this.el_.play()),this.setTimeout(function(){n.pause();try{n.webkitEnterFullScreen()}catch(u){this.trigger("fullscreenerror",u)}},0);else try{n.webkitEnterFullScreen()}catch(u){this.trigger("fullscreenerror",u)}},h.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},h.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},h.src=function(n){if(void 0===n)return this.el_.src;this.setSrc(n)},h.reset=function(){p.resetMediaElement(this.el_)},h.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},h.setControls=function(n){this.el_.controls=!!n},h.addTextTrack=function(n,u,m){return this.featuresNativeTextTracks?this.el_.addTextTrack(n,u,m):s.prototype.addTextTrack.call(this,n,u,m)},h.createRemoteTextTrack=function(n){if(!this.featuresNativeTextTracks)return s.prototype.createRemoteTextTrack.call(this,n);var u=document.createElement("track");return n.kind&&(u.kind=n.kind),n.label&&(u.label=n.label),(n.language||n.srclang)&&(u.srclang=n.language||n.srclang),n.default&&(u.default=n.default),n.id&&(u.id=n.id),n.src&&(u.src=n.src),u},h.addRemoteTextTrack=function(n,u){return u=s.prototype.addRemoteTextTrack.call(this,n,u),this.featuresNativeTextTracks&&this.el().appendChild(u),u},h.removeRemoteTextTrack=function(n){if(s.prototype.removeRemoteTextTrack.call(this,n),this.featuresNativeTextTracks)for(var u=this.$$("track"),m=u.length;m--;)n!==u[m]&&n!==u[m].track||this.el().removeChild(u[m])},h.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var n={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(n.droppedVideoFrames=this.el().webkitDroppedFrameCount,n.totalVideoFrames=this.el().webkitDecodedFrameCount),window.performance&&"function"==typeof window.performance.now?n.creationTime=window.performance.now():window.performance&&window.performance.timing&&"number"==typeof window.performance.timing.navigationStart&&(n.creationTime=window.Date.now()-window.performance.timing.navigationStart),n},p}(Ze);is(Te,"TEST_VID",function(){if(ga()){var s=document.createElement("video"),p=document.createElement("track");return p.kind="captions",p.srclang="en",p.label="English",s.appendChild(p),s}}),Te.isSupported=function(){try{Te.TEST_VID.volume=.5}catch(s){return!1}return!(!Te.TEST_VID||!Te.TEST_VID.canPlayType)},Te.canPlayType=function(s){return Te.TEST_VID.canPlayType(s)},Te.canPlaySource=function(s,p){return Te.canPlayType(s.type)},Te.canControlVolume=function(){try{var s=Te.TEST_VID.volume;return Te.TEST_VID.volume=s/2+.1,s!==Te.TEST_VID.volume}catch(p){return!1}},Te.canMuteVolume=function(){try{var s=Te.TEST_VID.muted;return Te.TEST_VID.muted=!s,Te.TEST_VID.muted?Qa(Te.TEST_VID,"muted","muted"):cr(Te.TEST_VID,"muted"),s!==Te.TEST_VID.muted}catch(p){return!1}},Te.canControlPlaybackRate=function(){if(Fe&&ct&&yt<58)return!1;try{var s=Te.TEST_VID.playbackRate;return Te.TEST_VID.playbackRate=s/2+.1,s!==Te.TEST_VID.playbackRate}catch(p){return!1}},Te.canOverrideAttributes=function(){try{var s=function(){};Object.defineProperty(document.createElement("video"),"src",{get:s,set:s}),Object.defineProperty(document.createElement("audio"),"src",{get:s,set:s}),Object.defineProperty(document.createElement("video"),"innerHTML",{get:s,set:s}),Object.defineProperty(document.createElement("audio"),"innerHTML",{get:s,set:s})}catch(p){return!1}return!0},Te.supportsNativeTextTracks=function(){return La||At&&ct},Te.supportsNativeVideoTracks=function(){return!(!Te.TEST_VID||!Te.TEST_VID.videoTracks)},Te.supportsNativeAudioTracks=function(){return!(!Te.TEST_VID||!Te.TEST_VID.audioTracks)},Te.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresVolumeControl","canControlVolume"],["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(s){var h=s[1];is(Te.prototype,s[0],function(){return Te[h]()},!0)}),Te.prototype.movingMediaElementInDOM=!At,Te.prototype.featuresFullscreenResize=!0,Te.prototype.featuresProgressEvents=!0,Te.prototype.featuresTimeupdateEvents=!0,Te.patchCanPlayType=function(){4<=$e&&!Xe&&!ct&&(Pr=Te.TEST_VID&&Te.TEST_VID.constructor.prototype.canPlayType,Te.TEST_VID.constructor.prototype.canPlayType=function(s){return s&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(s)?"maybe":Pr.call(this,s)})},Te.unpatchCanPlayType=function(){var s=Te.TEST_VID.constructor.prototype.canPlayType;return Pr&&(Te.TEST_VID.constructor.prototype.canPlayType=Pr),s},Te.patchCanPlayType(),Te.disposeMediaElement=function(s){if(s){for(s.parentNode&&s.parentNode.removeChild(s);s.hasChildNodes();)s.removeChild(s.firstChild);s.removeAttribute("src"),"function"==typeof s.load&&function(){try{s.load()}catch(p){}}()}},Te.resetMediaElement=function(s){if(s){for(var p=s.querySelectorAll("source"),h=p.length;h--;)s.removeChild(p[h]);s.removeAttribute("src"),"function"==typeof s.load&&function(){try{s.load()}catch(n){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(s){Te.prototype[s]=function(){return this.el_[s]||this.el_.hasAttribute(s)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(s){Te.prototype["set"+pt(s)]=function(p){(this.el_[s]=p)?this.el_.setAttribute(s,s):this.el_.removeAttribute(s)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(s){Te.prototype[s]=function(){return this.el_[s]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(s){Te.prototype["set"+pt(s)]=function(p){this.el_[s]=p}}),["pause","load","play"].forEach(function(s){Te.prototype[s]=function(){return this.el_[s]()}}),Ze.withSourceHandlers(Te),Te.nativeSourceHandler={},Te.nativeSourceHandler.canPlayType=function(s){try{return Te.TEST_VID.canPlayType(s)}catch(p){return""}},Te.nativeSourceHandler.canHandleSource=function(s,p){return s.type?Te.nativeSourceHandler.canPlayType(s.type):s.src?(s=jn(s.src),Te.nativeSourceHandler.canPlayType("video/"+s)):""},Te.nativeSourceHandler.handleSource=function(s,p,h){p.setSrc(s.src)},Te.nativeSourceHandler.dispose=function(){},Te.registerSourceHandler(Te.nativeSourceHandler),Ze.registerTech("Html5",Te);var du=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],rs={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},ns=["tiny","xsmall","small","medium","large","xlarge","huge"],Ar={};ns.forEach(function(s){var p="x"===s.charAt(0)?"x-"+s.substring(1):s;Ar[s]="vjs-layout-"+p});var Oh={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},vt=function(s){function p(n,u,m){var y,T;if(n.id=n.id||u.id||"vjs_video_"+xa++,(u=te(p.getTagSettings(n),u)).initChildren=!1,u.createEl=!1,u.evented=!1,u.reportTouchActivity=!1,!u.language)if("function"==typeof n.closest){var S=n.closest("[lang]");S&&S.getAttribute&&(u.language=S.getAttribute("lang"))}else for(var x=n;x&&1===x.nodeType;){if(_a(x).hasOwnProperty("lang")){u.language=x.getAttribute("lang");break}x=x.parentNode}if((y=s.call(this,null,u,m)||this).boundDocumentFullscreenChange_=function(A){return y.documentFullscreenChange_(A)},y.boundFullWindowOnEscKey_=function(A){return y.fullWindowOnEscKey(A)},y.boundUpdateStyleEl_=function(A){return y.updateStyleEl_(A)},y.boundApplyInitTime_=function(A){return y.applyInitTime_(A)},y.boundUpdateCurrentBreakpoint_=function(A){return y.updateCurrentBreakpoint_(A)},y.boundHandleTechClick_=function(A){return y.handleTechClick_(A)},y.boundHandleTechDoubleClick_=function(A){return y.handleTechDoubleClick_(A)},y.boundHandleTechTouchStart_=function(A){return y.handleTechTouchStart_(A)},y.boundHandleTechTouchMove_=function(A){return y.handleTechTouchMove_(A)},y.boundHandleTechTouchEnd_=function(A){return y.handleTechTouchEnd_(A)},y.boundHandleTechTap_=function(A){return y.handleTechTap_(A)},y.isFullscreen_=!1,y.log=$(y.id_),y.fsApi_=g,y.isPosterFromTech_=!1,y.queuedCallbacks_=[],y.isReady_=!1,y.hasStarted_=!1,y.userActive_=!1,y.debugEnabled_=!1,!y.options_||!y.options_.techOrder||!y.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");return y.tag=n,y.tagAttributes=n&&_a(n),y.language(y.options_.language),u.languages?(T={},Object.getOwnPropertyNames(u.languages).forEach(function(A){T[A.toLowerCase()]=u.languages[A]}),y.languages_=T):y.languages_=p.prototype.options_.languages,y.resetCache_(),y.poster_=u.poster||"",y.controls_=!!u.controls,n.controls=!1,n.removeAttribute("controls"),y.changingSrc_=!1,y.playCallbacks_=[],y.playTerminatedQueue_=[],n.hasAttribute("autoplay")?y.autoplay(!0):y.autoplay(y.options_.autoplay),u.plugins&&Object.keys(u.plugins).forEach(function(A){if("function"!=typeof y[A])throw new Error('plugin "'+A+'" does not exist')}),y.scrubbing_=!1,y.el_=y.createEl(),Rn(De(y),{eventBusKey:"el_"}),y.fsApi_.requestFullscreen&&(Xt(document,y.fsApi_.fullscreenchange,y.boundDocumentFullscreenChange_),y.on(y.fsApi_.fullscreenchange,y.boundDocumentFullscreenChange_)),y.fluid_&&y.on(["playerreset","resize"],y.boundUpdateStyleEl_),m=at(y.options_),u.plugins&&Object.keys(u.plugins).forEach(function(A){y[A](u.plugins[A])}),u.debug&&y.debug(!0),y.options_.playerOptions=m,y.middleware_=[],y.playbackRates(u.playbackRates),y.initChildren(),y.isAudio("audio"===n.nodeName.toLowerCase()),y.controls()?y.addClass("vjs-controls-enabled"):y.addClass("vjs-controls-disabled"),y.el_.setAttribute("role","region"),y.isAudio()?y.el_.setAttribute("aria-label",y.localize("Audio Player")):y.el_.setAttribute("aria-label",y.localize("Video Player")),y.isAudio()&&y.addClass("vjs-audio"),y.flexNotSupported_()&&y.addClass("vjs-no-flex"),ua&&y.addClass("vjs-touch-enabled"),At||y.addClass("vjs-workinghover"),p.players[y.id_]=De(y),n=i.split(".")[0],y.addClass("vjs-v"+n),y.userActive(!0),y.reportUserActivity(),y.one("play",function(A){return y.listenForUserActivity_(A)}),y.on("stageclick",function(A){return y.handleStageClick_(A)}),y.on("keydown",function(A){return y.handleKeyDown(A)}),y.on("languagechange",function(A){return y.handleLanguagechange(A)}),y.breakpoints(y.options_.breakpoints),y.responsive(y.options_.responsive),y}ge(p,s);var h=p.prototype;return h.dispose=function(){var n=this;this.trigger("dispose"),this.off("dispose"),Dt(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Dt(document,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),p.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),zn[this.id()]=null,$t.names.forEach(function(u){(u=n[(u=$t[u]).getterName]())&&u.off&&u.off()}),s.prototype.dispose.call(this)},h.createEl=function(){var n,u=this.tag,m=this.playerElIngest_=u.parentNode&&u.parentNode.hasAttribute&&u.parentNode.hasAttribute("data-vjs-player"),y="video-js"===this.tag.tagName.toLowerCase();m?n=this.el_=u.parentNode:y||(n=this.el_=s.prototype.createEl.call(this,"div"));var T,S,x=_a(u);if(y){for(n=this.el_=u,u=this.tag=document.createElement("video");n.children.length;)u.appendChild(n.firstChild);Ua(n,"video-js")||ya(n,"video-js"),n.appendChild(u),m=this.playerElIngest_=n,Object.keys(n).forEach(function(j){try{u[j]=n[j]}catch(B){}})}u.setAttribute("tabindex","-1"),x.tabindex="-1",(_t||ct&&Aa)&&(u.setAttribute("role","application"),x.role="application"),u.removeAttribute("width"),u.removeAttribute("height"),"width"in x&&delete x.width,"height"in x&&delete x.height,Object.getOwnPropertyNames(x).forEach(function(j){y&&"class"===j||n.setAttribute(j,x[j]),y&&u.setAttribute(j,x[j])}),u.playerId=u.id,u.id+="_html5_api",u.className="vjs-tech",(u.player=n.player=this).addClass("vjs-paused"),!0!==window.VIDEOJS_NO_DYNAMIC_STYLE&&(this.styleEl_=Ao("vjs-styles-dimensions"),T=Ia(".vjs-styles-defaults"),(S=Ia("head")).insertBefore(this.styleEl_,T?T.nextSibling:S.firstChild)),this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var A=u.getElementsByTagName("a"),L=0;L<A.length;L++){var O=A.item(L);ya(O,"vjs-hidden"),O.setAttribute("hidden","hidden")}return u.initNetworkState_=u.networkState,u.parentNode&&!m&&u.parentNode.insertBefore(n,u),Cn(u,n),this.children_.unshift(u),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=n},h.crossOrigin=function(n){if(!n)return this.techGet_("crossOrigin");"anonymous"===n||"use-credentials"===n?this.techCall_("setCrossOrigin",n):U.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+n+'"')},h.width=function(n){return this.dimension("width",n)},h.height=function(n){return this.dimension("height",n)},h.dimension=function(n,u){var m=n+"_";if(void 0===u)return this[m]||0;if(""===u||"auto"===u)return this[m]=void 0,void this.updateStyleEl_();var y=parseFloat(u);isNaN(y)?U.error('Improper value "'+u+'" supplied for for '+n):(this[m]=y,this.updateStyleEl_())},h.fluid=function(n){var u,m=this;if(void 0===n)return!!this.fluid_;this.fluid_=!!n,va(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),n?(this.addClass("vjs-fluid"),this.fill(!1),u=function(){m.on(["playerreset","resize"],m.boundUpdateStyleEl_)},va(n=this)?u():(n.eventedCallbacks||(n.eventedCallbacks=[]),n.eventedCallbacks.push(u))):this.removeClass("vjs-fluid"),this.updateStyleEl_()},h.fill=function(n){if(void 0===n)return!!this.fill_;this.fill_=!!n,n?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},h.aspectRatio=function(n){if(void 0===n)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(n))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=n,this.fluid(!0),this.updateStyleEl_()},h.updateStyleEl_=function(){var n,u,m,y;!0!==window.VIDEOJS_NO_DYNAMIC_STYLE?(y=(m=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:0<this.videoWidth()?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"))[1]/m[0],n=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/y:this.videoWidth()||300,u=void 0!==this.height_?this.height_:n*y,m=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(m),Io(this.styleEl_,"\n      ."+m+" {\n        width: "+n+"px;\n        height: "+u+"px;\n      }\n\n      ."+m+".vjs-fluid {\n        padding-top: "+100*y+"%;\n      }\n    ")):(u="number"==typeof this.width_?this.width_:this.options_.width,m="number"==typeof this.height_?this.height_:this.options_.height,(y=this.tech_&&this.tech_.el())&&(0<=u&&(y.width=u),0<=m&&(y.height=m)))},h.loadTech_=function(n,u){var m=this;this.tech_&&this.unloadTech_();var y=pt(n),T=n.charAt(0).toLowerCase()+n.slice(1);"Html5"!==y&&this.tag&&(Ze.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=y,this.isReady_=!1;var S=this.autoplay(),x={source:u,autoplay:S=!("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&S,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+T+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};if($t.names.forEach(function(A){x[(A=$t[A]).getterName]=m[A.privateName]}),te(x,this.options_[y]),te(x,this.options_[T]),te(x,this.options_[n.toLowerCase()]),this.tag&&(x.tag=this.tag),u&&u.src===this.cache_.src&&0<this.cache_.currentTime&&(x.startTime=this.cache_.currentTime),!(n=Ze.getTech(n)))throw new Error("No Tech named '"+y+"' exists! '"+y+"' should be registered using videojs.registerTech()'");this.tech_=new n(x),this.tech_.ready(Je(this,this.handleTechReady_),!0),function(s,p){s.forEach(function(h){var n=p.addRemoteTextTrack(h).track;!h.src&&h.cues&&h.cues.forEach(function(u){return n.addCue(u)})}),p.textTracks()}(this.textTracksJson_||[],this.tech_),du.forEach(function(A){m.on(m.tech_,A,function(L){return m["handleTech"+pt(A)+"_"](L)})}),Object.keys(rs).forEach(function(A){m.on(m.tech_,A,function(L){0===m.tech_.playbackRate()&&m.tech_.seeking()?m.queuedCallbacks_.push({callback:m["handleTech"+rs[A]+"_"].bind(m),event:L}):m["handleTech"+rs[A]+"_"](L)})}),this.on(this.tech_,"loadstart",function(A){return m.handleTechLoadStart_(A)}),this.on(this.tech_,"sourceset",function(A){return m.handleTechSourceset_(A)}),this.on(this.tech_,"waiting",function(A){return m.handleTechWaiting_(A)}),this.on(this.tech_,"ended",function(A){return m.handleTechEnded_(A)}),this.on(this.tech_,"seeking",function(A){return m.handleTechSeeking_(A)}),this.on(this.tech_,"play",function(A){return m.handleTechPlay_(A)}),this.on(this.tech_,"firstplay",function(A){return m.handleTechFirstPlay_(A)}),this.on(this.tech_,"pause",function(A){return m.handleTechPause_(A)}),this.on(this.tech_,"durationchange",function(A){return m.handleTechDurationChange_(A)}),this.on(this.tech_,"fullscreenchange",function(A,L){return m.handleTechFullscreenChange_(A,L)}),this.on(this.tech_,"fullscreenerror",function(A,L){return m.handleTechFullscreenError_(A,L)}),this.on(this.tech_,"enterpictureinpicture",function(A){return m.handleTechEnterPictureInPicture_(A)}),this.on(this.tech_,"leavepictureinpicture",function(A){return m.handleTechLeavePictureInPicture_(A)}),this.on(this.tech_,"error",function(A){return m.handleTechError_(A)}),this.on(this.tech_,"posterchange",function(A){return m.handleTechPosterChange_(A)}),this.on(this.tech_,"textdata",function(A){return m.handleTechTextData_(A)}),this.on(this.tech_,"ratechange",function(A){return m.handleTechRateChange_(A)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===y&&this.tag||Cn(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},h.unloadTech_=function(){var n=this;$t.names.forEach(function(u){n[(u=$t[u]).privateName]=n[u.getterName]()}),this.textTracksJson_=function(s){var p=s.$$("track"),h=Array.prototype.map.call(p,function(n){return n.track});return Array.prototype.map.call(p,function(n){var u=Oo(n.track);return n.src&&(u.src=n.src),u}).concat(Array.prototype.filter.call(s.textTracks(),function(n){return-1===h.indexOf(n)}).map(Oo))}(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},h.tech=function(n){return void 0===n&&U.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},h.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},h.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},h.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},h.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())},h.manualAutoplay_=function(n){var u=this;if(this.tech_&&"string"==typeof n){var m,y=function(){var T=u.muted();function S(){u.muted(T)}u.muted(!0),u.playTerminatedQueue_.push(S);var x=u.play();if(Ni(x))return x.catch(function(A){throw S(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(A||""))})};if("any"!==n||this.muted()?m="muted"!==n||this.muted()?this.play():y():Ni(m=this.play())&&(m=m.catch(y)),Ni(m))return m.then(function(){u.trigger({type:"autoplay-success",autoplay:n})}).catch(function(){u.trigger({type:"autoplay-failure",autoplay:n})})}},h.updateSourceCaches_=function(n){var u=n=void 0===n?"":n,m="";"string"!=typeof u&&(u=n.src,m=n.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],u&&!m&&(m=function(L,O){if(!O)return"";if(L.cache_.source.src===O&&L.cache_.source.type)return L.cache_.source.type;var j=L.cache_.sources.filter(function(V){return V.src===O});if(j.length)return j[0].type;for(var B=L.$$("source"),H=0;H<B.length;H++){var q=B[H];if(q.type&&q.src&&q.src===O)return q.type}return Sr(O)}(this,u)),this.cache_.source=at({},n,{src:u,type:m}),m=this.cache_.sources.filter(function(O){return O.src&&O.src===u});for(var y=[],T=this.$$("source"),S=[],x=0;x<T.length;x++){var A=_a(T[x]);y.push(A),A.src&&A.src===u&&S.push(A.src)}S.length&&!m.length?this.cache_.sources=y:m.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=u},h.handleTechSourceset_=function(n){var u,m,y,T=this;this.changingSrc_||(u=function(S){return T.updateSourceCaches_(S)},m=this.currentSource().src,y=n.src,m&&!/^blob:/.test(m)&&/^blob:/.test(y)&&(this.lastSource_&&(this.lastSource_.tech===y||this.lastSource_.player===m)||(u=function(){})),u(y),n.src||this.tech_.any(["sourceset","loadstart"],function(S){"sourceset"!==S.type&&(S=T.techGet("currentSrc"),T.lastSource_.tech=S,T.updateSourceCaches_(S))})),this.lastSource_={player:this.currentSource().src,tech:n.src},this.trigger({src:n.src,type:"sourceset"})},h.hasStarted=function(n){if(void 0===n)return this.hasStarted_;n!==this.hasStarted_&&(this.hasStarted_=n,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},h.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},h.handleTechRateChange_=function(){0<this.tech_.playbackRate()&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(n){return n.callback(n.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},h.handleTechWaiting_=function(){var n=this;this.addClass("vjs-waiting"),this.trigger("waiting");var u=this.currentTime();this.on("timeupdate",function m(){u!==n.currentTime()&&(n.removeClass("vjs-waiting"),n.off("timeupdate",m))})},h.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},h.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},h.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},h.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},h.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},h.handleTechFirstPlay_=function(){this.options_.starttime&&(U.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},h.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},h.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},h.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},h.handleTechClick_=function(n){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,n):this.paused()?la(this.play()):this.pause()))},h.handleTechDoubleClick_=function(n){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(u){return u.contains(n.target)})||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,n):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},h.handleTechTap_=function(){this.userActive(!this.userActive())},h.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},h.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},h.handleTechTouchEnd_=function(n){n.cancelable&&n.preventDefault()},h.handleStageClick_=function(){this.reportUserActivity()},h.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},h.documentFullscreenChange_=function(n){var u=n.target.player;u&&u!==this||(n=this.el(),!(u=document[this.fsApi_.fullscreenElement]===n)&&n.matches?u=n.matches(":"+this.fsApi_.fullscreen):!u&&n.msMatchesSelector&&(u=n.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(u))},h.handleTechFullscreenChange_=function(n,u){u&&(u.nativeIOSFullscreen&&this.toggleClass("vjs-ios-native-fs"),this.isFullscreen(u.isFullscreen))},h.handleTechFullscreenError_=function(n,u){this.trigger("fullscreenerror",u)},h.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},h.handleTechEnterPictureInPicture_=function(n){this.isInPictureInPicture(!0)},h.handleTechLeavePictureInPicture_=function(n){this.isInPictureInPicture(!1)},h.handleTechError_=function(){var n=this.tech_.error();this.error(n)},h.handleTechTextData_=function(){this.trigger("textdata",1<arguments.length?arguments[1]:null)},h.getCache=function(){return this.cache_},h.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},h.techCall_=function(n,u){this.ready(function(){if(n in Ah)return T=u,(y=this.tech_)[y=n](this.middleware_.reduce(qn(y),T));if(n in Jo)return Qo(this.middleware_,this.tech_,n,u);var y,T;try{this.tech_&&this.tech_[n](u)}catch(S){throw U(S),S}},!0)},h.techGet_=function(n){if(this.tech_&&this.tech_.isReady_){if(n in Ph)return m=this.tech_,this.middleware_.reduceRight(qn(y=n),m[y]());if(n in Jo)return Qo(this.middleware_,this.tech_,n);var m,y;try{return this.tech_[n]()}catch(T){throw void 0===this.tech_[n]?(U("Video.js: "+n+" method not defined for "+this.techName_+" playback technology.",T),T):"TypeError"===T.name?(U("Video.js: "+n+" unavailable on "+this.techName_+" playback technology element.",T),this.tech_.isReady_=!1,T):(U(T),T)}}},h.play=function(){var n=this,u=this.options_.Promise||window.Promise;return u?new u(function(m){n.play_(m)}):this.play_()},h.play_=function(n){var u=this;if(this.playCallbacks_.push(n=void 0===n?la:n),n=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!n)return this.waitToPlay_=function(m){u.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(n||!La&&!At||this.load());null===(n=this.techGet_("play"))?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(n)},h.runPlayTerminatedQueue_=function(){var n=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],n.forEach(function(u){u()})},h.runPlayCallbacks_=function(n){var u=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],u.forEach(function(m){m(n)})},h.pause=function(){this.techCall_("pause")},h.paused=function(){return!1!==this.techGet_("paused")},h.played=function(){return this.techGet_("played")||Fa(0,0)},h.scrubbing=function(n){if(void 0===n)return this.scrubbing_;this.scrubbing_=!!n,this.techCall_("setScrubbing",this.scrubbing_),n?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},h.currentTime=function(n){return void 0!==n?(n<0&&(n=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",n),void(this.cache_.initTime=0)):(this.cache_.initTime=n,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},h.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},h.duration=function(n){if(void 0===n)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(n=(n=parseFloat(n))<0?1/0:n)!==this.cache_.duration&&((this.cache_.duration=n)===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(n)||this.trigger("durationchange"))},h.remainingTime=function(){return this.duration()-this.currentTime()},h.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},h.buffered=function(){var n;return(n=this.techGet_("buffered"))&&n.length?n:Fa(0,0)},h.bufferedPercent=function(){return No(this.buffered(),this.duration())},h.bufferedEnd=function(){var n=this.buffered(),u=this.duration();return u<(n=n.end(n.length-1))?u:n},h.volume=function(n){var u;return void 0!==n?(u=Math.max(0,Math.min(1,parseFloat(n))),this.cache_.volume=u,this.techCall_("setVolume",u),void(0<u&&this.lastVolume_(u))):(u=parseFloat(this.techGet_("volume")),isNaN(u)?1:u)},h.muted=function(n){if(void 0===n)return this.techGet_("muted")||!1;this.techCall_("setMuted",n)},h.defaultMuted=function(n){return void 0!==n?this.techCall_("setDefaultMuted",n):this.techGet_("defaultMuted")||!1},h.lastVolume_=function(n){if(void 0===n||0===n)return this.cache_.lastVolume;this.cache_.lastVolume=n},h.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},h.isFullscreen=function(n){if(void 0===n)return this.isFullscreen_;var u=this.isFullscreen_;this.isFullscreen_=Boolean(n),this.isFullscreen_!==u&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_()},h.requestFullscreen=function(n){var u=this.options_.Promise||window.Promise;if(u){var m=this;return new u(function(y,T){function S(){m.off("fullscreenerror",A),m.off("fullscreenchange",x)}function x(){S(),y()}function A(O,j){S(),T(j)}m.one("fullscreenchange",x),m.one("fullscreenerror",A);var L=m.requestFullscreenHelper_(n);L&&(L.then(S,S),L.then(y,T))})}return this.requestFullscreenHelper_()},h.requestFullscreenHelper_=function(n){var u=this;if(this.fsApi_.prefixed||(m=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==n&&(m=n)),this.fsApi_.requestFullscreen){var m=this.el_[this.fsApi_.requestFullscreen](m);return m&&m.then(function(){return u.isFullscreen(!0)},function(){return u.isFullscreen(!1)}),m}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},h.exitFullscreen=function(){var n=this.options_.Promise||window.Promise;if(n){var u=this;return new n(function(m,y){function T(){u.off("fullscreenerror",x),u.off("fullscreenchange",S)}function S(){T(),m()}function x(L,O){T(),y(O)}u.one("fullscreenchange",S),u.one("fullscreenerror",x);var A=u.exitFullscreenHelper_();A&&(A.then(T,T),A.then(m,y))})}return this.exitFullscreenHelper_()},h.exitFullscreenHelper_=function(){var n=this;if(this.fsApi_.requestFullscreen){var u=document[this.fsApi_.exitFullscreen]();return u&&la(u.then(function(){return n.isFullscreen(!1)})),u}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},h.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,Xt(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow="hidden",ya(document.body,"vjs-full-window"),this.trigger("enterFullWindow")},h.fullWindowOnEscKey=function(n){we.isEventKey(n,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},h.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,Dt(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow=this.docOrigOverflow,wi(document.body,"vjs-full-window"),this.trigger("exitFullWindow")},h.disablePictureInPicture=function(n){if(void 0===n)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",n),this.options_.disablePictureInPicture=n,this.trigger("disablepictureinpicturechanged")},h.isInPictureInPicture=function(n){return void 0!==n?(this.isInPictureInPicture_=!!n,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},h.requestPictureInPicture=function(){if("pictureInPictureEnabled"in document&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},h.exitPictureInPicture=function(){if("pictureInPictureEnabled"in document)return document.exitPictureInPicture()},h.handleKeyDown=function(n){var m,y,u=this.options_.userActions;u&&u.hotkeys&&(y=(m=this.el_.ownerDocument.activeElement).tagName.toLowerCase(),m.isContentEditable||("input"===y?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(m.type):-1!==["textarea"].indexOf(y))||("function"==typeof u.hotkeys?u.hotkeys.call(this,n):this.handleHotkeys(n)))},h.handleHotkeys=function(n){var m=(u=this.options_.userActions?this.options_.userActions.hotkeys:{}).fullscreenKey,y=void 0===(y=u.muteKey)?function(T){return we.isEventKey(T,"m")}:y,u=void 0===(u=u.playPauseKey)?function(T){return we.isEventKey(T,"k")||we.isEventKey(T,"Space")}:u;(void 0===m?function(T){return we.isEventKey(T,"f")}:m).call(this,n)?(n.preventDefault(),n.stopPropagation(),m=de.getComponent("FullscreenToggle"),!1!==document[this.fsApi_.fullscreenEnabled]&&m.prototype.handleClick.call(this,n)):y.call(this,n)?(n.preventDefault(),n.stopPropagation(),de.getComponent("MuteToggle").prototype.handleClick.call(this,n)):u.call(this,n)&&(n.preventDefault(),n.stopPropagation(),de.getComponent("PlayToggle").prototype.handleClick.call(this,n))},h.canPlayType=function(n){for(var u,m=0,y=this.options_.techOrder;m<y.length;m++){var T=y[m],S=Ze.getTech(T);if(S=S||de.getComponent(T)){if(S.isSupported()&&(u=S.canPlayType(n)))return u}else U.error('The "'+T+'" tech is undefined. Skipped browser support check for that tech.')}return""},h.selectSource=function(n){function u(x,A,L){var O;return x.some(function(j){return A.some(function(B){if(O=L(j,B))return!0})}),O}var m,y=this,T=this.options_.techOrder.map(function(x){return[x,Ze.getTech(x)]}).filter(function(x){var A=x[0];return(x=x[1])?x.isSupported():(U.error('The "'+A+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),S=function(x,A){var L=x[0];if(x[1].canPlaySource(A,y.options_[L.toLowerCase()]))return{source:A,tech:L}};return(S=this.options_.sourceOrder?u(n,T,(m=S,function(x,A){return m(A,x)})):u(T,n,S))||!1},h.handleSrc_=function(n,u){var m=this;if(void 0===n)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var y,T,S=Zo(n);S.length?(this.changingSrc_=!0,u||(this.cache_.sources=S),this.updateSourceCaches_(S[0]),function(s,p,h){s.setTimeout(function(){return function n(u,m,y,T,S,x){void 0===u&&(u={}),void 0===m&&(m=[]),void 0===S&&(S=[]),void 0===x&&(x=!1);var A=m,L=(m=A[0],A.slice(1));if("string"==typeof m)n(u,ja[m],y,T,S,x);else if(m){var O=function(s,p){var h=zn[s.id()],n=null;if(null==h)return n=p(s),zn[s.id()]=[[p,n]],n;for(var u=0;u<h.length;u++){var y=(m=h[u])[0],m=m[1];y===p&&(n=m)}return null===n&&(n=p(s),h.push([p,n])),n}(T,m);if(!O.setSource)return S.push(O),n(u,L,y,T,S,x);O.setSource(te({},u),function(j,B){return j?n(u,L,y,T,S,x):(S.push(O),void n(B,u.type===B.type?L:ja[B.type],y,T,S,x))})}else L.length?n(u,L,y,T,S,x):x?y(u,S):n(u,ja["*"],y,T,S,!0)}(p,ja[p.type],h,s)},1)}(this,S[0],function(x,A){var L;return m.middleware_=A,u||(m.cache_.sources=S),m.updateSourceCaches_(x),m.src_(x)?1<S.length?m.handleSrc_(S.slice(1)):(m.changingSrc_=!1,m.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),void m.triggerReady()):(L=m.tech_,void(A=A).forEach(function(O){return O.setTech&&O.setTech(L)}))}),this.options_.retryOnError&&1<S.length&&(T=function(){m.off("error",y)},this.one("error",y=function(){m.error(null),m.handleSrc_(S.slice(1),!0)}),this.one("playing",T),this.resetRetryOnError_=function(){m.off("error",y),m.off("playing",T)})):this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0)},h.src=function(n){return this.handleSrc_(n,!1)},h.src_=function(n){var m,y=this,T=this.selectSource([n]);return!T||(m=this.techName_,pt(T.tech)!==pt(m)?(this.changingSrc_=!0,this.loadTech_(T.tech,T.source),this.tech_.ready(function(){y.changingSrc_=!1})):this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",n):this.techCall_("src",n.src),this.changingSrc_=!1},!0),!1)},h.load=function(){this.techCall_("load")},h.reset=function(){var n=this,u=this.options_.Promise||window.Promise;this.paused()||!u?this.doReset_():la(this.play().then(function(){return n.doReset_()}))},h.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),va(this)&&this.trigger("playerreset")},h.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},h.resetProgressBar_=function(){this.currentTime(0);var u=(n=this.controlBar).durationDisplay,n=n.remainingTimeDisplay;u&&u.updateContent(),n&&n.updateContent()},h.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},h.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},h.currentSources=function(){var n=this.currentSource(),u=[];return 0!==Object.keys(n).length&&u.push(n),this.cache_.sources||u},h.currentSource=function(){return this.cache_.source||{}},h.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},h.currentType=function(){return this.currentSource()&&this.currentSource().type||""},h.preload=function(n){return void 0!==n?(this.techCall_("setPreload",n),void(this.options_.preload=n)):this.techGet_("preload")},h.autoplay=function(n){if(void 0===n)return this.options_.autoplay||!1;var u;"string"==typeof n&&/(any|play|muted)/.test(n)||!0===n&&this.options_.normalizeAutoplay?(this.options_.autoplay=n,this.manualAutoplay_("string"==typeof n?n:"play"),u=!1):this.options_.autoplay=!!n,u=void 0===u?this.options_.autoplay:u,this.tech_&&this.techCall_("setAutoplay",u)},h.playsinline=function(n){return void 0!==n?(this.techCall_("setPlaysinline",n),this.options_.playsinline=n,this):this.techGet_("playsinline")},h.loop=function(n){return void 0!==n?(this.techCall_("setLoop",n),void(this.options_.loop=n)):this.techGet_("loop")},h.poster=function(n){if(void 0===n)return this.poster_;(n=n||"")!==this.poster_&&(this.poster_=n,this.techCall_("setPoster",n),this.isPosterFromTech_=!1,this.trigger("posterchange"))},h.handleTechPosterChange_=function(){var n;this.poster_&&!this.options_.techCanOverridePoster||!this.tech_||!this.tech_.poster||(n=this.tech_.poster()||"")!==this.poster_&&(this.poster_=n,this.isPosterFromTech_=!0,this.trigger("posterchange"))},h.controls=function(n){if(void 0===n)return!!this.controls_;this.controls_!==(n=!!n)&&(this.controls_=n,this.usingNativeControls()&&this.techCall_("setControls",n),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},h.usingNativeControls=function(n){if(void 0===n)return!!this.usingNativeControls_;this.usingNativeControls_!==(n=!!n)&&(this.usingNativeControls_=n,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},h.error=function(n){var u=this;if(void 0===n)return this.error_||null;if(o("beforeerror").forEach(function(y){ce(y=y(u,n))&&!Array.isArray(y)||"string"==typeof y||"number"==typeof y||null===y?n=y:u.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&n&&4===n.code){var m=function(){this.error(n)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],m),void this.one("loadstart",function(){this.off(["click","touchstart"],m)})}if(null===n)return this.error_=n,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Ft(n),this.addClass("vjs-error"),U.error("(CODE:"+this.error_.code+" "+Ft.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),o("error").forEach(function(y){return y(u,u.error_)})},h.reportUserActivity=function(n){this.userActivity_=!0},h.userActive=function(n){if(void 0===n)return this.userActive_;if((n=!!n)!==this.userActive_){if(this.userActive_=n,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(u){u.stopPropagation(),u.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},h.listenForUserActivity_=function(){var n,u,m,S,y=Je(this,this.reportUserActivity),T=function(x){y(),this.clearInterval(n)};this.on("mousedown",function(){y(),this.clearInterval(n),n=this.setInterval(y,250)}),this.on("mousemove",function(x){x.screenX===u&&x.screenY===m||(u=x.screenX,m=x.screenY,y())}),this.on("mouseup",T),this.on("mouseleave",T),!(T=this.getChild("controlBar"))||At||Fe||(T.on("mouseenter",function(x){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),T.on("mouseleave",function(x){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",y),this.on("keyup",y),this.setInterval(function(){var x;this.userActivity_&&(this.userActivity_=!1,this.userActive(!0),this.clearTimeout(S),(x=this.options_.inactivityTimeout)<=0||(S=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},x)))},250)},h.playbackRate=function(n){if(void 0===n)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",n)},h.defaultPlaybackRate=function(n){return void 0!==n?this.techCall_("setDefaultPlaybackRate",n):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},h.isAudio=function(n){if(void 0===n)return!!this.isAudio_;this.isAudio_=!!n},h.addTextTrack=function(n,u,m){if(this.tech_)return this.tech_.addTextTrack(n,u,m)},h.addRemoteTextTrack=function(n,u){if(this.tech_)return this.tech_.addRemoteTextTrack(n,u)},h.removeRemoteTextTrack=function(n){var u=(u=(n=void 0===n?{}:n).track)||n;if(this.tech_)return this.tech_.removeRemoteTextTrack(u)},h.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},h.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},h.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},h.language=function(n){if(void 0===n)return this.language_;this.language_!==String(n).toLowerCase()&&(this.language_=String(n).toLowerCase(),va(this)&&this.trigger("languagechange"))},h.languages=function(){return at(p.prototype.options_.languages,this.languages_)},h.toJSON=function(){var n=at(this.options_),u=n.tracks;n.tracks=[];for(var m=0;m<u.length;m++){var y=u[m];(y=at(y)).player=void 0,n.tracks[m]=y}return n},h.createModal=function(n,u){var m=this;(u=u||{}).content=n||"";var y=new ti(this,u);return this.addChild(y),y.on("dispose",function(){m.removeChild(y)}),y.open(),y},h.updateCurrentBreakpoint_=function(){if(this.responsive())for(var n=this.currentBreakpoint(),u=this.currentWidth(),m=0;m<ns.length;m++){var y=ns[m];if(u<=this.breakpoints_[y]){if(n===y)return;n&&this.removeClass(Ar[n]),this.addClass(Ar[y]),this.breakpoint_=y;break}}},h.removeCurrentBreakpoint_=function(){var n=this.currentBreakpointClass();this.breakpoint_="",n&&this.removeClass(n)},h.breakpoints=function(n){return void 0===n||(this.breakpoint_="",this.breakpoints_=te({},Oh,n),this.updateCurrentBreakpoint_()),te(this.breakpoints_)},h.responsive=function(n){return void 0===n?this.responsive_:(n=Boolean(n))!==this.responsive_?((this.responsive_=n)?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),n):void 0},h.currentBreakpoint=function(){return this.breakpoint_},h.currentBreakpointClass=function(){return Ar[this.breakpoint_]||""},h.loadMedia=function(n,u){var m,y,T,S=this;n&&"object"==typeof n&&(this.reset(),this.cache_.media=at(n),m=(T=this.cache_.media).artwork,y=T.poster,n=T.src,T=T.textTracks,!m&&y&&(this.cache_.media.artwork=[{src:y,type:Sr(y)}]),n&&this.src(n),y&&this.poster(y),Array.isArray(T)&&T.forEach(function(x){return S.addRemoteTextTrack(x,!1)}),this.ready(u))},h.getMedia=function(){if(this.cache_.media)return at(this.cache_.media);var n=this.poster(),u={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(m){return{kind:m.kind,label:m.label,language:m.language,src:m.src}})};return n&&(u.poster=n,u.artwork=[{src:u.poster,type:Sr(u.poster)}]),u},p.getTagSettings=function(n){var u,m={sources:[],tracks:[]},y=_a(n),T=y["data-setup"];if(Ua(n,"vjs-fill")&&(y.fill=!0),Ua(n,"vjs-fluid")&&(y.fluid=!0),null!==T&&(T=(u=function(s,p){var h,n=null;try{h=JSON.parse(s,void 0)}catch(u){n=u}return[n,h]}(T||"{}"))[0],u=u[1],T&&U.error(T),te(y,u)),te(m,y),n.hasChildNodes())for(var S=n.childNodes,x=0,A=S.length;x<A;x++){var L=S[x],O=L.nodeName.toLowerCase();"source"===O?m.sources.push(_a(L)):"track"===O&&m.tracks.push(_a(L))}return m},h.flexNotSupported_=function(){var n=document.createElement("i");return!("flexBasis"in n.style||"webkitFlexBasis"in n.style||"mozFlexBasis"in n.style||"msFlexBasis"in n.style||"msFlexOrder"in n.style)},h.debug=function(n){if(void 0===n)return this.debugEnabled_;n?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},h.playbackRates=function(n){if(void 0===n)return this.cache_.playbackRates;Array.isArray(n)&&n.every(function(u){return"number"==typeof u})&&(this.cache_.playbackRates=n,this.trigger("playbackrateschange"))},p}(de);$t.names.forEach(function(s){var p=$t[s];vt.prototype[p.getterName]=function(){return this.tech_?this.tech_[p.getterName]():(this[p.privateName]=this[p.privateName]||new p.ListClass,this[p.privateName])}}),vt.prototype.crossorigin=vt.prototype.crossOrigin,vt.players={},le=window.navigator,vt.prototype.options_={techOrder:Ze.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:le&&(le.languages&&le.languages[0]||le.userLanguage||le.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(s){vt.prototype[s]=function(){return this.techGet_(s)}}),du.forEach(function(s){vt.prototype["handleTech"+pt(s)+"_"]=function(){return this.trigger(s)}}),de.registerComponent("Player",vt);var hu=z(function(s){function p(h,n){return s.exports=p=Object.setPrototypeOf||function(u,m){return u.__proto__=m,u},p(h,n)}s.exports=p});function Ir(s){return si.hasOwnProperty(s)}function xr(s){return Ir(s)?si[s]:void 0}function Mr(s,p,h){s.trigger(h=(h?"before":"")+"pluginsetup",p),s.trigger(h+":"+p.name,p)}function cu(s,p){return p.prototype.name=s,function(){Mr(this,{name:s,plugin:p,instance:null},!0);for(var h=arguments.length,n=new Array(h),u=0;u<h;u++)n[u]=arguments[u];var m=Fh(p,[this].concat(n));return this[s]=function(){return m},Mr(this,m.getEventHash()),m}}var Bh=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(s){return!1}},Fh=z(function(s){function p(h,n,u){return s.exports=p=Bh()?Reflect.construct:function(m,y,T){var S=[null];return S.push.apply(S,y),S=new(Function.bind.apply(m,S)),T&&hu(S,T.prototype),S},p.apply(null,arguments)}s.exports=p}),wr="plugin",ni="activePlugins_",si={},pu=function(s,p){s[ni]=s[ni]||{},s[ni][p]=!0},ca=function(){function s(h){if(this.constructor===s)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=h,this.log||(this.log=this.player.log.createLogger(this.name)),Rn(this),delete this.trigger,Ro(this,this.constructor.defaultState),pu(h,this.name),this.dispose=this.dispose.bind(this),h.on("dispose",this.dispose)}var p=s.prototype;return p.version=function(){return this.constructor.VERSION},p.getEventHash=function(h){return(h=void 0===h?{}:h).name=this.name,h.plugin=this.constructor,h.instance=this,h},p.trigger=function(h,n){return Za(this.eventBusEl_,h,this.getEventHash(n=void 0===n?{}:n))},p.handleStateChanged=function(h){},p.dispose=function(){var h=this.name,n=this.player;this.trigger("dispose"),this.off(),n.off("dispose",this.dispose),n[ni][h]=!1,this.player=this.state=null,n[h]=cu(h,si[h])},s.isBasic=function(h){return"function"==typeof(h="string"==typeof h?xr(h):h)&&!s.prototype.isPrototypeOf(h.prototype)},s.registerPlugin=function(h,n){if("string"!=typeof h)throw new Error('Illegal plugin name, "'+h+'", must be a string, was '+typeof h+".");if(Ir(h))U.warn('A plugin named "'+h+'" already exists. You may want to avoid re-registering plugins!');else if(vt.prototype.hasOwnProperty(h))throw new Error('Illegal plugin name, "'+h+'", cannot share a name with an existing player method!');if("function"!=typeof n)throw new Error('Illegal plugin for "'+h+'", must be a function, was '+typeof n+".");return si[h]=n,h!==wr&&(vt.prototype[h]=s.isBasic(n)?function(s,p){function h(){Mr(this,{name:s,plugin:p,instance:null},!0);var n=p.apply(this,arguments);return pu(this,s),Mr(this,{name:s,plugin:p,instance:n}),n}return Object.keys(p).forEach(function(n){h[n]=p[n]}),h}(h,n):cu(h,n)),n},s.deregisterPlugin=function(h){if(h===wr)throw new Error("Cannot de-register base plugin.");Ir(h)&&(delete si[h],delete vt.prototype[h])},s.getPlugins=function(h){var n;return(h=void 0===h?Object.keys(si):h).forEach(function(u){var m=xr(u);m&&((n=n||{})[u]=m)}),n},s.getPluginVersion=function(h){return(h=xr(h))&&h.VERSION||""},s}();ca.getPlugin=xr,ca.BASE_PLUGIN_NAME=wr,ca.registerPlugin(wr,ca),vt.prototype.usingPlugin=function(s){return!!this[ni]&&!0===this[ni][s]},vt.prototype.hasPlugin=function(s){return!!Ir(s)};var mu=function(s){return 0===s.indexOf("#")?s.slice(1):s};function J(s,p,h){if(u=J.getPlayer(s))return p&&U.warn('Player "'+s+'" is already initialised. Options will not be applied.'),h&&u.ready(h),u;var n="string"==typeof s?Ia("#"+mu(s)):s;if(!fa(n))throw new TypeError("The element or ID supplied is not valid. (videojs)");n.ownerDocument.defaultView&&n.ownerDocument.body.contains(n)||U.warn("The element supplied is not included in the DOM"),p=p||{},o("beforesetup").forEach(function(m){ce(m=m(n,at(p)))&&!Array.isArray(m)?p=at(p,m):U.error("please return an object in beforesetup hooks")});var u=new(de.getComponent("Player"))(n,p,h);return o("setup").forEach(function(m){return m(u)}),u}J.hooks_=r,J.hooks=o,J.hook=function(s,p){o(s,p)},J.hookOnce=function(s,p){o(s,[].concat(p).map(function(h){return function n(){return l(s,n),h.apply(void 0,arguments)}}))},J.removeHook=l,!0!==window.VIDEOJS_NO_DYNAMIC_STYLE&&ga()&&((Gt=Ia(".vjs-styles-defaults"))||(Gt=Ao("vjs-styles-defaults"),(le=Ia("head"))&&le.insertBefore(Gt,le.firstChild),Io(Gt,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    "))),In(1,J),J.VERSION=i,J.options=vt.prototype.options_,J.getPlayers=function(){return vt.players},J.getPlayer=function(s){var p=vt.players;if("string"==typeof s){var h=mu(s),n=p[h];if(n)return n;h=Ia("#"+h)}else h=s;if(fa(h)&&(s=h.player,h=h.playerId,s||p[h]))return s||p[h]},J.getAllPlayers=function(){return Object.keys(vt.players).map(function(s){return vt.players[s]}).filter(Boolean)},J.players=vt.players,J.getComponent=de.getComponent,J.registerComponent=function(s,p){Ze.isTech(p)&&U.warn("The "+s+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),de.registerComponent.call(de,s,p)},J.getTech=Ze.getTech,J.registerTech=Ze.registerTech,J.use=function(s,p){ja[s]=ja[s]||[],ja[s].push(p)},Object.defineProperty(J,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(J.middleware,"TERMINATOR",{value:Er,writeable:!1,enumerable:!0}),J.browser=tt,J.TOUCH_ENABLED=ua,J.extend=function(s,p){var h,n=function(){s.apply(this,arguments)},u={};for(h in"object"==typeof(p=void 0===p?{}:p)?(p.constructor!==Object.prototype.constructor&&(n=p.constructor),u=p):"function"==typeof p&&(n=p),function(s,p){if("function"!=typeof p&&null!==p)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(p&&p.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),p&&hu(s,p)}(n,s),s&&(n.super_=s),u)u.hasOwnProperty(h)&&(n.prototype[h]=u[h]);return n},J.mergeOptions=at,J.bind=Je,J.registerPlugin=ca.registerPlugin,J.deregisterPlugin=ca.deregisterPlugin,J.plugin=function(s,p){return U.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),ca.registerPlugin(s,p)},J.getPlugins=ca.getPlugins,J.getPlugin=ca.getPlugin,J.getPluginVersion=ca.getPluginVersion,J.addLanguage=function(s,p){var h;return s=(""+s).toLowerCase(),(J.options.languages=at(J.options.languages,((h={})[s]=p,h)))[s]},J.log=U,J.createLogger=$,J.createTimeRange=J.createTimeRanges=Fa,J.formatTime=ri,J.setFormatTime=function(s){Qn=s},J.resetFormatTime=function(){Qn=tu},J.parseUrl=Fn,J.isCrossOrigin=vr,J.EventTarget=Bt,J.on=Xt,J.one=fr,J.off=Dt,J.trigger=Za,J.xhr=$n,J.TextTrack=Oi,J.AudioTrack=Se,J.VideoTrack=Qe,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(s){J[s]=function(){return U.warn("videojs."+s+"() is deprecated; use videojs.dom."+s+"() instead"),bo[s].apply(null,arguments)}}),J.computedStyle=ye,J.dom=bo,J.url=da,J.defineLazyProperty=is,J.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"});var Dr=z(function(s,p){var h,n,u,m,y;h=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,n=/^([^\/?#]*)([^]*)$/,u=/(?:\/|^)\.(?=\/)/g,m=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s.exports=y={buildAbsoluteURL:function(T,S,x){if(x=x||{},T=T.trim(),!(S=S.trim())){if(!x.alwaysNormalize)return T;var A=y.parseURL(T);if(!A)throw new Error("Error trying to parse base URL.");return A.path=y.normalizePath(A.path),y.buildURLFromParts(A)}if(!(A=y.parseURL(S)))throw new Error("Error trying to parse relative URL.");if(A.scheme)return x.alwaysNormalize?(A.path=y.normalizePath(A.path),y.buildURLFromParts(A)):S;if(!(S=y.parseURL(T)))throw new Error("Error trying to parse base URL.");var L;return!S.netLoc&&S.path&&"/"!==S.path[0]&&(L=n.exec(S.path),S.netLoc=L[1],S.path=L[2]),S.netLoc&&!S.path&&(S.path="/"),T={scheme:S.scheme,netLoc:A.netLoc,path:null,params:A.params,query:A.query,fragment:A.fragment},A.netLoc||(T.netLoc=S.netLoc,"/"!==A.path[0]&&(A.path?(L=(L=S.path).substring(0,L.lastIndexOf("/")+1)+A.path,T.path=y.normalizePath(L)):(T.path=S.path,A.params||(T.params=S.params,A.query||(T.query=S.query))))),null===T.path&&(T.path=x.alwaysNormalize?y.normalizePath(A.path):A.path),y.buildURLFromParts(T)},parseURL:function(T){return(T=h.exec(T))?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(T){for(T=T.split("").reverse().join("").replace(u,"");T.length!==(T=T.replace(m,"")).length;);return T.split("").reverse().join("")},buildURLFromParts:function(T){return T.scheme+T.netLoc+T.path+T.params+T.query+T.fragment}}}),gu="http://example.com",Gt=function(){function s(){this.listeners={}}var p=s.prototype;return p.on=function(h,n){this.listeners[h]||(this.listeners[h]=[]),this.listeners[h].push(n)},p.off=function(h,n){return!!this.listeners[h]&&(n=this.listeners[h].indexOf(n),this.listeners[h]=this.listeners[h].slice(0),this.listeners[h].splice(n,1),-1<n)},p.trigger=function(h){var n=this.listeners[h];if(n)if(2===arguments.length)for(var u=n.length,m=0;m<u;++m)n[m].call(this,arguments[1]);else for(var y=Array.prototype.slice.call(arguments,1),T=n.length,S=0;S<T;++S)n[S].apply(this,y)},p.dispose=function(){this.listeners={}},p.pipe=function(h){this.on("data",function(n){h.push(n)})},s}();function fu(s){for(var p=function(s){return window.atob?window.atob(s):Buffer.from(s,"base64").toString("binary")}(s),h=new Uint8Array(p.length),n=0;n<p.length;n++)h[n]=p.charCodeAt(n);return h}function ss(s){var p=/([0-9.]*)?@?([0-9.]*)?/.exec(s||"");return s={},p[1]&&(s.length=parseInt(p[1],10)),p[2]&&(s.offset=parseInt(p[2],10)),s}function aa(s){for(var p,h=s.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},u=h.length;u--;)""!==h[u]&&((p=/([^=]*)=(.*)/.exec(h[u]).slice(1))[0]=p[0].replace(/^\s+|\s+$/g,""),p[1]=p[1].replace(/^\s+|\s+$/g,""),p[1]=p[1].replace(/^['"](.*)['"]$/g,"$1"),n[p[0]]=p[1]);return n}function oi(s){var p={};return Object.keys(s).forEach(function(h){p[h.toLowerCase().replace(/-(\w)/g,function(n){return n[1].toUpperCase()})]=s[h]}),p}function os(s){var p,h,n,u,m=s.serverControl,y=s.targetDuration,T=s.partTargetDuration;m&&(p="#EXT-X-SERVER-CONTROL",h="holdBack",n="partHoldBack",u=y&&3*y,s=T&&2*T,y&&!m.hasOwnProperty(h)&&(m[h]=u,this.trigger("info",{message:p+" defaulting HOLD-BACK to targetDuration * 3 ("+u+")."})),u&&m[h]<u&&(this.trigger("warn",{message:p+" clamping HOLD-BACK ("+m[h]+") to targetDuration * 3 ("+u+")"}),m[h]=u),T&&!m.hasOwnProperty(n)&&(m[n]=3*T,this.trigger("info",{message:p+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+m[n]+")."})),T&&m[n]<s&&(this.trigger("warn",{message:p+" clamping PART-HOLD-BACK ("+m[n]+") to partTargetDuration * 2 ("+s+")."}),m[n]=s))}function yu(s){return s&&s.replace(/avc1\.(\d+)\.(\d+)/i,function(p,h,n){return"avc1."+("00"+Number(h).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)})}function pa(s){s=(s=void 0===s?"":s).split(",");var p=[];return s.forEach(function(h){var n;h=h.trim(),Wh.forEach(function(u){var m,y=Va[u].exec(h.toLowerCase());!y||y.length<=1||(n=u,m=h.substring(0,y[1].length),y=h.replace(m,""),p.push({type:m,details:y,mediaType:u}))}),n||p.push({type:h,details:"",mediaType:"unknown"})}),p}function _u(s){return Va.audio.test((s=void 0===s?"":s).trim().toLowerCase())}function Gi(s){if(s&&"string"==typeof s){var p=s.toLowerCase().split(",").map(function(u){return yu(u.trim())}),h="video";1===p.length&&_u(p[0])?h="audio":1===p.length&&Va.text.test((n=void 0===(n=p[0])?"":n).trim().toLowerCase())&&(h="application");var n="mp4";return p.every(function(u){return Va.mp4.test(u)})?n="mp4":p.every(function(u){return Va.webm.test(u)})?n="webm":p.every(function(u){return Va.ogg.test(u)})&&(n="ogg"),h+"/"+n+';codecs="'+s+'"'}}function Rr(s){return void 0===s&&(s=""),window.MediaSource&&window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported(Gi(s))||!1}function us(s){return(s=void 0===s?"":s).toLowerCase().split(",").every(function(p){p=p.trim();for(var h=0;h<vu.length;h++)if(Va["muxer"+vu[h]].test(p))return!0;return!1})}function ku(s){return zh.test(s)?"hls":qh.test(s)?"dash":"application/vnd.videojs.vhs+json"===s?"vhs-json":null}function ls(s,p){if(/^[a-z]+:/i.test(p))return p;/^data:/.test(s)&&(s=window.location&&window.location.href||"");var h="function"==typeof window.URL,n=/^\/\//.test(s),u=!window.location&&!/\/\//i.test(s);return h?s=new window.URL(s,window.location||Eu):/\/\//i.test(s)||(s=Dr.buildAbsoluteURL(window.location&&window.location.href||"",s)),h?(h=new URL(p,s),u?h.href.slice(Eu.length):n?h.href.slice(h.protocol.length):h.href):Dr.buildAbsoluteURL(s,p)}var Vh=function(s){function p(){var h=s.call(this)||this;return h.buffer="",h}return ge(p,s),p.prototype.push=function(h){var n;for(this.buffer+=h,n=this.buffer.indexOf("\n");-1<n;n=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,n)),this.buffer=this.buffer.substring(n+1)},p}(Gt),Gh=String.fromCharCode(9),Kh=function(s){function p(){var n=s.call(this)||this;return n.customParsers=[],n.tagMappers=[],n}ge(p,s);var h=p.prototype;return h.push=function(n){var u,m,y=this;0!==(n=n.trim()).length&&("#"===n[0]?this.tagMappers.reduce(function(T,S){return(S=S(n))===n?T:T.concat([S])},[n]).forEach(function(T){for(var S,x,A=0;A<y.customParsers.length;A++)if(y.customParsers[A].call(y,T))return;if(0===T.indexOf("#EXT"))if(T=T.replace("\r",""),u=/^#EXTM3U/.exec(T))y.trigger("data",{type:"tag",tagType:"m3u"});else{if(u=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(T))return m={type:"tag",tagType:"inf"},u[1]&&(m.duration=parseFloat(u[1])),u[2]&&(m.title=u[2]),void y.trigger("data",m);if(u=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(T))return m={type:"tag",tagType:"targetduration"},u[1]&&(m.duration=parseInt(u[1],10)),void y.trigger("data",m);if(u=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(T))return m={type:"tag",tagType:"version"},u[1]&&(m.version=parseInt(u[1],10)),void y.trigger("data",m);if(u=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(T))return m={type:"tag",tagType:"media-sequence"},u[1]&&(m.number=parseInt(u[1],10)),void y.trigger("data",m);if(u=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(T))return m={type:"tag",tagType:"discontinuity-sequence"},u[1]&&(m.number=parseInt(u[1],10)),void y.trigger("data",m);if(u=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(T))return m={type:"tag",tagType:"playlist-type"},u[1]&&(m.playlistType=u[1]),void y.trigger("data",m);if(u=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(T))return m=Z(ss(u[1]),{type:"tag",tagType:"byterange"}),void y.trigger("data",m);if(u=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(T))return m={type:"tag",tagType:"allow-cache"},u[1]&&(m.allowed=!/NO/.test(u[1])),void y.trigger("data",m);if(u=/^#EXT-X-MAP:?(.*)$/.exec(T))return m={type:"tag",tagType:"map"},u[1]&&((S=aa(u[1])).URI&&(m.uri=S.URI),S.BYTERANGE&&(m.byterange=ss(S.BYTERANGE))),void y.trigger("data",m);if(u=/^#EXT-X-STREAM-INF:?(.*)$/.exec(T))return m={type:"tag",tagType:"stream-inf"},u[1]&&(m.attributes=aa(u[1]),m.attributes.RESOLUTION&&(x={},(S=m.attributes.RESOLUTION.split("x"))[0]&&(x.width=parseInt(S[0],10)),S[1]&&(x.height=parseInt(S[1],10)),m.attributes.RESOLUTION=x),m.attributes.BANDWIDTH&&(m.attributes.BANDWIDTH=parseInt(m.attributes.BANDWIDTH,10)),m.attributes["PROGRAM-ID"]&&(m.attributes["PROGRAM-ID"]=parseInt(m.attributes["PROGRAM-ID"],10))),void y.trigger("data",m);if(u=/^#EXT-X-MEDIA:?(.*)$/.exec(T))return m={type:"tag",tagType:"media"},u[1]&&(m.attributes=aa(u[1])),void y.trigger("data",m);if(u=/^#EXT-X-ENDLIST/.exec(T))y.trigger("data",{type:"tag",tagType:"endlist"});else{if(!(u=/^#EXT-X-DISCONTINUITY/.exec(T)))return(u=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(T))?(m={type:"tag",tagType:"program-date-time"},u[1]&&(m.dateTimeString=u[1],m.dateTimeObject=new Date(u[1])),void y.trigger("data",m)):(u=/^#EXT-X-KEY:?(.*)$/.exec(T))?(m={type:"tag",tagType:"key"},u[1]&&(m.attributes=aa(u[1]),m.attributes.IV&&("0x"===m.attributes.IV.substring(0,2).toLowerCase()&&(m.attributes.IV=m.attributes.IV.substring(2)),m.attributes.IV=m.attributes.IV.match(/.{8}/g),m.attributes.IV[0]=parseInt(m.attributes.IV[0],16),m.attributes.IV[1]=parseInt(m.attributes.IV[1],16),m.attributes.IV[2]=parseInt(m.attributes.IV[2],16),m.attributes.IV[3]=parseInt(m.attributes.IV[3],16),m.attributes.IV=new Uint32Array(m.attributes.IV))),void y.trigger("data",m)):(u=/^#EXT-X-START:?(.*)$/.exec(T))?(m={type:"tag",tagType:"start"},u[1]&&(m.attributes=aa(u[1]),m.attributes["TIME-OFFSET"]=parseFloat(m.attributes["TIME-OFFSET"]),m.attributes.PRECISE=/YES/.test(m.attributes.PRECISE)),void y.trigger("data",m)):(u=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(T))?((m={type:"tag",tagType:"cue-out-cont"}).data=u[1]?u[1]:"",void y.trigger("data",m)):(u=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(T))?((m={type:"tag",tagType:"cue-out"}).data=u[1]?u[1]:"",void y.trigger("data",m)):(u=/^#EXT-X-CUE-IN:?(.*)?$/.exec(T))?((m={type:"tag",tagType:"cue-in"}).data=u[1]?u[1]:"",void y.trigger("data",m)):(u=/^#EXT-X-SKIP:(.*)$/.exec(T))&&u[1]?((m={type:"tag",tagType:"skip"}).attributes=aa(u[1]),m.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(m.attributes["SKIPPED-SEGMENTS"]=parseInt(m.attributes["SKIPPED-SEGMENTS"],10)),m.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(m.attributes["RECENTLY-REMOVED-DATERANGES"]=m.attributes["RECENTLY-REMOVED-DATERANGES"].split(Gh)),void y.trigger("data",m)):(u=/^#EXT-X-PART:(.*)$/.exec(T))&&u[1]?((m={type:"tag",tagType:"part"}).attributes=aa(u[1]),["DURATION"].forEach(function(L){m.attributes.hasOwnProperty(L)&&(m.attributes[L]=parseFloat(m.attributes[L]))}),["INDEPENDENT","GAP"].forEach(function(L){m.attributes.hasOwnProperty(L)&&(m.attributes[L]=/YES/.test(m.attributes[L]))}),m.attributes.hasOwnProperty("BYTERANGE")&&(m.attributes.byterange=ss(m.attributes.BYTERANGE)),void y.trigger("data",m)):(u=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(T))&&u[1]?((m={type:"tag",tagType:"server-control"}).attributes=aa(u[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(L){m.attributes.hasOwnProperty(L)&&(m.attributes[L]=parseFloat(m.attributes[L]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(L){m.attributes.hasOwnProperty(L)&&(m.attributes[L]=/YES/.test(m.attributes[L]))}),void y.trigger("data",m)):(u=/^#EXT-X-PART-INF:(.*)$/.exec(T))&&u[1]?((m={type:"tag",tagType:"part-inf"}).attributes=aa(u[1]),["PART-TARGET"].forEach(function(L){m.attributes.hasOwnProperty(L)&&(m.attributes[L]=parseFloat(m.attributes[L]))}),void y.trigger("data",m)):(u=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(T))&&u[1]?((m={type:"tag",tagType:"preload-hint"}).attributes=aa(u[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(L){var O;m.attributes.hasOwnProperty(L)&&(m.attributes[L]=parseInt(m.attributes[L],10),O="BYTERANGE-LENGTH"===L?"length":"offset",m.attributes.byterange=m.attributes.byterange||{},m.attributes.byterange[O]=m.attributes[L],delete m.attributes[L])}),void y.trigger("data",m)):(u=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(T))&&u[1]?((m={type:"tag",tagType:"rendition-report"}).attributes=aa(u[1]),["LAST-MSN","LAST-PART"].forEach(function(L){m.attributes.hasOwnProperty(L)&&(m.attributes[L]=parseInt(m.attributes[L],10))}),void y.trigger("data",m)):void y.trigger("data",{type:"tag",data:T.slice(4)});y.trigger("data",{type:"tag",tagType:"discontinuity"})}}else y.trigger("data",{type:"comment",text:T.slice(1)})}):this.trigger("data",{type:"uri",uri:n}))},h.addParser=function(n){var u=this,m=n.expression,y=n.customType,T=n.dataParser,S=n.segment;"function"!=typeof T&&(T=function(x){return x}),this.customParsers.push(function(x){if(m.exec(x))return u.trigger("data",{type:"custom",data:T(x),customType:y,segment:S}),!0})},h.addTagMapper=function(n){var u=n.expression,m=n.map;this.tagMappers.push(function(y){return u.test(y)?m(y):y})},p}(Gt),Hh=function(s){function p(){var n=s.call(this)||this;n.lineStream=new Vh,n.parseStream=new Kh,n.lineStream.pipe(n.parseStream);var u,m,y=De(n),T=[],S={},x=!1,A={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},L=0;n.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var O=0,j=0;return n.on("end",function(){S.uri||!S.parts&&!S.preloadHints||(!S.map&&u&&(S.map=u),!S.key&&m&&(S.key=m),S.timeline||"number"!=typeof L||(S.timeline=L),n.manifest.preloadSegment=S)}),n.parseStream.on("data",function(B){var H,q;({tag:function(){({version:function(){B.version&&(this.manifest.version=B.version)},"allow-cache":function(){this.manifest.allowCache=B.allowed,"allowed"in B||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var V={};"length"in B&&((S.byterange=V).length=B.length,"offset"in B||(B.offset=O)),"offset"in B&&((S.byterange=V).offset=B.offset),O=V.offset+V.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),0<B.duration&&(S.duration=B.duration),0===B.duration&&(S.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=T},key:function(){if(B.attributes)if("NONE"!==B.attributes.METHOD)if(B.attributes.URI){if("com.apple.streamingkeydelivery"===B.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:B.attributes});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===B.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(B.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===B.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==B.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):B.attributes.KEYID&&"0x"===B.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:B.attributes.KEYFORMAT,keyId:B.attributes.KEYID.substring(2)},pssh:fu(B.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));B.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),m={method:B.attributes.METHOD||"AES-128",uri:B.attributes.URI},void 0!==B.attributes.IV&&(m.iv=B.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else m=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(B.number)?this.manifest.mediaSequence=B.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+B.number})},"discontinuity-sequence":function(){isFinite(B.number)?(this.manifest.discontinuitySequence=B.number,L=B.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+B.number})},"playlist-type":function(){/VOD|EVENT/.test(B.playlistType)?this.manifest.playlistType=B.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+B.playlist})},map:function(){u={},B.uri&&(u.uri=B.uri),B.byterange&&(u.byterange=B.byterange),m&&(u.key=m)},"stream-inf":function(){this.manifest.playlists=T,this.manifest.mediaGroups=this.manifest.mediaGroups||A,B.attributes?(S.attributes||(S.attributes={}),Z(S.attributes,B.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){var V;this.manifest.mediaGroups=this.manifest.mediaGroups||A,B.attributes&&B.attributes.TYPE&&B.attributes["GROUP-ID"]&&B.attributes.NAME?((V=this.manifest.mediaGroups[B.attributes.TYPE])[B.attributes["GROUP-ID"]]=V[B.attributes["GROUP-ID"]]||{},H=V[B.attributes["GROUP-ID"]],q.autoselect=!!(q={default:/yes/i.test(B.attributes.DEFAULT)}).default||/yes/i.test(B.attributes.AUTOSELECT),B.attributes.LANGUAGE&&(q.language=B.attributes.LANGUAGE),B.attributes.URI&&(q.uri=B.attributes.URI),B.attributes["INSTREAM-ID"]&&(q.instreamId=B.attributes["INSTREAM-ID"]),B.attributes.CHARACTERISTICS&&(q.characteristics=B.attributes.CHARACTERISTICS),B.attributes.FORCED&&(q.forced=/yes/i.test(B.attributes.FORCED)),H[B.attributes.NAME]=q):this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){L+=1,S.discontinuity=!0,this.manifest.discontinuityStarts.push(T.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=B.dateTimeString,this.manifest.dateTimeObject=B.dateTimeObject),S.dateTimeString=B.dateTimeString,S.dateTimeObject=B.dateTimeObject},targetduration:function(){!isFinite(B.duration)||B.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+B.duration}):(this.manifest.targetDuration=B.duration,os.call(this,this.manifest))},start:function(){B.attributes&&!isNaN(B.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:B.attributes["TIME-OFFSET"],precise:B.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){S.cueOut=B.data},"cue-out-cont":function(){S.cueOutCont=B.data},"cue-in":function(){S.cueIn=B.data},skip:function(){this.manifest.skip=oi(B.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",B.attributes,["SKIPPED-SEGMENTS"])},part:function(){var V=this;x=!0;var ee=this.manifest.segments.length,ae=oi(B.attributes);S.parts=S.parts||[],S.parts.push(ae),ae.byterange&&(ae.byterange.hasOwnProperty("offset")||(ae.byterange.offset=j),j=ae.byterange.offset+ae.byterange.length),this.warnOnMissingAttributes_("#EXT-X-PART #"+(S.parts.length-1)+" for segment #"+ee,B.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(ie,he){ie.hasOwnProperty("lastPart")||V.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+he+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var V=this.manifest.serverControl=oi(B.attributes);V.hasOwnProperty("canBlockReload")||(V.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),os.call(this,this.manifest),V.canSkipDateranges&&!V.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var V=this.manifest.segments.length,ee=oi(B.attributes),ae=ee.type&&"PART"===ee.type;S.preloadHints=S.preloadHints||[],S.preloadHints.push(ee),ee.byterange&&(ee.byterange.hasOwnProperty("offset")||(ee.byterange.offset=ae?j:0,ae&&(j=ee.byterange.offset+ee.byterange.length)));var ne=S.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+ne+" for segment #"+V,B.attributes,["TYPE","URI"]),ee.type)for(var ie=0;ie<S.preloadHints.length-1;ie++){var he=S.preloadHints[ie];he.type&&he.type===ee.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+ne+" for segment #"+V+" has the same TYPE "+ee.type+" as preload hint #"+ie})}},"rendition-report":function(){var V=oi(B.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(V);var ee=this.manifest.renditionReports.length-1;V=["LAST-MSN","URI"],x&&V.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+ee,B.attributes,V)},"part-inf":function(){this.manifest.partInf=oi(B.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",B.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),os.call(this,this.manifest)}}[B.tagType]||function(){}).call(y)},uri:function(){S.uri=B.uri,T.push(S),!this.manifest.targetDuration||"duration"in S||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),S.duration=this.manifest.targetDuration),m&&(S.key=m),S.timeline=L,u&&(S.map=u),j=0,S={}},comment:function(){},custom:function(){B.segment?(S.custom=S.custom||{},S.custom[B.customType]=B.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[B.customType]=B.data)}})[B.type].call(y)}),n}ge(p,s);var h=p.prototype;return h.warnOnMissingAttributes_=function(n,u,m){var y=[];m.forEach(function(T){u.hasOwnProperty(T)||y.push(T)}),y.length&&this.trigger("warn",{message:n+" lacks required attribute(s): "+y.join(", ")})},h.push=function(n){this.lineStream.push(n)},h.end=function(){this.lineStream.push("\n"),this.trigger("end")},h.addParser=function(n){this.parseStream.addParser(n)},h.addTagMapper=function(n){this.parseStream.addTagMapper(n)},p}(Gt),Va={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},Wh=["video","audio","text"],vu=["Video","Audio","Text"],Tu="mp4a.40.2",zh=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,qh=/^application\/dash\+xml/i,Eu="http://example.com";function ds(s,p){return(p=void 0===p?Object:p)&&"function"==typeof p.freeze?p.freeze(s):s}var Su=ds({HTML:"text/html",isHTML:function(s){return s===Su.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Cu=ds({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(s){return s===Cu.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}),Lr={freeze:ds,MIME_TYPE:Su,NAMESPACE:Cu},Ki=Lr.NAMESPACE;function Xh(s){return""!==s}function Yh(s,p){return s.hasOwnProperty(p)||(s[p]=!0),s}function bu(s){return s?(s=(s=s)?s.split(/[\t\n\f\r ]+/).filter(Xh):[],Object.keys(s.reduce(Yh,{}))):[]}function Hi(s,p){for(var h in s)p[h]=s[h]}function Wt(s,p){var h,n=s.prototype;n instanceof p||((h=function(){}).prototype=p.prototype,Hi(n,h=new h),s.prototype=n=h),n.constructor!=s&&(n.constructor=s)}var Du,ia=(tt={}).ELEMENT_NODE=1,ui=tt.ATTRIBUTE_NODE=2,Nr=tt.TEXT_NODE=3,Pu=tt.CDATA_SECTION_NODE=4,Au=tt.ENTITY_REFERENCE_NODE=5,Iu=(tt.ENTITY_NODE=6,tt.PROCESSING_INSTRUCTION_NODE=7),xu=tt.COMMENT_NODE=8,Mu=tt.DOCUMENT_NODE=9,wu=tt.DOCUMENT_TYPE_NODE=10,Ta=tt.DOCUMENT_FRAGMENT_NODE=11,Ct=(tt.NOTATION_NODE=12,Se={},{});function Ga(s,p){var h;return p instanceof Error?h=p:(h=this,Error.call(this,Ct[s]),this.message=Ct[s],Error.captureStackTrace&&Error.captureStackTrace(this,Ga)),h.code=s,p&&(this.message=this.message+": "+p),h}function Ea(){}function li(s,p){this._node=s,this._refresh=p,hs(this)}function hs(s){var p,h=s._node._inc||s._node.ownerDocument._inc;s._inc!=h&&(p=s._refresh(s._node),Wu(s,"length",p.length),Hi(p,s),s._inc=h)}function Or(){}function Ru(s,p){for(var h=s.length;h--;)if(s[h]===p)return h}function Lu(s,p,h,n){n?p[Ru(p,n)]=h:p[p.length++]=h,!s||(p=(h.ownerElement=s).ownerDocument)&&(n&&Bu(p,s,n),s=s,h=h,(p=p)&&p._inc++,h.namespaceURI===Ki.XMLNS&&(s._nsMap[h.prefix?h.localName:""]=h.value))}function Nu(s,p,h){var n=Ru(p,h);if(!(0<=n))throw Ga(8,new Error(s.tagName+"@"+h));for(var u,m=p.length-1;n<m;)p[n]=p[++n];p.length=m,!s||(u=s.ownerDocument)&&(Bu(u,s,h),h.ownerElement=null)}function Ou(){}function Rt(){}function Uu(s){return("<"==s?"&lt;":">"==s&&"&gt;")||"&"==s&&"&amp;"||'"'==s&&"&quot;"||"&#"+s.charCodeAt()+";"}function Wi(s,p){if(p(s))return 1;if(s=s.firstChild)do{if(Wi(s,p))return 1}while(s=s.nextSibling)}function zi(){}function Bu(s,p,h){s&&s._inc++,h.namespaceURI===Ki.XMLNS&&delete p._nsMap[h.prefix?h.localName:""]}function cs(s,p,h){if(s&&s._inc){s._inc++;var n=p.childNodes;if(h)n[n.length++]=h;else{for(var u=p.firstChild,m=0;u;)u=(n[m++]=u).nextSibling;n.length=m}}}function Fu(s,p){var h=p.previousSibling,n=p.nextSibling;return h?h.nextSibling=n:s.firstChild=n,n?n.previousSibling=h:s.lastChild=h,cs(s.ownerDocument,s),p}function ju(s,p,h){var n=p.parentNode;if(n&&n.removeChild(p),p.nodeType===Ta){var u=p.firstChild;if(null==u)return p;var m=p.lastChild}else u=m=p;for(u.previousSibling=n=h?h.previousSibling:s.lastChild,m.nextSibling=h,n?n.nextSibling=u:s.firstChild=u,null==h?s.lastChild=m:h.previousSibling=m;u.parentNode=s,u!==m&&(u=u.nextSibling););return cs(s.ownerDocument||s,s),p.nodeType==Ta&&(p.firstChild=p.lastChild=null),p}function di(){this._nsMap={}}function Ur(){}function qi(){}function ps(){}function ms(){}function gs(){}function Br(){}function $u(){}function Vu(){}function fs(){}function Fr(){}function ys(){}function Gu(){}function Ku(s,p){var h,n=[],u=9==this.nodeType&&this.documentElement||this,m=u.prefix,y=u.namespaceURI;return hi(this,n,s,p,h=y&&null==m&&null==(m=u.lookupPrefix(y))?[{namespace:y,prefix:null}]:h),n.join("")}function Hu(s,p,h){var n=s.prefix||"",u=s.namespaceURI;if(u&&("xml"!==n||u!==Ki.XML)&&u!==Ki.XMLNS){for(var m=h.length;m--;){var y=h[m];if(y.prefix===n)return y.namespace!==u}return 1}}function _s(s,p,h){s.push(" ",p,'="',h.replace(/[<&"]/g,Uu),'"')}function hi(s,p,h,n,u){if(u=u||[],n){if(!(s=n(s)))return;if("string"==typeof s)return void p.push(s)}switch(s.nodeType){case ia:var H,q,V,m=s.attributes,y=m.length,T=s.firstChild,S=s.tagName,x=S;if(!(h=Ki.isHTML(s.namespaceURI)||h)&&!s.prefix&&s.namespaceURI){for(var A,L=0;L<m.length;L++)if("xmlns"===m.item(L).name){A=m.item(L).value;break}if(!A)for(var O=u.length-1;0<=O;O--)if(""===(j=u[O]).prefix&&j.namespace===s.namespaceURI){A=j.namespace;break}var j;if(A!==s.namespaceURI)for(O=u.length-1;0<=O;O--)if((j=u[O]).namespace===s.namespaceURI){j.prefix&&(x=j.prefix+":"+S);break}}p.push("<",x);for(var B=0;B<y;B++)"xmlns"==(H=m.item(B)).prefix?u.push({prefix:H.localName,namespace:H.value}):"xmlns"==H.nodeName&&u.push({prefix:"",namespace:H.value});for(B=0;B<y;B++)Hu(H=m.item(B),0,u)&&(_s(p,(q=H.prefix||"")?"xmlns:"+q:"xmlns",V=H.namespaceURI),u.push({prefix:q,namespace:V})),hi(H,p,h,n,u);if(S===x&&Hu(s,0,u)&&(_s(p,(q=s.prefix||"")?"xmlns:"+q:"xmlns",V=s.namespaceURI),u.push({prefix:q,namespace:V})),T||h&&!/^(?:meta|link|img|br|hr|input)$/i.test(S)){if(p.push(">"),h&&/^script$/i.test(S))for(;T;)T.data?p.push(T.data):hi(T,p,h,n,u.slice()),T=T.nextSibling;else for(;T;)hi(T,p,h,n,u.slice()),T=T.nextSibling;p.push("</",x,">")}else p.push("/>");return;case Mu:case Ta:for(T=s.firstChild;T;)hi(T,p,h,n,u.slice()),T=T.nextSibling;return;case ui:return _s(p,s.name,s.value),0;case Nr:return p.push(s.data.replace(/[<&]/g,Uu).replace(/]]>/g,"]]&gt;"));case Pu:return p.push("<![CDATA[",s.data,"]]>");case xu:return p.push("\x3c!--",s.data,"--\x3e");case wu:var ee=s.publicId,ae=s.systemId;return p.push("<!DOCTYPE ",s.name),void(ee?(p.push(" PUBLIC ",ee),ae&&"."!=ae&&p.push(" ",ae),p.push(">")):ae&&"."!=ae?p.push(" SYSTEM ",ae,">"):((ae=s.internalSubset)&&p.push(" [",ae,"]"),p.push(">")));case Iu:return p.push("<?",s.target," ",s.data,"?>");case Au:return p.push("&",s.nodeName,";");default:p.push("??",s.nodeName)}}function Wu(s,p,h){s[p]=h}Se.INDEX_SIZE_ERR=(Ct[1]="Index size error",1),Se.DOMSTRING_SIZE_ERR=(Ct[2]="DOMString size error",2),Se.HIERARCHY_REQUEST_ERR=(Ct[3]="Hierarchy request error",3),Se.WRONG_DOCUMENT_ERR=(Ct[4]="Wrong document",4),Se.INVALID_CHARACTER_ERR=(Ct[5]="Invalid character",5),Se.NO_DATA_ALLOWED_ERR=(Ct[6]="No data allowed",6),Se.NO_MODIFICATION_ALLOWED_ERR=(Ct[7]="No modification allowed",7),Se.NOT_FOUND_ERR=(Ct[8]="Not found",8),Se.NOT_SUPPORTED_ERR=(Ct[9]="Not supported",9),Se.INUSE_ATTRIBUTE_ERR=(Ct[10]="Attribute in use",10),Se.INVALID_STATE_ERR=(Ct[11]="Invalid state",11),Se.SYNTAX_ERR=(Ct[12]="Syntax error",12),Se.INVALID_MODIFICATION_ERR=(Ct[13]="Invalid modification",13),Se.NAMESPACE_ERR=(Ct[14]="Invalid namespace",14),Se.INVALID_ACCESS_ERR=(Ct[15]="Invalid access",15),Ga.prototype=Error.prototype,Hi(Se,Ga),Ea.prototype={length:0,item:function(s){return this[s]||null},toString:function(s,p){for(var h=[],n=0;n<this.length;n++)hi(this[n],h,s,p);return h.join("")}},li.prototype.item=function(s){return hs(this),this[s]},Wt(li,Ea),Or.prototype={length:0,item:Ea.prototype.item,getNamedItem:function(s){for(var p=this.length;p--;){var h=this[p];if(h.nodeName==s)return h}},setNamedItem:function(s){var p=s.ownerElement;if(p&&p!=this._ownerElement)throw new Ga(10);return p=this.getNamedItem(s.nodeName),Lu(this._ownerElement,this,s,p),p},setNamedItemNS:function(s){var p=s.ownerElement;if(p&&p!=this._ownerElement)throw new Ga(10);return p=this.getNamedItemNS(s.namespaceURI,s.localName),Lu(this._ownerElement,this,s,p),p},removeNamedItem:function(s){return s=this.getNamedItem(s),Nu(this._ownerElement,this,s),s},removeNamedItemNS:function(s,p){return p=this.getNamedItemNS(s,p),Nu(this._ownerElement,this,p),p},getNamedItemNS:function(s,p){for(var h=this.length;h--;){var n=this[h];if(n.localName==p&&n.namespaceURI==s)return n}return null}},Ou.prototype={hasFeature:function(s,p){return!0},createDocument:function(s,p,h){var n=new zi;return n.implementation=this,n.childNodes=new Ea,n.doctype=h||null,h&&n.appendChild(h),p&&(p=n.createElementNS(s,p),n.appendChild(p)),n},createDocumentType:function(s,p,h){var n=new Br;return n.name=s,n.nodeName=s,n.publicId=p||"",n.systemId=h||"",n}},Rt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(s,p){return ju(this,s,p)},replaceChild:function(s,p){this.insertBefore(s,p),p&&this.removeChild(p)},removeChild:function(s){return Fu(this,s)},appendChild:function(s){return this.insertBefore(s,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(s){return function p(h,n,u){var m=new n.constructor;for(var y in n){var T=n[y];"object"!=typeof T&&T!=m[y]&&(m[y]=T)}switch(n.childNodes&&(m.childNodes=new Ea),m.ownerDocument=h,m.nodeType){case ia:var S=n.attributes,x=m.attributes=new Or,A=S.length;x._ownerElement=m;for(var L=0;L<A;L++)m.setAttributeNode(p(h,S.item(L),!0));break;case ui:u=!0}if(u)for(var O=n.firstChild;O;)m.appendChild(p(h,O,u)),O=O.nextSibling;return m}(this.ownerDocument||this,this,s)},normalize:function(){for(var s=this.firstChild;s;){var p=s.nextSibling;p&&p.nodeType==Nr&&s.nodeType==Nr?(this.removeChild(p),s.appendData(p.data)):(s.normalize(),s=p)}},isSupported:function(s,p){return this.ownerDocument.implementation.hasFeature(s,p)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(s){for(var p=this;p;){var h=p._nsMap;if(h)for(var n in h)if(h[n]==s)return n;p=p.nodeType==ui?p.ownerDocument:p.parentNode}return null},lookupNamespaceURI:function(s){for(var p=this;p;){var h=p._nsMap;if(h&&s in h)return h[s];p=p.nodeType==ui?p.ownerDocument:p.parentNode}return null},isDefaultNamespace:function(s){return null==this.lookupPrefix(s)}},Hi(tt,Rt),Hi(tt,Rt.prototype),zi.prototype={nodeName:"#document",nodeType:Mu,doctype:null,documentElement:null,_inc:1,insertBefore:function(s,p){if(s.nodeType!=Ta)return null==this.documentElement&&s.nodeType==ia&&(this.documentElement=s),ju(this,s,p),s.ownerDocument=this,s;for(var h=s.firstChild;h;){var n=h.nextSibling;this.insertBefore(h,p),h=n}return s},removeChild:function(s){return this.documentElement==s&&(this.documentElement=null),Fu(this,s)},importNode:function(s,p){return function h(n,u,m){var y;switch(u.nodeType){case ia:(y=u.cloneNode(!1)).ownerDocument=n;case Ta:break;case ui:m=!0}if((y=y||u.cloneNode(!1)).ownerDocument=n,y.parentNode=null,m)for(var T=u.firstChild;T;)y.appendChild(h(n,T,m)),T=T.nextSibling;return y}(this,s,p)},getElementById:function(s){var p=null;return Wi(this.documentElement,function(h){if(h.nodeType==ia&&h.getAttribute("id")==s)return p=h,!0}),p},getElementsByClassName:function(s){var p=bu(s);return new li(this,function(h){var n=[];return 0<p.length&&Wi(h.documentElement,function(u){var m,y,T;u===h||u.nodeType!==ia||(m=u.getAttribute("class"))&&((y=s===m)||(m=bu(m),y=p.every((T=m,function(S){return T&&-1!==T.indexOf(S)}))),y&&n.push(u))}),n})},createElement:function(s){var p=new di;return p.ownerDocument=this,p.nodeName=s,p.tagName=s,p.localName=s,p.childNodes=new Ea,(p.attributes=new Or)._ownerElement=p},createDocumentFragment:function(){var s=new Fr;return s.ownerDocument=this,s.childNodes=new Ea,s},createTextNode:function(s){var p=new ps;return p.ownerDocument=this,p.appendData(s),p},createComment:function(s){var p=new ms;return p.ownerDocument=this,p.appendData(s),p},createCDATASection:function(s){var p=new gs;return p.ownerDocument=this,p.appendData(s),p},createProcessingInstruction:function(s,p){var h=new ys;return h.ownerDocument=this,h.tagName=h.target=s,h.nodeValue=h.data=p,h},createAttribute:function(s){var p=new Ur;return p.ownerDocument=this,p.name=s,p.nodeName=s,p.localName=s,p.specified=!0,p},createEntityReference:function(s){var p=new fs;return p.ownerDocument=this,p.nodeName=s,p},createElementNS:function(s,p){var h=new di,n=p.split(":"),u=h.attributes=new Or;return h.childNodes=new Ea,h.ownerDocument=this,h.nodeName=p,h.tagName=p,h.namespaceURI=s,2==n.length?(h.prefix=n[0],h.localName=n[1]):h.localName=p,u._ownerElement=h},createAttributeNS:function(s,p){var h=new Ur,n=p.split(":");return h.ownerDocument=this,h.nodeName=p,h.name=p,h.namespaceURI=s,h.specified=!0,2==n.length?(h.prefix=n[0],h.localName=n[1]):h.localName=p,h}},Wt(zi,Rt),zi.prototype.getElementsByTagName=(di.prototype={nodeType:ia,hasAttribute:function(s){return null!=this.getAttributeNode(s)},getAttribute:function(s){return(s=this.getAttributeNode(s))&&s.value||""},getAttributeNode:function(s){return this.attributes.getNamedItem(s)},setAttribute:function(s,p){(s=this.ownerDocument.createAttribute(s)).value=s.nodeValue=""+p,this.setAttributeNode(s)},removeAttribute:function(s){(s=this.getAttributeNode(s))&&this.removeAttributeNode(s)},appendChild:function(s){return s.nodeType===Ta?this.insertBefore(s,null):function(p,h){var n=h.parentNode;n&&(u=p.lastChild,n.removeChild(h),u=p.lastChild);var u=p.lastChild;return h.parentNode=p,h.previousSibling=u,h.nextSibling=null,u?u.nextSibling=h:p.firstChild=h,p.lastChild=h,cs(p.ownerDocument,p,h),h}(this,s)},setAttributeNode:function(s){return this.attributes.setNamedItem(s)},setAttributeNodeNS:function(s){return this.attributes.setNamedItemNS(s)},removeAttributeNode:function(s){return this.attributes.removeNamedItem(s.nodeName)},removeAttributeNS:function(s,p){(p=this.getAttributeNodeNS(s,p))&&this.removeAttributeNode(p)},hasAttributeNS:function(s,p){return null!=this.getAttributeNodeNS(s,p)},getAttributeNS:function(s,p){return(p=this.getAttributeNodeNS(s,p))&&p.value||""},setAttributeNS:function(s,p,h){(p=this.ownerDocument.createAttributeNS(s,p)).value=p.nodeValue=""+h,this.setAttributeNode(p)},getAttributeNodeNS:function(s,p){return this.attributes.getNamedItemNS(s,p)},getElementsByTagName:function(s){return new li(this,function(p){var h=[];return Wi(p,function(n){n===p||n.nodeType!=ia||"*"!==s&&n.tagName!=s||h.push(n)}),h})},getElementsByTagNameNS:function(s,p){return new li(this,function(h){var n=[];return Wi(h,function(u){u===h||u.nodeType!==ia||"*"!==s&&u.namespaceURI!==s||"*"!==p&&u.localName!=p||n.push(u)}),n})}}).getElementsByTagName,zi.prototype.getElementsByTagNameNS=di.prototype.getElementsByTagNameNS,Wt(di,Rt),Ur.prototype.nodeType=ui,Wt(Ur,Rt),qi.prototype={data:"",substringData:function(s,p){return this.data.substring(s,s+p)},appendData:function(s){this.nodeValue=this.data=s=this.data+s,this.length=s.length},insertData:function(s,p){this.replaceData(s,0,p)},appendChild:function(s){throw new Error(Ct[3])},deleteData:function(s,p){this.replaceData(s,p,"")},replaceData:function(s,p,h){var n=this.data.substring(0,s);p=this.data.substring(s+p),this.nodeValue=this.data=h=n+h+p,this.length=h.length}},Wt(qi,Rt),ps.prototype={nodeName:"#text",nodeType:Nr,splitText:function(s){var p=(h=this.data).substring(s),h=h.substring(0,s);return this.data=this.nodeValue=h,this.length=h.length,p=this.ownerDocument.createTextNode(p),this.parentNode&&this.parentNode.insertBefore(p,this.nextSibling),p}},Wt(ps,qi),ms.prototype={nodeName:"#comment",nodeType:xu},Wt(ms,qi),gs.prototype={nodeName:"#cdata-section",nodeType:Pu},Wt(gs,qi),Br.prototype.nodeType=wu,Wt(Br,Rt),$u.prototype.nodeType=12,Wt($u,Rt),Vu.prototype.nodeType=6,Wt(Vu,Rt),fs.prototype.nodeType=Au,Wt(fs,Rt),Fr.prototype.nodeName="#document-fragment",Fr.prototype.nodeType=Ta,Wt(Fr,Rt),ys.prototype.nodeType=Iu,Wt(ys,Rt),Gu.prototype.serializeToString=function(s,p,h){return Ku.call(s,p,h)},Rt.prototype.toString=Ku;try{Object.defineProperty&&(Du=function s(p){switch(p.nodeType){case ia:case Ta:var h=[];for(p=p.firstChild;p;)7!==p.nodeType&&8!==p.nodeType&&h.push(s(p)),p=p.nextSibling;return h.join("");default:return p.nodeValue}},Object.defineProperty(li.prototype,"length",{get:function(){return hs(this),this.$$length}}),Object.defineProperty(Rt.prototype,"textContent",{get:function(){return Du(this)},set:function(s){switch(this.nodeType){case ia:case Ta:for(;this.firstChild;)this.removeChild(this.firstChild);(s||String(s))&&this.appendChild(this.ownerDocument.createTextNode(s));break;default:this.data=s,this.value=s,this.nodeValue=s}}}),Wu=function(s,p,h){s["$$"+p]=h})}catch(s){}Qe={DocumentType:Br,DOMException:Ga,DOMImplementation:Ou,Element:di,Node:Rt,NodeList:Ea,XMLSerializer:Gu};var Xi=z(function(s,p){var h=Lr.freeze;p.XML_ENTITIES=h({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),p.HTML_ENTITIES=h({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",times:"\xd7",divide:"\xf7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",euro:"\u20ac",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),p.entityMap=p.HTML_ENTITIES}),Yi=Lr.NAMESPACE,zu=(da=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Gt=new RegExp("[\\-\\.0-9"+da.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),new RegExp("^"+da.source+Gt.source+"*(?::"+da.source+Gt.source+"*)?$"));function er(s,p){this.message=s,this.locator=p,Error.captureStackTrace&&Error.captureStackTrace(this,er)}function qu(){}function Xu(s,p){return p.lineNumber=s.lineNumber,p.columnNumber=s.columnNumber,p}function Yu(s,p,h){for(var n=s.tagName,u=null,m=s.length;m--;){var y=s[m],S=y.value,T=0<(A=(T=y.qName).indexOf(":"))?(x=y.prefix=T.slice(0,A),L=T.slice(A+1),"xmlns"===x&&L):(x=null,"xmlns"===(L=T)&&"");y.localName=L,!1!==T&&(null==u&&(u={},Qu(h,h={})),h[T]=u[T]=S,y.uri=Yi.XMLNS,p.startPrefixMapping(T,S))}var x;for(m=s.length;m--;)(x=(y=s[m]).prefix)&&("xml"===x&&(y.uri=Yi.XML),"xmlns"!==x&&(y.uri=h[x||""]));var A,L=0<(A=n.indexOf(":"))?(x=s.prefix=n.slice(0,A),s.localName=n.slice(A+1)):(x=null,s.localName=n),O=s.uri=h[x||""];if(p.startElement(O,L,n,s),!s.closed)return s.currentNSMap=h,s.localNSMap=u,1;if(p.endElement(O,L,n),u)for(x in u)p.endPrefixMapping(x)}function Qu(s,p){for(var h in s)p[h]=s[h]}function Ju(){this.attributeNames={}}(er.prototype=new Error).name=er.name,qu.prototype={parse:function(s,p,h){var n=this.domBuilder;n.startDocument(),Qu(p,p={}),function(u,m,y,T,S){function x(Ce){var pe=Ce.slice(1,-1);return pe in y?y[pe]:"#"===pe.charAt(0)?65535<(pe=parseInt(pe.substr(1).replace("x","0x")))?(pe-=65536,String.fromCharCode(55296+(pe>>10),56320+(1023&pe))):String.fromCharCode(pe):(S.error("entity not found:"+Ce),Ce)}function A(Ce){var pe;ee<Ce&&(pe=u.substring(ee,Ce).replace(/&#?\w+;/g,x),H&&L(ee),T.characters(pe,0,Ce-ee),ee=Ce)}function L(Ce,pe){for(;j<=Ce&&(pe=B.exec(u));)j=(O=pe.index)+pe[0].length,H.lineNumber++;H.columnNumber=Ce-O+1}for(var O=0,j=0,B=/.*(?:\r\n?|\n)|.*$/g,H=T.locator,q=[{currentNSMap:m}],V={},ee=0;;){try{var ae,ne,ie=u.indexOf("<",ee);if(ie<0)return u.substr(ee).match(/^\s*$/)||(ne=(ae=T.doc).createTextNode(u.substr(ee)),ae.appendChild(ne),T.currentElement=ne);switch(ee<ie&&A(ie),u.charAt(ie+1)){case"/":var he=u.indexOf(">",ie+3),ke=u.substring(ie+2,he).replace(/[ \t\n\r]+$/g,""),ve=q.pop();he<0?(ke=u.substring(ie+2).replace(/[\s<].*/,""),S.error("end tag name: "+ke+" is not complete:"+ve.tagName),he=ie+1+ke.length):ke.match(/\s</)&&(ke=ke.replace(/[\s<].*/,""),S.error("end tag name: "+ke+" maybe not complete"),he=ie+1+ke.length);var Ee=ve.localNSMap,xe=ve.tagName==ke;if(xe||ve.tagName&&ve.tagName.toLowerCase()==ke.toLowerCase()){if(T.endElement(ve.uri,ve.localName,ke),Ee)for(var Ne in Ee)T.endPrefixMapping(Ne);xe||S.fatalError("end tag name: "+ke+" is not match the current start tagName:"+ve.tagName)}else q.push(ve);he++;break;case"?":H&&L(ie),ze=T,void 0,he=(it=(Ce=u).indexOf("?>",pe=ie))&&(pe=Ce.substring(pe,it).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/))?(ze.processingInstruction(pe[1],pe[2]),it+2):-1;break;case"!":H&&L(ie),he=function(Ce,pe,ze,it){if("-"===Ce.charAt(pe+2)){if("-"!==Ce.charAt(pe+3))return-1;var lt=Ce.indexOf("--\x3e",pe+4);return pe<lt?(ze.comment(Ce,pe+4,lt-pe-4),lt+3):(it.error("Unclosed comment"),-1)}if("CDATA["==Ce.substr(pe+3,6))return lt=Ce.indexOf("]]>",pe+9),ze.startCDATA(),ze.characters(Ce,pe+9,lt-pe-9),ze.endCDATA(),lt+3;var rt=function(gt,st){var Pe,sa=[],ot=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(ot.lastIndex=st,ot.exec(gt);Pe=ot.exec(gt);)if(sa.push(Pe),Pe[1])return sa}(Ce,pe);return 1<(it=rt.length)&&/!doctype/i.test(rt[0][0])?(lt=rt[1][0],Ce=!1,pe=!1,3<it&&(/^public$/i.test(rt[2][0])?(Ce=rt[3][0],pe=4<it&&rt[4][0]):/^system$/i.test(rt[2][0])&&(pe=rt[3][0])),it=rt[it-1],ze.startDTD(lt,Ce,pe),ze.endDTD(),it.index+it[0].length):-1}(u,ie,T,S);break;default:H&&L(ie);var Be=new Ju,Ge=q[q.length-1].currentNSMap,Oe=(he=function(Ce,pe,ze,it,lt,rt){function nt(Ci,un,Ys){ze.attributeNames.hasOwnProperty(Ci)&&rt.fatalError("Attribute "+Ci+" redefined"),ze.addValue(Ci,un,Ys)}for(var gt,st=++pe,Pe=0;;){var sa=Ce.charAt(st);switch(sa){case"=":if(1===Pe)gt=Ce.slice(pe,st),Pe=3;else{if(2!==Pe)throw new Error("attribute equal must after attrName");Pe=3}break;case"'":case'"':if(3===Pe||1===Pe){if(1===Pe&&(rt.warning('attribute value must after "="'),gt=Ce.slice(pe,st)),!(0<(st=Ce.indexOf(sa,pe=st+1))))throw new Error("attribute value no end '"+sa+"' match");nt(gt,ot=Ce.slice(pe,st).replace(/&#?\w+;/g,lt),pe-1),Pe=5}else{if(4!=Pe)throw new Error('attribute value must after "="');nt(gt,ot=Ce.slice(pe,st).replace(/&#?\w+;/g,lt),pe),rt.warning('attribute "'+gt+'" missed start quot('+sa+")!!"),pe=st+1,Pe=5}break;case"/":switch(Pe){case 0:ze.setTagName(Ce.slice(pe,st));case 5:case 6:case 7:Pe=7,ze.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return rt.error("unexpected end of input"),0==Pe&&ze.setTagName(Ce.slice(pe,st)),st;case">":switch(Pe){case 0:ze.setTagName(Ce.slice(pe,st));case 5:case 6:case 7:break;case 4:case 1:"/"===(ot=Ce.slice(pe,st)).slice(-1)&&(ze.closed=!0,ot=ot.slice(0,-1));case 2:2===Pe&&(ot=gt),4==Pe?(rt.warning('attribute "'+ot+'" missed quot(")!'),nt(gt,ot.replace(/&#?\w+;/g,lt),pe)):(Yi.isHTML(it[""])&&ot.match(/^(?:disabled|checked|selected)$/i)||rt.warning('attribute "'+ot+'" missed value!! "'+ot+'" instead!!'),nt(ot,ot,pe));break;case 3:throw new Error("attribute value missed!!")}return st;case"\x80":sa=" ";default:if(sa<=" ")switch(Pe){case 0:ze.setTagName(Ce.slice(pe,st)),Pe=6;break;case 1:gt=Ce.slice(pe,st),Pe=2;break;case 4:var ot=Ce.slice(pe,st).replace(/&#?\w+;/g,lt);rt.warning('attribute "'+ot+'" missed quot(")!!'),nt(gt,ot,pe);case 5:Pe=6}else switch(Pe){case 2:Yi.isHTML(it[""])&&gt.match(/^(?:disabled|checked|selected)$/i)||rt.warning('attribute "'+gt+'" missed value!! "'+gt+'" instead2!!'),nt(gt,gt,pe),pe=st,Pe=1;break;case 5:rt.warning('attribute space is required"'+gt+'"!!');case 6:Pe=1,pe=st;break;case 3:Pe=4,pe=st;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}st++}}(u,ie,Be,Ge,x,S),Be.length);if(!Be.closed&&function(Ce,pe,ze,it){var lt=it[ze];return null==lt&&((lt=Ce.lastIndexOf("</"+ze+">"))<pe&&(lt=Ce.lastIndexOf("</"+ze)),it[ze]=lt),lt<pe}(u,he,Be.tagName,V)&&(Be.closed=!0,y.nbsp||S.warning("unclosed xml attribute")),H&&Oe){for(var Tt=Xu(H,{}),Pt=0;Pt<Oe;Pt++){var Qt=Be[Pt];L(Qt.offset),Qt.locator=Xu(H,{})}T.locator=Tt,Yu(Be,T,Ge)&&q.push(Be),T.locator=H}else Yu(Be,T,Ge)&&q.push(Be);Yi.isHTML(Be.uri)&&!Be.closed?he=function(Ce,pe,ze,it,lt){if(/^(?:script|textarea)$/i.test(ze)){var rt=Ce.indexOf("</"+ze+">",pe);if(Ce=Ce.substring(pe+1,rt),/[&<]/.test(Ce))return/^script$/i.test(ze)||(Ce=Ce.replace(/&#?\w+;/g,it)),lt.characters(Ce,0,Ce.length),rt}return pe+1}(u,he,Be.tagName,x,T):he++}}catch(Ce){if(Ce instanceof er)throw Ce;S.error("element parse error: "+Ce),he=-1}ee<he?ee=he:A(Math.max(ie,ee)+1)}var Ce,pe,ze,it}(s,p,h,n,this.errorHandler),n.endDocument()}},Ju.prototype={setTagName:function(s){if(!zu.test(s))throw new Error("invalid tagName:"+s);this.tagName=s},addValue:function(s,p,h){if(!zu.test(s))throw new Error("invalid attribute:"+s);this.attributeNames[s]=this.length,this[this.length++]={qName:s,value:p,offset:h}},length:0,getLocalName:function(s){return this[s].localName},getLocator:function(s){return this[s].locator},getQName:function(s){return this[s].qName},getURI:function(s){return this[s].uri},getValue:function(s){return this[s].value}};var Qh=Qe.DOMImplementation,Zu=Lr.NAMESPACE,Jh=(Se={XMLReader:qu,ParseError:er}).ParseError,Zh=Se.XMLReader;function el(s){this.options=s||{locator:{}}}function tr(){this.cdata=!1}function gi(s,p){p.lineNumber=s.lineNumber,p.columnNumber=s.columnNumber}function tl(s,p,h){return"string"==typeof s?s.substr(p,h):s.length>=p+h||p?new java.lang.String(s,p,h)+"":s}function $r(s,p){(s.currentElement||s.doc).appendChild(p)}function al(s){return!!s&&"object"==typeof s}function Lt(){for(var s=arguments.length,p=new Array(s),h=0;h<s;h++)p[h]=arguments[h];return p.reduce(function(n,u){return"object"!=typeof u||Object.keys(u).forEach(function(m){n[m]=Array.isArray(n[m])&&Array.isArray(u[m])?n[m].concat(u[m]):al(n[m])&&al(u[m])?Lt(n[m],u[m]):u[m]}),n},{})}function Vr(s){return s.reduce(function(p,h){return p.concat(h)},[])}function il(s){if(!s.length)return[];for(var p=[],h=0;h<s.length;h++)p.push(s[h]);return p}function ar(s){var p=s.baseUrl,h=void 0===(n=s.source)?"":n,n=void 0===(n=s.range)?"":n;return s=void 0===(s=s.indexRange)?"":s,h={uri:h,resolvedUri:ls((void 0===p?"":p)||"",h)},(n||s)&&(n=(n||s).split("-"),s=parseInt(n[0],10),n=parseInt(n[1],10),h.byterange={length:n-s+1,offset:s}),h}function rl(s){return s&&"number"!=typeof s&&(s=parseInt(s,10)),isNaN(s)?null:s}function ks(s){var p,h=s.type,n=s.duration,u=s.timescale,m=void 0===u?1:u,y=s.periodDuration,T=s.sourceDuration;return s=function(S,x){for(var A=[],L=S;L<x;L++)A.push(L);return A}((u=Ec[h](s)).start,u.end).map((p=s,function(S,x){var A=p.duration,L=p.timescale,j=p.startNumber;return{number:(void 0===j?1:j)+S,duration:A/(void 0===L?1:L),timeline:p.periodIndex,time:x*A}})),"static"===h&&(s[h=s.length-1].duration=("number"==typeof y?y:T)-n/m*h),s}function nl(s){var p=s.baseUrl,h=void 0===(u=s.initialization)?{}:u,n=s.sourceDuration,u=void 0===(m=s.indexRange)?"":m,m=s.duration;if(!p)throw new Error(kc);return h=ar({baseUrl:p,source:h.sourceURL,range:h.range}),(u=ar({baseUrl:p,source:p,indexRange:u})).map=h,m?(s=ks(s)).length&&(u.duration=s[0].duration,u.timeline=s[0].timeline):n&&(u.duration=n,u.timeline=0),u.number=0,[u]}function vs(s,p,h){for(var n=s.sidx.map||null,u=s.sidx.duration,m=s.timeline||0,y=(y=s.sidx.byterange).offset+y.length,T=p.timescale,S=p.references.filter(function(H){return 1!==H.referenceType}),x=[],A=s.endList?"static":"dynamic",L=y+p.firstOffset,O=0;O<S.length;O++){var B=(j=p.references[O]).referencedSize,j=nl({baseUrl:h,timescale:T,timeline:m,periodIndex:m,duration:j=j.subsegmentDuration,sourceDuration:u,indexRange:L+"-"+(L+B-1),type:A})[0];n&&(j.map=n),x.push(j),L+=B}return s.segments=x,s}function Gr(s){return s&&s.uri+"-"+(p=s.byterange).offset+"-"+(p.offset+p.length-1);var p}function sl(s){var p;return(p=s.reduce(function(h,n){var u,m=n.attributes.id+(n.attributes.lang||"");return h[m]?(n.segments[0]&&(n.segments[0].discontinuity=!0),(u=h[m].segments).push.apply(u,n.segments),n.attributes.contentProtection&&(h[m].attributes.contentProtection=n.attributes.contentProtection)):h[m]=n,h},{}),Object.keys(p).map(function(h){return p[h]})).map(function(h){return h.discontinuityStarts=h.segments.reduce(function(m,y,T){return y.discontinuity&&m.push(T),m},[]),h})}function Ts(s,p){var h=Gr(s.sidx);return(h=h&&p[h]&&p[h].sidx)&&vs(s,h,s.sidx.resolvedUri),s}function ac(s){var p=s.attributes,h=s.segments,n=s.sidx;return h={attributes:((s={NAME:p.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:p.width,height:p.height},CODECS:p.codecs,BANDWIDTH:p.bandwidth})["PROGRAM-ID"]=1,s),uri:"",endList:"static"===p.type,timeline:p.periodIndex,resolvedUri:"",targetDuration:p.duration,segments:h,mediaSequence:h.length?h[0].number:1},p.contentProtection&&(h.contentProtection=p.contentProtection),n&&(h.sidx=n),h}function ic(s){return"video/mp4"===(s=s.attributes).mimeType||"video/webm"===s.mimeType||"video"===s.contentType}function rc(s){return"audio/mp4"===(s=s.attributes).mimeType||"audio/webm"===s.mimeType||"audio"===s.contentType}function nc(s){return"text/vtt"===(s=s.attributes).mimeType||"text"===s.contentType}function ol(s,p){for(var u,m,y,T,S=s.type,x=s.minimumUpdatePeriod,A=void 0===x?0:x,L=void 0===(x=s.media)?"":x,O=s.sourceDuration,j=void 0===(x=s.timescale)?1:x,B=void 0===(x=s.startNumber)?1:x,H=s.periodIndex,q=[],V=-1,ee=0;ee<p.length;ee++){var ke,ve,ae=p[ee],ne=ae.d,ie=ae.r||0,he=ae.t||0;V<0&&(V=he),he&&V<he&&(V=he),ve=ie<0?(ke=ee+1)===p.length?"dynamic"===S&&0<A&&0<L.indexOf("$Number$")?(ae=void 0,u=(he=s).NOW,m=he.clientOffset,y=he.availabilityStartTime,T=he.timescale,ae=he.start,he=he.minimumUpdatePeriod,Math.ceil((((u+m)/1e3+(void 0===he?0:he)-(y+(void 0===ae?0:ae)))*(void 0===T?1:T)-V)/ne)):(O*j-V)/ne:(p[ke].t-V)/ne:ie+1;for(var Ee=B+q.length+ve,xe=B+q.length;xe<Ee;)q.push({number:xe,duration:ne/j,time:V,timeline:H}),V+=ne,xe++}return q}function ul(s,p){return s.replace(Sc,(h=p,function(n,u,m,y){return"$$"===n?"$":void 0===h[u]?n:(n=""+h[u],"RepresentationID"===u||(y=m?parseInt(y,10):1)<=n.length?n:new Array(y-n.length+1).join("0")+n)}));var h}function oc(s,p){var h={RepresentationID:s.id,Bandwidth:s.bandwidth||0},n=void 0===(n=s.initialization)?{sourceURL:"",range:""}:n,u=ar({baseUrl:s.baseUrl,source:ul(n.sourceURL,h),range:n.range});return(n=p,(p=s).duration||n?p.duration?ks(p):ol(p,n):[{number:p.startNumber||1,duration:p.sourceDuration,time:0,timeline:p.periodIndex}]).map(function(m){h.Number=m.number,h.Time=m.time;var y=ul(s.media||"",h),T=s.periodStart+(m.time-(s.presentationTimeOffset||0))/(T=s.timescale||1);return{uri:y,timeline:m.timeline,duration:m.duration,resolvedUri:ls(s.baseUrl||"",y),map:u,number:m.number,presentationTime:T}})}function uc(s,p){var h=s.duration,n=void 0===(n=s.segmentUrls)?[]:n,u=s.periodStart;if(!h&&!p||h&&p)throw new Error(vc);var m,y=n.map(function(T){return x=T,T=(S=s).baseUrl,S=ar({baseUrl:T,source:(S=void 0===(S=S.initialization)?{}:S).sourceURL,range:S.range}),(x=ar({baseUrl:T,source:x.media,range:x.mediaRange})).map=S,x;var S,x});return h&&(m=ks(s)),(m=p?ol(s,p):m).map(function(T,S){if(y[S]){var x=y[S],A=s.timescale||1;return S=s.presentationTimeOffset||0,x.timeline=T.timeline,x.duration=T.duration,x.number=T.number,x.presentationTime=u+(T.time-S)/A,x}}).filter(function(T){return T})}function lc(s){var p,h=s.attributes,n=s.segmentInfo;n.template?(m=oc,p=Lt(h,n.template)):n.base?(m=nl,p=Lt(h,n.base)):n.list&&(m=uc,p=Lt(h,n.list));var m,u={attributes:h};return m?(s=m(p,n.segmentTimeline),p.duration=p.duration?(h=p.duration)/(void 0===(m=p.timescale)?1:m):s.length?s.reduce(function(y,T){return Math.max(y,Math.ceil(T.duration))},0):0,u.attributes=p,u.segments=s,n.base&&p.indexRange&&(u.sidx=s[0],u.segments=[]),u):u}function mt(s,p){return il(s.childNodes).filter(function(h){return h.tagName===p})}function Es(s){return s.textContent.trim()}function fi(s){if(!(u=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(s)))return 0;var p=(m=u.slice(1))[0],h=m[1],n=m[2],u=(s=m[3],m[4]),m=m[5];return 31536e3*parseFloat(p||0)+2592e3*parseFloat(h||0)+86400*parseFloat(n||0)+3600*parseFloat(s||0)+60*parseFloat(u||0)+parseFloat(m||0)}function Nt(s){return s&&s.attributes?il(s.attributes).reduce(function(p,h){return p[h.name]=(gl[h.name]||gl.DEFAULT)(h.value),p},{}):{}}function Kr(s,p){return p.length?Vr(s.map(function(h){return p.map(function(n){return ls(h,Es(n))})})):s}function Ss(s){var p=mt(s,"SegmentTemplate")[0],h=mt(s,"SegmentList")[0],n=h&&mt(h,"SegmentURL").map(function(T){return Lt({tag:"SegmentURL"},Nt(T))}),u=mt(s,"SegmentBase")[0],m=(s=(m=h||p)&&mt(m,"SegmentTimeline")[0],(m=h||u||p)&&mt(m,"Initialization")[0]);(p=p&&Nt(p))&&m?p.initialization=m&&Nt(m):p&&p.initialization&&(p.initialization={sourceURL:p.initialization});var y={template:p,segmentTimeline:s&&mt(s,"S").map(Nt),list:h&&Lt(Nt(h),{segmentUrls:n,initialization:Nt(m)}),base:u&&Lt(Nt(u),{initialization:Nt(m)})};return Object.keys(y).forEach(function(T){y[T]||delete y[T]}),y}function ll(s){if(""===s)throw new Error(yc);var p,h,n=new gc;try{h=(p=n.parseFromString(s,"application/xml"))&&"MPD"===p.documentElement.tagName?p.documentElement:null}catch(u){}if(!h||h&&0<h.getElementsByTagName("parsererror").length)throw new Error(_c);return h}function Ae(s){return s instanceof Uint8Array?s:(Array.isArray(s)||ArrayBuffer.isView(s)||s instanceof ArrayBuffer||(s="number"!=typeof s||"number"==typeof s&&s!=s?0:[s]),new Uint8Array(s&&s.buffer||s,s&&s.byteOffset||0,s&&s.byteLength||0))}function dl(s,p){if("string"!=typeof(s="string"!=typeof s&&s&&"function"==typeof s.toString?s.toString():s))return new Uint8Array;p||(s=unescape(encodeURIComponent(s)));for(var h=new Uint8Array(s.length),n=0;n<s.length;n++)h[n]=s.charCodeAt(n);return h}function ut(s,p,h){var n=void 0===h?{}:h,u=void 0===(h=n.offset)?0:h,m=void 0===(n=n.mask)?[]:n;return s=Ae(s),n=(p=Ae(p)).every||Array.prototype.every,p.length&&s.length-u>=p.length&&n.call(p,function(y,T){return y===(m[T]?m[T]&s[u+T]:s[u+T])})}function yi(s,p){return void 0===p&&(p=0),(s=Ae(s)).length-p<10||!ut(s,Pc,{offset:p})?p:yi(s,p+=function(h,n){void 0===n&&(n=0);var u=(h=Ae(h))[n+5];return n=h[n+6]<<21|h[n+7]<<14|h[n+8]<<7|h[n+9],(16&u)>>4?20+n:10+n}(s,p))}function hl(s){return"string"==typeof s?dl(s):s}function cl(s,p,h){var n;void 0===h&&(h=!1),n=p,p=Array.isArray(n)?n.map(hl):[hl(n)],s=Ae(s);var u=[];if(!p.length)return u;for(var m=0;m<s.length;){var y=(s[m]<<24|s[m+1]<<16|s[m+2]<<8|s[m+3])>>>0,T=s.subarray(m+4,m+8);if(0==y)break;var S=m+y;if(S>s.length){if(h)break;S=s.length}y=s.subarray(m+8,S),ut(T,p[0])&&(1===p.length?u.push(y):u.push.apply(u,cl(y,p.slice(1),h))),m=S}return u}function Hr(s,p,h,n){void 0===h&&(h=!0),void 0===n&&(n=!1);var u=function(y){for(var T=1,S=0;S<As.length&&!(y&As[S]);S++)T++;return T}(s[p]),m=s.subarray(p,p+u);return h&&((m=Array.prototype.slice.call(s,p,p+u))[0]^=As[u-1]),{length:u,value:function(y,T){T=void 0!==(T=(S=void 0===T?{}:T).signed)&&T;var S,x=void 0!==(S=S.le)&&S;return S=((y=Ae(y))[S=x?"reduce":"reduceRight"]||Array.prototype[S]).call(y,function(A,L,O){return O=x?O:Math.abs(O+1-y.length),A+xt(L)*Ps[O]},xt(0)),!T||(T=Ps[y.length]/xt(2)-xt(1))<(S=xt(S))&&(S-=T,S-=T,S-=xt(2)),Number(S)}(m,{signed:n}),bytes:m}}function Cs(s){return"string"==typeof s?s.match(/.{1,2}/g).map(Cs):"number"==typeof s?function(s,p){for(var h=void 0!==(p=(void 0===p?{}:p).le)&&p,n=(p=s=xt(s="bigint"!=typeof s&&"number"!=typeof s||"number"==typeof s&&s!=s?0:s),Math.ceil(p.toString(2).length/8)),u=new Uint8Array(new ArrayBuffer(n)),m=0;m<n;m++){var y=h?m:Math.abs(m+1-u.length);u[y]=Number(s/Ps[m]&xt(255)),s<0&&(u[y]=Math.abs(~u[y]),u[y]-=0===m?1:2)}return u}(s):s}function pl(s,p,h){if(h>=p.length)return p.length;var n=Hr(p,h,!1);if(ut(s.bytes,n.bytes))return h;var u=Hr(p,h+n.length);return pl(s,p,h+u.length+u.value+n.length)}function bs(s,p){var h;h=p,p=Array.isArray(h)?h.map(Cs):[Cs(h)],s=Ae(s);var n=[];if(!p.length)return n;for(var u=0;u<s.length;){var m=Hr(s,u,!1),y=Hr(s,u+m.length),T=u+m.length+y.length;127===y.value&&(y.value=pl(m,s,T),y.value!==s.length&&(y.value-=T));var S=s.subarray(T,S=T+y.value>s.length?s.length:T+y.value);ut(p[0],m.bytes)&&(1===p.length?n.push(S):n=n.concat(bs(S,p.slice(1)))),u+=m.length+y.length+S.length}return n}function ml(s,p,h,n){void 0===n&&(n=1/0),s=Ae(s),h=[].concat(h);for(var u,m=0,y=0;m<s.length&&(y<n||u);){var T=void 0;if(ut(s.subarray(m),Ac)?T=4:ut(s.subarray(m),Ic)&&(T=3),T){if(y++,u)return function(x){for(var A=[],L=1;L<x.length-2;)ut(x.subarray(L,L+3),xc)&&(A.push(L+2),L++),L++;if(0===A.length)return x;var O=x.length-A.length,j=new Uint8Array(O),B=0;for(L=0;L<O;B++,L++)B===A[0]&&(B++,A.shift()),j[L]=x[B];return j}(s.subarray(u,m));var S=void 0;"h264"===p?S=31&s[m+T]:"h265"===p&&(S=s[m+T]>>1&63),-1!==h.indexOf(S)&&(u=m+T),m+=T+("h264"===p?1:2)}else m++}return s.subarray(0,0)}el.prototype.parseFromString=function(s,p){var h=this.options,n=new Zh,u=h.domBuilder||new tr,m=h.errorHandler,y=h.locator,T=h.xmlns||{},S=/\/x?html?$/.test(p);return p=S?Xi.HTML_ENTITIES:Xi.XML_ENTITIES,y&&u.setDocumentLocator(y),n.errorHandler=function(x,A,L){if(!x){if(A instanceof tr)return A;x=A}var O={},j=x instanceof Function;function B(H){var q=x[H];!q&&j&&(q=2==x.length?function(V){x(H,V)}:x),O[H]=q?function(V){q("[xmldom "+H+"]\t"+V+function(s){if(s)return"\n@"+(s.systemId||"")+"#[line:"+s.lineNumber+",col:"+s.columnNumber+"]"}(L))}:function(){}}return L=L||{},B("warning"),B("error"),B("fatalError"),O}(m,u,y),n.domBuilder=h.domBuilder||u,S&&(T[""]=Zu.HTML),T.xml=T.xml||Zu.XML,s&&"string"==typeof s?n.parse(s,T,p):n.errorHandler.error("invalid doc source"),u.doc},tr.prototype={startDocument:function(){this.doc=(new Qh).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(s,p,h,n){var u=this.doc,m=u.createElementNS(s,h||p),y=n.length;$r(this,m),this.currentElement=m,this.locator&&gi(this.locator,m);for(var T=0;T<y;T++){s=n.getURI(T);var S=n.getValue(T),x=(h=n.getQName(T),u.createAttributeNS(s,h));this.locator&&gi(n.getLocator(T),x),x.value=x.nodeValue=S,m.setAttributeNode(x)}},endElement:function(s,p,h){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(s,p){},endPrefixMapping:function(s){},processingInstruction:function(s,p){p=this.doc.createProcessingInstruction(s,p),this.locator&&gi(this.locator,p),$r(this,p)},ignorableWhitespace:function(s,p,h){},characters:function(s,p,h){var n;(s=tl.apply(this,arguments))&&(n=this.cdata?this.doc.createCDATASection(s):this.doc.createTextNode(s),this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(s)&&this.doc.appendChild(n),this.locator&&gi(this.locator,n))},skippedEntity:function(s){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(s){(this.locator=s)&&(s.lineNumber=0)},comment:function(s,p,h){s=tl.apply(this,arguments),s=this.doc.createComment(s),this.locator&&gi(this.locator,s),$r(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(s,p,h){var n=this.doc.implementation;n&&n.createDocumentType&&(h=n.createDocumentType(s,p,h),this.locator&&gi(this.locator,h),$r(this,h),this.doc.doctype=h)},warning:function(s){},error:function(s){},fatalError:function(s){throw new Jh(s,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(s){tr.prototype[s]=function(){return null}});var gc={__DOMHandler:tr,DOMParser:el,DOMImplementation:Qe.DOMImplementation,XMLSerializer:Qe.XMLSerializer}.DOMParser,fc="INVALID_NUMBER_OF_PERIOD",yc="DASH_EMPTY_MANIFEST",_c="DASH_INVALID_XML",kc="NO_BASE_URL",vc="SEGMENT_TIME_UNSPECIFIED",Ec={static:function(s){var n=void 0===(h=s.timescale)?1:h,u=s.sourceDuration,h=s.periodDuration;return n=s.duration/n,"number"==typeof(s=rl(s.endNumber))?{start:0,end:s}:"number"==typeof h?{start:0,end:h/n}:{start:0,end:u/n}},dynamic:function(s){var p=s.NOW,h=s.clientOffset,n=s.availabilityStartTime,m=void 0===(u=s.timescale)?1:u,y=s.duration,S=void 0===(T=s.start)?0:T,T=void 0===(u=s.minimumUpdatePeriod)?0:u,u=void 0===(u=s.timeShiftBufferDepth)?1/0:u;return s=rl(s.endNumber),h=(p+h)/1e3,S=n+S,T=Math.ceil((h+T-S)*m/y),u=Math.floor((h-S-u)*m/y),y=Math.floor((h-S)*m/y),{start:Math.max(0,u),end:"number"==typeof s?s:Math.min(T,y)}}},Sc=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,gl={mediaPresentationDuration:fi,availabilityStartTime:function(s){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(s=s)&&(s+="Z"),Date.parse(s)/1e3},minimumUpdatePeriod:fi,suggestedPresentationDelay:fi,type:function(s){return s},timeShiftBufferDepth:fi,start:fi,width:function(s){return parseInt(s,10)},height:function(s){return parseInt(s,10)},bandwidth:function(s){return parseInt(s,10)},startNumber:function(s){return parseInt(s,10)},timescale:function(s){return parseInt(s,10)},presentationTimeOffset:function(s){return parseInt(s,10)},duration:function(s){var p=parseInt(s,10);return isNaN(p)?fi(s):p},d:function(s){return parseInt(s,10)},t:function(s){return parseInt(s,10)},r:function(s){return parseInt(s,10)},DEFAULT:function(s){return s}},Cc={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},fl=Math.pow(2,32),xt=window.BigInt||Number,Ps=[xt("0x1"),xt("0x100"),xt("0x10000"),xt("0x1000000"),xt("0x100000000"),xt("0x10000000000"),xt("0x1000000000000"),xt("0x100000000000000"),xt("0x10000000000000000")],Pc=Ae([73,68,51]),Wr={EBML:Ae([26,69,223,163]),DocType:Ae([66,130]),Segment:Ae([24,83,128,103]),SegmentInfo:Ae([21,73,169,102]),Tracks:Ae([22,84,174,107]),Track:Ae([174]),TrackNumber:Ae([215]),DefaultDuration:Ae([35,227,131]),TrackEntry:Ae([174]),TrackType:Ae([131]),FlagDefault:Ae([136]),CodecID:Ae([134]),CodecPrivate:Ae([99,162]),VideoTrack:Ae([224]),AudioTrack:Ae([225]),Cluster:Ae([31,67,182,117]),Timestamp:Ae([231]),TimestampScale:Ae([42,215,177]),BlockGroup:Ae([160]),BlockDuration:Ae([155]),Block:Ae([161]),SimpleBlock:Ae([163])},As=[128,64,32,16,8,4,2,1],Ac=Ae([0,0,0,1]),Ic=Ae([0,0,1]),xc=Ae([0,0,3]),Kt={webm:Ae([119,101,98,109]),matroska:Ae([109,97,116,114,111,115,107,97]),flac:Ae([102,76,97,67]),ogg:Ae([79,103,103,83]),ac3:Ae([11,119]),riff:Ae([82,73,70,70]),avi:Ae([65,86,73]),wav:Ae([87,65,86,69]),"3gp":Ae([102,116,121,112,51,103]),mp4:Ae([102,116,121,112]),fmp4:Ae([115,116,121,112]),mov:Ae([102,116,121,112,113,116]),moov:Ae([109,111,111,118]),moof:Ae([109,111,111,102])},_i={aac:function(s){return ut(s,[255,16],{offset:yi(s),mask:[255,22]})},mp3:function(s){return ut(s,[255,2],{offset:yi(s),mask:[255,6]})},webm:function(s){return ut(s=bs(s,[Wr.EBML,Wr.DocType])[0],Kt.webm)},mkv:function(s){return ut(s=bs(s,[Wr.EBML,Wr.DocType])[0],Kt.matroska)},mp4:function(s){return!_i["3gp"](s)&&!_i.mov(s)&&(!(!ut(s,Kt.mp4,{offset:4})&&!ut(s,Kt.fmp4,{offset:4}))||!(!ut(s,Kt.moof,{offset:4})&&!ut(s,Kt.moov,{offset:4}))||void 0)},mov:function(s){return ut(s,Kt.mov,{offset:4})},"3gp":function(s){return ut(s,Kt["3gp"],{offset:4})},ac3:function(s){var p=yi(s);return ut(s,Kt.ac3,{offset:p})},ts:function(s){if(s.length<189&&1<=s.length)return 71===s[0];for(var p=0;p+188<s.length&&p<188;){if(71===s[p]&&71===s[p+188])return!0;p+=1}return!1},flac:function(s){var p=yi(s);return ut(s,Kt.flac,{offset:p})},ogg:function(s){return ut(s,Kt.ogg)},avi:function(s){return ut(s,Kt.riff)&&ut(s,Kt.avi,{offset:8})},wav:function(s){return ut(s,Kt.riff)&&ut(s,Kt.wav,{offset:8})},h264:function(s){return ml(s,"h264",7,3).length},h265:function(s){return ml(s,"h265",[32,33],3).length}},Is=Object.keys(_i).filter(function(s){return"ts"!==s&&"h264"!==s&&"h265"!==s}).concat(["ts","h264","h265"]);function xs(s){s=Ae(s);for(var p=0;p<Is.length;p++){var h=Is[p];if(Kc[h](s))return h}return""}function zr(s,p,h){return s&&h&&h.responseURL&&p!==h.responseURL?h.responseURL:p}function ra(s){return J.log.debug?J.log.debug.bind(J,"VHS:",s+" >"):function(){}}function yl(s,p){var h,n=[];if(s&&s.length)for(h=0;h<s.length;h++)p(s.start(h),s.end(h))&&n.push([s.start(h),s.end(h)]);return J.createTimeRanges(n)}function ki(s,p){return yl(s,function(h,n){return h-.1<=p&&p<=n+.1})}function qr(s,p){return yl(s,function(h){return p<=h-Ha})}function _l(s){var p=[];if(!s||!s.length)return"";for(var h=0;h<s.length;h++)p.push(s.start(h)+" => "+s.end(h));return p.join(", ")}function Ka(s){for(var p=[],h=0;h<s.length;h++)p.push({start:s.start(h),end:s.end(h)});return p}function kl(s){if(s&&s.length&&s.end)return s.end(s.length-1)}function Ms(s,p){var h=0;if(!s||!s.length)return h;for(var n=0;n<s.length;n++){var u=s.start(n),m=s.end(n);m<p||(h+=u<p&&p<=m?m-p:m-u)}return h}function ws(s,p){if(!p.preload)return p.duration;var h=0;return(p.parts||[]).forEach(function(n){h+=n.duration}),(p.preloadHints||[]).forEach(function(n){"PART"===n.type&&(h+=s.partTargetDuration)}),h}function Ds(s){return(s.segments||[]).reduce(function(p,h,n){return h.parts?h.parts.forEach(function(u,m){p.push({duration:u.duration,segmentIndex:n,partIndex:m,part:u,segment:h})}):p.push({duration:h.duration,segmentIndex:n,partIndex:null,segment:h,part:null}),p},[])}function vl(s){return(s=s.segments&&s.segments.length&&s.segments[s.segments.length-1])&&s.parts||[]}function Tl(s){var p=s.preloadSegment;if(p)return s=p.parts,(p=(p.preloadHints||[]).reduce(function(h,n){return h+("PART"===n.type?1:0)},0))+(s&&s.length?s.length:0)}function El(s,p){return p.endList?0:s&&s.suggestedPresentationDelay?s.suggestedPresentationDelay:(s=0<vl(p).length)&&p.serverControl&&p.serverControl.partHoldBack?p.serverControl.partHoldBack:s&&p.partTargetDuration?3*p.partTargetDuration:p.serverControl&&p.serverControl.holdBack?p.serverControl.holdBack:p.targetDuration?3*p.targetDuration:0}function Sl(s,p,h){if((p=void 0===p?s.mediaSequence+s.segments.length:p)<s.mediaSequence)return 0;var n=function(u,m){var y=0,T=m-u.mediaSequence,S=u.segments[T];if(S){if(void 0!==S.start)return{result:S.start,precise:!0};if(void 0!==S.end)return{result:S.end-S.duration,precise:!0}}for(;T--;){if(void 0!==(S=u.segments[T]).end)return{result:y+S.end,precise:!0};if(y+=ws(u,S),void 0!==S.start)return{result:y+S.start,precise:!0}}return{result:y,precise:!1}}(s,p);return n.precise?n.result:(p=function(u,m){for(var y,T=0,S=m-u.mediaSequence;S<u.segments.length;S++){if(void 0!==(y=u.segments[S]).start)return{result:y.start-T,precise:!0};if(T+=ws(u,y),void 0!==y.end)return{result:y.end-T,precise:!0}}return{result:-1,precise:!1}}(s,p)).precise?p.result:n.result+h}function Cl(s,p,h){if(!s)return 0;if("number"!=typeof h&&(h=0),void 0===p){if(s.totalDuration)return s.totalDuration;if(!s.endList)return window.Infinity}return Sl(s,p,h)}function ir(s){var p=s.defaultDuration,h=s.durationList,n=s.startIndex,u=s.endIndex,m=0;if(u<n&&(n=(s=[u,n])[0],u=s[1]),n<0){for(var y=n;y<Math.min(0,u);y++)m+=p;n=0}for(var T=n;T<u;T++)m+=h[T].duration;return m}function bl(s,p,h,n){return s&&s.segments?s.endList?Cl(s):null===p?null:(p=Sl(s,s.mediaSequence+s.segments.length,p=p||0),h&&(p-=n="number"==typeof n?n:El(null,s)),Math.max(0,p)):null}function Pl(s){return s.excludeUntil&&s.excludeUntil>Date.now()}function Rs(s){return s.excludeUntil&&s.excludeUntil===1/0}function Xr(s){var p=Pl(s);return!s.disabled&&!p}function Al(s,p){return p.attributes&&p.attributes[s]}function Ls(s,p){if(1===s.playlists.length)return!0;var h=p.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===s.playlists.filter(function(n){return!!Xr(n)&&(n.attributes.BANDWIDTH||0)<h}).length}function Ns(s,p){return!(!s&&!p||!s&&p||s&&!p||s!==p&&(!s.id||!p.id||s.id!==p.id)&&(!s.resolvedUri||!p.resolvedUri||s.resolvedUri!==p.resolvedUri)&&(!s.uri||!p.uri||s.uri!==p.uri))}function Il(s,p){var h,n=s&&s.mediaGroups&&s.mediaGroups.AUDIO||{},u=!1;for(h in n){for(var m in n[h])if(u=p(n[h][m]))break;if(u)break}return!!u}function rr(s){if(!s||!s.playlists||!s.playlists.length)return Il(s,function(n){return n.playlists&&n.playlists.length||n.uri});for(var p=0;p<s.playlists.length;p++){var h=function(n){var u=s.playlists[n];return(n=u.attributes&&u.attributes.CODECS)&&n.split(",").every(_u)||Il(s,function(m){return Ns(u,m)})?"continue":{v:!1}}(p);if("continue"!==h&&"object"==typeof h)return h.v}return!0}function Os(s,p){return s+"-"+p}function nr(s,p){s.mediaGroups&&["AUDIO","SUBTITLES"].forEach(function(h){if(s.mediaGroups[h])for(var n in s.mediaGroups[h])for(var u in s.mediaGroups[h][n])p(s.mediaGroups[h][n][u],h,n,u)})}function xl(s){var p=s.playlist,h=s.uri;p.id=s=s.id,p.playlistErrors_=0,h&&(p.uri=h),p.attributes=p.attributes||{}}function Ml(s,p){s.uri=p;for(var h=0;h<s.playlists.length;h++)s.playlists[h].uri||(s.playlists[h].uri="placeholder-uri-"+h);var n,u=rr(s);nr(s,function(m,y,T,S){var x="placeholder-uri-"+y+"-"+T+"-"+S;if(!m.playlists||!m.playlists.length){if(u&&"AUDIO"===y&&!m.uri)for(var A=0;A<s.playlists.length;A++){var L=s.playlists[A];if(L.attributes&&L.attributes.AUDIO&&L.attributes.AUDIO===T)return}m.playlists=[Z({},m)]}m.playlists.forEach(function(O,j){var B=Os(j,x);O.uri?O.resolvedUri=O.resolvedUri||na(s.uri,O.uri):(O.uri=0===j?x:B,O.resolvedUri=O.uri),O.id=O.id||B,O.attributes=O.attributes||{},s.playlists[O.id]=O,s.playlists[O.uri]=O})}),function(m){for(var y=m.playlists.length;y--;){var T=m.playlists[y];xl({playlist:T,id:Os(y,T.uri)}),T.resolvedUri=na(m.uri,T.uri),m.playlists[T.id]=T,(m.playlists[T.uri]=T).attributes.BANDWIDTH||rd.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}}(s),nr(n=s,function(m){m.uri&&(m.resolvedUri=na(n.uri,m.uri))})}function wl(s,p){!s.resolvedUri&&s.uri&&(s.resolvedUri=na(p,s.uri)),s.key&&!s.key.resolvedUri&&(s.key.resolvedUri=na(p,s.key.uri)),s.map&&!s.map.resolvedUri&&(s.map.resolvedUri=na(p,s.map.uri)),s.map&&s.map.key&&!s.map.key.resolvedUri&&(s.map.key.resolvedUri=na(p,s.map.key.uri)),s.parts&&s.parts.length&&s.parts.forEach(function(h){h.resolvedUri||(h.resolvedUri=na(p,h.uri))}),s.preloadHints&&s.preloadHints.length&&s.preloadHints.forEach(function(h){h.resolvedUri||(h.resolvedUri=na(p,h.uri))})}function Dl(s){var p=s.segments||[],h=s.preloadSegment;if(h&&h.parts&&h.parts.length){if(h.preloadHints)for(var n=0;n<h.preloadHints.length;n++)if("MAP"===h.preloadHints[n].type)return p;h.duration=s.targetDuration,h.preload=!0,p.push(h)}return p}function Rl(s,p){return s===p||s.segments&&p.segments&&s.segments.length===p.segments.length&&s.endList===p.endList&&s.mediaSequence===p.mediaSequence&&s.preloadSegment===p.preloadSegment}function Us(s,p,h){void 0===h&&(h=Rl);var n=tn(s,{}),u=n.playlists[p.id];if(!u||h(u,p))return null;p.segments=Dl(p);var m=tn(u,p);if(m.preloadSegment&&!p.preloadSegment&&delete m.preloadSegment,u.segments){if(p.skip){p.segments=p.segments||[];for(var y=0;y<p.skip.skippedSegments;y++)p.segments.unshift({skipped:!0})}m.segments=function(s,p,h){var n=s.slice(),u=p.slice();h=h||0;for(var m,y=[],T=0;T<u.length;T++){var S=n[T+h],x=u[T];S?(m=S.map||m,y.push(function(A,L){if(!A)return L;var O=tn(A,L);if(A.preloadHints&&!L.preloadHints&&delete O.preloadHints,A.parts&&!L.parts)delete O.parts;else if(A.parts&&L.parts)for(var j=0;j<L.parts.length;j++)A.parts&&A.parts[j]&&(O.parts[j]=tn(A.parts[j],L.parts[j]));return!A.skipped&&L.skipped&&(O.skipped=!1),A.preload&&!L.preload&&(O.preload=!1),O}(S,x))):(m&&!x.map&&(x.map=m),y.push(x))}return y}(u.segments,p.segments,p.mediaSequence-u.mediaSequence)}m.segments.forEach(function(S){wl(S,m.resolvedUri)});for(var T=0;T<n.playlists.length;T++)n.playlists[T].id===p.id&&(n.playlists[T]=m);return n.playlists[p.id]=m,n.playlists[p.uri]=m,nr(s,function(S,x,A,L){if(S.playlists)for(var O=0;O<S.playlists.length;O++)p.id===S.playlists[O].id&&(S.playlists[O]=p)}),n}function Bs(s,p){var h=s.segments||[],n=(h=(n=h[h.length-1])&&n.parts&&n.parts[n.parts.length-1])&&h.duration||n&&n.duration;return p&&n?1e3*n:500*(s.partTargetDuration||s.targetDuration||10)}function Fs(s,p,h,n){var u="arraybuffer"===s.responseType?s.response:s.responseText;!p&&u&&(s.responseTime=Date.now(),s.roundTripTime=s.responseTime-s.requestTime,s.bytesReceived=u.byteLength||u.length,s.bandwidth||(s.bandwidth=Math.floor(s.bytesReceived/s.roundTripTime*8*1e3))),h.headers&&(s.responseHeaders=h.headers),p&&"ETIMEDOUT"===p.code&&(s.timedout=!0),n(p=p||s.aborted||200===h.statusCode||206===h.statusCode||0===h.statusCode?p:new Error("XHR Failed with a response of: "+(s&&(u||s.responseText))),s)}function Ll(){function s(p,h){p=Wc({timeout:45e3},p);var n=s.beforeRequest||J.Vhs.xhr.beforeRequest;!n||"function"!=typeof n||(n=n(p))&&(p=n);var u=(!0===J.Vhs.xhr.original?Hc:J.Vhs.xhr)(p,function(y,T){return Fs(u,y,T,h)}),m=u.abort;return u.abort=function(){return u.aborted=!0,m.apply(u,arguments)},u.uri=p.uri,u.requestTime=Date.now(),u}return s.original=!0,s}function js(s){var p,h={};return s.byterange&&(h.Range="bytes="+(p=s.byterange).offset+"-"+(s=p.offset+p.length-1)),h}function wc(s,p){return s=s.toString(16),"00".substring(0,2-s.length)+s+(p%2?" ":"")}function Dc(s){return 32<=s&&s<126?String.fromCharCode(s):"."}function Nl(s){var p={};return Object.keys(s).forEach(function(h){var n=s[h];p[h]=ArrayBuffer.isView(n)?{bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:n}),p}function Yr(s){var p=s.byterange||{length:1/0,offset:0};return[p.length,p.offset,s.resolvedUri].join(",")}function Ol(s){return s.resolvedUri}function Ul(s){for(var p=Array.prototype.slice.call(s),h="",n=0;n<p.length/16;n++)h+=p.slice(16*n,16*n+16).map(wc).join("")+" "+p.slice(16*n,16*n+16).map(Dc).join("")+"\n";return h}function Bl(s){var p=s.programTime,h=s.playlist,n=s.retryCount,u=void 0===n?2:n,m=s.seekTo,y=s.pauseAfterSeek,T=void 0===y||y,S=s.tech,x=s.callback;if(!x)throw new Error("seekToProgramTime: callback must be provided");return void 0!==p&&h&&m?h.endList||S.hasStarted_?function(A){if(!A.segments||0===A.segments.length)return!1;for(var L=0;L<A.segments.length;L++)if(!A.segments[L].dateTimeObject)return!1;return!0}(h)?(n=function(A,L){var O;try{O=new Date(A)}catch(V){return null}if(!L||!L.segments||0===L.segments.length||O<(B=L.segments[0]).dateTimeObject)return null;for(var j=0;j<L.segments.length-1;j++){var B=L.segments[j];if(O<L.segments[j+1].dateTimeObject)break}var q=L.segments[L.segments.length-1],H=(A=q.dateTimeObject,q.videoTimingInfo?(H=q.videoTimingInfo).transmuxedPresentationEnd-H.transmuxedPresentationStart-H.transmuxerPrependedSeconds:q.duration+.25*q.duration);return new Date(A.getTime()+1e3*H)<O?null:{segment:B=A<O?q:B,estimatedStart:B.videoTimingInfo?B.videoTimingInfo.transmuxedPresentationStart:zt.duration(L,L.mediaSequence+L.segments.indexOf(B)),type:B.videoTimingInfo?"accurate":"estimate"}}(p,h))?(s=function(A,L){var O;try{j=new Date(A),O=new Date(L)}catch(B){}var j=j.getTime();return(O.getTime()-j)/1e3}((y=n.segment).dateTimeObject,p),"estimate"===n.type?0===u?x({message:p+" is not buffered yet. Try again"}):(m(n.estimatedStart+s),void S.one("seeked",function(){Bl({programTime:p,playlist:h,retryCount:u-1,seekTo:m,pauseAfterSeek:T,tech:S,callback:x})})):(s=y.start+s,S.one("seeked",function(){return x(null,S.currentTime())}),T&&S.pause(),void m(s))):x({message:p+" was not found in the stream"}):x({message:"programDateTime tags must be provided in the manifest "+h.resolvedUri}):x({message:"player must be playing a live stream to start buffering"}):x({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"})}function jl(s,p){if(!Rl(s,p)||s.sidx&&p.sidx&&(s.sidx.offset!==p.sidx.offset||s.sidx.length!==p.sidx.length)||!s.sidx&&p.sidx||s.sidx&&!p.sidx||s.segments&&!p.segments||!s.segments&&p.segments)return!1;if(!s.segments&&!p.segments)return!0;for(var h=0;h<s.segments.length;h++){var n=s.segments[h],u=p.segments[h];if(n.uri!==u.uri||(n.byterange||u.byterange)&&(u=u.byterange,(n=n.byterange)&&!u||!n&&u||n.offset!==u.offset||n.length!==u.length))return!1}return!0}function $l(s,p){var h,n={};for(h in s){var u=s[h].sidx;if(u){var m=Gr(u);if(!p[m])break;var y=p[m].sidxInfo;y=y,u=u,(Boolean(!y.map&&!u.map)||Boolean(y.map&&u.map&&y.map.byterange.offset===u.map.byterange.offset&&y.map.byterange.length===u.map.byterange.length))&&y.uri===u.uri&&y.byterange.offset===u.byterange.offset&&y.byterange.length===u.byterange.length&&(n[m]=p[m])}}return n}function Vl(s){return s.on=s.addEventListener,s.off=s.removeEventListener,s}function Gl(s){var p=s.transmuxer,h=s.bytes,n=s.audioAppendStart,u=s.gopsToAlignWith,m=s.remux,y=s.onData,T=s.onTrackInfo,S=s.onAudioTimingInfo,x=s.onVideoTimingInfo,A=s.onVideoSegmentTimingInfo,L=s.onAudioSegmentTimingInfo,O=s.onId3,j=s.onCaptions,B=s.onDone,H=s.onEndedTimeline,q=s.onTransmuxerLog,V=s.isEndOfTimeline,ee={buffer:[]},ae=V;p.onmessage=function(ne){var ie,he,ve,xe,Ne,Be,Ge,Oe,Tt,Ee;p.currentTransmux===s&&("data"===ne.data.action&&(ve=y,xe=(Ee=(he=ne).data.segment).type,Ne=Ee.initSegment,Be=Ee.captions,Ge=Ee.captionStreams,Oe=Ee.metadata,Tt=Ee.videoFrameDtsTime,Ee=Ee.videoFramePtsTime,ee.buffer.push({captions:Be,captionStreams:Ge,metadata:Oe}),he=he.data.segment.boxes||{data:he.data.segment.data},Ne={type:xe,data:new Uint8Array(he.data,he.data.byteOffset,he.data.byteLength),initSegment:new Uint8Array(Ne.data,Ne.byteOffset,Ne.byteLength)},void 0!==Tt&&(Ne.videoFrameDtsTime=Tt),void 0!==Ee&&(Ne.videoFramePtsTime=Ee),ve(Ne)),"trackinfo"===ne.data.action&&T(ne.data.trackInfo),"gopInfo"===ne.data.action&&(ee.gopInfo=ne.data.gopInfo),"audioTimingInfo"===ne.data.action&&S(ne.data.audioTimingInfo),"videoTimingInfo"===ne.data.action&&x(ne.data.videoTimingInfo),"videoSegmentTimingInfo"===ne.data.action&&A(ne.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===ne.data.action&&L(ne.data.audioSegmentTimingInfo),"id3Frame"===ne.data.action&&O([ne.data.id3Frame],ne.data.id3Frame.dispatchType),"caption"===ne.data.action&&j(ne.data.caption),"endedtimeline"===ne.data.action&&(ae=!1,H()),"log"===ne.data.action&&q(ne.data.log),"transmuxed"===ne.data.type&&(ae||(p.onmessage=null,ne=(ie={transmuxedData:ee,callback:B}).transmuxedData,ie=ie.callback,ne.buffer=[],ie(ne),sd(p))))},n&&p.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(u)&&p.postMessage({action:"alignGopsWith",gopsToAlignWith:u}),void 0!==m&&p.postMessage({action:"setRemux",remux:m}),h.byteLength&&(u=h instanceof ArrayBuffer?h:h.buffer,m=h instanceof ArrayBuffer?0:h.byteOffset,p.postMessage({action:"push",data:u,byteOffset:m,byteLength:h.byteLength},[u])),V&&p.postMessage({action:"endTimeline"}),p.postMessage({action:"flush"})}function Kl(s,p){s.postMessage({action:p}),sd(s)}function Qr(s){var p=s.transmuxer,h=s.endAction||s.action,n=s.callback,u=Z({},s,{endAction:null,transmuxer:null,callback:null}),m=function y(T){T.data.action===h&&(p.removeEventListener("message",y),T.data.data&&(T.data.data=new Uint8Array(T.data.data,s.byteOffset||0,s.byteLength||T.data.data.byteLength),s.data&&(s.data=T.data.data)),n(T.data))};p.addEventListener("message",m),s.data?(m=s.data instanceof ArrayBuffer,u.byteOffset=m?0:s.data.byteOffset,u.byteLength=s.data.byteLength,p.postMessage(u,m=[m?s.data:s.data.buffer])):p.postMessage(u)}function $s(s){s.forEach(function(p){p.abort()})}function Vs(s,p){return p.timedout?{status:p.status,message:"HLS request timed-out at URL: "+p.uri,code:Hs,xhr:p}:p.aborted?{status:p.status,message:"HLS request aborted at URL: "+p.uri,code:Ws,xhr:p}:s?{status:p.status,message:"HLS request errored at URL: "+p.uri,code:an,xhr:p}:"arraybuffer"===p.responseType&&0===p.response.byteLength?{status:p.status,message:"Empty HLS response at URL: "+p.uri,code:an,xhr:p}:null}function Hl(s,p,h){return function(n,u){var m=u.response;if(n=Vs(n,u))return h(n,s);if(16!==m.byteLength)return h({status:u.status,message:"Invalid HLS key at URL: "+u.uri,code:an,xhr:u},s);m=new DataView(m);for(var y=new Uint32Array([m.getUint32(0),m.getUint32(4),m.getUint32(8),m.getUint32(12)]),T=0;T<p.length;T++)p[T].bytes=y;return h(null,s)}}function Wl(s,p){var h=xs(s.map.bytes);if("mp4"!==h)return p({internal:!0,message:"Found unsupported "+(h||"unknown")+" container for initialization segment at URL: "+(s.map.resolvedUri||s.map.uri),code:an});Qr({action:"probeMp4Tracks",data:s.map.bytes,transmuxer:s.transmuxer,callback:function(u){var m=u.tracks;return s.map.bytes=u=u.data,m.forEach(function(y){s.map.tracks=s.map.tracks||{},s.map.tracks[y.type]||"number"==typeof(s.map.tracks[y.type]=y).id&&y.timescale&&(s.map.timescales=s.map.timescales||{},s.map.timescales[y.id]=y.timescale)}),p(null)}})}function zl(s){var p=s.segment,h=s.bytes,n=s.trackInfoFn,u=s.timingInfoFn,m=s.videoSegmentTimingInfoFn,y=s.audioSegmentTimingInfoFn,T=s.id3Fn,S=s.captionsFn,x=s.isEndOfTimeline,A=s.endedTimelineFn,L=s.dataFn,O=s.doneFn,j=s.onTransmuxerLog,B=new Uint8Array(h);if(0<cl(B,["moof"]).length){p.isFmp4=!0;var H=p.map.tracks,q={isFmp4:!0,hasVideo:!!H.video,hasAudio:!!H.audio};H.audio&&H.audio.codec&&"enca"!==H.audio.codec&&(q.audioCodec=H.audio.codec),H.video&&H.video.codec&&"encv"!==H.video.codec&&(q.videoCodec=H.video.codec),H.video&&H.audio&&(q.isMuxed=!0),n(p,q);var V=function(ee){L(p,{data:B,type:q.hasAudio&&!q.isMuxed?"audio":"video"}),ee&&ee.length&&S(p,ee),O(null,p,{})};Qr({action:"probeMp4StartTime",timescales:p.map.timescales,data:B,transmuxer:p.transmuxer,callback:function(ee){var ae=ee.data;ee=ee.startTime,h=ae.buffer,p.bytes=B=ae,q.hasAudio&&!q.isMuxed&&u(p,"audio","start",ee),q.hasVideo&&u(p,"video","start",ee),H.video&&ae.byteLength&&p.transmuxer?Qr({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:p.transmuxer,data:B,timescales:p.map.timescales,trackIds:[H.video.id],callback:function(ne){h=ne.data.buffer,p.bytes=B=ne.data,ne.logs.forEach(function(ie){j(J.mergeOptions(ie,{stream:"mp4CaptionParser"}))}),V(ne.captions)}}):V()}})}else if(p.transmuxer){if(void 0===p.container&&(p.container=xs(B)),"ts"!==p.container&&"aac"!==p.container)return n(p,{hasAudio:!1,hasVideo:!1}),O(null,p,{}),0;!function(s){var p=s.segment,h=s.bytes,n=s.trackInfoFn,u=s.timingInfoFn,m=s.videoSegmentTimingInfoFn,y=s.audioSegmentTimingInfoFn,T=s.id3Fn,S=s.captionsFn,x=s.isEndOfTimeline,A=s.endedTimelineFn,L=s.dataFn,O=s.doneFn,j=s.onTransmuxerLog,B=(s=p.map&&p.map.tracks||{},Boolean(s.audio&&s.video)),H=u.bind(null,p,"audio","start"),q=u.bind(null,p,"audio","end"),V=u.bind(null,p,"video","start"),ee=u.bind(null,p,"video","end");Qr({action:"probeTs",transmuxer:p.transmuxer,data:h,baseStartTime:p.baseStartTime,callback:function(ae){p.bytes=h=ae.data,(ae=ae.result)&&(n(p,{hasAudio:ae.hasAudio,hasVideo:ae.hasVideo,isMuxed:B}),n=null,ae.hasAudio&&!B&&H(ae.audioStart),ae.hasVideo&&V(ae.videoStart),V=H=null),function(s){if(!s.transmuxer.currentTransmux)return s.transmuxer.currentTransmux=s,void Gl(s);s.transmuxer.transmuxQueue.push(s)}({bytes:h,transmuxer:p.transmuxer,audioAppendStart:p.audioAppendStart,gopsToAlignWith:p.gopsToAlignWith,remux:B,onData:function(ne){ne.type="combined"===ne.type?"video":ne.type,L(p,ne)},onTrackInfo:function(ne){n&&(B&&(ne.isMuxed=!0),n(p,ne))},onAudioTimingInfo:function(ne){H&&void 0!==ne.start&&(H(ne.start),H=null),q&&void 0!==ne.end&&q(ne.end)},onVideoTimingInfo:function(ne){V&&void 0!==ne.start&&(V(ne.start),V=null),ee&&void 0!==ne.end&&ee(ne.end)},onVideoSegmentTimingInfo:function(ne){m(ne)},onAudioSegmentTimingInfo:function(ne){y(ne)},onId3:function(ne,ie){T(p,ne,ie)},onCaptions:function(ne){S(p,[ne])},isEndOfTimeline:x,onEndedTimeline:function(){A()},onTransmuxerLog:j,onDone:function(ne){O&&(ne.type="combined"===ne.type?"video":ne.type,O(null,p,ne))}})}})}({segment:p,bytes:h,trackInfoFn:n,timingInfoFn:u,videoSegmentTimingInfoFn:m,audioSegmentTimingInfoFn:y,id3Fn:T,captionsFn:S,isEndOfTimeline:x,endedTimelineFn:A,dataFn:L,doneFn:O,onTransmuxerLog:j})}else O(null,p,{})}function ql(s,p){var h=s.id,n=s.key,u=s.encryptedBytes,m=s.decryptionWorker;s=function y(T){T.data.source===h&&(m.removeEventListener("message",y),T=T.data.decrypted,p(new Uint8Array(T.bytes,T.byteOffset,T.byteLength)))},m.addEventListener("message",s),s=n.bytes.slice?n.bytes.slice():new Uint32Array(Array.prototype.slice.call(n.bytes)),m.postMessage(Nl({source:h,encrypted:u,key:s,iv:n.iv}),[u.buffer,s.buffer])}function Xl(s,p){return p=p.attributes||{},s&&s.mediaGroups&&s.mediaGroups.AUDIO&&p.AUDIO&&s.mediaGroups.AUDIO[p.AUDIO]}function Jr(s){var p={};return s.forEach(function(h){var n=h.mediaType,u=h.type;h=h.details,p[n]=p[n]||[],p[n].push(yu(""+u+h))}),Object.keys(p).forEach(function(h){return 1<p[h].length?(Xc("multiple "+h+" codecs found as attributes: "+p[h].join(", ")+". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs."),void(p[h]=null)):void(p[h]=p[h][0])}),p}function Yl(s){var p=0;return s.audio&&p++,s.video&&p++,p}function sr(s,p){var h,n=p.attributes||{},u=Jr(function(m){if((m=m.attributes||{}).CODECS)return pa(m.CODECS)}(p)||[]);return Xl(s,p)&&!u.audio&&!function(m,y){if(!Xl(m,y))return!0;var T,S=m.mediaGroups.AUDIO[(y=y.attributes||{}).AUDIO];for(T in S)if(!S[T].uri&&!S[T].playlists)return!0;return!1}(s,p)&&(h=Jr(function(m,y){if(!m.mediaGroups.AUDIO||!y)return null;var T,S=m.mediaGroups.AUDIO[y];if(!S)return null;for(T in S){var x=S[T];if(x.default&&x.playlists)return pa(x.playlists[0].attributes.CODECS)}return null}(s,n.AUDIO)||[])).audio&&(u.audio=h.audio),u}function Ql(s){if(s&&s.playlist){var p=s.playlist;return JSON.stringify({id:p.id,bandwidth:s.bandwidth,width:s.width,height:s.height,codecs:p.attributes&&p.attributes.CODECS||""})}}function Zr(s,p){return(s=s&&window.getComputedStyle(s))?s[p]:""}function vi(s,p){var h=s.slice();s.sort(function(n,u){var m=p(n,u);return 0===m?h.indexOf(n)-h.indexOf(u):m})}function Gs(s,p){var h,n;return(h=(h=s.attributes.BANDWIDTH?s.attributes.BANDWIDTH:h)||window.Number.MAX_VALUE)-((n=p.attributes.BANDWIDTH?p.attributes.BANDWIDTH:n)||window.Number.MAX_VALUE)}function Jl(s,p,h,n,u,m){if(s){var y={bandwidth:p,width:h,height:n,limitRenditionByPlayerDimensions:u},T=s.playlists;zt.isAudioOnly(s)&&(T=m.getAudioTrackPlaylists_(),y.audioOnly=!0);var S=T.map(function(V){return{bandwidth:V.attributes&&V.attributes.BANDWIDTH||window.Number.MAX_VALUE,width:V.attributes&&V.attributes.RESOLUTION&&V.attributes.RESOLUTION.width,height:V.attributes&&V.attributes.RESOLUTION&&V.attributes.RESOLUTION.height,playlist:V}});vi(S,function(V,ee){return V.bandwidth-ee.bandwidth});var O,j,B,x=(S=S.filter(function(V){return!zt.isIncompatible(V.playlist)})).filter(function(V){return zt.isEnabled(V.playlist)}),A=(s=(x=x.length?x:S.filter(function(V){return!zt.isDisabled(V.playlist)})).filter(function(V){return V.bandwidth*bt.BANDWIDTH_VARIANCE<p}))[s.length-1];if(T=s.filter(function(V){return V.bandwidth===A.bandwidth})[0],!1===u){var L=T||x[0]||S[0];return L&&L.playlist?(u=T?"bandwidthBestRep":"sortedPlaylistReps",x[0]&&(u="enabledPlaylistReps"),rn("choosing "+Ql(L)+" using "+u+" with options",y),L.playlist):(rn("could not choose a playlist with options",y),null)}vi(L=s.filter(function(V){return V.width&&V.height}),function(V,ee){return V.width-ee.width}),A=(s=L.filter(function(V){return V.width===h&&V.height===n}))[s.length-1],(s=s.filter(function(V){return V.bandwidth===A.bandwidth})[0])||(j=(O=L.filter(function(V){return V.width>h||V.height>n})).filter(function(V){return V.width===O[0].width&&V.height===O[0].height}),A=j[j.length-1],j=j.filter(function(V){return V.bandwidth===A.bandwidth})[0]),m.experimentalLeastPixelDiffSelector&&(vi(H=L.map(function(V){return V.pixelDiff=Math.abs(V.width-h)+Math.abs(V.height-n),V}),function(V,ee){return V.pixelDiff===ee.pixelDiff?ee.bandwidth-V.bandwidth:V.pixelDiff-ee.pixelDiff}),B=H[0]);var H=B||j||s||T||x[0]||S[0];return H&&H.playlist?(S="sortedPlaylistReps",B?S="leastPixelDiffRep":j?S="resolutionPlusOneRep":s?S="resolutionBestRep":T?S="bandwidthBestRep":x[0]&&(S="enabledPlaylistReps"),rn("choosing "+Ql(H)+" using "+S+" with options",y),H.playlist):(rn("could not choose a playlist with options",y),null)}}function or(s,p,h){var n,u;if(h&&h.cues)for(n=h.cues.length;n--;)(u=h.cues[n]).startTime>=s&&u.endTime<=p&&h.removeCue(u)}function Zl(s){return"number"==typeof s&&isFinite(s)}function Ti(s){var p=s.startOfSegment,h=s.duration,n=s.segment,u=s.part,m=s.playlist,y=m.mediaSequence,T=m.id,S=m.segments,x=s.mediaIndex,A=s.partIndex,L=s.timeline,O=(void 0===S?[]:S).length-1,j="mediaIndex/partIndex increment";return s.getMediaInfoForTime?j="getMediaInfoForTime ("+s.getMediaInfoForTime+")":s.isSyncRequest&&(j="getSyncSegmentCandidate (isSyncRequest)"),s.independent&&(j+=" with independent "+s.independent),S=s.segment.uri?"segment":"pre-segment",s=(m="number"==typeof A)?Tl({preloadSegment:n})-1:0,S+" ["+(y+x)+"/"+(y+O)+"]"+(m?" part ["+A+"/"+s+"]":"")+" segment start/end ["+n.start+" => "+n.end+"]"+(m?" part start/end ["+u.start+" => "+u.end+"]":"")+" startOfSegment ["+p+"] duration ["+h+"] timeline ["+L+"] selected by ["+j+"] playlist ["+T+"]"}function ed(s){return s+"TimingInfo"}function td(s){var p=s.timelineChangeController,h=s.currentTimeline,n=s.segmentTimeline,u=s.loaderType;if(s=s.audioDisabled,h!==n){if("audio"===u)return!(h=p.lastTimelineChange({type:"main"}))||h.to!==n;if("main"===u&&s)return!((p=p.pendingTimelineChange({type:"audio"}))&&p.to===n)}}function ad(s){var p=s.segmentDuration;return s=s.maxDuration,!!p&&Math.round(p)>s+Ha}Is.forEach(function(s){var p=_i[s];_i[s]=function(h){return p(Ae(h))}});var Kc=_i,en=9e4,na=function(s,p){if(/^[a-z]+:/i.test(p))return p;/^data:/.test(s)&&(s=window.location&&window.location.href||"");var h="function"==typeof window.URL,n=/^\/\//.test(s),u=!window.location&&!/\/\//i.test(s);return h?s=new window.URL(s,window.location||gu):/\/\//i.test(s)||(s=Dr.buildAbsoluteURL(window.location&&window.location.href||"",s)),h?(h=new URL(p,s),u?h.href.slice(gu.length):n?h.href.slice(h.protocol.length):h.href):Dr.buildAbsoluteURL(s,p)},Ha=1/30,id=J.createTimeRange,zt={liveEdgeDelay:El,duration:Cl,seekable:function(s,p,h){var n=p||0;return null===(h=bl(s,p,!0,h))?id():id(n,h)},getMediaInfoForTime:function(s){for(var p=s.playlist,h=s.currentTime,n=s.startingSegmentIndex,u=s.startingPartIndex,m=s.startTime,y=s.experimentalExactManifestTimings,T=h-m,S=Ds(p),x=0,A=0;A<S.length;A++){var L=S[A];if(n===L.segmentIndex&&("number"!=typeof u||"number"!=typeof L.partIndex||u===L.partIndex)){x=A;break}}if(T<0){if(0<x)for(var O=x-1;0<=O;O--){var j=S[O];if(T+=j.duration,y){if(T<0)continue}else if(T+Ha<=0)continue;return{partIndex:j.partIndex,segmentIndex:j.segmentIndex,startTime:m-ir({defaultDuration:p.targetDuration,durationList:S,startIndex:x,endIndex:O})}}return{partIndex:S[0]&&S[0].partIndex||null,segmentIndex:S[0]&&S[0].segmentIndex||0,startTime:h}}if(x<0){for(var B=x;B<0;B++)if((T-=p.targetDuration)<0)return{partIndex:S[0]&&S[0].partIndex||null,segmentIndex:S[0]&&S[0].segmentIndex||0,startTime:h};x=0}for(var H=x;H<S.length;H++){var q=S[H];if(T-=q.duration,y){if(0<T)continue}else if(0<=T-Ha)continue;return{partIndex:q.partIndex,segmentIndex:q.segmentIndex,startTime:m+ir({defaultDuration:p.targetDuration,durationList:S,startIndex:x,endIndex:H})}}return{segmentIndex:S[S.length-1].segmentIndex,partIndex:S[S.length-1].partIndex,startTime:h}},isEnabled:Xr,isDisabled:function(s){return s.disabled},isBlacklisted:Pl,isIncompatible:Rs,playlistEnd:bl,isAes:function(s){for(var p=0;p<s.segments.length;p++)if(s.segments[p].key)return!0;return!1},hasAttribute:Al,estimateSegmentRequestTime:function(s,p,h,n){return Al("BANDWIDTH",h)?(s*h.attributes.BANDWIDTH-8*(n=void 0===n?0:n))/p:NaN},isLowestEnabledRendition:Ls,isAudioOnly:rr,playlistMatch:Ns,segmentDurationWithParts:ws},rd=J.log,tn=J.mergeOptions,Ei=function(s){function p(n,u,m){var y;if(void 0===m&&(m={}),y=s.call(this)||this,!n)throw new Error("A non-empty playlist URL or object is required");y.logger_=ra("PlaylistLoader");var T=void 0!==(T=m.withCredentials)&&T;return m=void 0!==(m=m.handleManifestRedirects)&&m,y.src=n,y.vhs_=u,y.withCredentials=T,y.handleManifestRedirects=m,y.customTagParsers=(u=u.options_)&&u.customTagParsers||[],y.customTagMappers=u&&u.customTagMappers||[],y.experimentalLLHLS=u&&u.experimentalLLHLS||!1,J.browser.IE_VERSION&&(y.experimentalLLHLS=!1),y.state="HAVE_NOTHING",y.handleMediaupdatetimeout_=y.handleMediaupdatetimeout_.bind(De(y)),y.on("mediaupdatetimeout",y.handleMediaupdatetimeout_),y}ge(p,s);var h=p.prototype;return h.handleMediaupdatetimeout_=function(){var n,u,m=this;"HAVE_METADATA"===this.state&&(n=this.media(),u=na(this.master.uri,n.uri),this.experimentalLLHLS&&(u=function(y,T){if(T.endList||!T.serverControl)return y;var S,x,A,L,O={};return T.serverControl.canBlockReload&&(S=T.mediaSequence+T.segments.length,(A=T.preloadSegment)&&(x=A.parts||[],-1<(A=Tl(T)-1)&&A!=x.length-1&&(O._HLS_part=A),(-1<A||x.length)&&S--),O._HLS_msn=S),T.serverControl&&T.serverControl.canSkipUntil&&(O._HLS_skip=T.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(O).length&&(L=new window.URL(y),["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(j){O.hasOwnProperty(j)&&L.searchParams.set(j,O[j])}),y=L.toString()),y}(u,n)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:u,withCredentials:this.withCredentials},function(y,T){if(m.request)return y?m.playlistRequestError(m.request,m.media(),"HAVE_METADATA"):void m.haveMetadata({playlistString:m.request.responseText,url:m.media().uri,id:m.media().id})}))},h.playlistRequestError=function(n,u,m){var y=u.uri;u=u.id,this.request=null,m&&(this.state=m),this.error={playlist:this.master.playlists[u],status:n.status,message:"HLS playlist request error at URL: "+y+".",responseText:n.responseText,code:500<=n.status?4:2},this.trigger("error")},h.parseManifest_=function(n){var u=this,m=n.url;return function(y){var T=y.onwarn,S=y.oninfo,x=y.manifestString,L=void 0===(A=y.customTagParsers)?[]:A,A=void 0===(A=y.customTagMappers)?[]:A,O=(y=y.experimentalLLHLS,new Hh);T&&O.on("warn",T),S&&O.on("info",S),L.forEach(function(H){return O.addParser(H)}),A.forEach(function(H){return O.addTagMapper(H)}),O.push(x),O.end();var j=O.manifest;y||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(H){j.hasOwnProperty(H)&&delete j[H]}),j.segments&&j.segments.forEach(function(H){["parts","preloadHints"].forEach(function(q){H.hasOwnProperty(q)&&delete H[q]})})),j.targetDuration||(B=10,j.segments&&j.segments.length&&(B=j.segments.reduce(function(H,q){return Math.max(H,q.duration)},0)),T&&T("manifest has no targetDuration defaulting to "+B),j.targetDuration=B);var B=vl(j);return B.length&&!j.partTargetDuration&&(B=B.reduce(function(H,q){return Math.max(H,q.duration)},0),T&&(T("manifest has no partTargetDuration defaulting to "+B),rd.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),j.partTargetDuration=B),j}({onwarn:function(y){return u.logger_("m3u8-parser warn for "+m+": "+(y=y.message))},oninfo:function(y){return u.logger_("m3u8-parser info for "+m+": "+(y=y.message))},manifestString:n.manifestString,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,experimentalLLHLS:this.experimentalLLHLS})},h.haveMetadata=function(n){var u=n.playlistString,m=n.playlistObject,y=n.url;n=n.id,this.request=null,this.state="HAVE_METADATA",(u=m||this.parseManifest_({url:y,manifestString:u})).lastRequest=Date.now(),xl({playlist:u,uri:y,id:n}),y=Us(this.master,u),this.targetDuration=u.partTargetDuration||u.targetDuration,this.pendingMedia_=null,y?(this.master=y,this.media_=this.master.playlists[n]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Bs(this.media(),!!y)),this.trigger("loadedplaylist")},h.dispose=function(){this.trigger("dispose"),this.stopRequest(),window.clearTimeout(this.mediaUpdateTimeout),window.clearTimeout(this.finalRenditionTimeout),this.off()},h.stopRequest=function(){var n;this.request&&(n=this.request,this.request=null,n.onreadystatechange=null,n.abort())},h.media=function(n,u){var m=this;if(!n)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof n){if(!this.master.playlists[n])throw new Error("Unknown playlist URI: "+n);n=this.master.playlists[n]}if(window.clearTimeout(this.finalRenditionTimeout),u){var y=(n.partTargetDuration||n.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=window.setTimeout(this.media.bind(this,n,!1),y)}else{var T=this.state;if(u=!this.media_||n.id!==this.media_.id,(y=this.master.playlists[n.id])&&y.endList||n.endList&&n.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=n,void(u&&(this.trigger("mediachanging"),this.trigger("HAVE_MASTER"===T?"loadedmetadata":"mediachange")));if(this.updateMediaUpdateTimeout_(Bs(n,!0)),u){if(this.state="SWITCHING_MEDIA",this.request){if(n.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=n,this.request=this.vhs_.xhr({uri:n.resolvedUri,withCredentials:this.withCredentials},function(A,L){if(m.request){if(n.lastRequest=Date.now(),n.resolvedUri=zr(m.handleManifestRedirects,n.resolvedUri,L),A)return m.playlistRequestError(m.request,n,T);m.haveMetadata({playlistString:L.responseText,url:n.uri,id:n.id}),m.trigger("HAVE_MASTER"===T?"loadedmetadata":"mediachange")}})}}},h.pause=function(){this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.state=this.media_?"HAVE_METADATA":"HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")},h.load=function(n){var u=this;this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);var m=this.media();n?(n=m?(m.partTargetDuration||m.targetDuration)/2*1e3:5e3,this.mediaUpdateTimeout=window.setTimeout(function(){u.mediaUpdateTimeout=null,u.load()},n)):this.started?this.trigger(m&&!m.endList?"mediaupdatetimeout":"loadedplaylist"):this.start()},h.updateMediaUpdateTimeout_=function(n){var u=this;this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=window.setTimeout(function(){u.mediaUpdateTimeout=null,u.trigger("mediaupdatetimeout"),u.updateMediaUpdateTimeout_(n)},n))},h.start=function(){var n=this;if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=window.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(function(){n.setupInitialPlaylist(n.src)},0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},function(u,m){if(n.request){if(n.request=null,u)return n.error={status:m.status,message:"HLS playlist request error at URL: "+n.src+".",responseText:m.responseText,code:2},"HAVE_NOTHING"===n.state&&(n.started=!1),n.trigger("error");n.src=zr(n.handleManifestRedirects,n.src,m),m=n.parseManifest_({manifestString:m.responseText,url:n.src}),n.setupInitialPlaylist(m)}})},h.srcUri=function(){return"string"==typeof this.src?this.src:this.src.uri},h.setupInitialPlaylist=function(n){if(this.state="HAVE_MASTER",n.playlists)return this.master=n,Ml(this.master,this.srcUri()),n.playlists.forEach(function(S){S.segments=Dl(S),S.segments.forEach(function(x){wl(x,S.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.master.playlists[0]));var u,m,y,T=this.srcUri()||window.location.href;this.master=(m=Os(0,u=T),(y={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:window.location.href,resolvedUri:window.location.href,playlists:[{uri:u,id:m,resolvedUri:u,attributes:{}}]}).playlists[m]=y.playlists[0],y.playlists[u]=y.playlists[0],y),this.haveMetadata({playlistObject:n,url:T,id:this.master.playlists[0].id}),this.trigger("loadedmetadata")},p}(tt=J.EventTarget),Hc=J.xhr,Wc=J.mergeOptions,nd=(da=Object.freeze({__proto__:null,createTransferableMessage:Nl,initSegmentId:Yr,segmentKeyId:Ol,hexDump:Ul,tagDump:function(s){return Ul(s=s.bytes)},textRanges:function(s){for(var p,h,n="",u=0;u<s.length;u++)n+=(p=s).start(h=u)+"-"+p.end(h)+" ";return n}}),J.mergeOptions),Ks=function(s){function p(n,u,m,y){var T;if(void 0===m&&(m={}),(T=s.call(this)||this).masterPlaylistLoader_=y||De(T),y||(T.isMaster_=!0),y=void 0!==(y=m.withCredentials)&&y,m=void 0!==(m=m.handleManifestRedirects)&&m,T.vhs_=u,T.withCredentials=y,T.handleManifestRedirects=m,!n)throw new Error("A non-empty playlist URL or object is required");return T.on("minimumUpdatePeriod",function(){T.refreshXml_()}),T.on("mediaupdatetimeout",function(){T.refreshMedia_(T.media().id)}),T.state="HAVE_NOTHING",T.loadedPlaylists_={},T.logger_=ra("DashPlaylistLoader"),T.isMaster_?(T.masterPlaylistLoader_.srcUrl=n,T.masterPlaylistLoader_.sidxMapping_={}):T.childPlaylist_=n,T}ge(p,s);var h=p.prototype;return h.requestErrored_=function(n,u,m){return!this.request||(this.request=null,n?(this.error="object"!=typeof n||n instanceof Error?{status:u.status,message:"DASH request error at URL: "+u.uri,response:u.response,code:2}:n,m&&(this.state=m),this.trigger("error"),!0):void 0)},h.addSidxSegments_=function(n,u,m){var y,T,S=this,x=n.sidx&&Gr(n.sidx);n.sidx&&x&&!this.masterPlaylistLoader_.sidxMapping_[x]?(y=zr(this.handleManifestRedirects,n.sidx.resolvedUri),T=function(A,L){if(!S.requestErrored_(A,L,u)){var O;A=S.masterPlaylistLoader_.sidxMapping_;try{O=function(s){var p=new DataView(s.buffer,s.byteOffset,s.byteLength),h={version:s[0],flags:new Uint8Array(s.subarray(1,4)),references:[],referenceId:p.getUint32(4),timescale:p.getUint32(8)},n=12;0===h.version?(h.earliestPresentationTime=p.getUint32(n),h.firstOffset=p.getUint32(n+4),n+=8):(h.earliestPresentationTime=p.getUint32(n)*fl+p.getUint32(n+4),h.firstOffset=p.getUint32(n+8)*fl+p.getUint32(n+12),n+=16);var u=p.getUint16(n+=2);for(n+=2;0<u;n+=12,u--)h.references.push({referenceType:(128&s[n])>>>7,referencedSize:2147483647&p.getUint32(n),subsegmentDuration:p.getUint32(n+4),startsWithSap:!!(128&s[n+8]),sapType:(112&s[n+8])>>>4,sapDeltaTime:268435455&p.getUint32(n+8)});return h}(Ae(L.response).subarray(8))}catch(B){return void S.requestErrored_(B,L,u)}return A[x]={sidxInfo:n.sidx,sidx:O},vs(n,O,n.sidx.resolvedUri),m(!0)}},this.request=function(s,p,h){function n(x,A,L,O){return A.abort(),T=!0,h(x,A,L,O)}function u(x,A){if(!T){if(x)return n(x,A,"",y);var L=A.responseText.substring(y&&y.byteLength||0,A.responseText.length);return y=function(){for(var O=arguments.length,j=new Array(O),B=0;B<O;B++)j[B]=arguments[B];if((j=j.filter(function(ee){return ee&&(ee.byteLength||ee.length)&&"string"!=typeof ee})).length<=1)return Ae(j[0]);var H=j.reduce(function(ee,ae,ne){return ee+(ae.byteLength||ae.length)},0),q=new Uint8Array(H),V=0;return j.forEach(function(ee){ee=Ae(ee),q.set(ee,V),V+=ee.byteLength}),q}(y,dl(L,!0)),m=m||yi(y),y.length<10||m&&y.length<m+2||"ts"===(L=xs(y))&&y.length<188||!L&&y.length<376?function(s,p){if(4===s.readyState)return p()}(A,function(){return n(x,A,"",y)}):n(null,A,L,y)}}var m,y=[],T=!1,S=p({uri:s,beforeSend:function(x){x.overrideMimeType("text/plain; charset=x-user-defined"),x.addEventListener("progress",function(A){return Fs(x,null,{statusCode:x.status},u)})}},function(x,A){return Fs(S,x,A,u)});return S}(y,this.vhs_.xhr,function(A,L,O,j){return A?T(A,L):O&&"mp4"===O?(O=(B=n.sidx.byterange).offset,j.length>=(B=B.length)+O?T(A,{response:j.subarray(O,O+B),status:L.status,uri:L.uri}):void(S.request=S.vhs_.xhr({uri:y,responseType:"arraybuffer",headers:js({byterange:n.sidx.byterange})},T))):T({status:L.status,message:"Unsupported "+(O||"unknown")+" container type for sidx segment at URL: "+y,response:"",playlist:n,internal:!0,blacklistDuration:1/0,code:2},L);var B})):this.mediaRequest_=window.setTimeout(function(){return m(!1)},0)},h.dispose=function(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},window.clearTimeout(this.minimumUpdatePeriodTimeout_),window.clearTimeout(this.mediaRequest_),window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.off()},h.hasPendingRequest=function(){return this.request||this.mediaRequest_},h.stopRequest=function(){var n;this.request&&(n=this.request,this.request=null,n.onreadystatechange=null,n.abort())},h.media=function(n){var u=this;if(!n)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var m=this.state;if("string"==typeof n){if(!this.masterPlaylistLoader_.master.playlists[n])throw new Error("Unknown playlist URI: "+n);n=this.masterPlaylistLoader_.master.playlists[n]}var y=!this.media_||n.id!==this.media_.id;if(y&&this.loadedPlaylists_[n.id]&&this.loadedPlaylists_[n.id].endList)return this.state="HAVE_METADATA",this.media_=n,void(y&&(this.trigger("mediachanging"),this.trigger("mediachange")));y&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(n,m,function(T){u.haveMetadata({startingState:m,playlist:n})}))},h.haveMetadata=function(n){var u=n.startingState;n=n.playlist,this.state="HAVE_METADATA",this.loadedPlaylists_[n.id]=n,this.mediaRequest_=null,this.refreshMedia_(n.id),this.trigger("HAVE_MASTER"===u?"loadedmetadata":"mediachange")},h.pause=function(){this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMaster_&&(window.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_),this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)},h.load=function(n){var u=this;window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;var m=this.media();n?(n=m?m.targetDuration/2*1e3:5e3,this.mediaUpdateTimeout=window.setTimeout(function(){return u.load()},n)):this.started?m&&!m.endList?(this.isMaster_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()},h.start=function(){var n=this;this.started=!0,this.isMaster_?this.requestMaster_(function(u,m){n.haveMaster_(),n.hasPendingRequest()||n.media_||n.media(n.masterPlaylistLoader_.master.playlists[0])}):this.mediaRequest_=window.setTimeout(function(){return n.haveMaster_()},0)},h.requestMaster_=function(n){var u=this;this.request=this.vhs_.xhr({uri:this.masterPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},function(m,y){if(!u.requestErrored_(m,y)){var T=y.responseText!==u.masterPlaylistLoader_.masterXml_;return u.masterPlaylistLoader_.masterXml_=y.responseText,u.masterLoaded_=y.responseHeaders&&y.responseHeaders.date?Date.parse(y.responseHeaders.date):Date.now(),u.masterPlaylistLoader_.srcUrl=zr(u.handleManifestRedirects,u.masterPlaylistLoader_.srcUrl,y),T?(u.handleMaster_(),void u.syncClientServerClock_(function(){return n(y,T)})):n(y,T)}"HAVE_NOTHING"===u.state&&(u.started=!1)})},h.syncClientServerClock_=function(n){var u=this,m=function(s){return function(p){if(!(p=mt(p,"UTCTiming")[0]))return null;var h=Nt(p);switch(h.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":h.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":h.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":h.method="DIRECT",h.value=Date.parse(h.value);break;default:throw new Error("UNSUPPORTED_UTC_TIMING_SCHEME")}return h}(ll(s))}(this.masterPlaylistLoader_.masterXml_);return null===m?(this.masterPlaylistLoader_.clientOffset_=this.masterLoaded_-Date.now(),n()):"DIRECT"===m.method?(this.masterPlaylistLoader_.clientOffset_=m.value-Date.now(),n()):void(this.request=this.vhs_.xhr({uri:na(this.masterPlaylistLoader_.srcUrl,m.value),method:m.method,withCredentials:this.withCredentials},function(y,T){if(u.request){if(y)return u.masterPlaylistLoader_.clientOffset_=u.masterLoaded_-Date.now(),n();T="HEAD"===m.method?T.responseHeaders&&T.responseHeaders.date?Date.parse(T.responseHeaders.date):u.masterLoaded_:Date.parse(T.responseText),u.masterPlaylistLoader_.clientOffset_=T-Date.now(),n()}}))},h.haveMaster_=function(){this.state="HAVE_MASTER",this.isMaster_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)},h.handleMaster_=function(){this.mediaRequest_=null;var u=(y=function(s,p){void 0===p&&(p={});var h=function(s,p){var h=p=void 0===p?{}:p,n=void 0===(m=h.manifestUri)?"":m,u=(p=void 0===(u=h.NOW)?Date.now():u,void 0===(m=h.clientOffset)?0:m);if(!(h=mt(s,"Period")).length)throw new Error(fc);var m=mt(s,"Location"),y=Nt(s);s=Kr([n],mt(s,"BaseURL")),y.type=y.type||"static",y.sourceDuration=y.mediaPresentationDuration||0,y.NOW=p,y.clientOffset=u,m.length&&(y.locations=m.map(Es));var T,S,x=[];return h.forEach(function(A,L){var O,j=Nt(A),B=x[L-1];j.start=(L=(O={attributes:j,priorPeriodAttributes:B?B.attributes:null,mpdType:y.type}).attributes,B=O.priorPeriodAttributes,O=O.mpdType,"number"==typeof L.start?L.start:B&&"number"==typeof B.start&&"number"==typeof B.duration?B.start+B.duration:B||"static"!==O?null:0),x.push({node:A,attributes:j})}),{locations:y.locations,representationInfo:Vr(x.map((T=y,S=s,function(A,L){var O=Kr(S,mt(A.node,"BaseURL")),j=parseInt(A.attributes.id,10);return L=window.isNaN(j)?L:j,j=Lt(T,{periodIndex:L,periodStart:A.attributes.start}),"number"==typeof A.attributes.duration&&(j.periodDuration=A.attributes.duration),L=mt(A.node,"AdaptationSet"),A=Ss(A.node),Vr(L.map(function(s,p,h){return function(n){var u=Nt(n),m=Kr(p,mt(n,"BaseURL")),y={role:Nt(y=mt(n,"Role")[0])};u=Lt(s,u,y),(y="urn:scte:dash:cc:cea-608:2015"===(y=Nt(y=mt(n,"Accessibility")[0])).schemeIdUri?("string"!=typeof y.value?[]:y.value.split(";")).map(function(L){var O,j,B;return/^CC\d=/.test(B=L)?(j=(O=L.split("="))[0],B=O[1]):/^CC\d$/.test(L)&&(j=L),{channel:j,language:B}}):"urn:scte:dash:cc:cea-708:2015"===y.schemeIdUri?("string"!=typeof y.value?[]:y.value.split(";")).map(function(L){var O,j,B={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};return/=/.test(L)?(O=(j=L.split("="))[0],j=void 0===(j=j[1])?"":j,B.channel=O,B.language=L,j.split(",").forEach(function(H){H=(q=H.split(":"))[0];var q=q[1];"lang"===H?B.language=q:"er"===H?B.easyReader=Number(q):"war"===H?B.aspectRatio=Number(q):"3D"===H&&(B["3D"]=Number(q))})):B.language=L,B.channel&&(B.channel="SERVICE"+B.channel),B}):void 0)&&(u=Lt(u,{captionServices:y})),(y=mt(n,"Label")[0])&&y.childNodes.length&&(u=Lt(u,{label:T=y.childNodes[0].nodeValue.trim()}));var S,x,A,T=mt(n,"ContentProtection").reduce(function(L,O){var j=Nt(O),B=Cc[j.schemeIdUri];return B&&(L[B]={attributes:j},(O=mt(O,"cenc:pssh")[0])&&(O=(O=Es(O))&&fu(O),L[B].pssh=O)),L},{});return Object.keys(T).length&&(u=Lt(u,{contentProtection:T})),T=Ss(n),n=mt(n,"Representation"),T=Lt(h,T),Vr(n.map((S=u,x=m,A=T,function(L){var O=mt(L,"BaseURL"),j=(O=Kr(x,O),Lt(S,Nt(L))),B=Ss(L);return O.map(function(H){return{segmentInfo:Lt(A,B),attributes:Lt(j,{baseUrl:H})}})})))}}(j,O,A)))})))}}(ll(s),p);return function(s,p,h){if(void 0===h&&(h={}),!s.length)return{};var L,n=(A=s[0].attributes).sourceDuration,u=A.type,m=A.suggestedPresentationDelay,y=A.minimumUpdatePeriod,T=sl(s.filter(ic)).map(ac),S=sl(s.filter(rc)),x=s.filter(nc),A=s.map(function(O){return O.attributes.captionServices}).filter(Boolean);return T={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:((s={AUDIO:{},VIDEO:{}})["CLOSED-CAPTIONS"]={},s.SUBTITLES={},s),uri:"",duration:n,playlists:function(O,j){if(void 0===j&&(j={}),!Object.keys(j).length)return O;for(var B in O)O[B]=Ts(O[B],j);return O}(T,h)},0<=y&&(T.minimumUpdatePeriod=1e3*y),p&&(T.locations=p),"dynamic"===u&&(T.suggestedPresentationDelay=m),m=0===T.playlists.length,S.length&&(T.mediaGroups.AUDIO.audio=function(s,p,h){var n;return void 0===p&&(p={}),void 0===h&&(h=!1),s=s.reduce(function(u,m){var y=m.attributes.role&&m.attributes.role.value||"",T=m.attributes.lang||"",S=m.attributes.label||"main";u[S=T&&!m.attributes.label?m.attributes.lang+(y?" ("+y+")":""):S]||(u[S]={language:T,autoselect:!0,default:"main"===y,playlists:[],uri:""});var x,A,L,O=Ts((A=h,L=(x=m).attributes,O=x.segments,T=x.sidx,O={attributes:((x={NAME:L.id,BANDWIDTH:L.bandwidth,CODECS:L.codecs})["PROGRAM-ID"]=1,x),uri:"",endList:"static"===L.type,timeline:L.periodIndex,resolvedUri:"",targetDuration:L.duration,segments:O,mediaSequence:O.length?O[0].number:1},L.contentProtection&&(O.contentProtection=L.contentProtection),T&&(O.sidx=T),A&&(O.attributes.AUDIO="audio",O.attributes.SUBTITLES="subs"),O),p);return u[S].playlists.push(O),void 0===n&&"main"===y&&((n=m).default=!0),u},{}),n||(s[Object.keys(s)[0]].default=!0),s}(S,h,m)),x.length&&(T.mediaGroups.SUBTITLES.subs=(void 0===(L=h)&&(L={}),x.reduce(function(O,j){var H,q,V,B=j.attributes.lang||"text";return O[B]||(O[B]={language:B,default:!1,autoselect:!1,playlists:[],uri:""}),O[B].playlists.push(Ts((q=(H=j).attributes,void 0===(V=H.segments)&&(V=[{uri:q.baseUrl,timeline:q.periodIndex,resolvedUri:q.baseUrl||"",duration:q.sourceDuration,number:0}],q.duration=q.sourceDuration),(H={NAME:q.id,BANDWIDTH:q.bandwidth})["PROGRAM-ID"]=1,q.codecs&&(H.CODECS=q.codecs),{attributes:H,uri:"",endList:"static"===q.type,timeline:q.periodIndex,resolvedUri:q.baseUrl||"",targetDuration:q.duration,segments:V,mediaSequence:V.length?V[0].number:1}),L)),O},{}))),A.length&&(T.mediaGroups["CLOSED-CAPTIONS"].cc=A.reduce(function(O,j){return j&&j.forEach(function(B){var q=B.language;O[q]={autoselect:!1,default:!1,instreamId:B.channel,language:q},B.hasOwnProperty("aspectRatio")&&(O[q].aspectRatio=B.aspectRatio),B.hasOwnProperty("easyReader")&&(O[q].easyReader=B.easyReader),B.hasOwnProperty("3D")&&(O[q]["3D"]=B["3D"])}),O},{})),T}(s=h.representationInfo.map(lc),h.locations,p.sidxMapping)}((y={masterXml:this.masterPlaylistLoader_.masterXml_,srcUrl:this.masterPlaylistLoader_.srcUrl,clientOffset:this.masterPlaylistLoader_.clientOffset_,sidxMapping:this.masterPlaylistLoader_.sidxMapping_}).masterXml,{manifestUri:m=y.srcUrl,clientOffset:u=y.clientOffset,sidxMapping:y=y.sidxMapping}),Ml(y,m),y),m=this.masterPlaylistLoader_.master;m&&(u=function(T,S,x){for(var A=!0,L=nd(T,{duration:S.duration,minimumUpdatePeriod:S.minimumUpdatePeriod}),O=0;O<S.playlists.length;O++){var j,B=S.playlists[O];B.sidx&&(j=Gr(B.sidx),x&&x[j]&&x[j].sidx&&vs(B,x[j].sidx,B.sidx.resolvedUri)),(B=Us(L,B,jl))&&(L=B,A=!1)}return nr(S,function(H,q,V,ee){var ae;H.playlists&&H.playlists.length&&(ae=H.playlists[0].id,(H=Us(L,H.playlists[0],jl))&&((L=H).mediaGroups[q][V][ee].playlists[0]=L.playlists[ae],A=!1))}),(A=S.minimumUpdatePeriod===T.minimumUpdatePeriod&&A)?null:L}(m,u,this.masterPlaylistLoader_.sidxMapping_)),this.masterPlaylistLoader_.master=u||m;var y=this.masterPlaylistLoader_.master.locations&&this.masterPlaylistLoader_.master.locations[0];return y&&y!==this.masterPlaylistLoader_.srcUrl&&(this.masterPlaylistLoader_.srcUrl=y),(!m||u&&u.minimumUpdatePeriod!==m.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),Boolean(u)},h.updateMinimumUpdatePeriodTimeout_=function(){var n=this.masterPlaylistLoader_;n.createMupOnMedia_&&(n.off("loadedmetadata",n.createMupOnMedia_),n.createMupOnMedia_=null),n.minimumUpdatePeriodTimeout_&&(window.clearTimeout(n.minimumUpdatePeriodTimeout_),n.minimumUpdatePeriodTimeout_=null);var u=n.master&&n.master.minimumUpdatePeriod;0===u&&(n.media()?u=1e3*n.media().targetDuration:(n.createMupOnMedia_=n.updateMinimumUpdatePeriodTimeout_,n.one("loadedmetadata",n.createMupOnMedia_))),"number"!=typeof u||u<=0?u<0&&this.logger_("found invalid minimumUpdatePeriod of "+u+", not setting a timeout"):this.createMUPTimeout_(u)},h.createMUPTimeout_=function(n){var u=this.masterPlaylistLoader_;u.minimumUpdatePeriodTimeout_=window.setTimeout(function(){u.minimumUpdatePeriodTimeout_=null,u.trigger("minimumUpdatePeriod"),u.createMUPTimeout_(n)},n)},h.refreshXml_=function(){var n=this;this.requestMaster_(function(u,m){var y,T;m&&(n.media_&&(n.media_=n.masterPlaylistLoader_.master.playlists[n.media_.id]),n.masterPlaylistLoader_.sidxMapping_=(T=$l((m=n.masterPlaylistLoader_.master).playlists,y=n.masterPlaylistLoader_.sidxMapping_),nr(m,function(S,x,A,L){S.playlists&&S.playlists.length&&(T=nd(T,$l(S=S.playlists,y)))}),T),n.addSidxSegments_(n.media(),n.state,function(S){n.refreshMedia_(n.media().id)}))})},h.refreshMedia_=function(n){var u=this;if(!n)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMaster_&&this.handleMaster_();var m=this.masterPlaylistLoader_.master.playlists,y=!this.media_||this.media_!==m[n];y?this.media_=m[n]:this.trigger("playlistunchanged"),this.mediaUpdateTimeout||function T(){u.media().endList||(u.mediaUpdateTimeout=window.setTimeout(function(){u.trigger("mediaupdatetimeout"),T()},Bs(u.media(),Boolean(y))))}(),this.trigger("loadedplaylist")},p}(Gt=J.EventTarget),bt={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30},zc=(Se=function(s){return function(){var p=function(u){try{return URL.createObjectURL(new Blob([u],{type:"application/javascript"}))}catch(y){var m=new BlobBuilder;return m.append(u),URL.createObjectURL(m.getBlob())}}(s),h=Vl(new Worker(p));h.objURL=p;var n=h.terminate;return h.on=h.addEventListener,h.off=h.removeEventListener,h.terminate=function(){return URL.revokeObjectURL(p),n.call(this)},h}})((Qe=function(s){return"var browserWorkerPolyFill = "+Vl.toString()+";\nbrowserWorkerPolyFill(self);\n"+s})((tt=function(s){return s.toString().replace(/^function.+?{/,"").slice(0,-1)})(function(){var s=function(){this.init=function(){var C={};this.on=function(I,D){C[I]||(C[I]=[]),C[I]=C[I].concat(D)},this.off=function(I,D){return!!C[I]&&(D=C[I].indexOf(D),C[I]=C[I].slice(),C[I].splice(D,1),-1<D)},this.trigger=function(I){var D,w,N,F=C[I];if(F)if(2===arguments.length)for(w=F.length,D=0;D<w;++D)F[D].call(this,arguments[1]);else{for(N=[],D=arguments.length,D=1;D<arguments.length;++D)N.push(arguments[D]);for(w=F.length,D=0;D<w;++D)F[D].apply(this,N)}},this.dispose=function(){C={}}}};s.prototype.pipe=function(C){return this.on("data",function(I){C.push(I)}),this.on("done",function(I){C.flush(I)}),this.on("partialdone",function(I){C.partialFlush(I)}),this.on("endedtimeline",function(I){C.endTimeline(I)}),this.on("reset",function(I){C.reset(I)}),C},s.prototype.push=function(C){this.trigger("data",C)},s.prototype.flush=function(C){this.trigger("done",C)},s.prototype.partialFlush=function(C){this.trigger("partialdone",C)},s.prototype.endTimeline=function(C){this.trigger("endedtimeline",C)},s.prototype.reset=function(C){this.trigger("reset",C)};var p,h,n,u,m,y,T,S,x,A,L,O,j,B,H,q,V,ee,ae,ne,ie,he,ke,ve,Ee,xe,Ne,Be,Ge,Oe,Tt,Pt,Qt,Ce,pe,ze,it,lt,rt,nt=s,gt=Math.pow(2,32)-1;function st(C,I){var D={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return D.dataOffset=I,D.compositionTimeOffset=C.pts-C.dts,D.duration=C.duration,D.size=4*C.length,D.size+=C.byteLength,C.keyFrame&&(D.flags.dependsOn=2,D.flags.isNonSyncSample=0),D}function Pe(C){for(var I=[];C--;)I.push(0);return I}(function(){if(ie={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(var C in ie)ie.hasOwnProperty(C)&&(ie[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);he=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),ve=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),ke=new Uint8Array([0,0,0,1]),Ee=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),xe=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),Ne={video:Ee,audio:xe},Oe=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Ge=new Uint8Array([0,0,0,0,0,0,0,0]),Tt=new Uint8Array([0,0,0,0,0,0,0,0]),Pt=Tt,Qt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ce=Tt,Be=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),p=function(C){for(var I,D=[],w=0,N=1;N<arguments.length;N++)D.push(arguments[N]);for(N=D.length;N--;)w+=D[N].byteLength;for(I=new Uint8Array(w+8),new DataView(I.buffer,I.byteOffset,I.byteLength).setUint32(0,I.byteLength),I.set(C,4),N=0,w=8;N<D.length;N++)I.set(D[N],w),w+=D[N].byteLength;return I},h=function(){return p(ie.dinf,p(ie.dref,Oe))},n=function(C){return p(ie.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,C.audioobjecttype<<3|C.samplingfrequencyindex>>>1,C.samplingfrequencyindex<<7|C.channelcount<<3,6,1,2]))},B=function(C){return p(ie.hdlr,Ne[C])},j=function(C){var I=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,C.duration>>>24&255,C.duration>>>16&255,C.duration>>>8&255,255&C.duration,85,196,0,0]);return C.samplerate&&(I[12]=C.samplerate>>>24&255,I[13]=C.samplerate>>>16&255,I[14]=C.samplerate>>>8&255,I[15]=255&C.samplerate),p(ie.mdhd,I)},O=function(C){return p(ie.mdia,j(C),B(C.type),y(C))},m=function(C){return p(ie.mfhd,new Uint8Array([0,0,0,0,(4278190080&C)>>24,(16711680&C)>>16,(65280&C)>>8,255&C]))},y=function(C){return p(ie.minf,"video"===C.type?p(ie.vmhd,Be):p(ie.smhd,Ge),h(),q(C))},Da=function(C,I){for(var D=[],w=I.length;w--;)D[w]=ee(I[w]);return p.apply(null,[ie.moof,m(C)].concat(D))},T=function(C){for(var I=C.length,D=[];I--;)D[I]=A(C[I]);return p.apply(null,[ie.moov,x(4294967295)].concat(D).concat(S(C)))},S=function(C){for(var I=C.length,D=[];I--;)D[I]=ae(C[I]);return p.apply(null,[ie.mvex].concat(D))},x=function(C){return C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&C)>>24,(16711680&C)>>16,(65280&C)>>8,255&C,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),p(ie.mvhd,C)},H=function(C){for(var I,D=C.samples||[],w=new Uint8Array(4+D.length),N=0;N<D.length;N++)w[N+4]=(I=D[N].flags).dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return p(ie.sdtp,w)},q=function(C){return p(ie.stbl,V(C),p(ie.stts,Ce),p(ie.stsc,Pt),p(ie.stsz,Qt),p(ie.stco,Tt))},V=function(C){return p(ie.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),("video"===C.type?pe:ze)(C))},pe=function(C){for(var I,D,w=C.sps||[],N=C.pps||[],F=[],K=[],W=0;W<w.length;W++)F.push((65280&w[W].byteLength)>>>8),F.push(255&w[W].byteLength),F=F.concat(Array.prototype.slice.call(w[W]));for(W=0;W<N.length;W++)K.push((65280&N[W].byteLength)>>>8),K.push(255&N[W].byteLength),K=K.concat(Array.prototype.slice.call(N[W]));return I=[ie.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&C.width)>>8,255&C.width,(65280&C.height)>>8,255&C.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p(ie.avcC,new Uint8Array([1,C.profileIdc,C.profileCompatibility,C.levelIdc,255].concat([w.length],F,[N.length],K))),p(ie.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],C.sarRatio&&(D=C.sarRatio[0],C=C.sarRatio[1],I.push(p(ie.pasp,new Uint8Array([(4278190080&D)>>24,(16711680&D)>>16,(65280&D)>>8,255&D,(4278190080&C)>>24,(16711680&C)>>16,(65280&C)>>8,255&C])))),p.apply(null,I)},ze=function(C){return p(ie.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&C.channelcount)>>8,255&C.channelcount,(65280&C.samplesize)>>8,255&C.samplesize,0,0,0,0,(65280&C.samplerate)>>8,255&C.samplerate,0,0]),n(C))},L=function(C){return C=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&C.id)>>24,(16711680&C.id)>>16,(65280&C.id)>>8,255&C.id,0,0,0,0,(4278190080&C.duration)>>24,(16711680&C.duration)>>16,(65280&C.duration)>>8,255&C.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&C.width)>>8,255&C.width,0,0,(65280&C.height)>>8,255&C.height,0,0]),p(ie.tkhd,C)},ee=function(C){var I,D=p(ie.tfhd,new Uint8Array([0,0,0,58,(4278190080&C.id)>>24,(16711680&C.id)>>16,(65280&C.id)>>8,255&C.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),w=Math.floor(C.baseMediaDecodeTime/(1+gt)),N=Math.floor(C.baseMediaDecodeTime%(1+gt));return w=p(ie.tfdt,new Uint8Array([1,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,N>>>24&255,N>>>16&255,N>>>8&255,255&N])),"audio"===C.type?(I=ne(C,92),p(ie.traf,D,w,I)):(N=H(C),I=ne(C,N.length+92),p(ie.traf,D,w,I,N))},A=function(C){return C.duration=C.duration||4294967295,p(ie.trak,L(C),O(C))},ae=function(C){var I=new Uint8Array([0,0,0,0,(4278190080&C.id)>>24,(16711680&C.id)>>16,(65280&C.id)>>8,255&C.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==C.type&&(I[I.length-1]=0),p(ie.trex,I)},it=function(C,I){var D=0,w=0,N=0,F=0;return C.length&&(void 0!==C[0].duration&&(D=1),void 0!==C[0].size&&(w=2),void 0!==C[0].flags&&(N=4),void 0!==C[0].compositionTimeOffset&&(F=8)),[0,0,D|w|N|F,1,(4278190080&C.length)>>>24,(16711680&C.length)>>>16,(65280&C.length)>>>8,255&C.length,(4278190080&I)>>>24,(16711680&I)>>>16,(65280&I)>>>8,255&I]},lt=function(C,I){var D,w,N,F,K=C.samples||[];for(I=it(K,I+=20+16*K.length),(w=new Uint8Array(I.length+16*K.length)).set(I),D=I.length,F=0;F<K.length;F++)w[D++]=(4278190080&(N=K[F]).duration)>>>24,w[D++]=(16711680&N.duration)>>>16,w[D++]=(65280&N.duration)>>>8,w[D++]=255&N.duration,w[D++]=(4278190080&N.size)>>>24,w[D++]=(16711680&N.size)>>>16,w[D++]=(65280&N.size)>>>8,w[D++]=255&N.size,w[D++]=N.flags.isLeading<<2|N.flags.dependsOn,w[D++]=N.flags.isDependedOn<<6|N.flags.hasRedundancy<<4|N.flags.paddingValue<<1|N.flags.isNonSyncSample,w[D++]=61440&N.flags.degradationPriority,w[D++]=15&N.flags.degradationPriority,w[D++]=(4278190080&N.compositionTimeOffset)>>>24,w[D++]=(16711680&N.compositionTimeOffset)>>>16,w[D++]=(65280&N.compositionTimeOffset)>>>8,w[D++]=255&N.compositionTimeOffset;return p(ie.trun,w)},rt=function(C,I){var D,w,N,F,K=C.samples||[];for(I=it(K,I+=20+8*K.length),(D=new Uint8Array(I.length+8*K.length)).set(I),w=I.length,F=0;F<K.length;F++)D[w++]=(4278190080&(N=K[F]).duration)>>>24,D[w++]=(16711680&N.duration)>>>16,D[w++]=(65280&N.duration)>>>8,D[w++]=255&N.duration,D[w++]=(4278190080&N.size)>>>24,D[w++]=(16711680&N.size)>>>16,D[w++]=(65280&N.size)>>>8,D[w++]=255&N.size;return p(ie.trun,D)},ne=function(C,I){return("audio"===C.type?rt:lt)(C,I)},u=function(){return p(ie.ftyp,he,ke,he,ve)};var ot,Ci=function(C){return p(ie.mdat,C)},un=Da,wa=[33,16,5,32,164,27],Qs=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],Pd=function(C){return 9e4*C},Js=function(C){return C/9e4},Wa=9e4,Ad=Pd,Ot=Js,Id=function(C,I){return Pd(function(C,I){return C/I}(C,I))},Zs=function(C,I,D){return Js(D?C:C-I)},bi=function(C){delete C.minSegmentDts,delete C.maxSegmentDts,delete C.minSegmentPts,delete C.maxSegmentPts},xd=function(C,I){var D=C.minSegmentDts;return I||(D-=C.timelineStartInfo.dts),I=C.timelineStartInfo.baseMediaDecodeTime,I+=D,I=Math.max(0,I),"audio"===C.type&&(I*=C.samplerate/9e4,I=Math.floor(I)),I},eo=function(C,I){"number"==typeof I.pts&&(void 0===C.timelineStartInfo.pts&&(C.timelineStartInfo.pts=I.pts),C.minSegmentPts=void 0===C.minSegmentPts?I.pts:Math.min(C.minSegmentPts,I.pts),C.maxSegmentPts=void 0===C.maxSegmentPts?I.pts:Math.max(C.maxSegmentPts,I.pts)),"number"==typeof I.dts&&(void 0===C.timelineStartInfo.dts&&(C.timelineStartInfo.dts=I.dts),C.minSegmentDts=void 0===C.minSegmentDts?I.dts:Math.min(C.minSegmentDts,I.dts),C.maxSegmentDts=void 0===C.maxSegmentDts?I.dts:Math.max(C.maxSegmentDts,I.dts))},Md=function(C){for(var I=C.byteLength,D=[],w=1;w<I-2;)0===C[w]&&0===C[w+1]&&3===C[w+2]?(D.push(w+2),w+=2):w++;if(0===D.length)return C;var N=I-D.length,F=new Uint8Array(N),K=0;for(w=0;w<N;K++,w++)K===D[0]&&(K++,D.shift()),F[w]=C[K];return F};function ln(C){return 32<=C&&C<=127||160<=C&&C<=255}function ba(C){this.windowNum=C,this.reset()}((qt=function C(I){I=I||{},C.prototype.init.call(this),this.parse708captions_="boolean"!=typeof I.parse708captions||I.parse708captions,this.captionPackets_=[],this.ccStreams_=[new ht(0,0),new ht(0,1),new ht(1,0),new ht(1,1)],this.parse708captions_&&(this.cc708Stream_=new et({captionServices:I.captionServices})),this.reset(),this.ccStreams_.forEach(function(D){D.on("data",this.trigger.bind(this,"data")),D.on("partialdone",this.trigger.bind(this,"partialdone")),D.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))}).prototype=new nt).push=function(C){var I,D;if("sei_rbsp"===C.nalUnitType&&(I=function(C){for(var I=0,D={payloadType:-1,payloadSize:0},w=0,N=0;I<C.byteLength&&128!==C[I];){for(;255===C[I];)w+=255,I++;for(w+=C[I++];255===C[I];)N+=255,I++;if(N+=C[I++],!D.payload&&4===w){if("GA94"===String.fromCharCode(C[I+3],C[I+4],C[I+5],C[I+6])){D.payloadType=w,D.payloadSize=N,D.payload=C.subarray(I,I+N);break}D.payload=void 0}I+=N,N=w=0}return D}(C.escapedRBSP)).payload&&4===I.payloadType&&(D=function(C){return 181!==C.payload[0]||49!=(C.payload[1]<<8|C.payload[2])||"GA94"!==String.fromCharCode(C.payload[3],C.payload[4],C.payload[5],C.payload[6])||3!==C.payload[7]?null:C.payload.subarray(8,C.payload.length-1)}(I)))if(C.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(C.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));D=function(C,I){var D,w,N,F,K=[];if(!(64&I[0]))return K;for(w=31&I[0],D=0;D<w;D++)F={type:3&I[2+(N=3*D)],pts:C},4&I[2+N]&&(F.ccData=I[3+N]<<8|I[4+N],K.push(F));return K}(C.pts,D),this.captionPackets_=this.captionPackets_.concat(D),this.latestDts_!==C.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=C.dts}},qt.prototype.flushCCStreams=function(C){this.ccStreams_.forEach(function(I){return"flush"===C?I.flush():I.partialFlush()},this)},qt.prototype.flushStream=function(C){this.captionPackets_.length&&(this.captionPackets_.forEach(function(I,D){I.presortIndex=D}),this.captionPackets_.sort(function(I,D){return I.pts===D.pts?I.presortIndex-D.presortIndex:I.pts-D.pts}),this.captionPackets_.forEach(function(I){I.type<2?this.dispatchCea608Packet(I):this.dispatchCea708Packet(I)},this),this.captionPackets_.length=0),this.flushCCStreams(C)},qt.prototype.flush=function(){return this.flushStream("flush")},qt.prototype.partialFlush=function(){return this.flushStream("partialFlush")},qt.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(C){C.reset()})},qt.prototype.dispatchCea608Packet=function(C){this.setsTextOrXDSActive(C)?this.activeCea608Channel_[C.type]=null:this.setsChannel1Active(C)?this.activeCea608Channel_[C.type]=0:this.setsChannel2Active(C)&&(this.activeCea608Channel_[C.type]=1),null!==this.activeCea608Channel_[C.type]&&this.ccStreams_[(C.type<<1)+this.activeCea608Channel_[C.type]].push(C)},qt.prototype.setsChannel1Active=function(C){return 4096==(30720&C.ccData)},qt.prototype.setsChannel2Active=function(C){return 6144==(30720&C.ccData)},qt.prototype.setsTextOrXDSActive=function(C){return 256==(28928&C.ccData)||4138==(30974&C.ccData)||6186==(30974&C.ccData)},qt.prototype.dispatchCea708Packet=function(C){this.parse708captions_&&this.cc708Stream_.push(C)};var Np={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600};function dn(C,I,D){this.serviceNum=C,this.text="",this.currentWindow=new ba(-1),this.windows=[],this.stream=D,"string"==typeof I&&this.createTextDecoder(I)}ba.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},ba.prototype.getText=function(){return this.rows.join("\n")},ba.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},ba.prototype.newLine=function(C){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(C),0<this.rows.length&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},ba.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},ba.prototype.addText=function(C){this.rows[this.rowIdx]+=C},ba.prototype.backspace=function(){var C;this.isEmpty()||(this.rows[this.rowIdx]=(C=this.rows[this.rowIdx]).substr(0,C.length-1))},dn.prototype.init=function(C,I){this.startPts=C;for(var D=0;D<8;D++)this.windows[D]=new ba(D),"function"==typeof I&&(this.windows[D].beforeRowOverflow=I)},dn.prototype.setCurrentWindow=function(C){this.currentWindow=this.windows[C]},dn.prototype.createTextDecoder=function(C){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(C)}catch(I){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+C+" encoding. "+I})}};var et=function C(I){I=I||{},C.prototype.init.call(this);var D,w=this,N=I.captionServices||{},F={};Object.keys(N).forEach(function(K){D=N[K],/^SERVICE/.test(K)&&(F[K]=D.encoding)}),this.serviceEncodings=F,this.current708Packet=null,this.services={},this.push=function(K){(3===K.type||null===w.current708Packet)&&w.new708Packet(),w.add708Bytes(K)}};function hn(C){return null===C?"":(C=Op[C]||C,String.fromCharCode(C))}function za(){for(var C=[],I=15;I--;)C.push("");return C}et.prototype=new nt,et.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},et.prototype.add708Bytes=function(C){var D=(I=C.ccData)>>>8,I=255&I;this.current708Packet.ptsVals.push(C.pts),this.current708Packet.data.push(D),this.current708Packet.data.push(I)},et.prototype.push708Packet=function(){var C,I=this.current708Packet,D=I.data,w=null,N=0,F=D[N++];for(I.seq=F>>6,I.sizeCode=63&F;N<D.length;N++)C=31&(F=D[N++]),7==(w=F>>5)&&0<C&&(w=D[N++]),this.pushServiceBlock(w,N,C),0<C&&(N+=C-1)},et.prototype.pushServiceBlock=function(C,I,D){for(var w,N=I,F=this.current708Packet.data,K=(K=this.services[C])||this.initService(C,N);N<I+D&&N<F.length;N++)ln(w=F[N])?N=this.handleText(N,K):24===w?N=this.multiByteCharacter(N,K):16===w?N=this.extendedCommands(N,K):128<=w&&w<=135?N=this.setCurrentWindow(N,K):152<=w&&w<=159?N=this.defineWindow(N,K):136===w?N=this.clearWindows(N,K):140===w?N=this.deleteWindows(N,K):137===w?N=this.displayWindows(N,K):138===w?N=this.hideWindows(N,K):139===w?N=this.toggleWindows(N,K):151===w?N=this.setWindowAttributes(N,K):144===w?N=this.setPenAttributes(N,K):145===w?N=this.setPenColor(N,K):146===w?N=this.setPenLocation(N,K):143===w?K=this.reset(N,K):8===w?K.currentWindow.backspace():12===w?K.currentWindow.clearText():13===w?K.currentWindow.pendingNewLine=!0:14===w?K.currentWindow.clearText():141===w&&N++},et.prototype.extendedCommands=function(C,I){return ln(this.current708Packet.data[++C])?this.handleText(C,I,{isExtended:!0}):C},et.prototype.getPts=function(C){return this.current708Packet.ptsVals[Math.floor(C/2)]},et.prototype.initService=function(C,I){var D,w="SERVICE"+C,N=this;return w in this.serviceEncodings&&(D=this.serviceEncodings[w]),this.services[C]=new dn(C,D,N),this.services[C].init(this.getPts(I),function(F){N.flushDisplayed(F,N.services[C])}),this.services[C]},et.prototype.handleText=function(C,I,D){var w,N=D&&D.isExtended,F=D&&D.isMultiByte,W=N?4096:0,X=(K=this.current708Packet.data)[C],K=(D=K[C+1],I.currentWindow),oe=I.textDecoder_&&!N?(F?(w=[X,D],C++):w=[X],I.textDecoder_.decode(new Uint8Array(w))):(oe=Np[X|=W]||X,4096&X&&X===oe?"":String.fromCharCode(oe));return K.pendingNewLine&&!K.isEmpty()&&K.newLine(this.getPts(C)),K.pendingNewLine=!1,K.addText(oe),C},et.prototype.multiByteCharacter=function(C,I){var w=(D=this.current708Packet.data)[C+1],D=D[C+2];return ln(w)&&ln(D)?this.handleText(++C,I,{isMultiByte:!0}):C},et.prototype.setCurrentWindow=function(C,I){return I.setCurrentWindow(7&this.current708Packet.data[C]),C},et.prototype.defineWindow=function(C,I){var D=this.current708Packet.data,w=D[C];return I.setCurrentWindow(7&w),w=D[++C],(I=I.currentWindow).visible=(32&w)>>5,I.rowLock=(16&w)>>4,I.columnLock=(8&w)>>3,I.priority=7&w,w=D[++C],I.relativePositioning=(128&w)>>7,I.anchorVertical=127&w,w=D[++C],I.anchorHorizontal=w,w=D[++C],I.anchorPoint=(240&w)>>4,I.rowCount=15&w,w=D[++C],I.columnCount=63&w,w=D[++C],I.windowStyle=(56&w)>>3,I.penStyle=7&w,I.virtualRowCount=I.rowCount+1,C},et.prototype.setWindowAttributes=function(C,I){var D=this.current708Packet.data,w=D[C];return w=D[++C],(I=I.currentWindow.winAttr).fillOpacity=(192&w)>>6,I.fillRed=(48&w)>>4,I.fillGreen=(12&w)>>2,I.fillBlue=3&w,w=D[++C],I.borderType=(192&w)>>6,I.borderRed=(48&w)>>4,I.borderGreen=(12&w)>>2,I.borderBlue=3&w,w=D[++C],I.borderType+=(128&w)>>5,I.wordWrap=(64&w)>>6,I.printDirection=(48&w)>>4,I.scrollDirection=(12&w)>>2,I.justify=3&w,w=D[++C],I.effectSpeed=(240&w)>>4,I.effectDirection=(12&w)>>2,I.displayEffect=3&w,C},et.prototype.flushDisplayed=function(C,I){for(var D=[],w=0;w<8;w++)I.windows[w].visible&&!I.windows[w].isEmpty()&&D.push(I.windows[w].getText());I.endPts=C,I.text=D.join("\n\n"),this.pushCaption(I),I.startPts=C},et.prototype.pushCaption=function(C){""!==C.text&&(this.trigger("data",{startPts:C.startPts,endPts:C.endPts,text:C.text,stream:"cc708_"+C.serviceNum}),C.text="",C.startPts=C.endPts)},et.prototype.displayWindows=function(C,I){var D=this.current708Packet.data[++C],w=this.getPts(C);this.flushDisplayed(w,I);for(var N=0;N<8;N++)D&1<<N&&(I.windows[N].visible=1);return C},et.prototype.hideWindows=function(C,I){var D=this.current708Packet.data[++C],w=this.getPts(C);this.flushDisplayed(w,I);for(var N=0;N<8;N++)D&1<<N&&(I.windows[N].visible=0);return C},et.prototype.toggleWindows=function(C,I){var D=this.current708Packet.data[++C],w=this.getPts(C);this.flushDisplayed(w,I);for(var N=0;N<8;N++)D&1<<N&&(I.windows[N].visible^=1);return C},et.prototype.clearWindows=function(C,I){var D=this.current708Packet.data[++C],w=this.getPts(C);this.flushDisplayed(w,I);for(var N=0;N<8;N++)D&1<<N&&I.windows[N].clearText();return C},et.prototype.deleteWindows=function(C,I){var D=this.current708Packet.data[++C],w=this.getPts(C);this.flushDisplayed(w,I);for(var N=0;N<8;N++)D&1<<N&&I.windows[N].reset();return C},et.prototype.setPenAttributes=function(C,I){var D=this.current708Packet.data,w=D[C];return w=D[++C],(I=I.currentWindow.penAttr).textTag=(240&w)>>4,I.offset=(12&w)>>2,I.penSize=3&w,w=D[++C],I.italics=(128&w)>>7,I.underline=(64&w)>>6,I.edgeType=(56&w)>>3,I.fontStyle=7&w,C},et.prototype.setPenColor=function(C,I){var D=this.current708Packet.data,w=D[C];return w=D[++C],(I=I.currentWindow.penColor).fgOpacity=(192&w)>>6,I.fgRed=(48&w)>>4,I.fgGreen=(12&w)>>2,I.fgBlue=3&w,w=D[++C],I.bgOpacity=(192&w)>>6,I.bgRed=(48&w)>>4,I.bgGreen=(12&w)>>2,I.bgBlue=3&w,w=D[++C],I.edgeRed=(48&w)>>4,I.edgeGreen=(12&w)>>2,I.edgeBlue=3&w,C},et.prototype.setPenLocation=function(C,I){var D=this.current708Packet.data,w=D[C],N=I.currentWindow.penLoc;return I.currentWindow.pendingNewLine=!0,w=D[++C],N.row=15&w,w=D[++C],N.column=63&w,C},et.prototype.reset=function(C,I){var D=this.getPts(C);return this.flushDisplayed(D,I),this.initService(I.serviceNum,C)};var Op={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Up=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],ht=function C(I,D){C.prototype.init.call(this),this.field_=I||0,this.dataChannel_=D||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(w){var N,F,K,W,X=32639&w.ccData;X!==this.lastControlCode_?(4096==(61440&X)?this.lastControlCode_=X:X!==this.PADDING_&&(this.lastControlCode_=null),N=X>>>8,F=255&X,X===this.PADDING_||(X===this.RESUME_CAPTION_LOADING_?this.mode_="popOn":X===this.END_OF_CAPTION_?(this.mode_="popOn",this.clearFormatting(w.pts),this.flushDisplayed(w.pts),W=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=W,this.startPts_=w.pts):X===this.ROLL_UP_2_ROWS_?(this.rollUpRows_=2,this.setRollUp(w.pts)):X===this.ROLL_UP_3_ROWS_?(this.rollUpRows_=3,this.setRollUp(w.pts)):X===this.ROLL_UP_4_ROWS_?(this.rollUpRows_=4,this.setRollUp(w.pts)):X===this.CARRIAGE_RETURN_?(this.clearFormatting(w.pts),this.flushDisplayed(w.pts),this.shiftRowsUp_(),this.startPts_=w.pts):X===this.BACKSPACE_?"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1):X===this.ERASE_DISPLAYED_MEMORY_?(this.flushDisplayed(w.pts),this.displayed_=za()):X===this.ERASE_NON_DISPLAYED_MEMORY_?this.nonDisplayed_=za():X===this.RESUME_DIRECT_CAPTIONING_?("paintOn"!==this.mode_&&(this.flushDisplayed(w.pts),this.displayed_=za()),this.mode_="paintOn",this.startPts_=w.pts):this.isSpecialCharacter(N,F)?(K=hn((N=(3&N)<<8)|F),this[this.mode_](w.pts,K),this.column_++):this.isExtCharacter(N,F)?("popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),K=hn((N=(3&N)<<8)|F),this[this.mode_](w.pts,K),this.column_++):this.isMidRowCode(N,F)?(this.clearFormatting(w.pts),this[this.mode_](w.pts," "),this.column_++,14==(14&F)&&this.addFormatting(w.pts,["i"]),1==(1&F)&&this.addFormatting(w.pts,["u"])):this.isOffsetControlCode(N,F)?this.column_+=3&F:this.isPAC(N,F)?(W=Up.indexOf(7968&X),"rollUp"===this.mode_&&(W-this.rollUpRows_+1<0&&(W=this.rollUpRows_-1),this.setRollUp(w.pts,W)),W!==this.row_&&(this.clearFormatting(w.pts),this.row_=W),1&F&&-1===this.formatting_.indexOf("u")&&this.addFormatting(w.pts,["u"]),16==(16&X)&&(this.column_=4*((14&X)>>1)),this.isColorPAC(F)&&14==(14&F)&&this.addFormatting(w.pts,["i"])):this.isNormalChar(N)&&(0===F&&(F=null),K=hn(N),K+=hn(F),this[this.mode_](w.pts,K),this.column_+=K.length))):this.lastControlCode_=null}};function to(C,I){var D=1;for(I<C&&(D=-1);4294967296<Math.abs(I-C);)C+=8589934592*D;return C}ht.prototype=new nt,ht.prototype.flushDisplayed=function(C){var I=this.displayed_.map(function(D,w){try{return D.trim()}catch(N){return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+w+"."}),""}},this).join("\n").replace(/^\n+|\n+$/g,"");I.length&&this.trigger("data",{startPts:this.startPts_,endPts:C,text:I,stream:this.name_})},ht.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=za(),this.nonDisplayed_=za(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},ht.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},ht.prototype.isSpecialCharacter=function(C,I){return C===this.EXT_&&48<=I&&I<=63},ht.prototype.isExtCharacter=function(C,I){return(C===this.EXT_+1||C===this.EXT_+2)&&32<=I&&I<=63},ht.prototype.isMidRowCode=function(C,I){return C===this.EXT_&&32<=I&&I<=47},ht.prototype.isOffsetControlCode=function(C,I){return C===this.OFFSET_&&33<=I&&I<=35},ht.prototype.isPAC=function(C,I){return C>=this.BASE_&&C<this.BASE_+8&&64<=I&&I<=127},ht.prototype.isColorPAC=function(C){return 64<=C&&C<=79||96<=C&&C<=127},ht.prototype.isNormalChar=function(C){return 32<=C&&C<=127},ht.prototype.setRollUp=function(C,I){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(C),this.nonDisplayed_=za(),this.displayed_=za()),void 0!==I&&I!==this.row_)for(var D=0;D<this.rollUpRows_;D++)this.displayed_[I-D]=this.displayed_[this.row_-D],this.displayed_[this.row_-D]="";void 0===I&&(I=this.row_),this.topRow_=I-this.rollUpRows_+1},ht.prototype.addFormatting=function(C,I){this.formatting_=this.formatting_.concat(I),I=I.reduce(function(D,w){return D+"<"+w+">"},""),this[this.mode_](C,I)},ht.prototype.clearFormatting=function(C){var I;this.formatting_.length&&(I=this.formatting_.reverse().reduce(function(D,w){return D+"</"+w+">"},""),this.formatting_=[],this[this.mode_](C,I))},ht.prototype.popOn=function(C,I){var D=this.nonDisplayed_[this.row_];this.nonDisplayed_[this.row_]=D+=I},ht.prototype.rollUp=function(C,I){var D=this.displayed_[this.row_];this.displayed_[this.row_]=D+=I},ht.prototype.shiftRowsUp_=function(){for(var C=0;C<this.topRow_;C++)this.displayed_[C]="";for(C=this.row_+1;C<15;C++)this.displayed_[C]="";for(C=this.topRow_;C<this.row_;C++)this.displayed_[C]=this.displayed_[C+1];this.displayed_[this.row_]=""},ht.prototype.paintOn=function(C,I){var D=this.displayed_[this.row_];this.displayed_[this.row_]=D+=I};var cn={CaptionStream:qt,Cea608Stream:ht,Cea708Stream:et},wt={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21};function wd(C,I,D){for(var w="",N=I;N<D;N++)w+="%"+("00"+C[N].toString(16)).slice(-2);return w}function pn(C,I,D){return decodeURIComponent(wd(C,I,D))}function mn(C){return C[0]<<21|C[1]<<14|C[2]<<7|C[3]}(s=function C(I){var D,w;C.prototype.init.call(this),this.type_=I||"shared",this.push=function(N){"shared"!==this.type_&&N.type!==this.type_||(void 0===w&&(w=N.dts),N.dts=to(N.dts,w),N.pts=to(N.pts,w),D=N.dts,this.trigger("data",N))},this.flush=function(){w=D,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){D=w=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}}).prototype=new nt;var Da=s,qt=to,Dd={TXXX:function(C){var I;if(3===C.data[0]){for(I=1;I<C.data.length;I++)if(0===C.data[I]){C.description=pn(C.data,1,I),C.value=pn(C.data,I+1,C.data.length).replace(/\0*$/,"");break}C.data=C.value}},WXXX:function(C){var I;if(3===C.data[0])for(I=1;I<C.data.length;I++)if(0===C.data[I]){C.description=pn(C.data,1,I),C.url=pn(C.data,I+1,C.data.length);break}},PRIV:function(C){for(var D=0;D<C.data.length;D++)if(0===C.data[D]){C.owner=unescape(wd(C.data,0,D));break}C.privateData=C.data.subarray(D+1),C.data=C.privateData}},ao=function(C){var I,D={descriptor:C&&C.descriptor},w=0,N=[],F=0;if(ao.prototype.init.call(this),this.dispatchType=wt.METADATA_STREAM_TYPE.toString(16),D.descriptor)for(I=0;I<D.descriptor.length;I++)this.dispatchType+=("00"+D.descriptor[I].toString(16)).slice(-2);this.push=function(K){var W,X,oe,ue,re,_e,Me;if("timed-metadata"===K.type)if(K.dataAlignmentIndicator&&(F=0,N.length=0),0===N.length&&(K.data.length<10||K.data[0]!=="I".charCodeAt(0)||K.data[1]!=="D".charCodeAt(0)||K.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(N.push(K),F+=K.data.byteLength,1===N.length&&(w=mn(K.data.subarray(6,10)),w+=10),!(F<w)){for(W={data:new Uint8Array(w),frames:[],pts:N[0].pts,dts:N[0].dts},ue=0;ue<w;)W.data.set(N[0].data.subarray(0,w-ue),ue),ue+=N[0].data.byteLength,F-=N[0].data.byteLength,N.shift();X=10,64&W.data[5]&&(X+=4,X+=mn(W.data.subarray(10,14)),w-=mn(W.data.subarray(16,20)));do{if((oe=mn(W.data.subarray(X+4,X+8)))<1)return void this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."})}while((Me={id:String.fromCharCode(W.data[X],W.data[X+1],W.data[X+2],W.data[X+3]),data:W.data.subarray(X+10,X+oe+10)}).key=Me.id,Dd[Me.id]&&(Dd[Me.id](Me),"com.apple.streaming.transportStreamTimestamp"===Me.owner&&(_e=(1&(re=Me.data)[3])<<30|re[4]<<22|re[5]<<14|re[6]<<6|re[7]>>>2,_e*=4,Me.timeStamp=_e+=3&re[7],void 0===W.pts&&void 0===W.dts&&(W.pts=Me.timeStamp,W.dts=Me.timeStamp),this.trigger("timestamp",Me))),W.frames.push(Me),X+=10,(X+=oe)<w);this.trigger("data",W)}}};ao.prototype=new nt,s=ao,Da=Da;var gn,io,ro=function(){var C=new Uint8Array(188),I=0;ro.prototype.init.call(this),this.push=function(D){var w,N=0,F=188;for(I?((w=new Uint8Array(D.byteLength+I)).set(C.subarray(0,I)),w.set(D,I),I=0):w=D;F<w.byteLength;)71!==w[N]||71!==w[F]?(N++,F++):(this.trigger("data",w.subarray(N,F)),N+=188,F+=188);N<w.byteLength&&(C.set(w.subarray(N),0),I=w.byteLength-N)},this.flush=function(){188===I&&71===C[0]&&(this.trigger("data",C),I=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){I=0,this.trigger("reset")}};ro.prototype=new nt,(gn=function(){var C,I,D,w;gn.prototype.init.call(this),(w=this).packetsWaitingForPmt=[],this.programMapTable=void 0,C=function(N,F){var K=0;F.payloadUnitStartIndicator&&(K+=N[K]+1),("pat"===F.type?I:D)(N.subarray(K),F)},I=function(N,F){F.section_number=N[7],F.last_section_number=N[8],w.pmtPid=(31&N[10])<<8|N[11],F.pmtPid=w.pmtPid},D=function(N,F){var K,W;if(1&N[5]){for(w.programMapTable={video:null,audio:null,"timed-metadata":{}},K=3+((15&N[1])<<8|N[2])-4,W=12+((15&N[10])<<8|N[11]);W<K;){var X=N[W],oe=(31&N[W+1])<<8|N[W+2];X===wt.H264_STREAM_TYPE&&null===w.programMapTable.video?w.programMapTable.video=oe:X===wt.ADTS_STREAM_TYPE&&null===w.programMapTable.audio?w.programMapTable.audio=oe:X===wt.METADATA_STREAM_TYPE&&(w.programMapTable["timed-metadata"][oe]=X),W+=5+((15&N[W+3])<<8|N[W+4])}F.programMapTable=w.programMapTable}},this.push=function(N){var F={},K=4;if(F.payloadUnitStartIndicator=!!(64&N[1]),F.pid=31&N[1],F.pid<<=8,F.pid|=N[2],1<(48&N[3])>>>4&&(K+=N[K]+1),0===F.pid)F.type="pat",C(N.subarray(K),F),this.trigger("data",F);else if(F.pid===this.pmtPid)for(F.type="pmt",C(N.subarray(K),F),this.trigger("data",F);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([N,K,F]):this.processPes_(N,K,F)},this.processPes_=function(N,F,K){K.streamType=K.pid===this.programMapTable.video?wt.H264_STREAM_TYPE:K.pid===this.programMapTable.audio?wt.ADTS_STREAM_TYPE:this.programMapTable["timed-metadata"][K.pid],K.type="pes",K.data=N.subarray(F),this.trigger("data",K)}}).prototype=new nt,gn.STREAM_TYPES={h264:27,adts:15},(io=function(){function C(W,X,oe){var ue,re,_e,Me,Ke=new Uint8Array(W.size),Ue={type:X},je=0,St=0;if(W.data.length&&!(W.size<9)){for(Ue.trackId=W.data[0].pid,je=0;je<W.data.length;je++)Ke.set((ue=W.data[je]).data,St),St+=ue.data.byteLength;Me=(re=Ke)[0]<<16|re[1]<<8|re[2],(_e=Ue).data=new Uint8Array,1==Me&&(_e.packetLength=6+(re[4]<<8|re[5]),_e.dataAlignmentIndicator=0!=(4&re[6]),192&(Me=re[7])&&(_e.pts=(14&re[9])<<27|(255&re[10])<<20|(254&re[11])<<12|(255&re[12])<<5|(254&re[13])>>>3,_e.pts*=4,_e.pts+=(6&re[13])>>>1,_e.dts=_e.pts,64&Me&&(_e.dts=(14&re[14])<<27|(255&re[15])<<20|(254&re[16])<<12|(255&re[17])<<5|(254&re[18])>>>3,_e.dts*=4,_e.dts+=(6&re[18])>>>1)),_e.data=re.subarray(9+re[8])),X="video"===X||Ue.packetLength<=W.size,(oe||X)&&(W.size=0,W.data.length=0),X&&D.trigger("data",Ue)}}var I,D=this,w=!1,N={data:[],size:0},F={data:[],size:0},K={data:[],size:0};io.prototype.init.call(this),this.push=function(W){({pat:function(){},pes:function(){var X,oe;switch(W.streamType){case wt.H264_STREAM_TYPE:X=N,oe="video";break;case wt.ADTS_STREAM_TYPE:X=F,oe="audio";break;case wt.METADATA_STREAM_TYPE:X=K,oe="timed-metadata";break;default:return}W.payloadUnitStartIndicator&&C(X,oe,!0),X.data.push(W),X.size+=W.data.byteLength},pmt:function(){var X={type:"metadata",tracks:[]};null!==(I=W.programMapTable).video&&X.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.video,codec:"avc",type:"video"}),null!==I.audio&&X.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.audio,codec:"adts",type:"audio"}),w=!0,D.trigger("data",X)}})[W.type]()},this.reset=function(){N.size=0,N.data.length=0,F.size=0,F.data.length=0,this.trigger("reset")},this.flushStreams_=function(){C(N,"video"),C(F,"audio"),C(K,"timed-metadata")},this.flush=function(){var W;!w&&I&&(W={type:"metadata",tracks:[]},null!==I.video&&W.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.video,codec:"avc",type:"video"}),null!==I.audio&&W.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.audio,codec:"adts",type:"audio"}),D.trigger("data",W)),w=!1,this.flushStreams_(),this.trigger("done")}}).prototype=new nt;var fn,Rd={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:ro,TransportParseStream:gn,ElementaryStream:io,TimestampRolloverStream:Da,CaptionStream:cn.CaptionStream,Cea608Stream:cn.Cea608Stream,Cea708Stream:cn.Cea708Stream,MetadataStream:s};for(fn in wt)wt.hasOwnProperty(fn)&&(Rd[fn]=wt[fn]);var Pa=Rd,Ld=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],no=function(C){var I,D=0;no.prototype.init.call(this),this.skipWarn_=function(w,N){this.trigger("log",{level:"warn",message:"adts skiping bytes "+w+" to "+N+" in frame "+D+" outside syncword"})},this.push=function(w){var N,F,K,W,X,oe,ue=0;if(C||(D=0),"audio"===w.type){for(I&&I.length?(K=I,(I=new Uint8Array(K.byteLength+w.data.byteLength)).set(K),I.set(w.data,K.byteLength)):I=w.data;ue+7<I.length;)if(255===I[ue]&&240==(246&I[ue+1])){if("number"==typeof oe&&(this.skipWarn_(oe,ue),oe=null),F=2*(1&~I[ue+1]),X=9e4*(W=1024*(1+(3&I[ue+6])))/Ld[(60&I[ue+2])>>>2],I.byteLength-ue<(N=(3&I[ue+3])<<11|I[ue+4]<<3|(224&I[ue+5])>>5))break;this.trigger("data",{pts:w.pts+D*X,dts:w.dts+D*X,sampleCount:W,audioobjecttype:1+(I[ue+2]>>>6&3),channelcount:(1&I[ue+2])<<2|(192&I[ue+3])>>>6,samplerate:Ld[(60&I[ue+2])>>>2],samplingfrequencyindex:(60&I[ue+2])>>>2,samplesize:16,data:I.subarray(ue+7+F,ue+N)}),D++,ue+=N}else"number"!=typeof oe&&(oe=ue),ue++;"number"==typeof oe&&(this.skipWarn_(oe,ue),oe=null),I=I.subarray(ue)}},this.flush=function(){D=0,this.trigger("done")},this.reset=function(){I=void 0,this.trigger("reset")},this.endTimeline=function(){I=void 0,this.trigger("endedtimeline")}};no.prototype=new nt;var so,Nd,Od=no,Fp=function(C){var I=C.byteLength,D=0,w=0;this.length=function(){return 8*I},this.bitsAvailable=function(){return 8*I+w},this.loadWord=function(){var N=C.byteLength-I,F=new Uint8Array(4),K=Math.min(4,I);if(0===K)throw new Error("no bytes available");F.set(C.subarray(N,N+K)),D=new DataView(F.buffer).getUint32(0),w=8*K,I-=K},this.skipBits=function(N){var F;N<w||(N-=w,N-=8*(F=Math.floor(N/8)),I-=F,this.loadWord()),D<<=N,w-=N},this.readBits=function(N){var F=Math.min(w,N),K=D>>>32-F;return 0<(w-=F)?D<<=F:0<I&&this.loadWord(),0<(F=N-F)?K<<F|this.readBits(F):K},this.skipLeadingZeros=function(){for(var N=0;N<w;++N)if(0!=(D&2147483648>>>N))return D<<=N,w-=N,N;return this.loadWord(),N+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var N=this.skipLeadingZeros();return this.readBits(N+1)-1},this.readExpGolomb=function(){var N=this.readUnsignedExpGolomb();return 1&N?1+N>>>1:-1*(N>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},yn=function(){var C,I,D=0;yn.prototype.init.call(this),this.push=function(w){for(var N,F=(I=I?((N=new Uint8Array(I.byteLength+w.data.byteLength)).set(I),N.set(w.data,I.byteLength),N):w.data).byteLength;D<F-3;D++)if(1===I[D+2]){C=D+5;break}for(;C<F;)switch(I[C]){case 0:if(0!==I[C-1]){C+=2;break}if(0!==I[C-2]){C++;break}for(D+3!==C-2&&this.trigger("data",I.subarray(D+3,C-2));1!==I[++C]&&C<F;);D=C-2,C+=3;break;case 1:if(0!==I[C-1]||0!==I[C-2]){C+=3;break}this.trigger("data",I.subarray(D+3,C-2)),D=C-2,C+=3;break;default:C+=3}I=I.subarray(D),C-=D,D=0},this.reset=function(){I=null,D=0,this.trigger("reset")},this.flush=function(){I&&3<I.byteLength&&this.trigger("data",I.subarray(D+3)),I=null,D=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}};function Ud(C,I){var D=0<=(D=C[I+6]<<21|C[I+7]<<14|C[I+8]<<7|C[I+9])?D:0;return(16&C[I+5])>>4?D+20:D+10}function Bd(C,I){return C.length-I<10||C[I]!=="I".charCodeAt(0)||C[I+1]!=="D".charCodeAt(0)||C[I+2]!=="3".charCodeAt(0)?I:Bd(C,I+=Ud(C,I))}function Fd(C){return C[0]<<21|C[1]<<14|C[2]<<7|C[3]}yn.prototype=new nt,Nd={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(so=function(){var C,I,D,w,N,F,K,W=new yn;so.prototype.init.call(this),(C=this).push=function(X){"video"===X.type&&(I=X.trackId,D=X.pts,w=X.dts,W.push(X))},W.on("data",function(X){var oe={trackId:I,pts:D,dts:w,data:X,nalUnitTypeCode:31&X[0]};switch(oe.nalUnitTypeCode){case 5:oe.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:oe.nalUnitType="sei_rbsp",oe.escapedRBSP=N(X.subarray(1));break;case 7:oe.nalUnitType="seq_parameter_set_rbsp",oe.escapedRBSP=N(X.subarray(1)),oe.config=F(oe.escapedRBSP);break;case 8:oe.nalUnitType="pic_parameter_set_rbsp";break;case 9:oe.nalUnitType="access_unit_delimiter_rbsp"}C.trigger("data",oe)}),W.on("done",function(){C.trigger("done")}),W.on("partialdone",function(){C.trigger("partialdone")}),W.on("reset",function(){C.trigger("reset")}),W.on("endedtimeline",function(){C.trigger("endedtimeline")}),this.flush=function(){W.flush()},this.partialFlush=function(){W.partialFlush()},this.reset=function(){W.reset()},this.endTimeline=function(){W.endTimeline()},K=function(X,oe){for(var ue=8,re=8,_e=0;_e<X;_e++)ue=0===(re=0!==re?(ue+oe.readExpGolomb()+256)%256:re)?ue:re},N=function(X){for(var oe=X.byteLength,ue=[],re=1;re<oe-2;)0===X[re]&&0===X[re+1]&&3===X[re+2]?(ue.push(re+2),re+=2):re++;if(0===ue.length)return X;var _e=oe-ue.length,Me=new Uint8Array(_e),Ke=0;for(re=0;re<_e;Ke++,re++)Ke===ue[0]&&(Ke++,ue.shift()),Me[re]=X[Ke];return Me},F=function(X){var oe,ue,re,_e,Me,Ke=0,Ue=0,je=0,St=0,Ve=[1,1],Le=new Fp(X),En=Le.readUnsignedByte(),hr=Le.readUnsignedByte(),oa=Le.readUnsignedByte();if(Le.skipUnsignedExpGolomb(),Nd[En]&&(3===(ue=Le.readUnsignedExpGolomb())&&Le.skipBits(1),Le.skipUnsignedExpGolomb(),Le.skipUnsignedExpGolomb(),Le.skipBits(1),Le.readBoolean()))for(_e=3!==ue?8:12,Me=0;Me<_e;Me++)Le.readBoolean()&&K(Me<6?16:64,Le);if(Le.skipUnsignedExpGolomb(),0===(re=Le.readUnsignedExpGolomb()))Le.readUnsignedExpGolomb();else if(1===re)for(Le.skipBits(1),Le.skipExpGolomb(),Le.skipExpGolomb(),oe=Le.readUnsignedExpGolomb(),Me=0;Me<oe;Me++)Le.skipExpGolomb();if(Le.skipUnsignedExpGolomb(),Le.skipBits(1),X=Le.readUnsignedExpGolomb(),ue=Le.readUnsignedExpGolomb(),0===(re=Le.readBits(1))&&Le.skipBits(1),Le.skipBits(1),Le.readBoolean()&&(Ke=Le.readUnsignedExpGolomb(),Ue=Le.readUnsignedExpGolomb(),je=Le.readUnsignedExpGolomb(),St=Le.readUnsignedExpGolomb()),Le.readBoolean()&&Le.readBoolean())switch(Le.readUnsignedByte()){case 1:Ve=[1,1];break;case 2:Ve=[12,11];break;case 3:Ve=[10,11];break;case 4:Ve=[16,11];break;case 5:Ve=[40,33];break;case 6:Ve=[24,11];break;case 7:Ve=[20,11];break;case 8:Ve=[32,11];break;case 9:Ve=[80,33];break;case 10:Ve=[18,11];break;case 11:Ve=[15,11];break;case 12:Ve=[64,33];break;case 13:Ve=[160,99];break;case 14:Ve=[4,3];break;case 15:Ve=[3,2];break;case 16:Ve=[2,1];break;case 255:Ve=[Le.readUnsignedByte()<<8|Le.readUnsignedByte(),Le.readUnsignedByte()<<8|Le.readUnsignedByte()]}return{profileIdc:En,levelIdc:oa,profileCompatibility:hr,width:16*(X+1)-2*Ke-2*Ue,height:(2-re)*(ue+1)*16-2*je-2*St,sarRatio:Ve}}}).prototype=new nt,Da={H264Stream:so,NalByteStream:yn};var jp=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],_n={isLikelyAacData:function(C){var I=Bd(C,0);return C.length>=I+2&&255==(255&C[I])&&240==(240&C[I+1])&&16==(22&C[I+1])},parseId3TagSize:Ud,parseAdtsSize:function(C,I){return 6144&C[I+3]|C[I+4]<<3|(224&C[I+5])>>5},parseType:function(C,I){return C[I]==="I".charCodeAt(0)&&C[I+1]==="D".charCodeAt(0)&&C[I+2]==="3".charCodeAt(0)?"timed-metadata":!0&C[I]&&240==(240&C[I+1])?"audio":null},parseSampleRate:function(C){for(var I=0;I+5<C.length;){if(255===C[I]&&240==(246&C[I+1]))return jp[(60&C[I+2])>>>2];I++}return null},parseAacTimestamp:function(C){var I,D=10;64&C[5]&&(D+=4,D+=Fd(C.subarray(10,14)));do{if((I=Fd(C.subarray(D+4,D+8)))<1)return null;if("PRIV"===String.fromCharCode(C[D],C[D+1],C[D+2],C[D+3]))for(var w=C.subarray(D+10,D+I+10),N=0;N<w.byteLength;N++)if(0===w[N]){if("com.apple.streaming.transportStreamTimestamp"!==unescape(function(W,X,oe){for(var ue="",re=0;re<oe;re++)ue+="%"+("00"+W[re].toString(16)).slice(-2);return ue}(w,0,N)))break;var F=w.subarray(N+1),K=(1&F[3])<<30|F[4]<<22|F[5]<<14|F[6]<<6|F[7]>>>2;return(K*=4)+(3&F[7])}}while(D+=10,(D+=I)<C.byteLength);return null}},oo=function(){var C=new Uint8Array,I=0;oo.prototype.init.call(this),this.setTimestamp=function(D){I=D},this.push=function(D){var w,N,F=0,K=0;for(C.length?(N=C.length,(C=new Uint8Array(D.byteLength+N)).set(C.subarray(0,N)),C.set(D,N)):C=D;3<=C.length-K;)if(C[K]!=="I".charCodeAt(0)||C[K+1]!=="D".charCodeAt(0)||C[K+2]!=="3".charCodeAt(0))if(255!=(255&C[K])||240!=(240&C[K+1]))K++;else{if(C.length-K<7||K+(F=_n.parseAdtsSize(C,K))>C.length)break;w={type:"audio",data:C.subarray(K,K+F),pts:I,dts:I},this.trigger("data",w),K+=F}else{if(C.length-K<10||K+(F=_n.parseId3TagSize(C,K))>C.length)break;w={type:"timed-metadata",data:C.subarray(K,K+F)},this.trigger("data",w),K+=F}C=0<(D=C.length-K)?C.subarray(K):new Uint8Array},this.reset=function(){C=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){C=new Uint8Array,this.trigger("endedtimeline")}};function $p(C,I){I.stream=C,this.trigger("log",I)}function jd(C,I){for(var D=Object.keys(I),w=0;w<D.length;w++){var N=D[w];"headOfPipeline"!==N&&I[N].on&&I[N].on("log",$p.bind(C,N))}}function $d(C,I){var D;if(C.length===I.length){for(D=0;D<C.length;D++)if(C[D]!==I[D])return;return 1}}function uo(C,I,D,w,N,F){return{start:{dts:C,pts:C+(D-I)},end:{dts:C+(w-I),pts:C+(N-D)},prependedContentDuration:F,baseMediaDecodeTime:C}}oo.prototype=new nt;var kn,lo,Pi,Vp=oo,ho=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],co=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Gp=Da.H264Stream,Kp=_n.isLikelyAacData,ur=function(C,I){var D=[],w=0,N=0,F=1/0,K=(I=I||{}).firstSequenceNumber||0;ur.prototype.init.call(this),this.push=function(W){eo(C,W),C&&ho.forEach(function(X){C[X]=W[X]}),D.push(W)},this.setEarliestDts=function(W){w=W},this.setVideoBaseMediaDecodeTime=function(W){F=W},this.setAudioAppendStart=function(W){N=W},this.flush=function(){var W,X,oe,ue,re;0!==D.length&&(W=function(C,I,D){return I.minSegmentDts>=D?C:(I.minSegmentDts=1/0,C.filter(function(w){return w.dts>=D&&(I.minSegmentDts=Math.min(I.minSegmentDts,w.dts),I.minSegmentPts=I.minSegmentDts,!0)}))}(D,C,w),C.baseMediaDecodeTime=xd(C,I.keepOriginalTimestamps),re=function(C,I,D,w){var N,F,K,W,X,oe,ue=0,re=0;if(I.length&&(N=Id(C.baseMediaDecodeTime,C.samplerate),F=Math.ceil(Wa/(C.samplerate/1024)),D&&w&&(K=N-Math.max(D,w),re=(ue=Math.floor(K/F))*F),!(ue<1||Wa/2<re))){for(W=(W=function(){var C,I;return ot||(C={96e3:[wa,[227,64],Pe(154),[56]],88200:[wa,[231],Pe(170),[56]],64e3:[wa,[248,192],Pe(240),[56]],48e3:[wa,[255,192],Pe(268),[55,148,128],Pe(54),[112]],44100:[wa,[255,192],Pe(268),[55,163,128],Pe(84),[112]],32e3:[wa,[255,192],Pe(268),[55,234],Pe(226),[112]],24e3:[wa,[255,192],Pe(268),[55,255,128],Pe(268),[111,112],Pe(126),[224]],16e3:[wa,[255,192],Pe(268),[55,255,128],Pe(268),[111,255],Pe(269),[223,108],Pe(195),[1,192]],12e3:[Qs,Pe(268),[3,127,248],Pe(268),[6,255,240],Pe(268),[13,255,224],Pe(268),[27,253,128],Pe(259),[56]],11025:[Qs,Pe(268),[3,127,248],Pe(268),[6,255,240],Pe(268),[13,255,224],Pe(268),[27,255,192],Pe(268),[55,175,128],Pe(108),[112]],8e3:[Qs,Pe(268),[3,121,16],Pe(47),[7]]},I=C,ot=Object.keys(I).reduce(function(D,w){return D[w]=new Uint8Array(I[w].reduce(function(N,F){return N.concat(F)},[])),D},{})),ot}()[C.samplerate])||I[0].data,X=0;X<ue;X++)I.splice(0,0,{data:W,dts:(oe=I[0]).dts-F,pts:oe.pts-F});return C.baseMediaDecodeTime-=Math.floor(function(C,I){return function(C,I){return C*I}(Js(C),I)}(re,C.samplerate)),re}}(C,W,N,F),C.samples=function(C){for(var D=[],w=0;w<C.length;w++)D.push({size:C[w].data.byteLength,duration:1024});return D}(W),X=Ci(function(C){for(var I,D=0,w=new Uint8Array(function(F){for(var K=0,W=0;W<F.length;W++)K+=F[W].data.byteLength;return K}(C)),N=0;N<C.length;N++)w.set((I=C[N]).data,D),D+=I.data.byteLength;return w}(W)),D=[],ue=un(K,[C]),oe=new Uint8Array(ue.byteLength+X.byteLength),K++,oe.set(ue),oe.set(X,ue.byteLength),bi(C),ue=Math.ceil(9216e4/C.samplerate),W.length&&(ue*=W.length,this.trigger("segmentTimingInfo",uo(Id(C.baseMediaDecodeTime,C.samplerate),W[0].dts,W[0].pts,W[0].dts+ue,W[0].pts+ue,re||0)),this.trigger("timingInfo",{start:W[0].pts,end:W[0].pts+ue})),this.trigger("data",{track:C,boxes:oe})),this.trigger("done","AudioSegmentStream")},this.reset=function(){bi(C),D=[],this.trigger("reset")}};function Vd(C){var I=31&C[1];return(I<<=8)|C[2]}function vn(C){return!!(64&C[1])}function Tn(C){var I=0;return 1<(48&C[3])>>>4&&(I+=C[4]+1),I}function po(C){switch(C){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}}ur.prototype=new nt,(kn=function(C,I){var D,w,N=[],F=[],K=(I=I||{}).firstSequenceNumber||0;kn.prototype.init.call(this),delete C.minPTS,this.gopCache_=[],this.push=function(W){eo(C,W),"seq_parameter_set_rbsp"!==W.nalUnitType||D||(D=W.config,C.sps=[W.data],co.forEach(function(X){C[X]=D[X]},this)),"pic_parameter_set_rbsp"!==W.nalUnitType||w||(w=W.data,C.pps=[W.data]),N.push(W)},this.flush=function(){for(var W,X,oe,ue=0;N.length&&"access_unit_delimiter_rbsp"!==N[0].nalUnitType;)N.shift();if(0===N.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(W=function(C){var I,D,w=[],N=[];for(N.byteLength=0,N.nalCount=0,N.duration=0,I=w.byteLength=0;I<C.length;I++)"access_unit_delimiter_rbsp"===(D=C[I]).nalUnitType?(w.length&&(w.duration=D.dts-w.dts,N.byteLength+=w.byteLength,N.nalCount+=w.length,N.duration+=w.duration,N.push(w)),(w=[D]).byteLength=D.data.byteLength,w.pts=D.pts,w.dts=D.dts):("slice_layer_without_partitioning_rbsp_idr"===D.nalUnitType&&(w.keyFrame=!0),w.duration=D.dts-w.dts,w.byteLength+=D.data.byteLength,w.push(D));return N.length&&(!w.duration||w.duration<=0)&&(w.duration=N[N.length-1].duration),N.byteLength+=w.byteLength,N.nalCount+=w.length,N.duration+=w.duration,N.push(w),N}(N),(X=function(C){var I,D,w=[],N=[];for(w.byteLength=0,w.nalCount=0,w.duration=0,w.pts=C[0].pts,w.dts=C[0].dts,N.byteLength=0,N.nalCount=0,N.duration=0,N.pts=C[0].pts,N.dts=C[0].dts,I=0;I<C.length;I++)(D=C[I]).keyFrame?(w.length&&(N.push(w),N.byteLength+=w.byteLength,N.nalCount+=w.nalCount,N.duration+=w.duration),(w=[D]).nalCount=D.length,w.byteLength=D.byteLength,w.pts=D.pts,w.dts=D.dts,w.duration=D.duration):(w.duration+=D.duration,w.nalCount+=D.length,w.byteLength+=D.byteLength,w.push(D));return N.length&&w.duration<=0&&(w.duration=N[N.length-1].duration),N.byteLength+=w.byteLength,N.nalCount+=w.nalCount,N.duration+=w.duration,N.push(w),N}(W))[0][0].keyFrame||((oe=this.getGopForFusion_(N[0],C))?(ue=oe.duration,X.unshift(oe),X.byteLength+=oe.byteLength,X.nalCount+=oe.nalCount,X.pts=oe.pts,X.dts=oe.dts,X.duration+=oe.duration):X=function(C){var I;return!C[0][0].keyFrame&&1<C.length&&(I=C.shift(),C.byteLength-=I.byteLength,C.nalCount-=I.nalCount,C[0][0].dts=I.dts,C[0][0].pts=I.pts,C[0][0].duration+=I.duration),C}(X)),F.length){var re=I.alignGopsAtEnd?this.alignGopsAtEnd_(X):this.alignGopsAtStart_(X);if(!re)return this.gopCache_.unshift({gop:X.pop(),pps:C.pps,sps:C.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),N=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");bi(C),X=re}eo(C,X),C.samples=function(C,I){for(var D,w,N,F=0,K=[],W=0;W<C.length;W++)for(w=C[W],D=0;D<w.length;D++)F+=(N=st(N=w[D],F)).size,K.push(N);return K}(X),W=Ci(function(C){for(var I,D,w,N,F,K=0,oe=new Uint8Array(C.byteLength+4*C.nalCount),ue=new DataView(oe.buffer),re=0;re<C.length;re++)for(w=C[re],I=0;I<w.length;I++)for(N=w[I],D=0;D<N.length;D++)ue.setUint32(K,(F=N[D]).data.byteLength),oe.set(F.data,K+=4),K+=F.data.byteLength;return oe}(X)),C.baseMediaDecodeTime=xd(C,I.keepOriginalTimestamps),this.trigger("processedGopsInfo",X.map(function(_e){return{pts:_e.pts,dts:_e.dts,byteLength:_e.byteLength}})),this.trigger("segmentTimingInfo",uo(C.baseMediaDecodeTime,(oe=X[0]).dts,oe.pts,(re=X[X.length-1]).dts+re.duration,re.pts+re.duration,ue)),this.trigger("timingInfo",{start:X[0].pts,end:X[X.length-1].pts+X[X.length-1].duration}),this.gopCache_.unshift({gop:X.pop(),pps:C.pps,sps:C.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),N=[],this.trigger("baseMediaDecodeTime",C.baseMediaDecodeTime),this.trigger("timelineStartInfo",C.timelineStartInfo),ue=un(K,[C]),X=new Uint8Array(ue.byteLength+W.byteLength),K++,X.set(ue),X.set(W,ue.byteLength),this.trigger("data",{track:C,boxes:X}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),N=[],this.gopCache_.length=0,F.length=0,this.trigger("reset")},this.resetStream_=function(){bi(C),w=D=void 0},this.getGopForFusion_=function(W){for(var X,oe,ue,re=1/0,_e=0;_e<this.gopCache_.length;_e++)oe=(ue=this.gopCache_[_e]).gop,C.pps&&$d(C.pps[0],ue.pps[0])&&C.sps&&$d(C.sps[0],ue.sps[0])&&(oe.dts<C.timelineStartInfo.dts||-1e4<=(oe=W.dts-oe.dts-oe.duration)&&oe<=45e3&&(!X||oe<re)&&(X=ue,re=oe));return X?X.gop:null},this.alignGopsAtStart_=function(W){for(var X,oe,ue,re,_e=W.byteLength,Me=W.nalCount,Ke=W.duration,Ue=X=0;Ue<F.length&&X<W.length&&(oe=F[Ue]).pts!==(ue=W[X]).pts;)ue.pts>oe.pts?Ue++:(X++,_e-=ue.byteLength,Me-=ue.nalCount,Ke-=ue.duration);return 0===X?W:X===W.length?null:((re=W.slice(X)).byteLength=_e,re.duration=Ke,re.nalCount=Me,re.pts=re[0].pts,re.dts=re[0].dts,re)},this.alignGopsAtEnd_=function(W){for(var X,oe,ue=F.length-1,re=W.length-1,_e=null,Me=!1;0<=ue&&0<=re;){if((X=F[ue]).pts===(oe=W[re]).pts){Me=!0;break}X.pts>oe.pts?ue--:(ue===F.length-1&&(_e=re),re--)}if(!Me&&null===_e)return null;if(0===(Ue=Me?re:_e))return W;var Ke=W.slice(Ue),Ue=Ke.reduce(function(je,St){return je.byteLength+=St.byteLength,je.duration+=St.duration,je.nalCount+=St.nalCount,je},{byteLength:0,duration:0,nalCount:0});return Ke.byteLength=Ue.byteLength,Ke.duration=Ue.duration,Ke.nalCount=Ue.nalCount,Ke.pts=Ke[0].pts,Ke.dts=Ke[0].dts,Ke},this.alignGopsWith=function(W){F=W}}).prototype=new nt,(Pi=function(C,I){this.numberOfTracks=0,this.metadataStream=I,this.remuxTracks=void 0===(C=C||{}).remux||!!C.remux,this.keepOriginalTimestamps="boolean"==typeof C.keepOriginalTimestamps&&C.keepOriginalTimestamps,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Pi.prototype.init.call(this),this.push=function(D){return D.text?this.pendingCaptions.push(D):D.frames?this.pendingMetadata.push(D):(this.pendingTracks.push(D.track),this.pendingBytes+=D.boxes.byteLength,"video"===D.track.type&&(this.videoTrack=D.track,this.pendingBoxes.push(D.boxes)),void("audio"===D.track.type&&(this.audioTrack=D.track,this.pendingBoxes.unshift(D.boxes))))}}).prototype=new nt,Pi.prototype.flush=function(C){var I,D,w,N=0,F={captions:[],captionStreams:{},metadata:[],info:{}},K=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==C&&"AudioSegmentStream"!==C||this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(K=this.videoTrack.timelineStartInfo.pts,co.forEach(function(W){F.info[W]=this.videoTrack[W]},this)):this.audioTrack&&(K=this.audioTrack.timelineStartInfo.pts,ho.forEach(function(W){F.info[W]=this.audioTrack[W]},this)),this.videoTrack||this.audioTrack){for(F.type=1===this.pendingTracks.length?this.pendingTracks[0].type:"combined",this.emittedTracks+=this.pendingTracks.length,C=function(C){var I=u(),D=T(C);return(C=new Uint8Array(I.byteLength+D.byteLength)).set(I),C.set(D,I.byteLength),C}(this.pendingTracks),F.initSegment=new Uint8Array(C.byteLength),F.initSegment.set(C),F.data=new Uint8Array(this.pendingBytes),w=0;w<this.pendingBoxes.length;w++)F.data.set(this.pendingBoxes[w],N),N+=this.pendingBoxes[w].byteLength;for(w=0;w<this.pendingCaptions.length;w++)(I=this.pendingCaptions[w]).startTime=Zs(I.startPts,K,this.keepOriginalTimestamps),I.endTime=Zs(I.endPts,K,this.keepOriginalTimestamps),F.captionStreams[I.stream]=!0,F.captions.push(I);for(w=0;w<this.pendingMetadata.length;w++)(D=this.pendingMetadata[w]).cueTime=Zs(D.pts,K,this.keepOriginalTimestamps),F.metadata.push(D);for(F.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",F),w=0;w<F.captions.length;w++)this.trigger("caption",I=F.captions[w]);for(w=0;w<F.metadata.length;w++)this.trigger("id3Frame",D=F.metadata[w])}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Pi.prototype.setRemux=function(C){this.remuxTracks=C},(lo=function(C){var I,D,w=this,N=!0;lo.prototype.init.call(this),this.baseMediaDecodeTime=(C=C||{}).baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var F={};(this.transmuxPipeline_=F).type="aac",F.metadataStream=new Pa.MetadataStream,F.aacStream=new Vp,F.audioTimestampRolloverStream=new Pa.TimestampRolloverStream("audio"),F.timedMetadataTimestampRolloverStream=new Pa.TimestampRolloverStream("timed-metadata"),F.adtsStream=new Od,F.coalesceStream=new Pi(C,F.metadataStream),F.headOfPipeline=F.aacStream,F.aacStream.pipe(F.audioTimestampRolloverStream).pipe(F.adtsStream),F.aacStream.pipe(F.timedMetadataTimestampRolloverStream).pipe(F.metadataStream).pipe(F.coalesceStream),F.metadataStream.on("timestamp",function(K){F.aacStream.setTimestamp(K.timeStamp)}),F.aacStream.on("data",function(K){"timed-metadata"!==K.type&&"audio"!==K.type||F.audioSegmentStream||(D=D||{timelineStartInfo:{baseMediaDecodeTime:w.baseMediaDecodeTime},codec:"adts",type:"audio"},F.coalesceStream.numberOfTracks++,F.audioSegmentStream=new ur(D,C),F.audioSegmentStream.on("log",w.getLogTrigger_("audioSegmentStream")),F.audioSegmentStream.on("timingInfo",w.trigger.bind(w,"audioTimingInfo")),F.adtsStream.pipe(F.audioSegmentStream).pipe(F.coalesceStream),w.trigger("trackinfo",{hasAudio:!!D,hasVideo:!!I}))}),F.coalesceStream.on("data",this.trigger.bind(this,"data")),F.coalesceStream.on("done",this.trigger.bind(this,"done")),jd(this,F)},this.setupTsPipeline=function(){var F={};(this.transmuxPipeline_=F).type="ts",F.metadataStream=new Pa.MetadataStream,F.packetStream=new Pa.TransportPacketStream,F.parseStream=new Pa.TransportParseStream,F.elementaryStream=new Pa.ElementaryStream,F.timestampRolloverStream=new Pa.TimestampRolloverStream,F.adtsStream=new Od,F.h264Stream=new Gp,F.captionStream=new Pa.CaptionStream(C),F.coalesceStream=new Pi(C,F.metadataStream),F.headOfPipeline=F.packetStream,F.packetStream.pipe(F.parseStream).pipe(F.elementaryStream).pipe(F.timestampRolloverStream),F.timestampRolloverStream.pipe(F.h264Stream),F.timestampRolloverStream.pipe(F.adtsStream),F.timestampRolloverStream.pipe(F.metadataStream).pipe(F.coalesceStream),F.h264Stream.pipe(F.captionStream).pipe(F.coalesceStream),F.elementaryStream.on("data",function(K){var W;if("metadata"===K.type){for(W=K.tracks.length;W--;)I||"video"!==K.tracks[W].type?D||"audio"!==K.tracks[W].type||((D=K.tracks[W]).timelineStartInfo.baseMediaDecodeTime=w.baseMediaDecodeTime):(I=K.tracks[W]).timelineStartInfo.baseMediaDecodeTime=w.baseMediaDecodeTime;I&&!F.videoSegmentStream&&(F.coalesceStream.numberOfTracks++,F.videoSegmentStream=new kn(I,C),F.videoSegmentStream.on("log",w.getLogTrigger_("videoSegmentStream")),F.videoSegmentStream.on("timelineStartInfo",function(X){D&&!C.keepOriginalTimestamps&&(D.timelineStartInfo=X,F.audioSegmentStream.setEarliestDts(X.dts-w.baseMediaDecodeTime))}),F.videoSegmentStream.on("processedGopsInfo",w.trigger.bind(w,"gopInfo")),F.videoSegmentStream.on("segmentTimingInfo",w.trigger.bind(w,"videoSegmentTimingInfo")),F.videoSegmentStream.on("baseMediaDecodeTime",function(X){D&&F.audioSegmentStream.setVideoBaseMediaDecodeTime(X)}),F.videoSegmentStream.on("timingInfo",w.trigger.bind(w,"videoTimingInfo")),F.h264Stream.pipe(F.videoSegmentStream).pipe(F.coalesceStream)),D&&!F.audioSegmentStream&&(F.coalesceStream.numberOfTracks++,F.audioSegmentStream=new ur(D,C),F.audioSegmentStream.on("log",w.getLogTrigger_("audioSegmentStream")),F.audioSegmentStream.on("timingInfo",w.trigger.bind(w,"audioTimingInfo")),F.audioSegmentStream.on("segmentTimingInfo",w.trigger.bind(w,"audioSegmentTimingInfo")),F.adtsStream.pipe(F.audioSegmentStream).pipe(F.coalesceStream)),w.trigger("trackinfo",{hasAudio:!!D,hasVideo:!!I})}}),F.coalesceStream.on("data",this.trigger.bind(this,"data")),F.coalesceStream.on("id3Frame",function(K){K.dispatchType=F.metadataStream.dispatchType,w.trigger("id3Frame",K)}),F.coalesceStream.on("caption",this.trigger.bind(this,"caption")),F.coalesceStream.on("done",this.trigger.bind(this,"done")),jd(this,F)},this.setBaseMediaDecodeTime=function(F){var K=this.transmuxPipeline_;C.keepOriginalTimestamps||(this.baseMediaDecodeTime=F),D&&(D.timelineStartInfo.dts=void 0,D.timelineStartInfo.pts=void 0,bi(D),K.audioTimestampRolloverStream&&K.audioTimestampRolloverStream.discontinuity()),I&&(K.videoSegmentStream&&(K.videoSegmentStream.gopCache_=[]),I.timelineStartInfo.dts=void 0,I.timelineStartInfo.pts=void 0,bi(I),K.captionStream.reset()),K.timestampRolloverStream&&K.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(F){D&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(F)},this.setRemux=function(F){var K=this.transmuxPipeline_;C.remux=F,K&&K.coalesceStream&&K.coalesceStream.setRemux(F)},this.alignGopsWith=function(F){I&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(F)},this.getLogTrigger_=function(F){var K=this;return function(W){W.stream=F,K.trigger("log",W)}},this.push=function(F){var K;N&&((K=Kp(F))&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():K||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),N=!1),this.transmuxPipeline_.headOfPipeline.push(F)},this.flush=function(){N=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new nt;var zp={Transmuxer:lo,VideoSegmentStream:kn,AudioSegmentStream:ur,AUDIO_PROPERTIES:ho,VIDEO_PROPERTIES:co,generateSegmentTimingInfo:uo},lr=function(C){var I="";return I+=String.fromCharCode(C[0]),I+=String.fromCharCode(C[1]),(I+=String.fromCharCode(C[2]))+String.fromCharCode(C[3])},qp=s=function(C){return C>>>0},ft=function C(I,D){var w,N,F,K=[];if(!D.length)return null;for(w=0;w<I.byteLength;)N=qp(I[w]<<24|I[w+1]<<16|I[w+2]<<8|I[w+3]),F=lr(I.subarray(w+4,w+8)),N=1<N?w+N:I.byteLength,F===D[0]&&(1===D.length?K.push(I.subarray(w+8,N)):(F=C(I.subarray(w+8,N),D.slice(1))).length&&(K=K.concat(F))),w=N;return K},Gd=s,Kd=function(C){var I={version:C[0],flags:new Uint8Array(C.subarray(1,4)),baseMediaDecodeTime:Gd(C[4]<<24|C[5]<<16|C[6]<<8|C[7])};return 1===I.version&&(I.baseMediaDecodeTime*=Math.pow(2,32),I.baseMediaDecodeTime+=Gd(C[8]<<24|C[9]<<16|C[10]<<8|C[11])),I},Hd=function(C){return{isLeading:(12&C[0])>>>2,dependsOn:3&C[0],isDependedOn:(192&C[1])>>>6,hasRedundancy:(48&C[1])>>>4,paddingValue:(14&C[1])>>>1,isNonSyncSample:1&C[1],degradationPriority:C[2]<<8|C[3]}},Wd=function(C){var I,D={version:C[0],flags:new Uint8Array(C.subarray(1,4)),samples:[]},w=new DataView(C.buffer,C.byteOffset,C.byteLength),N=1&D.flags[2],F=4&D.flags[2],K=1&D.flags[1],W=2&D.flags[1],X=4&D.flags[1],oe=8&D.flags[1],ue=w.getUint32(4),re=8;for(N&&(D.dataOffset=w.getInt32(re),re+=4),F&&ue&&(I={flags:Hd(C.subarray(re,re+4))},re+=4,K&&(I.duration=w.getUint32(re),re+=4),W&&(I.size=w.getUint32(re),re+=4),oe&&(I.compositionTimeOffset=1===D.version?w.getInt32(re):w.getUint32(re),re+=4),D.samples.push(I),ue--);ue--;)I={},K&&(I.duration=w.getUint32(re),re+=4),W&&(I.size=w.getUint32(re),re+=4),X&&(I.flags=Hd(C.subarray(re,re+4)),re+=4),oe&&(I.compositionTimeOffset=1===D.version?w.getInt32(re):w.getUint32(re),re+=4),D.samples.push(I);return D},zd=function(C){var I=new DataView(C.buffer,C.byteOffset,C.byteLength),D={version:C[0],flags:new Uint8Array(C.subarray(1,4)),trackId:I.getUint32(4)},w=1&D.flags[2],N=2&D.flags[2],F=8&D.flags[2],K=16&D.flags[2],W=32&D.flags[2],X=65536&D.flags[0],oe=131072&D.flags[0];return C=8,w&&(C+=4,D.baseDataOffset=I.getUint32(12),C+=4),N&&(D.sampleDescriptionIndex=I.getUint32(C),C+=4),F&&(D.defaultSampleDuration=I.getUint32(C),C+=4),K&&(D.defaultSampleSize=I.getUint32(C),C+=4),W&&(D.defaultSampleFlags=I.getUint32(C)),X&&(D.durationIsEmpty=!0),!w&&oe&&(D.baseDataOffsetIsMoof=!0),D},Xp=Md,Yp=cn.CaptionStream,Qp=function(){var C,I,D,w,N,F,K=!1;this.isInitialized=function(){return K},this.init=function(W){C=new Yp,K=!0,F=!!W&&W.isPartial,C.on("data",function(X){X.startTime=X.startPts/w,X.endTime=X.endPts/w,N.captions.push(X),N.captionStreams[X.stream]=!0}),C.on("log",function(X){N.logs.push(X)})},this.isNewInit=function(W,X){return!(W&&0===W.length||X&&"object"==typeof X&&0===Object.keys(X).length||D===W[0]&&w===X[D])},this.parse=function(W,X,oe){if(!this.isInitialized()||!X||!oe)return null;if(this.isNewInit(X,oe))w=oe[D=X[0]];else if(null===D||!w)return I.push(W),null;for(;0<I.length;){var ue=I.shift();this.parse(ue,X,oe)}return Me=w,(W=null===(_e=D)?null:(_e=function(C,I){var D=ft(C,["moof","traf"]),w=(C=ft(C,["mdat"]),{}),N=[];return C.forEach(function(F,K){N.push({mdat:F,traf:K=D[K]})}),N.forEach(function(F){var K,W,X,oe,ue,re=F.mdat,Me=ft(_e=F.traf,["tfhd"]),Ke=zd(Me[0]),_e=(F=Ke.trackId,Me=0<(Me=ft(_e,["tfdt"])).length?Kd(Me[0]).baseMediaDecodeTime:0,ft(_e,["trun"]));I===F&&0<_e.length&&(K=Me,W=(Ke=Ke).defaultSampleDuration||0,X=Ke.defaultSampleSize||0,oe=Ke.trackId,ue=[],(_e=_e).forEach(function(Ue){(Ue=Wd(Ue).samples).forEach(function(je){void 0===je.duration&&(je.duration=W),void 0===je.size&&(je.size=X),je.trackId=oe,je.dts=K,void 0===je.compositionTimeOffset&&(je.compositionTimeOffset=0),je.pts=K+je.compositionTimeOffset,K+=je.duration}),ue=ue.concat(Ue)}),re=function(Ue,je,St){for(var Ve,Le,En=new DataView(Ue.buffer,Ue.byteOffset,Ue.byteLength),hr={logs:[],seiNals:[]},oa=0;oa+4<Ue.length;oa+=Ve)if(Ve=En.getUint32(oa),oa+=4,!(Ve<=0))switch(31&Ue[oa]){case 6:var Ra=Ue.subarray(oa+1,oa+1+Ve),Sn=function(rm,Xd){for(var Yd=rm,mo=0;mo<Xd.length;mo++){var go=Xd[mo];if(Yd<go.size)return go;Yd-=go.size}return null}(oa,je);if(Ra={nalUnitType:"sei_rbsp",size:Ve,data:Ra,escapedRBSP:Xp(Ra),trackId:St},Sn)Ra.pts=Sn.pts,Ra.dts=Sn.dts,Le=Sn;else{if(!Le){hr.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+oa+" for trackId "+St+". See mux.js#223."});break}Ra.pts=Le.pts,Ra.dts=Le.dts}hr.seiNals.push(Ra)}return hr}(re,ue,F),w[F]||(w[F]={seiNals:[],logs:[]}),w[F].seiNals=w[F].seiNals.concat(re.seiNals),w[F].logs=w[F].logs.concat(re.logs))}),w}(W,_e)[_e]||{},{seiNals:_e.seiNals,logs:_e.logs,timescale:Me}))&&W.logs&&(N.logs=N.logs.concat(W.logs)),null!==W&&W.seiNals?(this.pushNals(W.seiNals),this.flushStream(),N):N.logs.length?{logs:N.logs,captions:[],captionStreams:[]}:null;var _e,Me},this.pushNals=function(W){if(!this.isInitialized()||!W||0===W.length)return null;W.forEach(function(X){C.push(X)})},this.flushStream=function(){if(!this.isInitialized())return null;F?C.partialFlush():C.flush()},this.clearParsedCaptions=function(){N.captions=[],N.captionStreams={},N.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;C.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){I=[],w=D=null,N?this.clearParsedCaptions():N={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Ai=s,dr=function(C){return("00"+C.toString(16)).slice(-2)},Zp=(Da=function(C){return ft(C,["moov","trak"]).reduce(function(I,D){var N,F=ft(D,["tkhd"])[0];return F?(F=Ai(F[N=0===F[0]?12:20]<<24|F[1+N]<<16|F[2+N]<<8|F[3+N]),(D=ft(D,["mdia","mdhd"])[0])?(I[F]=Ai(D[N=0===D[0]?12:20]<<24|D[1+N]<<16|D[2+N]<<8|D[3+N]),I):null):null},{})},Md=function(C,I){var D,w,N=ft(I,["moof","traf"]),F=0,K=0;return N&&N.length&&(D=ft(N[0],["tfhd"])[0],I=ft(N[0],["trun"])[0],N=ft(N[0],["tfdt"])[0],D&&(w=zd(D).trackId),N&&(F=Kd(N).baseMediaDecodeTime),!I||(I=Wd(I)).samples&&I.samples.length&&(K=I.samples[0].compositionTimeOffset||0)),(F+K)/(C[w]||9e4)},nt=function(C,I){return I=ft(I,["moof","traf"]),I=[].concat.apply([],I.map(function(D){return ft(D,["tfhd"]).map(function(w){var N=Ai(w[4]<<24|w[5]<<16|w[6]<<8|w[7]);return w=C[N]||9e4,(N="number"!=typeof(N=ft(D,["tfdt"]).map(function(F){var K=F[0],W=Ai(F[4]<<24|F[5]<<16|F[6]<<8|F[7]);return 1===K&&(W*=Math.pow(2,32),W+=Ai(F[8]<<24|F[9]<<16|F[10]<<8|F[11])),W})[0])||isNaN(N)?1/0:N)/w})})),I=Math.min.apply(null,I),isFinite(I)?I:0}),em=s=function(C){C=ft(C,["moov","trak"]);var I=[];return C.forEach(function(D){var w={},N=ft(D,["tkhd"])[0];N&&(N=(F=new DataView(N.buffer,N.byteOffset,N.byteLength)).getUint8(0),w.id=F.getUint32(0===N?12:20));var F=ft(D,["mdia","hdlr"])[0];F&&(W=lr(F.subarray(8,12)),w.type="vide"===W?"video":"soun"===W?"audio":W);var K,W=ft(D,["mdia","minf","stbl","stsd"])[0];W&&(W=W.subarray(8),w.codec=lr(W.subarray(4,8)),(W=ft(W,[w.codec])[0])&&(/^[asm]vc[1-9]$/i.test(w.codec)?(K=W.subarray(78),"avcC"===lr(K.subarray(4,8))&&11<K.length?(w.codec+=".",w.codec+=dr(K[9]),w.codec+=dr(K[10]),w.codec+=dr(K[11])):w.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(w.codec)?(K=W.subarray(28),"esds"===lr(K.subarray(4,8))&&20<K.length&&0!==K[19]?(w.codec+="."+dr(K[19]),w.codec+="."+dr(K[20]>>>2&63).replace(/^0/,"")):w.codec="mp4a.40.2"):w.codec=w.codec.toLowerCase())),(D=ft(D,["mdia","mdhd"])[0])&&(w.timescale=function(C){var I=0===C[0]?12:20;return Ai(C[I]<<24|C[1+I]<<16|C[2+I]<<8|C[3+I])}(D)),I.push(w)}),I},Ii=qt,qe={};function tm(C,I,D){for(var w,N,F,K,W=0,X=188,oe=!1;X<=C.byteLength;)if(71!==C[W]||71!==C[X]&&X!==C.byteLength)W++,X++;else{if(w=C.subarray(W,X),"pes"===qe.ts.parseType(w,I.pid)&&(N=qe.ts.parsePesType(w,I.table),F=qe.ts.parsePayloadUnitStartIndicator(w),"audio"===N&&F&&(K=qe.ts.parsePesTime(w))&&(K.type="audio",D.audio.push(K),oe=!0)),oe)break;W+=188,X+=188}for(W=(X=C.byteLength)-188,oe=!1;0<=W;)if(71!==C[W]||71!==C[X]&&X!==C.byteLength)W--,X--;else{if(w=C.subarray(W,X),"pes"===qe.ts.parseType(w,I.pid)&&(N=qe.ts.parsePesType(w,I.table),F=qe.ts.parsePayloadUnitStartIndicator(w),"audio"===N&&F&&(K=qe.ts.parsePesTime(w))&&(K.type="audio",D.audio.push(K),oe=!0)),oe)break;W-=188,X-=188}}function am(C){var I,D={pid:null,table:null},w={};for(I in function(N,F){for(var K,W=0,X=188;X<N.byteLength;)if(71!==N[W]||71!==N[X])W++,X++;else{switch(K=N.subarray(W,X),qe.ts.parseType(K,F.pid)){case"pat":F.pid=qe.ts.parsePat(K);break;case"pmt":var oe=qe.ts.parsePmt(K);F.table=F.table||{},Object.keys(oe).forEach(function(ue){F.table[ue]=oe[ue]})}W+=188,X+=188}}(C,D),D.table)if(D.table.hasOwnProperty(I))switch(D.table[I]){case wt.H264_STREAM_TYPE:w.video=[],function(N,F,K){for(var W,X,oe,ue,re,_e,Me,Ke,Ue=0,je=188,St=!1,Ve={data:[],size:0};je<N.byteLength;)if(71!==N[Ue]||71!==N[je])Ue++,je++;else{if(W=N.subarray(Ue,je),"pes"===qe.ts.parseType(W,F.pid)&&(X=qe.ts.parsePesType(W,F.table),oe=qe.ts.parsePayloadUnitStartIndicator(W),"video"===X&&(oe&&!St&&(ue=qe.ts.parsePesTime(W))&&(ue.type="video",K.video.push(ue),St=!0),!K.firstKeyFrame))){if(oe&&0!==Ve.size){for(re=new Uint8Array(Ve.size),_e=0;Ve.data.length;)Me=Ve.data.shift(),re.set(Me,_e),_e+=Me.byteLength;!qe.ts.videoPacketContainsKeyFrame(re)||(Ke=qe.ts.parsePesTime(re))&&(K.firstKeyFrame=Ke,K.firstKeyFrame.type="video"),Ve.size=0}Ve.data.push(W),Ve.size+=W.byteLength}if(St&&K.firstKeyFrame)break;Ue+=188,je+=188}for(Ue=(je=N.byteLength)-188,St=!1;0<=Ue;)if(71!==N[Ue]||71!==N[je])Ue--,je--;else{if(W=N.subarray(Ue,je),"pes"===qe.ts.parseType(W,F.pid)&&(X=qe.ts.parsePesType(W,F.table),oe=qe.ts.parsePayloadUnitStartIndicator(W),"video"===X&&oe&&(ue=qe.ts.parsePesTime(W))&&(ue.type="video",K.video.push(ue),St=!0)),St)break;Ue-=188,je-=188}}(C,D,w),0===w.video.length&&delete w.video;break;case wt.ADTS_STREAM_TYPE:w.audio=[],tm(C,D,w),0===w.audio.length&&delete w.audio}return w}qe.ts={parseType:function(C,I){return 0===(C=Vd(C))?"pat":C===I?"pmt":I?"pes":null},parsePat:function(C){var I=vn(C),D=4+Tn(C);return I&&(D+=C[D]+1),(31&C[D+10])<<8|C[D+11]},parsePmt:function(C){var I={},D=vn(C),w=4+Tn(C);if(D&&(w+=C[w]+1),1&C[w+5]){for(var N=3+((15&C[w+1])<<8|C[w+2])-4,F=12+((15&C[w+10])<<8|C[w+11]);F<N;){var K=w+F;I[(31&C[K+1])<<8|C[K+2]]=C[K],F+=5+((15&C[K+3])<<8|C[K+4])}return I}},parsePayloadUnitStartIndicator:vn,parsePesType:function(C,I){switch(I[Vd(C)]){case wt.H264_STREAM_TYPE:return"video";case wt.ADTS_STREAM_TYPE:return"audio";case wt.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(C){if(!vn(C))return null;var I=4+Tn(C);if(I>=C.byteLength)return null;var D=null,w=C[I+7];return 192&w&&((D={}).pts=(14&C[I+9])<<27|(255&C[I+10])<<20|(254&C[I+11])<<12|(255&C[I+12])<<5|(254&C[I+13])>>>3,D.pts*=4,D.pts+=(6&C[I+13])>>>1,D.dts=D.pts,64&w&&(D.dts=(14&C[I+14])<<27|(255&C[I+15])<<20|(254&C[I+16])<<12|(255&C[I+17])<<5|(254&C[I+18])>>>3,D.dts*=4,D.dts+=(6&C[I+18])>>>1)),D},videoPacketContainsKeyFrame:function(C){for(var I=4+Tn(C),D=C.subarray(I),w=0,N=0,F=!1;N<D.byteLength-3;N++)if(1===D[N+2]){w=N+5;break}for(;w<D.byteLength;)switch(D[w]){case 0:if(0!==D[w-1]){w+=2;break}if(0!==D[w-2]){w++;break}for(N+3!==w-2&&"slice_layer_without_partitioning_rbsp_idr"===po(31&D[N+3])&&(F=!0);1!==D[++w]&&w<D.length;);N=w-2,w+=3;break;case 1:if(0!==D[w-1]||0!==D[w-2]){w+=3;break}"slice_layer_without_partitioning_rbsp_idr"===po(31&D[N+3])&&(F=!0),N=w-2,w+=3;break;default:w+=3}return D=D.subarray(N),w-=N,N=0,!!(D&&3<D.byteLength&&"slice_layer_without_partitioning_rbsp_idr"===po(31&D[N+3]))||F}},qe.aac=_n;var qa=Wa,im=function(C,I){var D,w,N=(qe.aac.isLikelyAacData(C)?function(F){for(var K,W=!1,X=0,oe=null,ue=null,re=0,_e=0;3<=F.length-_e;){switch(qe.aac.parseType(F,_e)){case"timed-metadata":if(F.length-_e<10){W=!0;break}if((re=qe.aac.parseId3TagSize(F,_e))>F.length){W=!0;break}null===ue&&(K=F.subarray(_e,_e+re),ue=qe.aac.parseAacTimestamp(K)),_e+=re;break;case"audio":if(F.length-_e<7){W=!0;break}if((re=qe.aac.parseAdtsSize(F,_e))>F.length){W=!0;break}null===oe&&(K=F.subarray(_e,_e+re),oe=qe.aac.parseSampleRate(K)),X++,_e+=re;break;default:_e++}if(W)return null}if(null===oe||null===ue)return null;var Me=qa/oe;return{audio:[{type:"audio",dts:ue,pts:ue},{type:"audio",dts:ue+1024*X*Me,pts:ue+1024*X*Me}]}}:am)(C);return N&&(N.audio||N.video)?(C=I,(I=N).audio&&I.audio.length&&(void 0!==(D=C)&&!isNaN(D)||(D=I.audio[0].dts),I.audio.forEach(function(F){F.dts=Ii(F.dts,D),F.pts=Ii(F.pts,D),F.dtsTime=F.dts/qa,F.ptsTime=F.pts/qa})),I.video&&I.video.length&&(void 0!==(w=C)&&!isNaN(w)||(w=I.video[0].dts),I.video.forEach(function(F){F.dts=Ii(F.dts,w),F.pts=Ii(F.pts,w),F.dtsTime=F.dts/qa,F.ptsTime=F.pts/qa}),I.firstKeyFrame&&((I=I.firstKeyFrame).dts=Ii(I.dts,w),I.pts=Ii(I.pts,w),I.dtsTime=I.dts/qa,I.ptsTime=I.pts/qa)),N):null},qd=function(){function C(D,w){this.options=w||{},this.self=D,this.init()}var I=C.prototype;return I.init=function(){var D,w;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new zp.Transmuxer(this.options),D=this.self,(w=this.transmuxer).on("data",function(N){var F=N.initSegment;N.initSegment={data:F.buffer,byteOffset:F.byteOffset,byteLength:F.byteLength},N.data=(F=N.data).buffer,D.postMessage({action:"data",segment:N,byteOffset:F.byteOffset,byteLength:F.byteLength},[N.data])}),w.on("done",function(N){D.postMessage({action:"done"})}),w.on("gopInfo",function(N){D.postMessage({action:"gopInfo",gopInfo:N})}),w.on("videoSegmentTimingInfo",function(N){var F={start:{decode:Ot(N.start.dts),presentation:Ot(N.start.pts)},end:{decode:Ot(N.end.dts),presentation:Ot(N.end.pts)},baseMediaDecodeTime:Ot(N.baseMediaDecodeTime)};N.prependedContentDuration&&(F.prependedContentDuration=Ot(N.prependedContentDuration)),D.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:F})}),w.on("audioSegmentTimingInfo",function(N){var F={start:{decode:Ot(N.start.dts),presentation:Ot(N.start.pts)},end:{decode:Ot(N.end.dts),presentation:Ot(N.end.pts)},baseMediaDecodeTime:Ot(N.baseMediaDecodeTime)};N.prependedContentDuration&&(F.prependedContentDuration=Ot(N.prependedContentDuration)),D.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:F})}),w.on("id3Frame",function(N){D.postMessage({action:"id3Frame",id3Frame:N})}),w.on("caption",function(N){D.postMessage({action:"caption",caption:N})}),w.on("trackinfo",function(N){D.postMessage({action:"trackinfo",trackInfo:N})}),w.on("audioTimingInfo",function(N){D.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:Ot(N.start),end:Ot(N.end)}})}),w.on("videoTimingInfo",function(N){D.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:Ot(N.start),end:Ot(N.end)}})}),w.on("log",function(N){D.postMessage({action:"log",log:N})})},I.pushMp4Captions=function(D){this.captionParser||(this.captionParser=new Qp,this.captionParser.init());var w=new Uint8Array(D.data,D.byteOffset,D.byteLength);D=this.captionParser.parse(w,D.trackIds,D.timescales),this.self.postMessage({action:"mp4Captions",captions:D&&D.captions||[],logs:D&&D.logs||[],data:w.buffer},[w.buffer])},I.probeMp4StartTime=function(D){var w=Zp(w=D.timescales,D=D.data);this.self.postMessage({action:"probeMp4StartTime",startTime:w,data:D},[D.buffer])},I.probeMp4Tracks=function(D){var w=D.data;D=em(w),this.self.postMessage({action:"probeMp4Tracks",tracks:D,data:w},[w.buffer])},I.probeTs=function(D){var w=D.data,N=(D="number"!=typeof(N=D.baseStartTime)||isNaN(N)?void 0:N*Wa,im(w,D));D=null,N&&((D={hasVideo:N.video&&2===N.video.length||!1,hasAudio:N.audio&&2===N.audio.length||!1}).hasVideo&&(D.videoStart=N.video[0].ptsTime),D.hasAudio&&(D.audioStart=N.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:D,data:w},[w.buffer])},I.clearAllMp4Captions=function(){this.captionParser&&this.captionParser.clearAllCaptions()},I.clearParsedMp4Captions=function(){this.captionParser&&this.captionParser.clearParsedCaptions()},I.push=function(D){D=new Uint8Array(D.data,D.byteOffset,D.byteLength),this.transmuxer.push(D)},I.reset=function(){this.transmuxer.reset()},I.setTimestampOffset=function(D){D=D.timestampOffset||0,this.transmuxer.setBaseMediaDecodeTime(Math.round(Ad(D)))},I.setAudioAppendStart=function(D){this.transmuxer.setAudioAppendStart(Math.ceil(Ad(D.appendStart)))},I.setRemux=function(D){this.transmuxer.setRemux(D.remux)},I.flush=function(D){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})},I.endTimeline=function(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})},I.alignGopsWith=function(D){this.transmuxer.alignGopsWith(D.gopsToAlignWith.slice())},C}();self.onmessage=function(C){"init"===C.data.action&&C.data.options?this.messageHandlers=new qd(self,C.data.options):(this.messageHandlers||(this.messageHandlers=new qd(self)),C.data&&C.data.action&&"init"!==C.data.action&&this.messageHandlers[C.data.action]&&this.messageHandlers[C.data.action](C.data))}}))),sd=function(s){s.currentTransmux=null,s.transmuxQueue.length&&(s.currentTransmux=s.transmuxQueue.shift(),"function"==typeof s.currentTransmux?s.currentTransmux():Gl(s.currentTransmux))},od=function(s){!function(s,p){if(!p.currentTransmux)return p.currentTransmux=s,Kl(p,s),0;p.transmuxQueue.push(Kl.bind(null,p,s))}("reset",s)},an=2,Hs=-101,Ws=-102,Xc=ra("CodecUtils"),rn=ra("PlaylistSelector"),zs=(Gt=function(){var s=this.useDevicePixelRatio&&window.devicePixelRatio||1;return Jl(this.playlists.master,this.systemBandwidth,parseInt(Zr(this.tech_.el(),"width"),10)*s,parseInt(Zr(this.tech_.el(),"height"),10)*s,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)},function(s){function p(n,u){var m=s.call(this)||this;if(!n)throw new TypeError("Initialization settings are required");if("function"!=typeof n.currentTime)throw new TypeError("No currentTime getter specified");if(!n.mediaSource)throw new TypeError("No MediaSource specified");return m.bandwidth=n.bandwidth,m.throughput={rate:0,count:0},m.roundTrip=NaN,m.resetStats_(),m.mediaIndex=null,m.partIndex=null,m.hasPlayed_=n.hasPlayed,m.currentTime_=n.currentTime,m.seekable_=n.seekable,m.seeking_=n.seeking,m.duration_=n.duration,m.mediaSource_=n.mediaSource,m.vhs_=n.vhs,m.loaderType_=n.loaderType,m.currentMediaInfo_=void 0,m.startingMediaInfo_=void 0,m.segmentMetadataTrack_=n.segmentMetadataTrack,m.goalBufferLength_=n.goalBufferLength,m.sourceType_=n.sourceType,m.sourceUpdater_=n.sourceUpdater,m.inbandTextTracks_=n.inbandTextTracks,m.state_="INIT",m.timelineChangeController_=n.timelineChangeController,m.shouldSaveSegmentTimingInfo_=!0,m.parse708captions_=n.parse708captions,m.captionServices_=n.captionServices,m.experimentalExactManifestTimings=n.experimentalExactManifestTimings,m.checkBufferTimeout_=null,m.error_=void 0,m.currentTimeline_=-1,m.pendingSegment_=null,m.xhrOptions_=null,m.pendingSegments_=[],m.audioDisabled_=!1,m.isPendingTimestampOffset_=!1,m.gopBuffer_=[],m.timeMapping_=0,m.safeAppend_=11<=J.browser.IE_VERSION,m.appendInitSegment_={audio:!0,video:!0},m.playlistOfLastInitSegment_={audio:null,video:null},m.callQueue_=[],m.loadQueue_=[],m.metadataQueue_={id3:[],caption:[]},m.waitingOnRemove_=!1,m.quotaExceededErrorRetryTimeout_=null,m.activeInitSegmentId_=null,m.initSegments_={},m.cacheEncryptionKeys_=n.cacheEncryptionKeys,m.keyCache_={},m.decrypter_=n.decrypter,m.syncController_=n.syncController,m.syncPoint_={segmentIndex:0,time:0},m.transmuxer_=m.createTransmuxer_(),m.triggerSyncInfoUpdate_=function(){return m.trigger("syncinfoupdate")},m.syncController_.on("syncinfoupdate",m.triggerSyncInfoUpdate_),m.mediaSource_.addEventListener("sourceopen",function(){m.isEndOfStream_()||(m.ended_=!1)}),m.fetchAtBuffer_=!1,m.logger_=ra("SegmentLoader["+m.loaderType_+"]"),Object.defineProperty(De(m),"state",{get:function(){return this.state_},set:function(y){y!==this.state_&&(this.logger_(this.state_+" -> "+y),this.state_=y,this.trigger("statechange"))}}),m.sourceUpdater_.on("ready",function(){m.hasEnoughInfoToAppend_()&&m.processCallQueue_()}),"main"===m.loaderType_&&m.timelineChangeController_.on("pendingtimelinechange",function(){m.hasEnoughInfoToAppend_()&&m.processCallQueue_()}),"audio"===m.loaderType_&&m.timelineChangeController_.on("timelinechange",function(){m.hasEnoughInfoToLoad_()&&m.processLoadQueue_(),m.hasEnoughInfoToAppend_()&&m.processCallQueue_()}),m}ge(p,s);var h=p.prototype;return h.createTransmuxer_=function(){return function(s){var p=new zc;p.currentTransmux=null,p.transmuxQueue=[];var h=p.terminate;return p.terminate=function(){return p.currentTransmux=null,p.transmuxQueue.length=0,h.call(p)},p.postMessage({action:"init",options:s}),p}({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})},h.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0},h.dispose=function(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()},h.setAudio=function(n){this.audioDisabled_=!n,n?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())},h.abort=function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)},h.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,window.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null},h.checkForAbort_=function(n){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==n:(this.state="READY",!0)},h.error=function(n){return void 0!==n&&(this.logger_("error occurred:",n),this.error_=n),this.pendingSegment_=null,this.error_},h.endOfStream=function(){this.ended_=!0,this.transmuxer_&&od(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},h.buffered_=function(){var n=this.getMediaInfo_();if(!this.sourceUpdater_||!n)return J.createTimeRanges();if("main"===this.loaderType_){var u=n.hasAudio,m=n.hasVideo;if(n=n.isMuxed,m&&u&&!this.audioDisabled_&&!n)return this.sourceUpdater_.buffered();if(m)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()},h.initSegmentForMap=function(n,u){if(void 0===u&&(u=!1),!n)return null;var m=Yr(n),y=this.initSegments_[m];return u&&!y&&n.bytes&&(this.initSegments_[m]=y={resolvedUri:n.resolvedUri,byterange:n.byterange,bytes:n.bytes,tracks:n.tracks,timescales:n.timescales}),y||n},h.segmentKey=function(n,u){if(void 0===u&&(u=!1),!n)return null;var m=Ol(n),y=this.keyCache_[m];return this.cacheEncryptionKeys_&&u&&!y&&n.bytes&&(this.keyCache_[m]=y={resolvedUri:n.resolvedUri,bytes:n.bytes}),n={resolvedUri:(y||n).resolvedUri},y&&(n.bytes=y.bytes),n},h.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},h.load=function(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))},h.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},h.playlist=function(n,u){if(void 0===u&&(u={}),n){var m=this.playlist_,y=this.pendingSegment_;this.playlist_=n,this.xhrOptions_=u,"INIT"===this.state&&(n.syncInfo={mediaSequence:n.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(n));var T=null;if(m&&(m.id?T=m.id:m.uri&&(T=m.uri)),this.logger_("playlist update ["+T+" => "+(n.id||n.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!m||m.uri!==n.uri)return null!==this.mediaIndex&&(n.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,void this.trigger("playlistupdate");this.logger_("live window shift ["+(u=n.mediaSequence-m.mediaSequence)+"]"),null!==this.mediaIndex&&(this.mediaIndex-=u,this.mediaIndex<0?(this.mediaIndex=null,this.partIndex=null):(T=this.playlist_.segments[this.mediaIndex],!this.partIndex||T.parts&&T.parts.length&&T.parts[this.partIndex]||(T=this.mediaIndex,this.logger_("currently processing part (index "+this.partIndex+") no longer exists."),this.resetLoader(),this.mediaIndex=T))),y&&(y.mediaIndex-=u,y.mediaIndex<0?(y.mediaIndex=null,y.partIndex=null):(0<=y.mediaIndex&&(y.segment=n.segments[y.mediaIndex]),0<=y.partIndex&&y.segment.parts&&(y.part=y.segment.parts[y.partIndex]))),this.syncController_.saveExpiredSegmentInfo(m,n)}},h.pause=function(){this.checkBufferTimeout_&&(window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},h.paused=function(){return null===this.checkBufferTimeout_},h.resetEverything=function(n){this.ended_=!1,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,n),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))},h.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},h.resyncLoader=function(){this.transmuxer_&&od(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})},h.remove=function(n,u,m,y){if(void 0===m&&(m=function(){}),void 0===y&&(y=!1),(u=u===1/0?this.duration_():u)<=n)this.logger_("skipping remove because end ${end} is <= start ${start}");else if(this.sourceUpdater_&&this.getMediaInfo_()){var T,S=1,x=function(){0==--S&&m()};for(T in!y&&this.audioDisabled_||(S++,this.sourceUpdater_.removeAudio(n,u,x)),!y&&"main"!==this.loaderType_||(this.gopBuffer_=function(A,L,O,j){for(var B=Math.ceil((L-j)*en),H=Math.ceil((O-j)*en),q=(j=A.slice(),A.length);q--&&!(A[q].pts<=H););if(-1===q)return j;for(var V=q+1;V--&&!(A[V].pts<=B););return V=Math.max(V,0),j.splice(V,q-V+1),j}(this.gopBuffer_,n,u,this.timeMapping_),S++,this.sourceUpdater_.removeVideo(n,u,x)),this.inbandTextTracks_)or(n,u,this.inbandTextTracks_[T]);or(n,u,this.segmentMetadataTrack_),x()}else this.logger_("skipping remove because no source updater or starting media info")},h.monitorBuffer_=function(){this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window.setTimeout(this.monitorBufferTick_.bind(this),1)},h.monitorBufferTick_=function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window.setTimeout(this.monitorBufferTick_.bind(this),500)},h.fillBuffer_=function(){var n;this.sourceUpdater_.updating()||(n=this.chooseNextRequest_())&&("number"==typeof n.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:n.timeline})),this.loadSegment_(n))},h.isEndOfStream_=function(n,u,m){if(void 0===n&&(n=this.mediaIndex),void 0===u&&(u=this.playlist_),void 0===m&&(m=this.partIndex),!u||!this.mediaSource_)return!1;var y="number"==typeof n&&u.segments[n];return n=n+1===u.segments.length,y=!y||!y.parts||m+1===y.parts.length,u.endList&&"open"===this.mediaSource_.readyState&&n&&y},h.chooseNextRequest_=function(){var n,S,u=kl(n=this.buffered_())||0,m=Ms(n,this.currentTime_()),y=!this.hasPlayed_()&&1<=m,T=m>=this.goalBufferLength_();if(!(n=this.playlist_.segments).length||y||T)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()),(y={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)}).isSyncRequest?y.mediaIndex=function(L,O,j){O=O||[];for(var B=[],H=0,q=0;q<O.length;q++){var V=O[q];if(L===V.timeline&&(B.push(q),j<(H+=V.duration)))return q}return 0===B.length?0:B[B.length-1]}(this.currentTimeline_,n,u):null!==this.mediaIndex?(S="number"==typeof this.partIndex?this.partIndex:-1,y.startOfSegment=(T=n[this.mediaIndex]).end||u,T.parts&&T.parts[S+1]?(y.mediaIndex=this.mediaIndex,y.partIndex=S+1):y.mediaIndex=this.mediaIndex+1):(S=(A=zt.getMediaInfoForTime({experimentalExactManifestTimings:this.experimentalExactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?u:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time})).segmentIndex,x=A.startTime,A=A.partIndex,y.getMediaInfoForTime=this.fetchAtBuffer_?"bufferedEnd "+u:"currentTime "+this.currentTime_(),y.mediaIndex=S,y.startOfSegment=x,y.partIndex=A);var x=n[y.mediaIndex],A=x&&"number"==typeof y.partIndex&&x.parts&&x.parts[y.partIndex];return!x||"number"==typeof y.partIndex&&!A?null:("number"!=typeof y.partIndex&&x.parts&&(y.partIndex=0,A=x.parts[0]),m||!A||A.independent||(0===y.partIndex?(A=(m=n[y.mediaIndex-1]).parts&&m.parts.length&&m.parts[m.parts.length-1])&&A.independent&&(--y.mediaIndex,y.partIndex=m.parts.length-1,y.independent="previous segment"):x.parts[y.partIndex-1].independent&&(--y.partIndex,y.independent="previous part")),x=this.mediaSource_&&"ended"===this.mediaSource_.readyState,y.mediaIndex>=n.length-1&&x&&!this.seeking_()?null:this.generateSegmentInfo_(y))},h.generateSegmentInfo_=function(n){var u=n.independent,m=n.playlist,y=n.mediaIndex,T=n.startOfSegment,S=n.isSyncRequest,x=n.partIndex,A=n.forceTimestampOffset,L=n.getMediaInfoForTime,O=m.segments[y];return n="number"==typeof x&&O.parts[x],u={requestId:"segment-loader-"+Math.random(),uri:n&&n.resolvedUri||O.resolvedUri,mediaIndex:y,partIndex:n?x:null,isSyncRequest:S,startOfSegment:T,playlist:m,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:O.timeline,duration:n&&n.duration||O.duration,segment:O,part:n,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:L,independent:u},A=void 0!==A?A:this.isPendingTimestampOffset_,u.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:O.timeline,currentTimeline:this.currentTimeline_,startOfSegment:T,buffered:this.buffered_(),overrideCheck:A}),"number"==typeof(A=kl(this.sourceUpdater_.audioBuffered()))&&(u.audioAppendStart=A-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(u.gopsToAlignWith=function(j,B,H){if(null==B||!j.length)return[];for(var q=Math.ceil((B-H+3)*en),V=0;V<j.length&&!(j[V].pts>q);V++);return j.slice(V)}(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),u},h.timestampOffsetForSegment_=function(n){return m=(u=n).segmentTimeline,y=u.currentTimeline,n=u.buffered,u.overrideCheck||m!==y?m<y||!n.length?u.startOfSegment:n.end(n.length-1):null;var u,m,y},h.earlyAbortWhenNeeded_=function(n){var u,m,y,T,S,x,A,L,O,j,B,H,q;!this.vhs_.tech_.paused()&&this.xhrOptions_.timeout&&this.playlist_.attributes.BANDWIDTH&&(Date.now()-(n.firstBytesReceivedAt||Date.now())<1e3||(u=this.currentTime_(),q=zt.estimateSegmentRequestTime(S=this.pendingSegment_.duration,T=n.bandwidth,this.playlist_,n.bytesReceived),m=this.buffered_(),y=u,void 0===(n=this.vhs_.tech_.playbackRate())&&(n=1),q<=(n=((m.length?m.end(m.length-1):0)-y)/n-1)||(T={master:this.vhs_.playlists.master,currentTime:u,bandwidth:T,duration:this.duration_(),segmentDuration:S,timeUntilRebuffer:n,currentTimeline:this.currentTimeline_,syncController:this.syncController_},x=T.currentTime,A=T.bandwidth,L=T.duration,O=T.segmentDuration,j=T.timeUntilRebuffer,B=T.currentTimeline,H=T.syncController,vi(S=(T=(S=(S=(T=(S=T.master).playlists.filter(function(V){return!zt.isIncompatible(V)})).filter(zt.isEnabled)).length?S:T.filter(function(V){return!zt.isDisabled(V)})).filter(zt.hasAttribute.bind(null,"BANDWIDTH")).map(function(V){var ee=H.getSyncPoint(V,L,B,x)?1:2;return{playlist:V,rebufferingImpact:zt.estimateSegmentRequestTime(O,A,V)*ee-j}})).filter(function(V){return V.rebufferingImpact<=0}),function(V,ee){return Gs(ee.playlist,V.playlist)}),(T=S.length?S[0]:(vi(T,function(V,ee){return V.rebufferingImpact-ee.rebufferingImpact}),T[0]||null))&&(q=q-n-T.rebufferingImpact,!T.playlist||T.playlist.uri===this.playlist_.uri||q<(n<=Ha?1:.5)||(this.bandwidth=T.playlist.attributes.BANDWIDTH*bt.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))))))},h.handleAbort_=function(n){this.logger_("Aborting "+Ti(n)),this.mediaRequestsAborted+=1},h.handleProgress_=function(n,u){this.earlyAbortWhenNeeded_(u.stats),this.checkForAbort_(u.requestId)||this.trigger("progress")},h.handleTrackInfo_=function(n,u){this.earlyAbortWhenNeeded_(n.stats),this.checkForAbort_(n.requestId)||this.checkForIllegalMediaSwitch(u)||(function(m,y){if(!m&&!y||!m&&y||m&&!y)return!1;if(m===y)return!0;var T=Object.keys(m).sort(),S=Object.keys(y).sort();if(T.length!==S.length)return!1;for(var x=0;x<T.length;x++){var A=T[x];if(A!==S[x]||m[A]!==y[A])return!1}return!0}(this.currentMediaInfo_,u=u||{})||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=u,this.currentMediaInfo_=u,this.logger_("trackinfo update",u),this.trigger("trackinfo")),this.checkForAbort_(n.requestId)||(this.pendingSegment_.trackInfo=u,this.hasEnoughInfoToAppend_()&&this.processCallQueue_()))},h.handleTimingInfo_=function(n,u,m,y){var T;this.earlyAbortWhenNeeded_(n.stats),this.checkForAbort_(n.requestId)||((T=this.pendingSegment_)[n=ed(u)]=T[n]||{},T[n][m]=y,this.logger_("timinginfo: "+u+" - "+m+" - "+y),this.hasEnoughInfoToAppend_()&&this.processCallQueue_())},h.handleCaptions_=function(n,u){var m,y,T=this;this.earlyAbortWhenNeeded_(n.stats),this.checkForAbort_(n.requestId)||(0!==u.length?this.pendingSegment_.hasAppendedData_?(m=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),y={},u.forEach(function(S){y[S.stream]=y[S.stream]||{startTime:1/0,captions:[],endTime:0};var x=y[S.stream];x.startTime=Math.min(x.startTime,S.startTime+m),x.endTime=Math.max(x.endTime,S.endTime+m),x.captions.push(S)}),Object.keys(y).forEach(function(S){var x,A,L,O,j,B,H,q,V,ee,ae=y[S],ne=ae.startTime,ie=ae.endTime,he=ae.captions,ke=T.inbandTextTracks_;T.logger_("adding cues from "+ne+" -> "+ie+" for "+S),A=T.vhs_.tech_,(x=ke)[L=S]||(A.trigger({type:"usage",name:"vhs-608"}),A.trigger({type:"usage",name:"hls-608"}),/^cc708_/.test(O=L)&&(O="SERVICE"+L.split("_")[1]),(H=A.textTracks().getTrackById(O))?x[L]=H:(B=j=L,ae=!1,(H=(A.options_.vhs&&A.options_.vhs.captionServices||{})[O])&&(j=H.label,B=H.language,ae=H.default),x[L]=A.addRemoteTextTrack({kind:"captions",id:O,default:ae,label:j,language:B},!1).track)),or(ne,ie,ke[S]),V=(he={captionArray:he,inbandTextTracks:ke,timestampOffset:m}).inbandTextTracks,ee=he.timestampOffset,(ke=he.captionArray)&&(q=window.WebKitDataCue||window.VTTCue,ke.forEach(function(ve){V[ve.stream].addCue(new q(ve.startTime+ee,ve.endTime+ee,ve.text))}))}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})):this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,n,u)):this.logger_("SegmentLoader received no captions from a caption event"))},h.handleId3_=function(n,u,m){var y,T,S;this.earlyAbortWhenNeeded_(n.stats),this.checkForAbort_(n.requestId)||(this.pendingSegment_.hasAppendedData_?(y=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),S=m,(T=this.inbandTextTracks_).metadataTrack_||(T.metadataTrack_=this.vhs_.tech_.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,T.metadataTrack_.inBandMetadataTrackDispatchType=S),function(s){var h=s.metadataArray,n=s.timestampOffset,u=s.videoDuration;if(h){var m=window.WebKitDataCue||window.VTTCue,y=s.inbandTextTracks.metadataTrack_;if(y&&(h.forEach(function(O){var j=O.cueTime+n;!("number"!=typeof j||window.isNaN(j)||j<0)&&j<1/0&&O.frames.forEach(function(B){var H,q=new m(j,j,B.value||B.url||B.data||"");q.frame=B,q.value=B,H=q,Object.defineProperties(H.frame,{id:{get:function(){return J.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),H.value.key}},value:{get:function(){return J.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),H.value.data}},privateData:{get:function(){return J.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),H.value.data}}}),y.addCue(q)})}),y.cues&&y.cues.length)){for(var T=y.cues,S=[],x=0;x<T.length;x++)T[x]&&S.push(T[x]);var A=S.reduce(function(O,j){var B=O[j.startTime]||[];return B.push(j),O[j.startTime]=B,O},{}),L=Object.keys(A).sort(function(O,j){return Number(O)-Number(j)});L.forEach(function(O,j){O=A[O];var B=Number(L[j+1])||u;O.forEach(function(H){H.endTime=B})})}}}({inbandTextTracks:this.inbandTextTracks_,metadataArray:u,timestampOffset:y,videoDuration:this.duration_()})):this.metadataQueue_.id3.push(this.handleId3_.bind(this,n,u,m)))},h.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(n){return n()}),this.metadataQueue_.caption.forEach(function(n){return n()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},h.processCallQueue_=function(){var n=this.callQueue_;this.callQueue_=[],n.forEach(function(u){return u()})},h.processLoadQueue_=function(){var n=this.loadQueue_;this.loadQueue_=[],n.forEach(function(u){return u()})},h.hasEnoughInfoToLoad_=function(){if("audio"!==this.loaderType_)return!0;var n=this.pendingSegment_;return!(!n||this.getCurrentMediaInfo_()&&td({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:n.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},h.getCurrentMediaInfo_=function(n){return(n=void 0===n?this.pendingSegment_:n)&&n.trackInfo||this.currentMediaInfo_},h.getMediaInfo_=function(n){return void 0===n&&(n=this.pendingSegment_),this.getCurrentMediaInfo_(n)||this.startingMediaInfo_},h.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;var n=this.pendingSegment_,u=this.getCurrentMediaInfo_();if(!n||!u)return!1;var m=u.hasAudio,y=u.hasVideo;return u=u.isMuxed,!(y&&!n.videoTimingInfo||m&&!this.audioDisabled_&&!u&&!n.audioTimingInfo||td({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:n.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},h.handleData_=function(n,u){if(this.earlyAbortWhenNeeded_(n.stats),!this.checkForAbort_(n.requestId))if(!this.callQueue_.length&&this.hasEnoughInfoToAppend_()){var m,y=this.pendingSegment_;if(this.setTimeMapping_(y.timeline),this.updateMediaSecondsLoaded_(y.part||y.segment),"closed"!==this.mediaSource_.readyState){if(n.map&&(n.map=this.initSegmentForMap(n.map,!0),y.segment.map=n.map),n.key&&this.segmentKey(n.key,!0),y.isFmp4=n.isFmp4,y.timingInfo=y.timingInfo||{},y.isFmp4?(this.trigger("fmp4"),y.timingInfo.start=y[ed(u.type)].start):(m=this.getCurrentMediaInfo_(),(m="main"===this.loaderType_&&m&&m.hasVideo)&&(T=y.videoTimingInfo.start),y.timingInfo.start=this.trueSegmentStart_({currentStart:y.timingInfo.start,playlist:y.playlist,mediaIndex:y.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:m,firstVideoFrameTimeForData:T,videoTimingInfo:y.videoTimingInfo,audioTimingInfo:y.audioTimingInfo})),this.updateAppendInitSegmentStatus(y,u.type),this.updateSourceBufferTimestampOffset_(y),y.isSyncRequest){this.updateTimingInfoEnd_(y),this.syncController_.saveSegmentTimingInfo({segmentInfo:y,shouldSaveTimelineMapping:"main"===this.loaderType_});var T=this.chooseNextRequest_();if(T.mediaIndex!==y.mediaIndex||T.partIndex!==y.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}y.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(y,u)}}else this.callQueue_.push(this.handleData_.bind(this,n,u))},h.updateAppendInitSegmentStatus=function(n,u){"main"!==this.loaderType_||"number"!=typeof n.timestampOffset||n.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[u]!==n.playlist&&(this.appendInitSegment_[u]=!0)},h.getInitSegmentAndUpdateState_=function(n){var u=n.type,m=n.initSegment,y=n.map,T=n.playlist;if(y){if(n=Yr(y),this.activeInitSegmentId_===n)return null;m=this.initSegmentForMap(y,!0).bytes,this.activeInitSegmentId_=n}return m&&this.appendInitSegment_[u]?(this.playlistOfLastInitSegment_[u]=T,this.appendInitSegment_[u]=!1,this.activeInitSegmentId_=null,m):null},h.handleQuotaExceededError_=function(n,u){var m=this,y=n.segmentInfo,T=n.type,S=n.bytes,x=this.sourceUpdater_.audioBuffered(),A=this.sourceUpdater_.videoBuffered();1<x.length&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Ka(x).join(", ")),1<A.length&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Ka(A).join(", "));var L=x.length?x.start(0):0,O=x.length?x.end(x.length-1):0,j=A.length?A.start(0):0;if(n=A.length?A.end(A.length-1):0,O-L<=1&&n-j<=1)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: "+S.byteLength+", audio buffer: "+Ka(x).join(", ")+", video buffer: "+Ka(A).join(", ")+", "),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:y,type:T,bytes:S})),S=this.currentTime_()-1,this.logger_("On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to "+S),this.remove(0,S,function(){m.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),m.waitingOnRemove_=!1,m.quotaExceededErrorRetryTimeout_=window.setTimeout(function(){m.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),m.quotaExceededErrorRetryTimeout_=null,m.processCallQueue_()},1e3)},!0)},h.handleAppendError_=function(n,u){var m=n.segmentInfo,y=n.type;n=n.bytes,u&&(22!==u.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",u),this.error(y+" append of "+n.length+"b failed for segment #"+m.mediaIndex+" in playlist "+m.playlist.id),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:m,type:y,bytes:n}))},h.appendToSourceBuffer_=function(n){var u,m,y=n.segmentInfo,T=n.type,S=n.initSegment,x=n.data,A=n.bytes;A||(n=[x],x=x.byteLength,S&&(n.unshift(S),x+=S.byteLength),m=0,(n={bytes:x,segments:n}).bytes&&(u=new Uint8Array(n.bytes),n.segments.forEach(function(L){u.set(L,m),m+=L.byteLength})),A=u),this.sourceUpdater_.appendBuffer({segmentInfo:y,type:T,bytes:A},this.handleAppendError_.bind(this,{segmentInfo:y,type:T,bytes:A}))},h.handleSegmentTimingInfo_=function(n,u,m){this.pendingSegment_&&u===this.pendingSegment_.requestId&&((u=this.pendingSegment_.segment)[n+="TimingInfo"]||(u[n]={}),u[n].transmuxerPrependedSeconds=m.prependedContentDuration||0,u[n].transmuxedPresentationStart=m.start.presentation,u[n].transmuxedDecodeStart=m.start.decode,u[n].transmuxedPresentationEnd=m.end.presentation,u[n].transmuxedDecodeEnd=m.end.decode,u[n].baseMediaDecodeTime=m.baseMediaDecodeTime)},h.appendData_=function(n,u){var m=u.type,y=u.data;y&&y.byteLength&&("audio"===m&&this.audioDisabled_||(u=this.getInitSegmentAndUpdateState_({type:m,initSegment:u.initSegment,playlist:n.playlist,map:n.isFmp4?n.segment.map:null}),this.appendToSourceBuffer_({segmentInfo:n,type:m,initSegment:u,data:y})))},h.loadSegment_=function(n){var u=this;this.state="WAITING",this.pendingSegment_=n,this.trimBackBuffer_(n),"number"==typeof n.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(n):this.loadQueue_.push(function(){var m=Z({},n,{forceTimestampOffset:!0});Z(n,u.generateSegmentInfo_(m)),u.isPendingTimestampOffset_=!1,u.updateTransmuxerAndRequestSegment_(n)})},h.updateTransmuxerAndRequestSegment_=function(n){var u=this;this.shouldUpdateTransmuxerTimestampOffset_(n.timestampOffset)&&(this.gopBuffer_.length=0,n.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:n.timestampOffset}));var m=this.createSimplifiedSegmentObj_(n),y=this.isEndOfStream_(n.mediaIndex,n.playlist,n.partIndex),S=n.timeline!==this.currentTimeline_&&0<n.timeline;S=y||null!==this.mediaIndex&&S,this.logger_("Requesting "+Ti(n)),m.map&&!m.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),n.abortRequests=function(s){var p,h,n,u=s.xhr,m=s.xhrOptions,T=s.segment,S=s.abortFn,x=s.progressFn,A=s.trackInfoFn,L=s.timingInfoFn,O=s.videoSegmentTimingInfoFn,j=s.audioSegmentTimingInfoFn,B=s.id3Fn,H=s.captionsFn,q=s.isEndOfTimeline,V=s.endedTimelineFn,ee=s.dataFn,ne=[],ae=function(s){var p=s.activeXhrs,h=s.decryptionWorker,n=s.trackInfoFn,u=s.timingInfoFn,m=s.videoSegmentTimingInfoFn,y=s.audioSegmentTimingInfoFn,T=s.id3Fn,S=s.captionsFn,x=s.isEndOfTimeline,A=s.endedTimelineFn,L=s.dataFn,O=s.doneFn,j=s.onTransmuxerLog,B=0,H=!1;return function(q,V){if(!H){if(q)return H=!0,$s(p),O(q,V);if((B+=1)===p.length){var ee=function(){if(V.encryptedBytes)return ne=(ae={decryptionWorker:h,segment:V,trackInfoFn:n,timingInfoFn:u,videoSegmentTimingInfoFn:m,audioSegmentTimingInfoFn:y,id3Fn:T,captionsFn:S,isEndOfTimeline:x,endedTimelineFn:A,dataFn:L,doneFn:O,onTransmuxerLog:j}).decryptionWorker,he=ae.trackInfoFn,ke=ae.timingInfoFn,ve=ae.videoSegmentTimingInfoFn,Ee=ae.audioSegmentTimingInfoFn,xe=ae.id3Fn,Ne=ae.captionsFn,Be=ae.isEndOfTimeline,Ge=ae.endedTimelineFn,Oe=ae.dataFn,Tt=ae.doneFn,Pt=ae.onTransmuxerLog,void ql({id:(ie=ae.segment).requestId,key:ie.key,encryptedBytes:ie.encryptedBytes,decryptionWorker:ne},function(Qt){ie.bytes=Qt,zl({segment:ie,bytes:ie.bytes,trackInfoFn:he,timingInfoFn:ke,videoSegmentTimingInfoFn:ve,audioSegmentTimingInfoFn:Ee,id3Fn:xe,captionsFn:Ne,isEndOfTimeline:Be,endedTimelineFn:Ge,dataFn:Oe,doneFn:Tt,onTransmuxerLog:Pt})});var ae,ne,ie,he,ke,ve,Ee,xe,Ne,Be,Ge,Oe,Tt,Pt;zl({segment:V,bytes:V.bytes,trackInfoFn:n,timingInfoFn:u,videoSegmentTimingInfoFn:m,audioSegmentTimingInfoFn:y,id3Fn:T,captionsFn:S,isEndOfTimeline:x,endedTimelineFn:A,dataFn:L,doneFn:O,onTransmuxerLog:j})};if(V.endOfAllRequests=Date.now(),V.map&&V.map.encryptedBytes&&!V.map.bytes)return ql({decryptionWorker:h,id:V.requestId+"-init",encryptedBytes:V.map.encryptedBytes,key:V.map.key},function(ae){V.map.bytes=ae,Wl(V,function(ne){return ne?($s(p),O(ne,V)):void ee()})});ee()}}}}({activeXhrs:ne,decryptionWorker:s.decryptionWorker,trackInfoFn:A,timingInfoFn:L,videoSegmentTimingInfoFn:O,audioSegmentTimingInfoFn:j,id3Fn:B,captionsFn:H,isEndOfTimeline:q,endedTimelineFn:V,dataFn:ee,doneFn:ae=s.doneFn,onTransmuxerLog:s=s.onTransmuxerLog});T.key&&!T.key.bytes&&(s=[T.key],T.map&&!T.map.bytes&&T.map.key&&T.map.key.resolvedUri===T.key.resolvedUri&&s.push(T.map.key),s=u(J.mergeOptions(m,{uri:T.key.resolvedUri,responseType:"arraybuffer"}),Hl(T,s,ae)),ne.push(s)),T.map&&!T.map.bytes&&(!T.map.key||T.key&&T.key.resolvedUri===T.map.key.resolvedUri||(p=u(J.mergeOptions(m,{uri:T.map.key.resolvedUri,responseType:"arraybuffer"}),Hl(T,[T.map.key],ae)),ne.push(p)),p=u(J.mergeOptions(m,{uri:T.map.resolvedUri,responseType:"arraybuffer",headers:js(T.map)}),(h=(p={segment:T,finishProcessingFn:ae}).segment,n=p.finishProcessingFn,function(he,ke){return(he=Vs(he,ke))?n(he,h):(he=new Uint8Array(ke.response),h.map.key?(h.map.encryptedBytes=he,n(null,h)):(h.map.bytes=he,void Wl(h,function(ve){return ve?(ve.xhr=ke,ve.status=ke.status,n(ve,h)):void n(null,h)})))})),ne.push(p)),(m=u(m=J.mergeOptions(m,{uri:T.part&&T.part.resolvedUri||T.resolvedUri,responseType:"arraybuffer",headers:js(T)}),function(s){var p=s.segment,h=s.finishProcessingFn,n=s.responseType;return function(u,m){return(u=Vs(u,m))?h(u,p):(u="arraybuffer"!==n&&m.responseText?function(y){for(var T=new Uint8Array(new ArrayBuffer(y.length)),S=0;S<y.length;S++)T[S]=y.charCodeAt(S);return T.buffer}(m.responseText.substring(p.lastReachedChar||0)):m.response,p.stats={bandwidth:(m=m).bandwidth,bytesReceived:m.bytesReceived||0,roundTripTime:m.roundTripTime||0},p.key?p.encryptedBytes=new Uint8Array(u):p.bytes=new Uint8Array(u),h(null,p))}}({segment:T,finishProcessingFn:ae,responseType:m.responseType}))).addEventListener("progress",function(s){var p=s.segment,h=s.progressFn;return function(n){var u,m=n.target;if(!m.aborted)return p.stats=J.mergeOptions(p.stats,(m=(u=n).target,(m={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-m.requestTime||0}).bytesReceived=u.loaded,m.bandwidth=Math.floor(m.bytesReceived/m.roundTripTime*8*1e3),m)),!p.stats.firstBytesReceivedAt&&p.stats.bytesReceived&&(p.stats.firstBytesReceivedAt=Date.now()),h(n,p)}}({segment:T,progressFn:x,trackInfoFn:A,timingInfoFn:L,videoSegmentTimingInfoFn:O,audioSegmentTimingInfoFn:j,id3Fn:B,captionsFn:H,isEndOfTimeline:q,endedTimelineFn:V,dataFn:ee})),ne.push(m);var ie={};return ne.forEach(function(he){var ke,ve;he.addEventListener("loadend",(ke=(he={loadendState:ie,abortFn:S}).loadendState,ve=he.abortFn,function(Ee){Ee.target.aborted&&ve&&!ke.calledAbortFn&&(ve(),ke.calledAbortFn=!0)}))}),function(){return $s(ne)}}({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:m,abortFn:this.handleAbort_.bind(this,n),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",n.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",n.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:S,endedTimelineFn:function(){u.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:function(x){var A=x.message,L=x.level;x=x.stream,u.logger_(Ti(n)+" logged from transmuxer stream "+x+" as a "+L+": "+A)}})},h.trimBackBuffer_=function(n){var u,m,y,T;0<(u=this.seekable_(),m=this.currentTime_(),y=this.playlist_.targetDuration||10,T=m-bt.BACK_BUFFER_LENGTH,u.length&&(T=Math.max(T,u.start(0))),T=Math.min(m-y,T))&&this.remove(0,T)},h.createSimplifiedSegmentObj_=function(n){var m,u=n.segment,y={resolvedUri:((m=n.part)||u).resolvedUri,byterange:(m||u).byterange,requestId:n.requestId,transmuxer:n.transmuxer,audioAppendStart:n.audioAppendStart,gopsToAlignWith:n.gopsToAlignWith,part:n.part};return(m=n.playlist.segments[n.mediaIndex-1])&&m.timeline===u.timeline&&(m.videoTimingInfo?y.baseStartTime=m.videoTimingInfo.transmuxedDecodeEnd:m.audioTimingInfo&&(y.baseStartTime=m.audioTimingInfo.transmuxedDecodeEnd)),u.key&&(n=u.key.iv||new Uint32Array([0,0,0,n.mediaIndex+n.playlist.mediaSequence]),y.key=this.segmentKey(u.key),y.key.iv=n),u.map&&(y.map=this.initSegmentForMap(u.map)),y},h.saveTransferStats_=function(n){this.mediaRequests+=1,n&&(this.mediaBytesTransferred+=n.bytesReceived,this.mediaTransferDuration+=n.roundTripTime)},h.saveBandwidthRelatedStats_=function(n,u){this.pendingSegment_.byteLength=u.bytesReceived,n<1/60?this.logger_("Ignoring segment's bandwidth because its duration of "+n+" is less than the min to record "+1/60):(this.bandwidth=u.bandwidth,this.roundTrip=u.roundTripTime)},h.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate")},h.segmentRequestFinished_=function(n,u,m){if(this.callQueue_.length)this.callQueue_.push(this.segmentRequestFinished_.bind(this,n,u,m));else if(this.saveTransferStats_(u.stats),this.pendingSegment_&&u.requestId===this.pendingSegment_.requestId){if(n)return this.pendingSegment_=null,this.state="READY",n.code===Ws?void 0:(this.pause(),n.code===Hs?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(n),void this.trigger("error")));this.saveBandwidthRelatedStats_((n=this.pendingSegment_).duration,u.stats),n.endOfAllRequests=u.endOfAllRequests,m.gopInfo&&(this.gopBuffer_=function(y,T,S){if(!T.length)return y;if(S)return T.slice();for(var x=T[0].pts,A=0;A<y.length&&!(y[A].pts>=x);A++);return y.slice(0,A).concat(T)}(this.gopBuffer_,m.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(n)}},h.setTimeMapping_=function(n){null!==(n=this.syncController_.mappingForTimeline(n))&&(this.timeMapping_=n)},h.updateMediaSecondsLoaded_=function(n){this.mediaSecondsLoaded+="number"==typeof n.start&&"number"==typeof n.end?n.end-n.start:n.duration},h.shouldUpdateTransmuxerTimestampOffset_=function(n){return null!==n&&("main"===this.loaderType_&&n!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&n!==this.sourceUpdater_.audioTimestampOffset())},h.trueSegmentStart_=function(n){var u=n.currentStart,m=n.playlist,y=n.mediaIndex,T=n.firstVideoFrameTimeForData,S=n.currentVideoTimestampOffset,x=n.useVideoTimingInfo,A=n.videoTimingInfo;return n=n.audioTimingInfo,void 0!==u?u:x?(m=m.segments[y-1],0!==y&&m&&void 0!==m.start&&m.end===T+S?A.start:T):n.start},h.waitForAppendsToComplete_=function(n){if(!(u=this.getCurrentMediaInfo_(n)))return this.error({message:"No starting media returned, likely due to an unsupported media format.",blacklistDuration:1/0}),void this.trigger("error");var m=u.hasAudio,y=u.hasVideo,u=u.isMuxed;if(y="main"===this.loaderType_&&y,u=!this.audioDisabled_&&m&&!u,n.waitingOnAppends=0,!n.hasAppendedData_)return n.timingInfo||"number"!=typeof n.timestampOffset||(this.isPendingTimestampOffset_=!0),n.timingInfo={start:0},n.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(n),this.processMetadataQueue_()),void this.checkAppendsDone_(n);y&&n.waitingOnAppends++,u&&n.waitingOnAppends++,y&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,n)),u&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,n))},h.checkAppendsDone_=function(n){this.checkForAbort_(n.requestId)||(n.waitingOnAppends--,0===n.waitingOnAppends&&this.handleAppendsDone_())},h.checkForIllegalMediaSwitch=function(n){var u,m;return!(u=this.loaderType_,m=this.getCurrentMediaInfo_(),n=n,!(n="main"===u&&m&&n?n.hasAudio||n.hasVideo?m.hasVideo&&!n.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!m.hasVideo&&n.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null)||(this.error({message:n,blacklistDuration:1/0}),this.trigger("error"),0))},h.updateSourceBufferTimestampOffset_=function(n){var u;null===n.timestampOffset||"number"!=typeof n.timingInfo.start||n.changedTimestampOffset||"main"!==this.loaderType_||(u=!1,n.timestampOffset-=n.timingInfo.start,n.changedTimestampOffset=!0,n.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(n.timestampOffset),u=!0),n.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(n.timestampOffset),u=!0),u&&this.trigger("timestampoffset"))},h.updateTimingInfoEnd_=function(n){n.timingInfo=n.timingInfo||{};var u=this.getMediaInfo_();(u="main"===this.loaderType_&&u&&u.hasVideo&&n.videoTimingInfo?n.videoTimingInfo:n.audioTimingInfo)&&(n.timingInfo.end="number"==typeof u.end?u.end:u.start+n.duration)},h.handleAppendsDone_=function(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var n=this.pendingSegment_;this.updateTimingInfoEnd_(n),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:"main"===this.loaderType_});var u=function(s,p){if("hls"!==p)return null;var m,y,h=(m=(m=s.audioTimingInfo)&&"number"==typeof m.start&&"number"==typeof m.end?m.end-m.start:0,y=(y=s.videoTimingInfo)&&"number"==typeof y.start&&"number"==typeof y.end?y.end-y.start:0,Math.max(m,y));if(!h)return null;var u=ad({segmentDuration:h,maxDuration:2*(n=s.playlist.targetDuration)}),n=(p=ad({segmentDuration:h,maxDuration:n}),"Segment with index "+s.mediaIndex+" from playlist "+s.playlist.id+" has a duration of "+h+" when the reported duration is "+s.duration+" and the target duration is "+n+". For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1");return u||p?{severity:u?"warn":"info",message:n}:null}(n,this.sourceType_);if(u&&("warn"===u.severity?J.log.warn(u.message):this.logger_(u.message)),this.recordThroughput_(n),this.pendingSegment_=null,this.state="READY",!n.isSyncRequest||(this.trigger("syncinfoupdate"),n.hasAppendedData_)){this.logger_("Appended "+Ti(n)),this.addSegmentMetadataCue_(n),this.fetchAtBuffer_=!0,this.currentTimeline_!==n.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:n.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:n.timeline})),this.currentTimeline_=n.timeline,this.trigger("syncinfoupdate"),u=n.part;var m=(m=n.segment).end&&this.currentTime_()-m.end>3*n.playlist.targetDuration;if(u=u&&u.end&&this.currentTime_()-u.end>3*n.playlist.partTargetDuration,m||u)return this.logger_("bad "+(m?"segment":"part")+" "+Ti(n)),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=n.mediaIndex,this.partIndex=n.partIndex,this.isEndOfStream_(n.mediaIndex,n.playlist,n.partIndex)&&this.endOfStream(),this.trigger("appended"),n.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}else this.logger_("Throwing away un-appended sync request "+Ti(n))},h.recordThroughput_=function(n){var u,m;n.duration<1/60?this.logger_("Ignoring segment's throughput because its duration of "+n.duration+" is less than the min to record "+1/60):(u=this.throughput.rate,m=Date.now()-n.endOfAllRequests+1,m=Math.floor(n.byteLength/m*8*1e3),this.throughput.rate+=(m-u)/++this.throughput.count)},h.addSegmentMetadataCue_=function(n){var u,m,y,T;this.segmentMetadataTrack_&&(m=(u=n.segment).start,T=u.end,Zl(m)&&Zl(T)&&(or(m,T,this.segmentMetadataTrack_),y=window.WebKitDataCue||window.VTTCue,n={custom:u.custom,dateTimeObject:u.dateTimeObject,dateTimeString:u.dateTimeString,bandwidth:n.playlist.attributes.BANDWIDTH,resolution:n.playlist.attributes.RESOLUTION,codecs:n.playlist.attributes.CODECS,byteLength:n.byteLength,uri:n.uri,timeline:n.timeline,playlist:n.playlist.id,start:m,end:T},(T=new y(m,T,JSON.stringify(n))).value=n,this.segmentMetadataTrack_.addCue(T)))},p}(J.EventTarget));function Sa(){}function ud(s){return"string"!=typeof s?s:s.replace(/./,function(p){return p.toUpperCase()})}function qs(s,p){var h=p[s+"Buffer"];return h&&h.updating||p.queuePending[s]}function Si(s,p){if(0!==p.queue.length){var h=0,n=p.queue[h];if("mediaSource"!==n.type){if("mediaSource"!==s&&p.ready()&&"closed"!==p.mediaSource.readyState&&!qs(s,p)){if(n.type!==s){if(null===(h=function(u,m){for(var y=0;y<m.length;y++){var T=m[y];if("mediaSource"===T.type)return null;if(T.type===u)return y}return null}(s,p.queue)))return;n=p.queue[h]}p.queue.splice(h,1),(p.queuePending[s]=n).action(s,p),n.doneFn||(p.queuePending[s]=null,Si(s,p))}}else p.updating()||"closed"===p.mediaSource.readyState||(p.queue.shift(),n.action(p),n.doneFn&&n.doneFn(),Si("audio",p),Si("video",p))}}function ld(s,p){var h=p[s+"Buffer"],n=ud(s);h&&(h.removeEventListener("updateend",p["on"+n+"UpdateEnd_"]),h.removeEventListener("error",p["on"+n+"Error_"]),p.codecs[s]=null,p[s+"Buffer"]=null)}function ma(s,p){return s&&p&&-1!==Array.prototype.indexOf.call(s.sourceBuffers,p)}function Yt(s){var p=s.type,h=s.sourceUpdater;h.queue.push({type:p,action:s.action,doneFn:s.doneFn,name:s=s.name}),Si(p,h)}function dd(s,p){return function(h){var n;p.queuePending[s]&&(n=p.queuePending[s].doneFn,p.queuePending[s]=null,n&&n(p[s+"Error_"])),Si(s,p)}}function hd(s){return decodeURIComponent(escape(String.fromCharCode.apply(null,s)))}function nn(s,p){s.abort(),s.pause(),p&&p.activePlaylistLoader&&(p.activePlaylistLoader.pause(),p.activePlaylistLoader=null)}function cd(s,p){(p.activePlaylistLoader=s).load()}function pd(s,p){for(var h=0;h<s.length;h++)if(Ns(p,s[h])||s[h].playlists&&pd(s[h].playlists,p))return!0;return!1}function Qc(s,p,h){var n,u,m,y,T=s.masterPlaylistController_,S=T[(s.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(T);p.attributes&&(this.width=(n=p.attributes.RESOLUTION)&&n.width,this.height=n&&n.height,this.bandwidth=p.attributes.BANDWIDTH),this.codecs=sr(T.master(),p),this.playlist=p,this.id=h,this.enabled=(u=s.playlists,m=p.id,y=S,function(x){var A=u.master.playlists[m],L=Rs(A),O=Xr(A);return void 0===x?O:(x?delete A.disabled:A.disabled=!0,x===O||L||(y(),u.trigger(x?"renditionenabled":"renditiondisabled")),x)})}function md(s,p){var h=0,n=0,u=J.mergeOptions(gp,p);function m(){n&&s.currentTime(n)}function y(x){null!=x&&(n=s.duration()!==1/0&&s.currentTime()||0,s.one("loadedmetadata",m),s.src(x),s.trigger({type:"usage",name:"vhs-error-reload"}),s.trigger({type:"usage",name:"hls-error-reload"}),s.play())}function T(){return Date.now()-h<1e3*u.errorInterval?(s.trigger({type:"usage",name:"vhs-error-reload-canceled"}),void s.trigger({type:"usage",name:"hls-error-reload-canceled"})):u.getSource&&"function"==typeof u.getSource?(h=Date.now(),u.getSource.call(s,y)):void J.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}function S(){s.off("loadedmetadata",m),s.off("error",T),s.off("dispose",S)}s.ready(function(){s.trigger({type:"usage",name:"vhs-error-reload-initialized"}),s.trigger({type:"usage",name:"hls-error-reload-initialized"})}),s.on("error",T),s.on("dispose",S),s.reloadSourceOnError=function(x){S(),md(s,x)}}var Ca,Jc=["video","audio"],Zc=function(s,p,h){return function(n,u){var m=u[n+"Buffer"];if(ma(u.mediaSource,m)){u.logger_("Appending segment "+p.mediaIndex+"'s "+s.length+" bytes to "+n+"Buffer");try{m.appendBuffer(s)}catch(y){u.logger_("Error with code "+y.code+" "+(22===y.code?"(QUOTA_EXCEEDED_ERR) ":"")+"when appending segment "+p.mediaIndex+" to "+n+"Buffer"),u.queuePending[n]=null,h(y)}}}},gd=function(s,p){return function(h,n){var u=n[h+"Buffer"];if(ma(n.mediaSource,u)){n.logger_("Removing "+s+" to "+p+" from "+h+"Buffer");try{u.remove(s,p)}catch(m){n.logger_("Remove "+s+" to "+p+" from "+h+"Buffer failed")}}}},fd=function(s){return function(p,h){var n=h[p+"Buffer"];ma(h.mediaSource,n)&&(h.logger_("Setting "+p+"timestampOffset to "+s),n.timestampOffset=s)}},yd=function(s){return function(p,h){s()}},ep=function(s){return function(p){if("open"===p.mediaSource.readyState){p.logger_("Calling mediaSource endOfStream("+(s||"")+")");try{p.mediaSource.endOfStream(s)}catch(h){J.log.warn("Failed to call media source endOfStream",h)}}}},tp=function(s){return function(p){p.logger_("Setting mediaSource duration to "+s);try{p.mediaSource.duration=s}catch(h){J.log.warn("Failed to set media source duration",h)}}},ip=function(s,p){return function(h){var n=ud(s),u=Gi(p);h.logger_("Adding "+s+"Buffer with codec "+p+" to mediaSource"),(u=h.mediaSource.addSourceBuffer(u)).addEventListener("updateend",h["on"+n+"UpdateEnd_"]),u.addEventListener("error",h["on"+n+"Error_"]),h.codecs[s]=p,h[s+"Buffer"]=u}},rp=function(s){return function(p){var h=p[s+"Buffer"];if(ld(s,p),ma(p.mediaSource,h)){p.logger_("Removing "+s+"Buffer with codec "+p.codecs[s]+" from mediaSource");try{p.mediaSource.removeSourceBuffer(h)}catch(n){J.log.warn("Failed to removeSourceBuffer "+s+"Buffer",n)}}}},np=function(s){return function(p,h){var n=h[p+"Buffer"],u=Gi(s);ma(h.mediaSource,n)&&h.codecs[p]!==s&&(h.logger_("changing "+p+"Buffer codec from "+h.codecs[p]+" to "+s),n.changeType(u),h.codecs[p]=s)}},_d=function(s){function p(n){var u=s.call(this)||this;return u.mediaSource=n,u.sourceopenListener_=function(){return Si("mediaSource",De(u))},u.mediaSource.addEventListener("sourceopen",u.sourceopenListener_),u.logger_=ra("SourceUpdater"),u.audioTimestampOffset_=0,u.videoTimestampOffset_=0,u.queue=[],u.queuePending={audio:null,video:null},u.delayedAudioAppendQueue_=[],u.videoAppendQueued_=!1,u.codecs={},u.onVideoUpdateEnd_=dd("video",De(u)),u.onAudioUpdateEnd_=dd("audio",De(u)),u.onVideoError_=function(m){u.videoError_=m},u.onAudioError_=function(m){u.audioError_=m},u.createdSourceBuffers_=!1,u.initializedEme_=!1,u.triggeredReady_=!1,u}ge(p,s);var h=p.prototype;return h.initializedEme=function(){this.initializedEme_=!0,this.triggerReady()},h.hasCreatedSourceBuffers=function(){return this.createdSourceBuffers_},h.hasInitializedAnyEme=function(){return this.initializedEme_},h.ready=function(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()},h.createSourceBuffers=function(n){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(n),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())},h.triggerReady=function(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))},h.addSourceBuffer=function(n,u){Yt({type:"mediaSource",sourceUpdater:this,action:ip(n,u),name:"addSourceBuffer"})},h.abort=function(n){Yt({type:n,sourceUpdater:this,action:function(s,p){if("open"===p.mediaSource.readyState){var h=p[s+"Buffer"];if(ma(p.mediaSource,h)){p.logger_("calling abort on "+s+"Buffer");try{h.abort()}catch(n){J.log.warn("Failed to abort on "+s+"Buffer",n)}}}},name:"abort"})},h.removeSourceBuffer=function(n){this.canRemoveSourceBuffer()?Yt({type:"mediaSource",sourceUpdater:this,action:rp(n),name:"removeSourceBuffer"}):J.log.error("removeSourceBuffer is not supported!")},h.canRemoveSourceBuffer=function(){return!J.browser.IE_VERSION&&!J.browser.IS_FIREFOX&&window.MediaSource&&window.MediaSource.prototype&&"function"==typeof window.MediaSource.prototype.removeSourceBuffer},p.canChangeType=function(){return window.SourceBuffer&&window.SourceBuffer.prototype&&"function"==typeof window.SourceBuffer.prototype.changeType},h.canChangeType=function(){return this.constructor.canChangeType()},h.changeType=function(n,u){this.canChangeType()?Yt({type:n,sourceUpdater:this,action:np(u),name:"changeType"}):J.log.error("changeType is not supported!")},h.addOrChangeSourceBuffers=function(n){var u=this;if(!n||"object"!=typeof n||0===Object.keys(n).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(n).forEach(function(m){var y=n[m];if(!u.hasCreatedSourceBuffers())return u.addSourceBuffer(m,y);u.canChangeType()&&u.changeType(m,y)})},h.appendBuffer=function(n,u){var m=this,y=n.segmentInfo,T=n.type,S=n.bytes;if(this.processedAppend_=!0,"audio"===T&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([n,u]),void this.logger_("delayed audio append of "+S.length+" until video append");Yt({type:T,sourceUpdater:this,action:Zc(S,y||{mediaIndex:-1},u),doneFn:u,name:"appendBuffer"}),"video"===T&&(this.videoAppendQueued_=!0,this.delayedAudioAppendQueue_.length&&(T=this.delayedAudioAppendQueue_.slice(),this.logger_("queuing delayed audio "+T.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,T.forEach(function(x){m.appendBuffer.apply(m,x)})))},h.audioBuffered=function(){return ma(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered||J.createTimeRange()},h.videoBuffered=function(){return ma(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered||J.createTimeRange()},h.buffered=function(){var n=ma(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,u=ma(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return u&&!n?this.audioBuffered():n&&!u?this.videoBuffered():function(m,y){var T=null,S=null,x=0,A=[],L=[];if(!(m&&m.length&&y&&y.length))return J.createTimeRange();for(var O=m.length;O--;)A.push({time:m.start(O),type:"start"}),A.push({time:m.end(O),type:"end"});for(O=y.length;O--;)A.push({time:y.start(O),type:"start"}),A.push({time:y.end(O),type:"end"});for(A.sort(function(j,B){return j.time-B.time}),O=0;O<A.length;O++)"start"===A[O].type?2==++x&&(T=A[O].time):"end"===A[O].type&&1==--x&&(S=A[O].time),null!==T&&null!==S&&(L.push([T,S]),S=T=null);return J.createTimeRanges(L)}(this.audioBuffered(),this.videoBuffered())},h.setDuration=function(n,u){void 0===u&&(u=Sa),Yt({type:"mediaSource",sourceUpdater:this,action:tp(n),name:"duration",doneFn:u})},h.endOfStream=function(n,u){void 0===u&&(u=Sa),Yt({type:"mediaSource",sourceUpdater:this,action:ep(n="string"!=typeof(n=void 0===n?null:n)?void 0:n),name:"endOfStream",doneFn:u})},h.removeAudio=function(n,u,m){void 0===m&&(m=Sa),this.audioBuffered().length&&0!==this.audioBuffered().end(0)?Yt({type:"audio",sourceUpdater:this,action:gd(n,u),doneFn:m,name:"remove"}):m()},h.removeVideo=function(n,u,m){void 0===m&&(m=Sa),this.videoBuffered().length&&0!==this.videoBuffered().end(0)?Yt({type:"video",sourceUpdater:this,action:gd(n,u),doneFn:m,name:"remove"}):m()},h.updating=function(){return!(!qs("audio",this)&&!qs("video",this))},h.audioTimestampOffset=function(n){return void 0!==n&&this.audioBuffer&&this.audioTimestampOffset_!==n&&(Yt({type:"audio",sourceUpdater:this,action:fd(n),name:"timestampOffset"}),this.audioTimestampOffset_=n),this.audioTimestampOffset_},h.videoTimestampOffset=function(n){return void 0!==n&&this.videoBuffer&&this.videoTimestampOffset!==n&&(Yt({type:"video",sourceUpdater:this,action:fd(n),name:"timestampOffset"}),this.videoTimestampOffset_=n),this.videoTimestampOffset_},h.audioQueueCallback=function(n){this.audioBuffer&&Yt({type:"audio",sourceUpdater:this,action:yd(n),name:"callback"})},h.videoQueueCallback=function(n){this.videoBuffer&&Yt({type:"video",sourceUpdater:this,action:yd(n),name:"callback"})},h.dispose=function(){var n=this;this.trigger("dispose"),Jc.forEach(function(u){n.abort(u),n.canRemoveSourceBuffer()?n.removeSourceBuffer(u):n[u+"QueueCallback"](function(){return ld(u,n)})}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()},p}(J.EventTarget),kd=new Uint8Array("\n\n".split("").map(function(s){return s.charCodeAt(0)})),sp=function(s){function p(n,u){return(u=s.call(this,n,u=void 0===u?{}:u)||this).mediaSource_=null,u.subtitlesTrack_=null,u.loaderType_="subtitle",u.featuresNativeTextTracks_=n.featuresNativeTextTracks,u.shouldSaveSegmentTimingInfo_=!1,u}ge(p,s);var h=p.prototype;return h.createTransmuxer_=function(){return null},h.buffered_=function(){return this.subtitlesTrack_&&this.subtitlesTrack_.cues&&this.subtitlesTrack_.cues.length?J.createTimeRanges([[(n=this.subtitlesTrack_.cues)[0].startTime,n=n[n.length-1].startTime]]):J.createTimeRanges();var n},h.initSegmentForMap=function(n,u){if(void 0===u&&(u=!1),!n)return null;var m=Yr(n),y=this.initSegments_[m];return u&&!y&&n.bytes&&(u=kd.byteLength+n.bytes.byteLength,(u=new Uint8Array(u)).set(n.bytes),u.set(kd,n.bytes.byteLength),this.initSegments_[m]=y={resolvedUri:n.resolvedUri,byterange:n.byterange,bytes:u}),y||n},h.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},h.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},h.track=function(n){return void 0===n||(this.subtitlesTrack_=n,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_},h.remove=function(n,u){or(n,u,this.subtitlesTrack_)},h.fillBuffer_=function(){var n=this,u=this.chooseNextRequest_();if(u){if(null===this.syncController_.timestampOffsetForTimeline(u.timeline))return this.syncController_.one("timestampoffset",function(){n.state="READY",n.paused()||n.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE");this.loadSegment_(u)}},h.timestampOffsetForSegment_=function(){return null},h.chooseNextRequest_=function(){return this.skipEmptySegments_(s.prototype.chooseNextRequest_.call(this))},h.skipEmptySegments_=function(n){for(;n&&n.segment.empty;){if(n.mediaIndex+1>=n.playlist.segments.length){n=null;break}n=this.generateSegmentInfo_({playlist:n.playlist,mediaIndex:n.mediaIndex+1,startOfSegment:n.startOfSegment+n.duration,isSyncRequest:n.isSyncRequest})}return n},h.stopForError=function(n){this.error(n),this.state="READY",this.pause(),this.trigger("error")},h.segmentRequestFinished_=function(n,u,m){var y=this;if(this.subtitlesTrack_){if(this.saveTransferStats_(u.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(n)return n.code===Hs&&this.handleTimeout_(),n.code===Ws?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(n);var T=this.pendingSegment_;this.saveBandwidthRelatedStats_(T.duration,u.stats),this.state="APPENDING",this.trigger("appending");var S=T.segment;if(S.map&&(S.map.bytes=u.map.bytes),T.bytes=u.bytes,"function"!=typeof window.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var x=function(){y.subtitlesTrack_.tech_.off("vttjsloaded",A),y.stopForError({message:"Error loading vtt.js"})},A=function(){y.subtitlesTrack_.tech_.off("vttjserror",x),y.segmentRequestFinished_(n,u,m)};return this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",A),void this.subtitlesTrack_.tech_.one("vttjserror",x)}S.requested=!0;try{this.parseVTTCues_(T)}catch(L){return void this.stopForError({message:L.message})}if(this.updateTimeMapping_(T,this.syncController_.timelines[T.timeline],this.playlist_),T.timingInfo=T.cues.length?{start:T.cues[0].startTime,end:T.cues[T.cues.length-1].endTime}:{start:T.startOfSegment,end:T.startOfSegment+T.duration},T.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");T.byteLength=T.bytes.byteLength,this.mediaSecondsLoaded+=S.duration,T.cues.forEach(function(L){y.subtitlesTrack_.addCue(y.featuresNativeTextTracks_?new window.VTTCue(L.startTime,L.endTime,L.text):L)}),function(L){var O=L.cues;if(O)for(var j=0;j<O.length;j++){for(var B=[],H=0,q=0;q<O.length;q++)O[j].startTime===O[q].startTime&&O[j].endTime===O[q].endTime&&O[j].text===O[q].text&&1<++H&&B.push(O[q]);B.length&&B.forEach(function(V){return L.removeCue(V)})}}(this.subtitlesTrack_),this.handleAppendsDone_()}else this.state="READY"},h.handleData_=function(){},h.updateTimingInfoEnd_=function(){},h.parseVTTCues_=function(n){var u=!1;"function"==typeof window.TextDecoder?m=new window.TextDecoder("utf8"):(m=window.WebVTT.StringDecoder(),u=!0);var m=new window.WebVTT.Parser(window,window.vttjs,m);n.cues=[],n.timestampmap={MPEGTS:0,LOCAL:0},m.oncue=n.cues.push.bind(n.cues),m.ontimestampmap=function(T){n.timestampmap=T},m.onparsingerror=function(T){J.log.warn("Error encountered when parsing cues: "+T.message)},n.segment.map&&(y=n.segment.map.bytes,u&&(y=hd(y)),m.parse(y));var y=n.bytes;u&&(y=hd(y)),m.parse(y),m.flush()},h.updateTimeMapping_=function(n,u,m){var y,T,S=n.segment;u&&(n.cues.length?(y=(T=n.timestampmap).MPEGTS/en-T.LOCAL+u.mapping,n.cues.forEach(function(x){x.startTime+=y,x.endTime+=y}),m.syncInfo||(T=n.cues[0].startTime,u=n.cues[n.cues.length-1].startTime,m.syncInfo={mediaSequence:m.mediaSequence+n.mediaIndex,time:Math.min(T,u-S.duration)})):S.empty=!0)},p}(zs),vd=[{name:"VOD",run:function(s,p,h,n,u){return h===1/0?null:{time:0,segmentIndex:0,partIndex:null}}},{name:"ProgramDateTime",run:function(s,p,h,n,u){if(!Object.keys(s.timelineToDatetimeMappings).length)return null;var m=null,y=null,T=Ds(p);u=u||0;for(var S=0;S<T.length;S++){var x=T[p.endList||0===u?S:T.length-(S+1)],A=x.segment,L=s.timelineToDatetimeMappings[A.timeline];if(L&&A.dateTimeObject){var O=A.dateTimeObject.getTime()/1e3+L;if(A.parts&&"number"==typeof x.partIndex)for(var j=0;j<x.partIndex;j++)O+=A.parts[j].duration;if(L=Math.abs(u-O),null!==y&&(0===L||y<L))break;y=L,m={time:O,segmentIndex:x.segmentIndex,partIndex:x.partIndex}}}return m}},{name:"Segment",run:function(s,p,h,n,u){var m=null,y=null;u=u||0;for(var T=Ds(p),S=0;S<T.length;S++){var x=T[p.endList||0===u?S:T.length-(S+1)],A=x.segment,L=x.part&&x.part.start||A&&A.start;if(A.timeline===n&&void 0!==L){if(A=Math.abs(u-L),null!==y&&y<A)break;(!m||null===y||A<=y)&&(y=A,m={time:L,segmentIndex:x.segmentIndex,partIndex:x.partIndex})}}return m}},{name:"Discontinuity",run:function(s,p,h,n,u){var m=null;if(u=u||0,p.discontinuityStarts&&p.discontinuityStarts.length)for(var y=null,T=0;T<p.discontinuityStarts.length;T++){var S=p.discontinuityStarts[T],x=p.discontinuitySequence+T+1,A=s.discontinuities[x];if(A){if(x=Math.abs(u-A.time),null!==y&&y<x)break;(!m||null===y||x<=y)&&(y=x,m={time:A.time,segmentIndex:S,partIndex:null})}}return m}},{name:"Playlist",run:function(s,p,h,n,u){return p.syncInfo?{time:p.syncInfo.time,segmentIndex:p.syncInfo.mediaSequence-p.mediaSequence,partIndex:null}:null}}],op=function(s){function p(n){var u=s.call(this)||this;return u.timelines=[],u.discontinuities=[],u.timelineToDatetimeMappings={},u.logger_=ra("SyncController"),u}ge(p,s);var h=p.prototype;return h.getSyncPoint=function(n,u,m,y){return(m=this.runStrategies_(n,u,m,y)).length?this.selectSyncPoint_(m,{key:"time",value:y}):null},h.getExpiredTime=function(n,u){return n&&n.segments&&(u=this.runStrategies_(n,u,n.discontinuitySequence,0)).length?(0<(u=this.selectSyncPoint_(u,{key:"segmentIndex",value:0})).segmentIndex&&(u.time*=-1),Math.abs(u.time+ir({defaultDuration:n.targetDuration,durationList:n.segments,startIndex:u.segmentIndex,endIndex:0}))):null},h.runStrategies_=function(n,u,m,y){for(var T=[],S=0;S<vd.length;S++){var x=vd[S],A=x.run(this,n,u,m,y);A&&(A.strategy=x.name,T.push({strategy:x.name,syncPoint:A}))}return T},h.selectSyncPoint_=function(n,u){for(var m=n[0].syncPoint,y=Math.abs(n[0].syncPoint[u.key]-u.value),T=n[0].strategy,S=1;S<n.length;S++){var x=Math.abs(n[S].syncPoint[u.key]-u.value);x<y&&(y=x,m=n[S].syncPoint,T=n[S].strategy)}return this.logger_("syncPoint for ["+u.key+": "+u.value+"] chosen with strategy ["+T+"]: [time:"+m.time+", segmentIndex:"+m.segmentIndex+("number"==typeof m.partIndex?",partIndex:"+m.partIndex:"")+"]"),m},h.saveExpiredSegmentInfo=function(n,u){var m=u.mediaSequence-n.mediaSequence;if(86400<m)J.log.warn("Not saving expired segment info. Media sequence gap "+m+" is too large.");else for(var y=m-1;0<=y;y--){var T=n.segments[y];if(T&&void 0!==T.start){u.syncInfo={mediaSequence:n.mediaSequence+y,time:T.start},this.logger_("playlist refresh sync: [time:"+u.syncInfo.time+", mediaSequence: "+u.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}},h.setDateTimeMappingForStart=function(n){var u;this.timelineToDatetimeMappings={},n.segments&&n.segments.length&&n.segments[0].dateTimeObject&&(n=(u=n.segments[0]).dateTimeObject.getTime()/1e3,this.timelineToDatetimeMappings[u.timeline]=-n)},h.saveSegmentTimingInfo=function(n){var u=n.segmentInfo,m=n.shouldSaveTimelineMapping,y=this.calculateSegmentTimeMapping_(u,u.timingInfo,m);n=u.segment,y&&(this.saveDiscontinuitySyncInfo_(u),u.playlist.syncInfo||(u.playlist.syncInfo={mediaSequence:u.playlist.mediaSequence+u.mediaIndex,time:n.start})),u=n.dateTimeObject,n.discontinuity&&m&&u&&(this.timelineToDatetimeMappings[n.timeline]=-u.getTime()/1e3)},h.timestampOffsetForTimeline=function(n){return void 0===this.timelines[n]?null:this.timelines[n].time},h.mappingForTimeline=function(n){return void 0===this.timelines[n]?null:this.timelines[n].mapping},h.calculateSegmentTimeMapping_=function(n,u,m){var y,T,S=n.segment,x=n.part,A=this.timelines[n.timeline];if("number"==typeof n.timestampOffset)A={time:n.startOfSegment,mapping:n.startOfSegment-u.start},m&&(this.timelines[n.timeline]=A,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+n.timeline+": [time: "+A.time+"] [mapping: "+A.mapping+"]")),y=n.startOfSegment,T=u.end+A.mapping;else{if(!A)return!1;y=u.start+A.mapping,T=u.end+A.mapping}return x&&(x.start=y,x.end=T),(!S.start||y<S.start)&&(S.start=y),S.end=T,!0},h.saveDiscontinuitySyncInfo_=function(n){var u=n.playlist,m=n.segment;if(m.discontinuity)this.discontinuities[m.timeline]={time:m.start,accuracy:0};else if(u.discontinuityStarts&&u.discontinuityStarts.length)for(var y=0;y<u.discontinuityStarts.length;y++){var T,S=u.discontinuityStarts[y],x=u.discontinuitySequence+y+1,A=S-n.mediaIndex,L=Math.abs(A);(!this.discontinuities[x]||this.discontinuities[x].accuracy>L)&&(T=A<0?m.start-ir({defaultDuration:u.targetDuration,durationList:u.segments,startIndex:n.mediaIndex,endIndex:S}):m.end+ir({defaultDuration:u.targetDuration,durationList:u.segments,startIndex:n.mediaIndex+1,endIndex:S}),this.discontinuities[x]={time:T,accuracy:L})}},h.dispose=function(){this.trigger("dispose"),this.off()},p}(J.EventTarget),up=function(s){function p(){var n=s.call(this)||this;return n.pendingTimelineChanges_={},n.lastTimelineChanges_={},n}ge(p,s);var h=p.prototype;return h.clearPendingTimelineChange=function(n){this.pendingTimelineChanges_[n]=null,this.trigger("pendingtimelinechange")},h.pendingTimelineChange=function(n){var u=n.type,m=n.from;return n=n.to,"number"==typeof m&&"number"==typeof n&&(this.pendingTimelineChanges_[u]={type:u,from:m,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[u]},h.lastTimelineChange=function(n){var u=n.type,m=n.from;return n=n.to,"number"==typeof m&&"number"==typeof n&&(this.lastTimelineChanges_[u]={type:u,from:m,to:n},delete this.pendingTimelineChanges_[u],this.trigger("timelinechange")),this.lastTimelineChanges_[u]},h.dispose=function(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()},p}(J.EventTarget),lp=Se(Qe(tt(function(){function s(A,L,O){return A(O={path:L,exports:{},require:function(j,B){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},O.exports),O.exports}var p=s(function(A){function L(O,j){for(var B=0;B<j.length;B++){var H=j[B];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(O,H.key,H)}}A.exports=function(O,j,B){return j&&L(O.prototype,j),B&&L(O,B),O},A.exports.default=A.exports,A.exports.__esModule=!0}),h=s(function(A){function L(O,j){return A.exports=L=Object.setPrototypeOf||function(B,H){return B.__proto__=H,B},A.exports.default=A.exports,A.exports.__esModule=!0,L(O,j)}A.exports=L,A.exports.default=A.exports,A.exports.__esModule=!0}),n=s(function(A){A.exports=function(L,O){L.prototype=Object.create(O.prototype),L.prototype.constructor=L,h(L,O)},A.exports.default=A.exports,A.exports.__esModule=!0}),u=function(){function A(){this.listeners={}}var L=A.prototype;return L.on=function(O,j){this.listeners[O]||(this.listeners[O]=[]),this.listeners[O].push(j)},L.off=function(O,j){return!!this.listeners[O]&&(j=this.listeners[O].indexOf(j),this.listeners[O]=this.listeners[O].slice(0),this.listeners[O].splice(j,1),-1<j)},L.trigger=function(O){var j=this.listeners[O];if(j)if(2===arguments.length)for(var B=j.length,H=0;H<B;++H)j[H].call(this,arguments[1]);else for(var q=Array.prototype.slice.call(arguments,1),V=j.length,ee=0;ee<V;++ee)j[ee].apply(this,q)},L.dispose=function(){this.listeners={}},L.pipe=function(O){this.on("data",function(j){O.push(j)})},A}(),m=null,y=function(){function A(L){var O,j,B;m=m||function(){for(var ie,he,ke,ve,Ee,xe,Ne,Be=[[[],[],[],[],[]],[[],[],[],[],[]]],Ge=Be[0],Oe=Be[1],Tt=Ge[4],Pt=Oe[4],Qt=[],Ce=[],pe=0;pe<256;pe++)Ce[(Qt[pe]=pe<<1^283*(pe>>7))^pe]=pe;for(ie=he=0;!Tt[ie];ie^=ke||1,he=Ce[he]||1)for(Ne=16843009*Qt[ve=Qt[ke=Qt[Pt[Tt[ie]=Ee=(Ee=he^he<<1^he<<2^he<<3^he<<4)>>8^255&Ee^99]=ie]]]^65537*ve^257*ke^16843008*ie,xe=257*Qt[Ee]^16843008*Ee,pe=0;pe<4;pe++)Ge[pe][ie]=xe=xe<<24^xe>>>8,Oe[pe][Ee]=Ne=Ne<<24^Ne>>>8;for(pe=0;pe<5;pe++)Ge[pe]=Ge[pe].slice(0),Oe[pe]=Oe[pe].slice(0);return Be}(),this._tables=[[m[0][0].slice(),m[0][1].slice(),m[0][2].slice(),m[0][3].slice(),m[0][4].slice()],[m[1][0].slice(),m[1][1].slice(),m[1][2].slice(),m[1][3].slice(),m[1][4].slice()]];var H=this._tables[0][4],q=this._tables[1],V=L.length,ee=1;if(4!==V&&6!==V&&8!==V)throw new Error("Invalid aes key size");var ae=L.slice(0),ne=[];for(this._key=[ae,ne],O=V;O<4*V+28;O++)B=ae[O-1],(O%V==0||8===V&&O%V==4)&&(B=H[B>>>24]<<24^H[B>>16&255]<<16^H[B>>8&255]<<8^H[255&B],O%V==0&&(B=B<<8^B>>>24^ee<<24,ee=ee<<1^283*(ee>>7))),ae[O]=ae[O-V]^B;for(j=0;O;j++,O--)B=ae[3&j?O:O-4],ne[j]=O<=4||j<4?B:q[0][H[B>>>24]]^q[1][H[B>>16&255]]^q[2][H[B>>8&255]]^q[3][H[255&B]]}return A.prototype.decrypt=function(L,O,j,B,H,q){for(var V,ee,ae,ne=this._key[1],ie=L^ne[0],he=B^ne[1],ke=j^ne[2],ve=O^ne[3],Ee=ne.length/4-2,xe=4,Ne=(O=this._tables[1])[0],Be=O[1],Ge=O[2],Oe=O[3],Tt=O[4],Pt=0;Pt<Ee;Pt++)V=Ne[ie>>>24]^Be[he>>16&255]^Ge[ke>>8&255]^Oe[255&ve]^ne[xe],ee=Ne[he>>>24]^Be[ke>>16&255]^Ge[ve>>8&255]^Oe[255&ie]^ne[xe+1],ae=Ne[ke>>>24]^Be[ve>>16&255]^Ge[ie>>8&255]^Oe[255&he]^ne[xe+2],ve=Ne[ve>>>24]^Be[ie>>16&255]^Ge[he>>8&255]^Oe[255&ke]^ne[xe+3],xe+=4,ie=V,he=ee,ke=ae;for(Pt=0;Pt<4;Pt++)H[(3&-Pt)+q]=Tt[ie>>>24]<<24^Tt[he>>16&255]<<16^Tt[ke>>8&255]<<8^Tt[255&ve]^ne[xe++],V=ie,ie=he,he=ke,ke=ve,ve=V},A}(),T=function(A){function L(){var j=A.call(this,u)||this;return j.jobs=[],j.delay=1,j.timeout_=null,j}n(L,A);var O=L.prototype;return O.processJob_=function(){this.jobs.shift()(),this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null},O.push=function(j){this.jobs.push(j),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},L}(u),S=function(A){return A<<24|(65280&A)<<8|(16711680&A)>>8|A>>>24},x=function(){function A(L,O,j,B){var H=A.STEP,q=new Int32Array(L.buffer),V=new Uint8Array(L.byteLength),ee=0;for(this.asyncStream_=new T,this.asyncStream_.push(this.decryptChunk_(q.subarray(ee,ee+H),O,j,V)),ee=H;ee<q.length;ee+=H)j=new Uint32Array([S(q[ee-4]),S(q[ee-3]),S(q[ee-2]),S(q[ee-1])]),this.asyncStream_.push(this.decryptChunk_(q.subarray(ee,ee+H),O,j,V));this.asyncStream_.push(function(){var ae;B(null,(ae=V).subarray(0,ae.byteLength-ae[ae.byteLength-1]))})}return A.prototype.decryptChunk_=function(L,O,j,B){return function(){var H=function(q,V,ee){for(var ae,ne,ie,he,ke=new Int32Array(q.buffer,q.byteOffset,q.byteLength>>2),ve=new y(Array.prototype.slice.call(V)),Ee=(q=new Uint8Array(q.byteLength),new Int32Array(q.buffer)),xe=ee[0],Ne=ee[1],Be=ee[2],Ge=ee[3],Oe=0;Oe<ke.length;Oe+=4)ae=S(ke[Oe]),ne=S(ke[Oe+1]),ie=S(ke[Oe+2]),he=S(ke[Oe+3]),ve.decrypt(ae,ne,ie,he,Ee,Oe),Ee[Oe]=S(Ee[Oe]^xe),Ee[Oe+1]=S(Ee[Oe+1]^Ne),Ee[Oe+2]=S(Ee[Oe+2]^Be),Ee[Oe+3]=S(Ee[Oe+3]^Ge),xe=ae,Ne=ne,Be=ie,Ge=he;return q}(L,O,j);B.set(H,L.byteOffset)}},p(A,null,[{key:"STEP",get:function(){return 32e3}}]),A}();self.onmessage=function(A){var L=A.data,O=new Uint8Array(L.encrypted.bytes,L.encrypted.byteOffset,L.encrypted.byteLength),j=new Uint32Array(L.key.bytes,L.key.byteOffset,L.key.byteLength/4);A=new Uint32Array(L.iv.bytes,L.iv.byteOffset,L.iv.byteLength/4),new x(O,j,A,function(B,H){var q,V;self.postMessage((q={source:L.source,decrypted:H},V={},Object.keys(q).forEach(function(ee){var ae=q[ee];V[ee]=ArrayBuffer.isView(ae)?{bytes:ae.buffer,byteOffset:ae.byteOffset,byteLength:ae.byteLength}:ae}),V),[H.buffer])})}}))),sn={AUDIO:function(s,p){return function(){var n=p.mediaTypes[s],u=p.blacklistCurrentPlaylist;nn(h=p.segmentLoaders[s],n);var m=n.activeTrack(),h=((h=n.activeGroup()).filter(function(S){return S.default})[0]||h[0]).id,y=n.tracks[h];if(m!==y){for(var T in J.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),n.tracks)n.tracks[T].enabled=n.tracks[T]===y;n.onTrackChanged()}else u({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(s,p){return function(){var h=p.segmentLoaders[s],n=p.mediaTypes[s];J.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),nn(h,n),(h=n.activeTrack())&&(h.mode="disabled"),n.onTrackChanged()}}},Td={AUDIO:function(s,p,h){var n,u,m;p&&(n=h.tech,u=h.requestOptions,m=h.segmentLoaders[s],p.on("loadedmetadata",function(){var y=p.media();m.playlist(y,u),(!n.paused()||y.endList&&"none"!==n.preload())&&m.load()}),p.on("loadedplaylist",function(){m.playlist(p.media(),u),n.paused()||m.load()}),p.on("error",sn[s](s,h)))},SUBTITLES:function(s,p,h){var n=h.tech,u=h.requestOptions,m=h.segmentLoaders[s],y=h.mediaTypes[s];p.on("loadedmetadata",function(){var T=p.media();m.playlist(T,u),m.track(y.activeTrack()),(!n.paused()||T.endList&&"none"!==n.preload())&&m.load()}),p.on("loadedplaylist",function(){m.playlist(p.media(),u),n.paused()||m.load()}),p.on("error",sn[s](s,h))}},dp={AUDIO:function(s,p){var h,n,u=p.vhs,m=p.sourceType,y=p.segmentLoaders[s],T=p.requestOptions,S=p.master.mediaGroups,x=p.mediaTypes[s],A=x.groups,L=x.tracks,O=x.logger_,j=p.masterPlaylistLoader,B=rr(j.master);for(h in S[s]&&0!==Object.keys(S[s]).length||(S[s]={main:{default:{default:!0}}},B&&(S[s].main.default.playlists=j.master.playlists)),S[s])for(var H in A[h]||(A[h]=[]),S[s][h]){var q=S[s][h][H],V=void 0;V=B?(O("AUDIO group '"+h+"' label '"+H+"' is a master playlist"),q.isMasterPlaylist=!0,null):"vhs-json"===m&&q.playlists?new Ei(q.playlists[0],u,T):q.resolvedUri?new Ei(q.resolvedUri,u,T):q.playlists&&"dash"===m?new Ks(q.playlists[0],u,T,j):null,q=J.mergeOptions({id:H,playlistLoader:V},q),Td[s](s,q.playlistLoader,p),A[h].push(q),void 0===L[H]&&(q=new J.AudioTrack({id:H,kind:(n=void 0,n=(V=q).default?"main":"alternative",n=V.characteristics&&0<=V.characteristics.indexOf("public.accessibility.describes-video")?"main-desc":n),enabled:!1,language:q.language,default:q.default,label:H}),L[H]=q)}y.on("error",sn[s](s,p))},SUBTITLES:function(s,p){var h,n=p.tech,u=p.vhs,m=p.sourceType,y=p.segmentLoaders[s],T=p.requestOptions,S=p.master.mediaGroups,x=p.mediaTypes[s],A=x.groups,L=x.tracks,O=p.masterPlaylistLoader;for(h in S[s])for(var j in A[h]||(A[h]=[]),S[s][h])if(!S[s][h][j].forced){var B=S[s][h][j],H=void 0;if("hls"===m)H=new Ei(B.resolvedUri,u,T);else if("dash"===m){if(!B.playlists.filter(function(q){return q.excludeUntil!==1/0}).length)return;H=new Ks(B.playlists[0],u,T,O)}else"vhs-json"===m&&(H=new Ei(B.playlists?B.playlists[0]:B.resolvedUri,u,T));B=J.mergeOptions({id:j,playlistLoader:H},B),Td[s](s,B.playlistLoader,p),A[h].push(B),void 0===L[j]&&(B=n.addRemoteTextTrack({id:j,kind:"subtitles",default:B.default&&B.autoselect,language:B.language,label:j},!1).track,L[j]=B)}y.on("error",sn[s](s,p))},"CLOSED-CAPTIONS":function(s,p){var h,n=p.tech,u=p.master.mediaGroups,m=(p=p.mediaTypes[s]).groups,y=p.tracks;for(h in u[s])for(var T in m[h]||(m[h]=[]),u[s][h]){var S,x,A=u[s][h][T];/^(?:CC|SERVICE)/.test(A.instreamId)&&(void 0===(x=(S=n.options_.vhs&&n.options_.vhs.captionServices||{})[(x={label:T,language:A.language,instreamId:A.instreamId,default:A.default&&A.autoselect}).instreamId]?J.mergeOptions(x,S[x.instreamId]):x).default&&delete x.default,m[h].push(J.mergeOptions({id:T},A)),void 0===y[T]&&(x=n.addRemoteTextTrack({id:x.instreamId,kind:"captions",default:x.default,language:x.language,label:x.label},!1).track,y[T]=x))}}},hp={AUDIO:function(s,p){return function(){var h,n=p.mediaTypes[s].tracks;for(h in n)if(n[h].enabled)return n[h];return null}},SUBTITLES:function(s,p){return function(){var h,n=p.mediaTypes[s].tracks;for(h in n)if("showing"===n[h].mode||"hidden"===n[h].mode)return n[h];return null}}},cp=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],pp=function(s){function p(n){var u=s.call(this)||this,m=n.src,y=n.handleManifestRedirects,T=n.withCredentials,S=n.tech,x=n.bandwidth,A=n.externVhs,L=n.useCueTags,O=n.blacklistDuration,j=n.enableLowInitialPlaylist,B=n.sourceType,H=n.cacheEncryptionKeys,q=n.experimentalBufferBasedABR,V=n.experimentalLeastPixelDiffSelector,ee=n.captionServices;if(!m)throw new Error("A non-empty playlist URL or JSON manifest string is required");var ae,ne=n.maxPlaylistRetries;return null!=ne||(ne=1/0),Ca=A,u.experimentalBufferBasedABR=Boolean(q),u.experimentalLeastPixelDiffSelector=Boolean(V),u.withCredentials=T,u.tech_=S,u.vhs_=S.vhs,u.sourceType_=B,u.useCueTags_=L,u.blacklistDuration=O,u.maxPlaylistRetries=ne,u.enableLowInitialPlaylist=j,u.useCueTags_&&(u.cueTagsTrack_=u.tech_.addTextTrack("metadata","ad-cues"),u.cueTagsTrack_.inBandMetadataTrackDispatchType=""),u.requestOptions_={withCredentials:T,handleManifestRedirects:y,maxPlaylistRetries:ne,timeout:null},u.on("error",u.pauseLoading),u.mediaTypes_=(ae={},["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(ie){ae[ie]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Sa,activeTrack:Sa,getActiveGroup:Sa,onGroupChanged:Sa,onTrackChanged:Sa,lastTrack_:null,logger_:ra("MediaGroups["+ie+"]")}}),ae),u.mediaSource=new window.MediaSource,u.handleDurationChange_=u.handleDurationChange_.bind(De(u)),u.handleSourceOpen_=u.handleSourceOpen_.bind(De(u)),u.handleSourceEnded_=u.handleSourceEnded_.bind(De(u)),u.mediaSource.addEventListener("durationchange",u.handleDurationChange_),u.mediaSource.addEventListener("sourceopen",u.handleSourceOpen_),u.mediaSource.addEventListener("sourceended",u.handleSourceEnded_),u.seekable_=J.createTimeRanges(),u.hasPlayed_=!1,u.syncController_=new op(n),u.segmentMetadataTrack_=S.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,u.decrypter_=new lp,u.sourceUpdater_=new _d(u.mediaSource),u.inbandTextTracks_={},u.timelineChangeController_=new up,H={vhs:u.vhs_,parse708captions:n.parse708captions,captionServices:ee,mediaSource:u.mediaSource,currentTime:u.tech_.currentTime.bind(u.tech_),seekable:function(){return u.seekable()},seeking:function(){return u.tech_.seeking()},duration:function(){return u.duration()},hasPlayed:function(){return u.hasPlayed_},goalBufferLength:function(){return u.goalBufferLength()},bandwidth:x,syncController:u.syncController_,decrypter:u.decrypter_,sourceType:u.sourceType_,inbandTextTracks:u.inbandTextTracks_,cacheEncryptionKeys:H,sourceUpdater:u.sourceUpdater_,timelineChangeController:u.timelineChangeController_,experimentalExactManifestTimings:n.experimentalExactManifestTimings},u.masterPlaylistLoader_=new("dash"===u.sourceType_?Ks:Ei)(m,u.vhs_,u.requestOptions_),u.setupMasterPlaylistLoaderListeners_(),u.mainSegmentLoader_=new zs(J.mergeOptions(H,{segmentMetadataTrack:u.segmentMetadataTrack_,loaderType:"main"}),n),u.audioSegmentLoader_=new zs(J.mergeOptions(H,{loaderType:"audio"}),n),u.subtitleSegmentLoader_=new sp(J.mergeOptions(H,{loaderType:"vtt",featuresNativeTextTracks:u.tech_.featuresNativeTextTracks}),n),u.setupSegmentLoaderListeners_(),u.experimentalBufferBasedABR&&(u.masterPlaylistLoader_.one("loadedplaylist",function(){return u.startABRTimer_()}),u.tech_.on("pause",function(){return u.stopABRTimer_()}),u.tech_.on("play",function(){return u.startABRTimer_()})),cp.forEach(function(ie){u[ie+"_"]=function(he){return this.audioSegmentLoader_[he]+this.mainSegmentLoader_[he]}.bind(De(u),ie)}),u.logger_=ra("MPC"),u.triggeredFmp4Usage=!1,"none"===u.tech_.preload()?(u.loadOnPlay_=function(){u.loadOnPlay_=null,u.masterPlaylistLoader_.load()},u.tech_.one("play",u.loadOnPlay_)):u.masterPlaylistLoader_.load(),u.timeToLoadedData__=-1,u.mainAppendsToLoadedData__=-1,u.audioAppendsToLoadedData__=-1,n="none"===u.tech_.preload()?"play":"loadstart",u.tech_.one(n,function(){var ie=Date.now();u.tech_.one("loadeddata",function(){u.timeToLoadedData__=Date.now()-ie,u.mainAppendsToLoadedData__=u.mainSegmentLoader_.mediaAppends,u.audioAppendsToLoadedData__=u.audioSegmentLoader_.mediaAppends})}),u}ge(p,s);var h=p.prototype;return h.mainAppendsToLoadedData_=function(){return this.mainAppendsToLoadedData__},h.audioAppendsToLoadedData_=function(){return this.audioAppendsToLoadedData__},h.appendsToLoadedData_=function(){var n=this.mainAppendsToLoadedData_(),u=this.audioAppendsToLoadedData_();return-1===n||-1===u?-1:n+u},h.timeToLoadedData_=function(){return this.timeToLoadedData__},h.checkABR_=function(){var n=this.selectPlaylist();n&&this.shouldSwitchToMedia_(n)&&this.switchMedia_(n,"abr")},h.switchMedia_=function(n,u,m){var T=(y=this.media())&&(y.id||y.uri),y=n.id||n.uri;T&&T!==y&&(this.logger_("switch media "+T+" -> "+y+" from "+u),this.tech_.trigger({type:"usage",name:"vhs-rendition-change-"+u})),this.masterPlaylistLoader_.media(n,m)},h.startABRTimer_=function(){var n=this;this.stopABRTimer_(),this.abrTimer_=window.setInterval(function(){return n.checkABR_()},250)},h.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(window.clearInterval(this.abrTimer_),this.abrTimer_=null)},h.getAudioTrackPlaylists_=function(){var n=this.master(),u=n&&n.playlists||[];if(!n||!n.mediaGroups||!n.mediaGroups.AUDIO)return u;var m,y=n.mediaGroups.AUDIO,T=Object.keys(y);if(Object.keys(this.mediaTypes_.AUDIO.groups).length)m=this.mediaTypes_.AUDIO.activeTrack();else{var S,x=y.main||T.length&&y[T[0]];for(S in x)if(x[S].default){m={label:S};break}}if(!m)return u;var A,L=[];for(A in y)if(y[A][m.label]){var O=y[A][m.label];if(O.playlists&&O.playlists.length)L.push.apply(L,O.playlists);else if(O.uri)L.push(O);else if(n.playlists.length)for(var j=0;j<n.playlists.length;j++){var B=n.playlists[j];B.attributes&&B.attributes.AUDIO&&B.attributes.AUDIO===A&&L.push(B)}}return L.length?L:u},h.setupMasterPlaylistLoaderListeners_=function(){var n=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var u=n.masterPlaylistLoader_.media(),m=1.5*u.targetDuration*1e3;n.requestOptions_.timeout=Ls(n.masterPlaylistLoader_.master,n.masterPlaylistLoader_.media())?0:m,u.endList&&"none"!==n.tech_.preload()&&(n.mainSegmentLoader_.playlist(u,n.requestOptions_),n.mainSegmentLoader_.load()),function(s){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(A){dp[A](A,s)});var p,h=s.mediaTypes,n=s.masterPlaylistLoader,u=s.tech,m=s.vhs,y=s.segmentLoaders,T=y.AUDIO,S=y.main;function x(){h.AUDIO.onTrackChanged(),u.trigger({type:"usage",name:"vhs-audio-change"}),u.trigger({type:"usage",name:"hls-audio-change"})}for(p in["AUDIO","SUBTITLES"].forEach(function(A){var L,O,j,B,H,q,V,ee,ae,ne;h[A].activeGroup=(L=A,O=s,function(ie){var ke=O.mediaTypes[L].groups,ve=O.masterPlaylistLoader.media();if(!ve)return null;var Ee=null;ve.attributes[L]&&(Ee=ke[ve.attributes[L]]);var xe=Object.keys(ke);if(!Ee)if("AUDIO"===L&&1<xe.length&&rr(O.master))for(var Ne=0;Ne<xe.length;Ne++){var Be=ke[xe[Ne]];if(pd(Be,ve)){Ee=Be;break}}else ke.main?Ee=ke.main:1===xe.length&&(Ee=ke[xe[0]]);return void 0===ie?Ee:null!==ie&&Ee&&Ee.filter(function(Ge){return Ge.id===ie.id})[0]||null}),h[A].activeTrack=hp[A](A,s),h[A].onGroupChanged=(j=A,B=s,function(){var he=(ie=B.segmentLoaders)[j],ke=ie.main,ve=B.mediaTypes[j],Ee=ve.activeTrack(),xe=ve.getActiveGroup(),Ne=ve.activePlaylistLoader,ie=ve.lastGroup_;xe&&ie&&xe.id===ie.id||(ve.lastGroup_=xe,ve.lastTrack_=Ee,nn(he,ve),xe&&!xe.isMasterPlaylist&&(xe.playlistLoader?(he.resyncLoader(),cd(xe.playlistLoader,ve)):Ne&&ke.resetEverything()))}),h[A].onGroupChanging=(H=A,q=s,function(){var ie=q.segmentLoaders[H];q.mediaTypes[H].lastGroup_=null,ie.abort(),ie.pause()}),h[A].onTrackChanged=(V=A,ee=s,function(){var ie=ee.masterPlaylistLoader,ke=(he=ee.segmentLoaders)[V],ve=he.main,Ee=ee.mediaTypes[V],xe=Ee.activeTrack(),Ne=Ee.getActiveGroup(),Be=Ee.activePlaylistLoader,Ge=Ee.lastTrack_;if((!Ge||!xe||Ge.id!==xe.id)&&(Ee.lastGroup_=Ne,Ee.lastTrack_=xe,nn(ke,Ee),Ne)){if(Ne.isMasterPlaylist){if(!xe||!Ge||xe.id===Ge.id)return;var Oe=ee.vhs.masterPlaylistController_,he=Oe.selectPlaylist();return Oe.media()===he?void 0:(Ee.logger_("track change. Switching master audio from "+Ge.id+" to "+xe.id),ie.pause(),ve.resetEverything(),void Oe.fastQualityChange_(he))}if("AUDIO"===V){if(!Ne.playlistLoader)return ve.setAudio(!0),void ve.resetEverything();ke.setAudio(!0),ve.setAudio(!1)}Be!==Ne.playlistLoader&&(ke.track&&ke.track(xe),ke.resetEverything()),cd(Ne.playlistLoader,Ee)}}),h[A].getActiveGroup=(ae=A,ne=s.mediaTypes,function(){var ie=ne[ae].activeTrack();return ie?ne[ae].activeGroup(ie):null})}),(y=h.AUDIO.activeGroup())&&(y=(y.filter(function(A){return A.default})[0]||y[0]).id,h.AUDIO.tracks[y].enabled=!0,h.AUDIO.onGroupChanged(),h.AUDIO.onTrackChanged(),h.AUDIO.getActiveGroup().playlistLoader?(S.setAudio(!1),T.setAudio(!0)):S.setAudio(!0)),n.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(A){return h[A].onGroupChanged()})}),n.on("mediachanging",function(){["AUDIO","SUBTITLES"].forEach(function(A){return h[A].onGroupChanging()})}),u.audioTracks().addEventListener("change",x),u.remoteTextTracks().addEventListener("change",h.SUBTITLES.onTrackChanged),m.on("dispose",function(){u.audioTracks().removeEventListener("change",x),u.remoteTextTracks().removeEventListener("change",h.SUBTITLES.onTrackChanged)}),u.clearTracks("audio"),h.AUDIO.tracks)u.audioTracks().addTrack(h.AUDIO.tracks[p])}({sourceType:n.sourceType_,segmentLoaders:{AUDIO:n.audioSegmentLoader_,SUBTITLES:n.subtitleSegmentLoader_,main:n.mainSegmentLoader_},tech:n.tech_,requestOptions:n.requestOptions_,masterPlaylistLoader:n.masterPlaylistLoader_,vhs:n.vhs_,master:n.master(),mediaTypes:n.mediaTypes_,blacklistCurrentPlaylist:n.blacklistCurrentPlaylist.bind(n)}),n.triggerPresenceUsage_(n.master(),u),n.setupFirstPlay(),!n.mediaTypes_.AUDIO.activePlaylistLoader||n.mediaTypes_.AUDIO.activePlaylistLoader.media()?n.trigger("selectedinitialmedia"):n.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){n.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){n.loadOnPlay_&&n.tech_.off("play",n.loadOnPlay_);var u,m=n.masterPlaylistLoader_.media();if(!m){if(n.excludeUnsupportedVariants_(),!(u=(u=n.enableLowInitialPlaylist?n.selectInitialPlaylist():u)||n.selectPlaylist())||!n.shouldSwitchToMedia_(u)||(n.initialMedia_=u,n.switchMedia_(n.initialMedia_,"initial"),"vhs-json"!==n.sourceType_||!n.initialMedia_.segments))return;m=n.initialMedia_}n.handleUpdatedMediaPlaylist(m)}),this.masterPlaylistLoader_.on("error",function(){n.blacklistCurrentPlaylist(n.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){n.mainSegmentLoader_.abort(),n.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var u=n.masterPlaylistLoader_.media(),m=1.5*u.targetDuration*1e3;n.requestOptions_.timeout=Ls(n.masterPlaylistLoader_.master,n.masterPlaylistLoader_.media())?0:m,n.mainSegmentLoader_.playlist(u,n.requestOptions_),n.mainSegmentLoader_.load(),n.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var u=n.masterPlaylistLoader_.media();"playlist-unchanged"!==u.lastExcludeReason_&&n.stuckAtPlaylistEnd_(u)&&(n.blacklistCurrentPlaylist({message:"Playlist no longer updating.",reason:"playlist-unchanged"}),n.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){n.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"}),n.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){n.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"}),n.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},h.handleUpdatedMediaPlaylist=function(n){this.useCueTags_&&this.updateAdCues_(n),this.mainSegmentLoader_.playlist(n,this.requestOptions_),this.updateDuration(!n.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},h.triggerPresenceUsage_=function(n,u){var m,y=n.mediaGroups||{},T=!0;for(m in n=Object.keys(y.AUDIO),y.AUDIO)for(var S in y.AUDIO[m])y.AUDIO[m][S].uri||(T=!1);T&&(this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),this.tech_.trigger({type:"usage",name:"hls-demuxed"})),Object.keys(y.SUBTITLES).length&&(this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),this.tech_.trigger({type:"usage",name:"hls-webvtt"})),Ca.Playlist.isAes(u)&&(this.tech_.trigger({type:"usage",name:"vhs-aes"}),this.tech_.trigger({type:"usage",name:"hls-aes"})),n.length&&1<Object.keys(y.AUDIO[n[0]]).length&&(this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})),this.useCueTags_&&(this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"}),this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"}))},h.shouldSwitchToMedia_=function(n){var u=this.masterPlaylistLoader_.media()||this.masterPlaylistLoader_.pendingMedia_,m=this.tech_.currentTime(),y=this.bufferLowWaterLine(),T=this.bufferHighWaterLine();return function(S){var x=S.currentPlaylist,A=S.buffered,L=S.currentTime,O=S.nextPlaylist,j=S.bufferLowWaterLine,B=S.bufferHighWaterLine,H=S.duration,q=S.experimentalBufferBasedABR,V=S.log;if(!O)return J.log.warn("We received no playlist to switch to. Please check your stream."),!1;var ee="allowing switch "+(x&&x.id||"null")+" -> "+O.id;return x?!(O.id===x.id||(S=Boolean(ki(A,L).length),x.endList?(A=Ms(A,L),H<(L=q?bt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:bt.MAX_BUFFER_LOW_WATER_LINE)?(V(ee+" as duration < max low water line ("+H+" < "+L+")"),0):(L=O.attributes.BANDWIDTH)<(O=x.attributes.BANDWIDTH)&&(!q||A<B)?(x=ee+" as next bandwidth < current bandwidth ("+L+" < "+O+")",q&&(x+=" and forwardBuffer < bufferHighWaterLine ("+A+" < "+B+")"),V(x),0):(!q||O<L)&&j<=A?(j=ee+" as forwardBuffer >= bufferLowWaterLine ("+A+" >= "+j+")",q&&(j+=" and next bandwidth > current bandwidth ("+L+" > "+O+")"),V(j),0):(V("not "+ee+" as no switching criteria met"),1)):S||"number"!=typeof x.partTargetDuration?(V(ee+" as current playlist is live"),0):(V("not "+ee+" as current playlist is live llhls, but currentTime isn't in buffered."),1))):(V(ee+" as current playlist is not set"),!0)}({buffered:this.tech_.buffered(),currentTime:m,currentPlaylist:u,nextPlaylist:n,bufferLowWaterLine:y,bufferHighWaterLine:T,duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},h.setupSegmentLoaderListeners_=function(){var n=this;function u(){if(!n.sourceUpdater_.hasCreatedSourceBuffers())return n.tryToCreateSourceBuffers_();var m=n.getCodecsOrExclude_();m&&n.sourceUpdater_.addOrChangeSourceBuffers(m)}this.experimentalBufferBasedABR||(this.mainSegmentLoader_.on("bandwidthupdate",function(){var m=n.selectPlaylist();n.shouldSwitchToMedia_(m)&&n.switchMedia_(m,"bandwidthupdate"),n.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){n.trigger("progress")})),this.mainSegmentLoader_.on("error",function(){n.blacklistCurrentPlaylist(n.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){n.error=n.mainSegmentLoader_.error_,n.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){n.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){n.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"}),n.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){n.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){n.error=n.audioSegmentLoader_.error_,n.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){n.logger_("main segment loader ended"),n.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(m){n.experimentalBufferBasedABR||(n.delegateLoaders_("all",["abort"]),n.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120))}),this.mainSegmentLoader_.on("trackinfo",u),this.audioSegmentLoader_.on("trackinfo",u),this.mainSegmentLoader_.on("fmp4",function(){n.triggeredFmp4Usage||(n.tech_.trigger({type:"usage",name:"vhs-fmp4"}),n.tech_.trigger({type:"usage",name:"hls-fmp4"}),n.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){n.triggeredFmp4Usage||(n.tech_.trigger({type:"usage",name:"vhs-fmp4"}),n.tech_.trigger({type:"usage",name:"hls-fmp4"}),n.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){n.logger_("audioSegmentLoader ended"),n.onEndOfStream()})},h.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},h.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},h.smoothQualityChange_=function(n){void 0===n&&(n=this.selectPlaylist()),this.fastQualityChange_(n)},h.fastQualityChange_=function(n){var u=this;(n=void 0===n?this.selectPlaylist():n)!==this.masterPlaylistLoader_.media()?(this.switchMedia_(n,"fast-quality"),this.mainSegmentLoader_.resetEverything(function(){u.tech_.setCurrentTime(J.browser.IE_VERSION||J.browser.IS_EDGE?u.tech_.currentTime()+.04:u.tech_.currentTime())})):this.logger_("skipping fastQualityChange because new media is same as old")},h.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var n=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<n.start(0)?this.tech_.setCurrentTime(n.end(n.length-1)):void 0}},h.setupFirstPlay=function(){var n=this,u=this.masterPlaylistLoader_.media();if(!u||this.tech_.paused()||this.hasPlayed_)return!1;if(!u.endList){var m=this.seekable();if(!m.length)return!1;if(J.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){n.trigger("firstplay"),n.tech_.setCurrentTime(m.end(0)),n.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(m.end(0))}return this.hasPlayed_=!0,this.load(),!0},h.handleSourceOpen_=function(){var n;this.tryToCreateSourceBuffers_(),!this.tech_.autoplay()||void 0!==(n=this.tech_.play())&&"function"==typeof n.then&&n.then(null,function(u){}),this.trigger("sourceopen")},h.handleSourceEnded_=function(){var n,u;!this.inbandTextTracks_.metadataTrack_||(n=this.inbandTextTracks_.metadataTrack_.cues)&&n.length&&(u=this.duration(),n[n.length-1].endTime=isNaN(u)||Math.abs(u)===1/0?Number.MAX_VALUE:u)},h.handleDurationChange_=function(){this.tech_.trigger("durationchange")},h.onEndOfStream=function(){var n,u=this.mainSegmentLoader_.ended_;(u=this.mediaTypes_.AUDIO.activePlaylistLoader?((n=this.mainSegmentLoader_.getCurrentMediaInfo_())&&!n.hasVideo||u)&&this.audioSegmentLoader_.ended_:u)&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},h.stuckAtPlaylistEnd_=function(n){if(!this.seekable().length)return!1;if(null===(u=this.syncController_.getExpiredTime(n,this.duration())))return!1;var u,m=Ca.Playlist.playlistEnd(n,u);return n=this.tech_.currentTime(),(u=this.tech_.buffered()).length?(u=u.end(u.length-1))-n<=.1&&m-u<=.1:m-n<=.1},h.blacklistCurrentPlaylist=function(n,u){var m=(n=void 0===n?{}:n).playlist||this.masterPlaylistLoader_.media();if(u=u||n.blacklistDuration||this.blacklistDuration,!m)return this.error=n,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));m.playlistErrors_++;var y,T=this.masterPlaylistLoader_.master.playlists,S=T.filter(Xr),x=1===S.length&&S[0]===m;return 1===T.length&&u!==1/0?(J.log.warn("Problem encountered with playlist "+m.id+". Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(x)):(x&&(y=!1,T.forEach(function(A){var L;A===m||void 0!==(L=A.excludeUntil)&&L!==1/0&&(y=!0,delete A.excludeUntil)}),y&&(J.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))),S=m.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*u,m.excludeUntil=S,n.reason&&(m.lastExcludeReason_=n.reason),this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-blacklisted"}),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"}),(T=this.selectPlaylist())?((u=n.internal?this.logger_:J.log.warn)((n.internal?"Internal problem":"Problem")+" encountered with playlist "+m.id+"."+(S=n.message?" "+n.message:"")+" Switching to playlist "+T.id+"."),T.attributes.AUDIO!==m.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),T.attributes.SUBTITLES!==m.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]),S=T.targetDuration/2*1e3||5e3,S="number"==typeof T.lastRequest&&Date.now()-T.lastRequest<=S,this.switchMedia_(T,"exclude",x||S)):(this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error")))},h.pauseLoading=function(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()},h.delegateLoaders_=function(n,u){var m=this,y=[],T="all"===n;!T&&"main"!==n||y.push(this.masterPlaylistLoader_);var S=[];!T&&"audio"!==n||S.push("AUDIO"),!T&&"subtitle"!==n||(S.push("CLOSED-CAPTIONS"),S.push("SUBTITLES")),S.forEach(function(x){(x=m.mediaTypes_[x]&&m.mediaTypes_[x].activePlaylistLoader)&&y.push(x)}),["main","audio","subtitle"].forEach(function(x){var A=m[x+"SegmentLoader_"];!A||n!==x&&"all"!==n||y.push(A)}),y.forEach(function(x){return u.forEach(function(A){"function"==typeof x[A]&&x[A]()})})},h.setCurrentTime=function(n){var u=ki(this.tech_.buffered(),n);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?u&&u.length?n:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},h.duration=function(){if(!this.masterPlaylistLoader_)return 0;var n=this.masterPlaylistLoader_.media();return n?n.endList?this.mediaSource?this.mediaSource.duration:Ca.Playlist.duration(n):1/0:0},h.seekable=function(){return this.seekable_},h.onSyncInfoUpdate_=function(){var n;if(this.masterPlaylistLoader_&&!this.sourceUpdater_.hasCreatedSourceBuffers()){var u=this.masterPlaylistLoader_.media();if(u){var m=this.syncController_.getExpiredTime(u,this.duration());if(null!==m){var y,T,S=this.masterPlaylistLoader_.master,x=Ca.Playlist.seekable(u,m,Ca.Playlist.liveEdgeDelay(S,u));if(0!==x.length){if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(u=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(m=this.syncController_.getExpiredTime(u,this.duration()))||0===(n=Ca.Playlist.seekable(u,m,Ca.Playlist.liveEdgeDelay(S,u))).length))return;this.seekable_&&this.seekable_.length&&(y=this.seekable_.end(0),T=this.seekable_.start(0)),this.seekable_=!n||n.start(0)>x.end(0)||x.start(0)>n.end(0)?x:J.createTimeRanges([[(n.start(0)>x.start(0)?n:x).start(0),(n.end(0)<x.end(0)?n:x).end(0)]]),this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===y&&this.seekable_.start(0)===T||(this.logger_("seekable updated ["+_l(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},h.updateDuration=function(n){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,n),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(n){var u=this.seekable();return u.length?void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<u.end(u.length-1))&&this.sourceUpdater_.setDuration(u.end(u.length-1))):void 0}n=this.tech_.buffered(),u=Ca.Playlist.duration(this.masterPlaylistLoader_.media()),0<n.length&&(u=Math.max(u,n.end(n.length-1))),this.mediaSource.duration!==u&&this.sourceUpdater_.setDuration(u)},h.dispose=function(){var n=this;this.trigger("dispose"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(function(u){var m,y=n.mediaTypes_[u].groups;for(m in y)y[m].forEach(function(T){T.playlistLoader&&T.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()},h.master=function(){return this.masterPlaylistLoader_.master},h.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},h.areMediaTypesKnown_=function(){var n=!!this.mediaTypes_.AUDIO.activePlaylistLoader,u=!!this.mainSegmentLoader_.getCurrentMediaInfo_();return n=!n||!!this.audioSegmentLoader_.getCurrentMediaInfo_(),u&&n},h.getCodecsOrExclude_=function(){var n=this,u={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}};u.video=u.main;var m=sr(this.master(),this.media()),y={},T=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(u.main.hasVideo&&(y.video=m.video||u.main.videoCodec||"avc1.4d400d"),u.main.isMuxed&&(y.video+=","+(m.audio||u.main.audioCodec||Tu)),(u.main.hasAudio&&!u.main.isMuxed||u.audio.hasAudio||T)&&(y.audio=m.audio||u.main.audioCodec||u.audio.audioCodec||Tu,u.audio.isFmp4=(u.main.hasAudio&&!u.main.isMuxed?u.main:u.audio).isFmp4),y.audio||y.video){var S,x,A={};if(["video","audio"].forEach(function(O){var B;y.hasOwnProperty(O)&&!(u[O].isFmp4?Rr:us)(B=y[O])&&(A[B=u[O].isFmp4?"browser":"muxer"]=A[B]||[],A[B].push(y[O]),"audio"===O&&(S=B))}),T&&S&&this.media().attributes.AUDIO&&(x=this.media().attributes.AUDIO,this.master().playlists.forEach(function(O){(O.attributes&&O.attributes.AUDIO)===x&&O!==n.media()&&(O.excludeUntil=1/0)}),this.logger_("excluding audio group "+x+" as "+S+' does not support codec(s): "'+y.audio+'"')),!Object.keys(A).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var L=[];if(["video","audio"].forEach(function(O){var j=(pa(n.sourceUpdater_.codecs[O]||"")[0]||{}).type,B=(pa(y[O]||"")[0]||{}).type;j&&B&&j.toLowerCase()!==B.toLowerCase()&&L.push('"'+n.sourceUpdater_.codecs[O]+'" -> "'+y[O]+'"')}),L.length)return void this.blacklistCurrentPlaylist({playlist:this.media(),message:"Codec switching not supported: "+L.join(", ")+".",blacklistDuration:1/0,internal:!0})}return y}T=Object.keys(A).reduce(function(O,j){return O&&(O+=", "),O+(j+' does not support codec(s): "')+A[j].join(",")+'"'},"")+".",this.blacklistCurrentPlaylist({playlist:this.media(),internal:!0,message:T,blacklistDuration:1/0})}else this.blacklistCurrentPlaylist({playlist:this.media(),message:"Could not determine codecs for playlist.",blacklistDuration:1/0})},h.tryToCreateSourceBuffers_=function(){var n;"open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_()||(n=this.getCodecsOrExclude_())&&(this.sourceUpdater_.createSourceBuffers(n),n=[n.video,n.audio].filter(Boolean).join(","),this.excludeIncompatibleVariants_(n))},h.excludeUnsupportedVariants_=function(){var n=this,u=this.master().playlists,m=[];Object.keys(u).forEach(function(y){var T,S=u[y];-1===m.indexOf(S.id)&&(m.push(S.id),T=[],!(y=sr(n.master,S)).audio||us(y.audio)||Rr(y.audio)||T.push("audio codec "+y.audio),!y.video||us(y.video)||Rr(y.video)||T.push("video codec "+y.video),y.text&&"stpp.ttml.im1t"===y.text&&T.push("text codec "+y.text),T.length&&(S.excludeUntil=1/0,n.logger_("excluding "+S.id+" for unsupported: "+T.join(", "))))})},h.excludeIncompatibleVariants_=function(n){var u=this,m=[],y=this.master().playlists,T=Yl(n=Jr(pa(n))),S=n.video&&pa(n.video)[0]||null,x=n.audio&&pa(n.audio)[0]||null;Object.keys(y).forEach(function(A){var L,O,j=y[A];-1===m.indexOf(j.id)&&j.excludeUntil!==1/0&&(m.push(j.id),L=[],A=Yl(O=sr(u.masterPlaylistLoader_.master,j)),(O.audio||O.video)&&(A!==T&&L.push('codec count "'+A+'" !== "'+T+'"'),u.sourceUpdater_.canChangeType()||(A=O.video&&pa(O.video)[0]||null,O=O.audio&&pa(O.audio)[0]||null,A&&S&&A.type.toLowerCase()!==S.type.toLowerCase()&&L.push('video codec "'+A.type+'" !== "'+S.type+'"'),O&&x&&O.type.toLowerCase()!==x.type.toLowerCase()&&L.push('audio codec "'+O.type+'" !== "'+x.type+'"')),L.length&&(j.excludeUntil=1/0,u.logger_("blacklisting "+j.id+": "+L.join(" && ")))))})},h.updateAdCues_=function(n){var u=0,m=this.seekable();m.length&&(u=m.start(0)),function(y,T,S){if(void 0===S&&(S=0),y.segments)for(var x=S,A=0;A<y.segments.length;A++){var L,O,j,B=y.segments[A];if(j=j||function(H,q){for(var V=H.cues,ee=0;ee<V.length;ee++){var ae=V[ee];if(q>=ae.adStartTime&&q<=ae.adEndTime)return ae}return null}(T,x+B.duration/2)){if("cueIn"in B){j.endTime=x,j.adEndTime=x,x+=B.duration,j=null;continue}if(x<j.endTime){x+=B.duration;continue}j.endTime+=B.duration}else"cueOut"in B&&((j=new window.VTTCue(x,x+B.duration,B.cueOut)).adStartTime=x,j.adEndTime=x+parseFloat(B.cueOut),T.addCue(j)),"cueOutCont"in B&&(L=(O=B.cueOutCont.split("/").map(parseFloat))[0],O=O[1],(j=new window.VTTCue(x,x+B.duration,"")).adStartTime=x-L,j.adEndTime=j.adStartTime+O,T.addCue(j));x+=B.duration}}(n,this.cueTagsTrack_,u)},h.goalBufferLength=function(){var n=this.tech_.currentTime(),u=bt.GOAL_BUFFER_LENGTH,m=bt.GOAL_BUFFER_LENGTH_RATE,y=Math.max(u,bt.MAX_GOAL_BUFFER_LENGTH);return Math.min(u+n*m,y)},h.bufferLowWaterLine=function(){var n=this.tech_.currentTime(),u=bt.BUFFER_LOW_WATER_LINE,m=bt.BUFFER_LOW_WATER_LINE_RATE,y=Math.max(u,bt.MAX_BUFFER_LOW_WATER_LINE),T=Math.max(u,bt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(u+n*m,this.experimentalBufferBasedABR?T:y)},h.bufferHighWaterLine=function(){return bt.BUFFER_HIGH_WATER_LINE},p}(J.EventTarget),Ed=["seeking","seeked","pause","playing","error"],mp=function(){function s(h){var n=this;function u(){return n.monitorCurrentTime_()}function m(){return n.monitorCurrentTime_()}function y(){return n.techWaiting_()}function T(){return n.cancelTimer_()}this.masterPlaylistController_=h.masterPlaylistController,this.tech_=h.tech,this.seekable=h.seekable,this.allowSeeksWithinUnsafeLiveWindow=h.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=h.liveRangeSafeTimeDelta,this.media=h.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=ra("PlaybackWatcher"),this.logger_("initialize");var S=this.masterPlaylistController_,x=["main","subtitle","audio"],A={};function L(O){["main","audio"].forEach(function(j){S[j+"SegmentLoader_"][O]("appended",n.seekingAppendCheck_)})}x.forEach(function(O){A[O]={reset:function(){return n.resetSegmentDownloads_(O)},updateend:function(){return n.checkSegmentDownloads_(O)}},S[O+"SegmentLoader_"].on("appendsdone",A[O].updateend),S[O+"SegmentLoader_"].on("playlistupdate",A[O].reset),n.tech_.on(["seeked","seeking"],A[O].reset)}),this.seekingAppendCheck_=function(){n.fixesBadSeeks_()&&(n.consecutiveUpdates=0,n.lastRecordedTime=n.tech_.currentTime(),L("off"))},this.clearSeekingAppendCheck_=function(){return L("off")},this.watchForBadSeeking_=function(){n.clearSeekingAppendCheck_(),L("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",y),this.tech_.on(Ed,T),this.tech_.on("canplay",m),this.tech_.one("play",u),this.dispose=function(){n.clearSeekingAppendCheck_(),n.logger_("dispose"),n.tech_.off("waiting",y),n.tech_.off(Ed,T),n.tech_.off("canplay",m),n.tech_.off("play",u),n.tech_.off("seeking",n.watchForBadSeeking_),n.tech_.off("seeked",n.clearSeekingAppendCheck_),x.forEach(function(O){S[O+"SegmentLoader_"].off("appendsdone",A[O].updateend),S[O+"SegmentLoader_"].off("playlistupdate",A[O].reset),n.tech_.off(["seeked","seeking"],A[O].reset)}),n.checkCurrentTimeTimeout_&&window.clearTimeout(n.checkCurrentTimeTimeout_),n.cancelTimer_()}}var p=s.prototype;return p.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&window.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=window.setTimeout(this.monitorCurrentTime_.bind(this),250)},p.resetSegmentDownloads_=function(h){var n=this.masterPlaylistController_[h+"SegmentLoader_"];0<this[h+"StalledDownloads_"]&&this.logger_("resetting possible stalled download count for "+h+" loader"),this[h+"StalledDownloads_"]=0,this[h+"Buffered_"]=n.buffered_()},p.checkSegmentDownloads_=function(h){var n=this.masterPlaylistController_,u=n[h+"SegmentLoader_"],m=u.buffered_(),y=function(T,S){if(T===S)return!1;if(!T&&S||!S&&T||T.length!==S.length)return!0;for(var x=0;x<T.length;x++)if(T.start(x)!==S.start(x)||T.end(x)!==S.end(x))return!0;return!1}(this[h+"Buffered_"],m);this[h+"Buffered_"]=m,y?this.resetSegmentDownloads_(h):(this[h+"StalledDownloads_"]++,this.logger_("found #"+this[h+"StalledDownloads_"]+" "+h+" appends that did not increase buffer (possible stalled download)",{playlistId:u.playlist_&&u.playlist_.id,buffered:Ka(m)}),this[h+"StalledDownloads_"]<10||(this.logger_(h+" loader stalled download exclusion"),this.resetSegmentDownloads_(h),this.tech_.trigger({type:"usage",name:"vhs-"+h+"-download-exclusion"}),"subtitle"!==h&&n.blacklistCurrentPlaylist({message:"Excessive "+h+" segment downloading detected."},1/0)))},p.checkCurrentTime_=function(){if(!this.tech_.paused()&&!this.tech_.seeking()){var h=this.tech_.currentTime(),n=this.tech_.buffered();if(this.lastRecordedTime===h&&(!n.length||h+.1>=n.end(n.length-1)))return this.techWaiting_();5<=this.consecutiveUpdates&&h===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):h===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=h)}},p.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},p.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var h,n=this.seekable(),u=this.tech_.currentTime();if(this.afterSeekableWindow_(n,u,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(h=n.end(n.length-1)),void 0!==(h=this.beforeSeekableWindow_(n,u)?(T=n.start(0))+(T===n.end(0)?0:.1):h))return this.logger_("Trying to seek outside of seekable at time "+u+" with seekable range "+_l(n)+". Seeking to "+h+"."),this.tech_.setCurrentTime(h),!0;for(var m=this.masterPlaylistController_.sourceUpdater_,y=this.tech_.buffered(),T=m.audioBuffer?m.audioBuffered():null,S=(n=m.videoBuffer?m.videoBuffered():null,(m=this.media()).partTargetDuration||2*(m.targetDuration-Ha)),x=[T,n],A=0;A<x.length;A++)if(x[A]&&Ms(x[A],u)<S)return!1;return 0!==(y=qr(y,u)).length&&(h=y.start(0)+.1,this.logger_("Buffered region starts ("+y.start(0)+")  just beyond seek point ("+u+"). Seeking to "+h+"."),this.tech_.setCurrentTime(h),!0)},p.waiting_=function(){var h,n;this.techWaiting_()||(h=this.tech_.currentTime(),(n=ki(n=this.tech_.buffered(),h)).length&&h+3<=n.end(0)&&(this.cancelTimer_(),this.tech_.setCurrentTime(h),this.logger_("Stopped at "+h+" while inside a buffered region ["+n.start(0)+" -> "+n.end(0)+"]. Attempting to resume playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"}),this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})))},p.techWaiting_=function(){var h=this.seekable(),n=this.tech_.currentTime();if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(h,n)){var u=h.end(h.length-1);return this.logger_("Fell out of live window at time "+n+". Seeking to live point (seekable end) "+u),this.cancelTimer_(),this.tech_.setCurrentTime(u),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}return h=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,u=this.tech_.buffered(),this.videoUnderflow_({audioBuffered:h.audioBuffered(),videoBuffered:h.videoBuffered(),currentTime:n})?(this.cancelTimer_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0):0<(h=qr(u,n)).length&&(u=h.start(0)-n,this.logger_("Stopped at "+n+", setting timer for "+u+", seeking to "+h.start(0)),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*u,n),!0)},p.afterSeekableWindow_=function(h,n,u,m){if(void 0===m&&(m=!1),!h.length)return!1;var y=h.end(h.length-1)+.1;return(y=!u.endList&&m?h.end(h.length-1)+3*u.targetDuration:y)<n},p.beforeSeekableWindow_=function(h,n){return!!(h.length&&0<h.start(0)&&n<h.start(0)-this.liveRangeSafeTimeDelta)},p.videoUnderflow_=function(h){var n,u,m=h.videoBuffered,y=h.audioBuffered,T=h.currentTime;if(m)return m.length&&y.length?(u=ki(m,T-3),h=ki(m,T),(y=ki(y,T)).length&&!h.length&&u.length&&(n={start:u.end(0),end:y.end(0)})):qr(m,T).length||(n=this.gapFromVideoUnderflow_(m,T)),!!n&&(this.logger_("Encountered a gap in video from "+n.start+" to "+n.end+". Seeking to current time "+T),!0)},p.skipTheGap_=function(h){var n=this.tech_.buffered(),u=this.tech_.currentTime();n=qr(n,u),this.cancelTimer_(),0!==n.length&&u===h&&(this.logger_("skipTheGap_:","currentTime:",u,"scheduled currentTime:",h,"nextRange start:",n.start(0)),this.tech_.setCurrentTime(n.start(0)+Ha),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},p.gapFromVideoUnderflow_=function(h,n){for(var u=function(S){if(S.length<2)return J.createTimeRanges();for(var x=[],A=1;A<S.length;A++){var L=S.end(A-1),O=S.start(A);x.push([L,O])}return J.createTimeRanges(x)}(h),m=0;m<u.length;m++){var y=u.start(m),T=u.end(m);if(n-y<4&&2<n-y)return{start:y,end:T}}return null},s}(),gp={errorInterval:30,getSource:function(s){return s(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},Mt={PlaylistLoader:Ei,Playlist:zt,utils:da,STANDARD_PLAYLIST_SELECTOR:Gt,INITIAL_PLAYLIST_SELECTOR:function(){var s=this,p=this.playlists.master.playlists.filter(zt.isEnabled);return vi(p,Gs),p.filter(function(h){return!!sr(s.playlists.master,h).video})[0]||null},lastBandwidthSelector:Gt,movingAverageBandwidthSelector:function(s){var p=-1,h=-1;if(s<0||1<s)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){var n=this.useDevicePixelRatio&&window.devicePixelRatio||1;return p<0&&(p=this.systemBandwidth,h=this.systemBandwidth),0<this.systemBandwidth&&this.systemBandwidth!==h&&(p=s*this.systemBandwidth+(1-s)*p,h=this.systemBandwidth),Jl(this.playlists.master,p,parseInt(Zr(this.tech_.el(),"width"),10)*n,parseInt(Zr(this.tech_.el(),"height"),10)*n,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)}},comparePlaylistBandwidth:Gs,comparePlaylistResolution:function(s,p){var h,n;return(h=(h=s.attributes.RESOLUTION&&s.attributes.RESOLUTION.width?s.attributes.RESOLUTION.width:h)||window.Number.MAX_VALUE)===(n=(n=p.attributes.RESOLUTION&&p.attributes.RESOLUTION.width?p.attributes.RESOLUTION.width:n)||window.Number.MAX_VALUE)&&s.attributes.BANDWIDTH&&p.attributes.BANDWIDTH?s.attributes.BANDWIDTH-p.attributes.BANDWIDTH:h-n},xhr:Ll()};function Sd(s,p){for(var h=p.media(),n=-1,u=0;u<s.length;u++)if(s[u].id===h.id){n=u;break}s.selectedIndex_=n,s.trigger({selectedIndex:n,type:"change"})}Object.keys(bt).forEach(function(s){Object.defineProperty(Mt,s,{get:function(){return J.log.warn("using Vhs."+s+" is UNSAFE be sure you know what you are doing"),bt[s]},set:function(p){J.log.warn("using Vhs."+s+" is UNSAFE be sure you know what you are doing"),"number"!=typeof p||p<0?J.log.warn("value of Vhs."+s+" must be greater than or equal to 0"):bt[s]=p}})});var Cd="videojs-vhs";function bd(){if(!window.localStorage)return null;var s=window.localStorage.getItem(Cd);if(!s)return null;try{return JSON.parse(s)}catch(p){return null}}Mt.canPlaySource=function(){return J.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")},Mt.supportsNativeHls=function(){if(!document||!document.createElement)return!1;var s=document.createElement("video");return!!J.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(p){return/maybe|probably/i.test(s.canPlayType(p))})}(),Mt.supportsNativeDash=!!(document&&document.createElement&&J.getTech("Html5").isSupported())&&/maybe|probably/i.test(document.createElement("video").canPlayType("application/dash+xml")),Mt.supportsTypeNatively=function(s){return"hls"===s?Mt.supportsNativeHls:"dash"===s&&Mt.supportsNativeDash},Mt.isSupported=function(){return J.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Xs=function(s){function p(n,u,m){var y=s.call(this,u,J.mergeOptions(m.hls,m.vhs))||this;if(m.hls&&Object.keys(m.hls).length&&J.log.warn("Using hls options is deprecated. Use vhs instead."),"number"==typeof m.initialBandwidth&&(y.options_.bandwidth=m.initialBandwidth),y.logger_=ra("VhsHandler"),u.options_&&u.options_.playerId&&((m=J(u.options_.playerId)).hasOwnProperty("hls")||Object.defineProperty(m,"hls",{get:function(){return J.log.warn("player.hls is deprecated. Use player.tech().vhs instead."),u.trigger({type:"usage",name:"hls-player-access"}),De(y)},configurable:!0}),m.hasOwnProperty("vhs")||Object.defineProperty(m,"vhs",{get:function(){return J.log.warn("player.vhs is deprecated. Use player.tech().vhs instead."),u.trigger({type:"usage",name:"vhs-player-access"}),De(y)},configurable:!0}),m.hasOwnProperty("dash")||Object.defineProperty(m,"dash",{get:function(){return J.log.warn("player.dash is deprecated. Use player.tech().vhs instead."),De(y)},configurable:!0}),y.player_=m),y.tech_=u,y.source_=n,y.stats={},y.ignoreNextSeekingEvent_=!1,y.setOptions_(),y.options_.overrideNative&&u.overrideNativeAudioTracks&&u.overrideNativeVideoTracks)u.overrideNativeAudioTracks(!0),u.overrideNativeVideoTracks(!0);else if(y.options_.overrideNative&&(u.featuresNativeVideoTracks||u.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return y.on(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(T){var S=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;S&&S.contains(y.tech_.el())?y.masterPlaylistController_.fastQualityChange_():y.masterPlaylistController_.checkABR_()}),y.on(y.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),y.on(y.tech_,"error",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),y.on(y.tech_,"play",y.play),y}ge(p,s);var h=p.prototype;return h.setOptions_=function(){var n,u=this;this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=!1!==this.options_.handleManifestRedirects,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage&&((n=bd())&&n.bandwidth&&(this.options_.bandwidth=n.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),n&&n.throughput&&(this.options_.throughput=n.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))),"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=bt.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===bt.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","experimentalBufferBasedABR","liveRangeSafeTimeDelta","experimentalLLHLS","useNetworkInformationApi","experimentalExactManifestTimings","experimentalLeastPixelDiffSelector"].forEach(function(m){void 0!==u.source_[m]&&(u.options_[m]=u.source_[m])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},h.src=function(n,u){var m=this;n&&(this.setOptions_(),this.options_.src=0===(n=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(n.substring(n.indexOf(",")+1)):n,this.options_.tech=this.tech_,this.options_.externVhs=Mt,this.options_.sourceType=ku(u),this.options_.seekTo=function(y){m.tech_.setCurrentTime(y)},this.options_.smoothQualityChange&&J.log.warn("smoothQualityChange is deprecated and will be removed in the next major version"),this.masterPlaylistController_=new pp(this.options_),u=J.mergeOptions({liveRangeSafeTimeDelta:.1},this.options_,{seekable:function(){return m.seekable()},media:function(){return m.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_}),this.playbackWatcher_=new mp(u),this.masterPlaylistController_.on("error",function(){var y=J.players[m.tech_.options_.playerId],T=m.masterPlaylistController_.error;"object"!=typeof T||T.code?"string"==typeof T&&(T={message:T,code:3}):T.code=3,y.error(T)}),u=this.options_.experimentalBufferBasedABR?Mt.movingAverageBandwidthSelector(.55):Mt.STANDARD_PLAYLIST_SELECTOR,this.masterPlaylistController_.selectPlaylist=(this.selectPlaylist||u).bind(this),this.masterPlaylistController_.selectInitialPlaylist=Mt.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(y){this.masterPlaylistController_.selectPlaylist=y.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(y){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=y,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){var y=this.masterPlaylistController_.mainSegmentLoader_.bandwidth,T=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return this.options_.useNetworkInformationApi&&T?1e7<=(T=1e3*T.downlink*1e3)&&1e7<=y?Math.max(y,T):T:y},set:function(y){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=y,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){return Math.floor(1/(1/(this.bandwidth||1)+(0<this.throughput?1/this.throughput:0)))},set:function(){J.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return m.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return m.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return m.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return m.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return m.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return m.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return m.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return m.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},mediaAppends:{get:function(){return m.masterPlaylistController_.mediaAppends_()||0},enumerable:!0},mainAppendsToLoadedData:{get:function(){return m.masterPlaylistController_.mainAppendsToLoadedData_()||0},enumerable:!0},audioAppendsToLoadedData:{get:function(){return m.masterPlaylistController_.audioAppendsToLoadedData_()||0},enumerable:!0},appendsToLoadedData:{get:function(){return m.masterPlaylistController_.appendsToLoadedData_()||0},enumerable:!0},timeToLoadedData:{get:function(){return m.masterPlaylistController_.timeToLoadedData_()||0},enumerable:!0},buffered:{get:function(){return Ka(m.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return m.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return m.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return m.tech_.name_},enumerable:!0},duration:{get:function(){return m.tech_.duration()},enumerable:!0},master:{get:function(){return m.playlists.master},enumerable:!0},playerDimensions:{get:function(){return m.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Ka(m.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return m.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){m.options_.useBandwidthFromLocalStorage&&function(y){if(window.localStorage){var T=(T=bd())?J.mergeOptions(T,y):y;try{window.localStorage.setItem(Cd,JSON.stringify(T))}catch(S){return}}}({bandwidth:m.bandwidth,throughput:Math.round(m.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){var y;(y=m).representations=function(){var T;return(T=rr(T=y.masterPlaylistController_.master())?y.masterPlaylistController_.getAudioTrackPlaylists_():T.playlists)?T.filter(function(S){return!Rs(S)}).map(function(S,x){return new Qc(y,S,S.id)}):[]}}),this.masterPlaylistController_.sourceUpdater_.on("createdsourcebuffers",function(){m.setupEme_()}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=window.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_)))},h.setupEme_=function(){var n=this,u=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,m=function(s){var p=s.player;return!(!(s=function(h,n,u){if(!h)return h;var m={};n&&n.attributes&&n.attributes.CODECS&&(m=Jr(pa(n.attributes.CODECS))),u&&u.attributes&&u.attributes.CODECS&&(m.audio=u.attributes.CODECS);var y,T=Gi(m.video),S=Gi(m.audio),x={};for(y in h)x[y]={},S&&(x[y].audioContentType=S),T&&(x[y].videoContentType=T),n.contentProtection&&n.contentProtection[y]&&n.contentProtection[y].pssh&&(x[y].pssh=n.contentProtection[y].pssh),"string"==typeof h[y]&&(x[y].url=h[y]);return J.mergeOptions(h,x)}(s.sourceKeySystems,s.media,s.audioMedia))||(p.currentSource().keySystems=s)&&!p.eme&&(J.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),1))}({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:u&&u.media()});this.player_.tech_.on("keystatuschange",function(y){"output-restricted"===y.status&&n.masterPlaylistController_.blacklistCurrentPlaylist({playlist:n.masterPlaylistController_.media(),message:"DRM keystatus changed to "+y.status+". Playlist will fail to play. Check for HDCP content.",blacklistDuration:1/0})}),11!==J.browser.IE_VERSION&&m?(this.logger_("waiting for EME key session creation"),function(s){var p=s.player,h=s.sourceKeySystems,n=s.audioMedia;if(s=s.mainPlaylists,!p.eme.initializeMediaKeys)return Promise.resolve();s=s=n?s.concat([n]):s,u=Object.keys(h),s=s.reduce(function(T,S){if(!S.contentProtection)return T;var x=u.reduce(function(A,L){var O=S.contentProtection[L];return O&&O.pssh&&(A[L]={pssh:O.pssh}),A},{});return Object.keys(x).length&&T.push(x),T},[]);var u,m=[],y=[];return s.forEach(function(T){y.push(new Promise(function(S,x){p.tech_.one("keysessioncreated",S)})),m.push(new Promise(function(S,x){p.eme.initializeMediaKeys({keySystems:T},function(A){A?x(A):S()})}))}),Promise.race([Promise.all(m),Promise.race(y)])}({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:u&&u.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){n.logger_("created EME key session"),n.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(y){n.logger_("error while creating EME key session",y),n.player_.error({message:"Failed to initialize media keys for EME",code:3})})):this.masterPlaylistController_.sourceUpdater_.initializedEme()},h.setupQualityLevels_=function(){var n=this,u=J.players[this.tech_.options_.playerId];u&&u.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=u.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){var m,y;m=n.qualityLevels_,(y=n).representations().forEach(function(T){m.addQualityLevel(T)}),Sd(m,y.playlists)}),this.playlists.on("mediachange",function(){Sd(n.qualityLevels_,n.playlists)}))},p.version=function(){return{"@videojs/http-streaming":"2.12.0","mux.js":"5.14.1","mpd-parser":"0.19.2","m3u8-parser":"4.7.0","aes-decrypter":"3.1.2"}},h.version=function(){return this.constructor.version()},h.canChangeType=function(){return _d.canChangeType()},h.play=function(){this.masterPlaylistController_.play()},h.setCurrentTime=function(n){this.masterPlaylistController_.setCurrentTime(n)},h.duration=function(){return this.masterPlaylistController_.duration()},h.seekable=function(){return this.masterPlaylistController_.seekable()},h.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&window.URL.revokeObjectURL&&(window.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),s.prototype.dispose.call(this)},h.convertToProgramTime=function(n,u){return function(s){var p=s.playlist,h=s.time,n=void 0===h?void 0:h;if(!(h=s.callback))throw new Error("getProgramTime: callback must be provided");return p&&void 0!==n?(s=function(u,m){if(!m||!m.segments||0===m.segments.length)return null;for(var y,T=0,S=0;S<m.segments.length&&!(u<=(T=(y=m.segments[S]).videoTimingInfo?y.videoTimingInfo.transmuxedPresentationEnd:T+y.duration));S++);var x=m.segments[m.segments.length-1];if(x.videoTimingInfo&&x.videoTimingInfo.transmuxedPresentationEnd<u)return null;if(T<u){if(u>T+.25*x.duration)return null;y=x}return{segment:y,estimatedStart:y.videoTimingInfo?y.videoTimingInfo.transmuxedPresentationStart:T-y.duration,type:y.videoTimingInfo?"accurate":"estimate"}}(n,p))?"estimate"===s.type?h({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:s.estimatedStart}):(p={mediaSeconds:n},(s=function(u,m){if(!m.dateTimeObject)return null;var y=u-(m.videoTimingInfo.transmuxedPresentationStart+(y=m.videoTimingInfo.transmuxerPrependedSeconds));return new Date(m.dateTimeObject.getTime()+1e3*y)}(n,s.segment))&&(p.programDateTime=s.toISOString()),h(null,p)):h({message:"valid programTime was not found"}):h({message:"getProgramTime: playlist and time must be provided"})}({playlist:this.masterPlaylistController_.media(),time:n,callback:u})},h.seekToProgramTime=function(n,u,m,y){return void 0===m&&(m=!0),void 0===y&&(y=2),Bl({programTime:n,playlist:this.masterPlaylistController_.media(),retryCount:y,pauseAfterSeek:m,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:u})},p}(J.getComponent("Component")),on={name:"videojs-http-streaming",VERSION:"2.12.0",canHandleSource:function(s,p){return p=J.mergeOptions(J.options,p=void 0===p?{}:p),on.canPlayType(s.type,p)},handleSource:function(s,p,h){return h=J.mergeOptions(J.options,h=void 0===h?{}:h),p.vhs=new Xs(s,p,h),J.hasOwnProperty("hls")||Object.defineProperty(p,"hls",{get:function(){return J.log.warn("player.tech().hls is deprecated. Use player.tech().vhs instead."),p.vhs},configurable:!0}),p.vhs.xhr=Ll(),p.vhs.src(s.src,s.type),p.vhs},canPlayType:function(s,p){return p=void 0===(p=J.mergeOptions(J.options,p=void 0===p?{}:p).vhs.overrideNative)?!J.browser.IS_ANY_SAFARI:p,!(s=ku(s))||Mt.supportsTypeNatively(s)&&!p?"":"maybe"}};return Rr("avc1.4d400d,mp4a.40.2")&&J.getTech("Html5").registerSourceHandler(on,0),J.VhsHandler=Xs,Object.defineProperty(J,"HlsHandler",{get:function(){return J.log.warn("videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead."),Xs},configurable:!0}),J.VhsSourceHandler=on,Object.defineProperty(J,"HlsSourceHandler",{get:function(){return J.log.warn("videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead."),on},configurable:!0}),J.Vhs=Mt,Object.defineProperty(J,"Hls",{get:function(){return J.log.warn("videojs.Hls is deprecated. Use videojs.Vhs instead."),Mt},configurable:!0}),J.use||(J.registerComponent("Hls",Mt),J.registerComponent("Vhs",Mt)),J.options.vhs=J.options.vhs||{},J.options.hls=J.options.hls||{},J.getPlugin&&J.getPlugin("reloadSourceOnError")||(J.registerPlugin||J.plugin)("reloadSourceOnError",function(s){md(this,s)}),J}),function(){var l=localStorage["dark-mode"],g=!1;if(l)try{g=JSON.parse(l).darkMode}catch(E){return console.warn("Error initializing angular-dark-mode"),void console.warn(E)}else g=window.matchMedia("(prefers-color-scheme: dark)").matches;document.body.classList.add("dark-mode-preloading",g?"dark-mode":"light-mode")}();